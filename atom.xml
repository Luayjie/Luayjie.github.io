<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£ç­ä¸Šçš„çŒ«</title>
  
  
  <link href="https://lukme.top/atom.xml" rel="self"/>
  
  <link href="https://lukme.top/"/>
  <updated>2024-12-05T04:38:23.646Z</updated>
  <id>https://lukme.top/</id>
  
  <author>
    <name>LuayğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>11-Prometheusæ•°æ®è¿œç«¯å­˜å‚¨</title>
    <link href="https://lukme.top/posts/ee6702b0.html"/>
    <id>https://lukme.top/posts/ee6702b0.html</id>
    <published>2024-11-25T03:23:03.000Z</published>
    <updated>2024-12-05T04:38:23.646Z</updated>
    
    <content type="html"><![CDATA[<h2 id="VicoriaMetricsæ¦‚è¿°">VicoriaMetricsæ¦‚è¿°</h2><p>VictoriaMetricsæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç»æµé«˜æ•ˆä¸”å¯æ‰©å±•çš„ç›‘æ§è§£å†³æ–¹æ¡ˆå’Œæ—¶é—´åºåˆ—æ•°æ®åº“ã€‚</p><p>å®˜ç½‘åœ°å€:<br><a href="https://victoriametrics.com/">https://victoriametrics.com/</a></p><p>å®˜æ–¹æ–‡æ¡£:<br><a href="https://docs.victoriametrics.com/">https://docs.victoriametrics.com/</a></p><p>GitHubåœ°å€:<br><a href="https://github.com/VictoriaMetrics/VictoriaMetrics">https://github.com/VictoriaMetrics/VictoriaMetrics</a></p><p>éƒ¨ç½²æ–‡æ¡£:<br><a href="https://docs.victoriametrics.com/quick-start/">https://docs.victoriametrics.com/quick-start/</a></p><h2 id="éƒ¨ç½²victoriametrics">éƒ¨ç½²victoriametrics</h2><p><strong>1. ä¸‹è½½victoriametrics</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# wget https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.16/victoria-metrics-linux-amd64-v1.93.16.tar.gz</span><br></pre></td></tr></table></figure><p>**2. è§£å‹è½¯ä»¶åŒ… **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# tar xf victoria-metrics-linux-amd64-v1.93.16.tar.gz  -C /usr/local/bin/</span><br></pre></td></tr></table></figure><p><strong>3 ç¼–å†™å¯åŠ¨è„šæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# <span class="built_in">cat</span> &gt; /etc/systemd/system/victoria-metrics.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Linux VictoriaMetrics Server</span></span><br><span class="line"><span class="string">Documentation=https://docs.victoriametrics.com/</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStart=/usr/local/bin/victoria-metrics-prod  \</span></span><br><span class="line"><span class="string">   -httpListenAddr=0.0.0.0:8428 \</span></span><br><span class="line"><span class="string">   -storageDataPath=/data/victoria-metrics \</span></span><br><span class="line"><span class="string">   -retentionPeriod=3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">[root@elk02 ~]# systemctl daemon-reload</span><br><span class="line">[root@elk02 ~]# systemctl <span class="built_in">enable</span> --now victoria-metrics.service</span><br><span class="line">[root@elk02 ~]# systemctl status victoria-metrics</span><br></pre></td></tr></table></figure><p><strong>4 æ£€æŸ¥ç«¯å£æ˜¯å¦å­˜æ´»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# ss -ntl | grep 8428</span><br><span class="line">LISTEN 0      4096              0.0.0.0:8428       0.0.0.0:*        </span><br></pre></td></tr></table></figure><p><strong>5 æŸ¥çœ‹webUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.212:8428/</span><br><span class="line">`æ­¤æ—¶ç‚¹åˆ°WebUIæ—¶å€™æœç´¢`<span class="string">&#x27;node_cpu_seconds_total&#x27;</span>  æ˜¯æ²¡æœ‰ä»»ä½•æ•°æ®çš„</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128130653976.png" alt="image-20241128130653976"></p><h2 id="prometheusé…ç½®è¿œç«¯å­˜å‚¨">prometheusé…ç½®è¿œç«¯å­˜å‚¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># åœ¨é¡¶çº§å­—æ®µä¸­é…ç½®VictoriaMetricsåœ°å€</span></span><br><span class="line">remote_write:</span><br><span class="line">  - url: http://10.0.0.212:8428/api/v1/write</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å› ä¸ºä¹‹å‰é…ç½®çš„prometheusçš„å¯åŠ¨è„šæœ¬æŒ‡å®šäº†æ•°æ®å­˜å‚¨ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œä¸ºäº†é¿å…å†²çªï¼Œä¸ä½¿ç”¨systemdæ–¹å¼å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">1.åœæ­¢prometheus</span><br><span class="line">systemctl stop prometheus-server.service </span><br><span class="line"></span><br><span class="line">2.è¿›å…¥prometheuså®‰è£…ç›®å½•</span><br><span class="line">[root@elk02:2 ~]# <span class="built_in">cd</span> /softwares/prometheus-2.53.2.linux-amd64/</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨prometheusï¼ŒæŒ‡å®šä¿®æ”¹è¿‡çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœé…ç½®æ²¡æœ‰é”™è¯¯ï¼Œå°±ä¼šå»è¿æ¥http://10.0.0.212:8428ï¼‰</span><br><span class="line">./prometheus --config.file=<span class="string">&quot;prometheus.yml&quot;</span>  </span><br><span class="line"></span><br><span class="line">4.æŸ¥çœ‹WebUI</span><br><span class="line">http://10.0.0.212:8428/</span><br><span class="line">`æ­¤æ—¶ç‚¹åˆ°WebUIæ—¶å€™æœç´¢`<span class="string">&#x27;node_cpu_seconds_total&#x27;</span> å‘ç°æ•°æ®è¿‡æ¥äº†</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128133415223.png" alt="image-20241128133415223"></p><blockquote><p>æ¸©é¦¨æç¤ºï¼š</p><p>â€‹    å¦‚æœæ­¤æ—¶æ²¡æœ‰æ•°æ®æ¥å…¥ï¼Œå°±ä¸è¦è¿›è¡Œä¸‹é¢æ­¥éª¤äº†ï¼Œä¸ç„¶å°±ä¸€ç›´æ˜¯é”™çš„ï¼Œå‡ºæ•°æ®å°±è¡Œ</p></blockquote><p><strong>4.é…ç½®grafanaçš„æ•°æ®æºåŠURL</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€‰æ‹©æ•°æ®æºè¿˜æ˜¯prometheusï¼Œåå­—åŒºåˆ†ä¸‹ï¼Œåœ°å€æ›´æ¢ä¸‹å°±è¡Œäº†</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128134037207.png" alt="image-20241128134037207"></p><h2 id="éƒ¨ç½²å‚è€ƒè¿æ¥">éƒ¨ç½²å‚è€ƒè¿æ¥</h2><p>å•ç‚¹éƒ¨ç½²å‚è€ƒé“¾æ¥:<br><a href="https://docs.victoriametrics.com/quick-start/#starting-vm-single-from-a-binary">https://docs.victoriametrics.com/quick-start/#starting-vm-single-from-a-binary</a></p><p>é›†ç¾¤éƒ¨ç½²å‚è€ƒé“¾æ¥:<br><a href="https://docs.victoriametrics.com/quick-start/#starting-vm-cluster-from-binaries">https://docs.victoriametrics.com/quick-start/#starting-vm-cluster-from-binaries</a><br><a href="https://docs.victoriametrics.com/cluster-victoriametrics/#architecture-overview">https://docs.victoriametrics.com/cluster-victoriametrics/#architecture-overview</a></p><p>éƒ¨ç½²é›†ç¾¤æ—¶è½¯ä»¶åŒ…è¦ä¸‹è½½å¯¹åº”çš„é›†ç¾¤clusterç‰ˆæœ¬:<br>wget <a href="https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.16/victoria-metrics-linux-amd64-v1.93.16-cluster.tar.gz">https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.16/victoria-metrics-linux-amd64-v1.93.16-cluster.tar.gz</a></p><p>è½¯ä»¶åŒ…ä¼šæä¾›3ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºå¯¹åº”äº†é›†ç¾¤çš„3ä¸ªç»„ä»¶<br>vmstorage:<br>å­˜å‚¨åŸå§‹æ•°æ®ï¼Œå¹¶è¿”å›ç»™å®šæ ‡ç­¾è¿‡æ»¤å™¨åœ¨ç»™å®šæ—¶é—´èŒƒå›´å†…çš„æŸ¥è¯¢æ•°æ®<br>vminsert:<br>æ¥å—æ‘„å…¥çš„æ•°æ®ï¼Œå¹¶æ ¹æ®å¯¹åº¦é‡åç§°åŠå…¶æ‰€æœ‰æ ‡ç­¾çš„ä¸€è‡´æ•£åˆ—åœ¨vmstorageèŠ‚ç‚¹ä¹‹é—´ä¼ æ’­<br>vmselect:<br>é€šè¿‡ä»æ‰€æœ‰é…ç½®çš„vmstorageèŠ‚ç‚¹è·å–æ‰€éœ€æ•°æ®æ¥æ‰§è¡Œä¼ å…¥æŸ¥è¯¢</p><p><strong>é›†ç¾¤éƒ¨ç½²VictoriaMetricsæ¶æ„</strong></p><p><img src="https://cos.lukme.top/Pic/VictoriaMetrics-cluster.png" alt="VictoriaMetricsé›†ç¾¤æ¶æ„å›¾è§£"></p>]]></content>
    
    
    <summary type="html">äº†è§£ä½¿ç”¨ VicoriaMetrics</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>10-Prometheusçš„è”é‚¦æ¨¡å¼</title>
    <link href="https://lukme.top/posts/d10c7e6f.html"/>
    <id>https://lukme.top/posts/d10c7e6f.html</id>
    <published>2024-11-24T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.740Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è”é‚¦æ¨¡å¼é…ç½®">è”é‚¦æ¨¡å¼é…ç½®</h2><p><strong>1.prometheusè”é‚¦æ¨¡å¼æ¶æ„æ¦‚è¿°</strong><br>é»˜è®¤æƒ…å†µä¸‹ï¼Œprometheusé‡‡é›†çš„æ•°æ®ä¼šå­˜å‚¨åˆ°æœ¬åœ°ï¼Œè¿™æ„å‘³è€…prometheusåœ¨è¿™ç§å·¥ä½œæ¨¡å¼ä¸‹ï¼Œå¯èƒ½ä¼šå­˜åœ¨å•æœºå­˜å‚¨çš„ç“¶é¢ˆã€‚ä¸ºäº†è§£å†³prometheuså¯¹äºæ•°æ®çš„é‡‡é›†å‹åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è”é‚¦æ¨¡å¼æ¥éƒ¨ç½²prometheusã€‚</p><blockquote><p>è¿™é‡Œ 91,92,93 èŠ‚ç‚¹åˆ†åˆ«å¯¹åº”æœ¬ç¯‡çš„ 211,212,213 èŠ‚ç‚¹</p></blockquote><p><img src="https://cos.lukme.top/Pic/prometheus-federate.jpg" alt="è”é‚¦æ¨¡å¼Prometheus server"></p><p><strong>2.éƒ¨ç½²Prometheusçš„é›†ç¾¤ç¯å¢ƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">1. 212,213èŠ‚ç‚¹éƒ¨ç½²Prometheus</span><br><span class="line">  ç•¥ï¼Œæ­¥éª¤è§01-Prometheusä»‹ç»åŠéƒ¨ç½²</span><br><span class="line"></span><br><span class="line">`212èŠ‚ç‚¹`</span><br><span class="line">2. 212èŠ‚ç‚¹é…ç½®Prometheus</span><br><span class="line">[root@elk02:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">  - job_name: <span class="string">&#x27;file-sd-discovery-212&#x27;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files:</span><br><span class="line">        - /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml</span><br><span class="line"></span><br><span class="line">3. ç¼–å†™Prometheusçš„åŸºäºæ–‡ä»¶æœåŠ¡çš„å‘ç°</span><br><span class="line">[root@elk02:0 ~]# <span class="built_in">cat</span> &gt; /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">- targets:</span></span><br><span class="line"><span class="string">  - 10.0.0.211:9100</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    &quot;tag&quot;: &quot;elk01&quot;</span></span><br><span class="line"><span class="string">    &quot;apps&quot;: &quot;yaml&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">4. æ£€æŸ¥Prometheusè¯­æ³•</span><br><span class="line">[root@elk02:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">5.Prometheusçƒ­åŠ è½½</span><br><span class="line">[root@elk02:0 ~]# curl -X POST http://10.0.0.212:9090/-/reload</span><br><span class="line"></span><br><span class="line">6.è®¿é—®Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.212:9090/targets?search=</span><br><span class="line"></span><br><span class="line">`213èŠ‚ç‚¹`</span><br><span class="line">1. 213 èŠ‚ç‚¹é…ç½®Prometheus</span><br><span class="line">[root@elk03:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">  - job_name: <span class="string">&#x27;file-sd-discovery-212&#x27;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files:</span><br><span class="line">        - /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml</span><br><span class="line"></span><br><span class="line">2.ç¼–å†™Prometheusçš„åŸºäºæ–‡ä»¶æœåŠ¡çš„å‘ç°</span><br><span class="line">[root@elk03:0 ~]# <span class="built_in">cat</span> &gt; /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">- targets:</span></span><br><span class="line"><span class="string">  - 10.0.0.212:9100</span></span><br><span class="line"><span class="string">  - 10.0.0.213:9100</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    &quot;tag&quot;: &quot;elk02/03&quot;</span></span><br><span class="line"><span class="string">    &quot;apps&quot;: &quot;yaml&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">3. æ£€æŸ¥Prometheusè¯­æ³•</span><br><span class="line">[root@elk03:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">4.Prometheusçƒ­åŠ è½½</span><br><span class="line">[root@elk03:0 ~]# curl -X POST http://10.0.0.213:9090/-/reload</span><br><span class="line"></span><br><span class="line">5.è®¿é—®Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.213:9090/targets?search=</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹211èŠ‚ç‚¹é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk01:0 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">  - job_name: <span class="string">&quot;prometheus-federate-212&quot;</span></span><br><span class="line">    metrics_path: <span class="string">&quot;/federate&quot;</span></span><br><span class="line">    honor_labels: <span class="literal">true</span></span><br><span class="line">    params:</span><br><span class="line">       <span class="string">&quot;match[]&quot;</span>:</span><br><span class="line">       - <span class="string">&#x27;&#123;job=&quot;promethues&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;job:.*&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;node.*&quot;&#125;&#x27;</span></span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.212:9090&quot;</span></span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;prometheus-federate-213&quot;</span></span><br><span class="line">    metrics_path: <span class="string">&quot;/federate&quot;</span></span><br><span class="line">    honor_labels: <span class="literal">true</span></span><br><span class="line">    params:</span><br><span class="line">       <span class="string">&quot;match[]&quot;</span>:</span><br><span class="line">       - <span class="string">&#x27;&#123;job=&quot;promethues&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;job:.*&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;node.*&quot;&#125;&#x27;</span></span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.213:9090&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.æ£€æŸ¥Prometheusè¯­æ³•</span><br><span class="line">3.Prometheusçƒ­åŠ è½½</span><br></pre></td></tr></table></figure><p><strong>4.éªŒè¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">213ä¸Šå¯æŸ¥è¯¢çš„è¯­æ³•ï¼ˆå¯è‡ªè¡Œè®¿é—®212æˆ–è€…213çš„Prometheusçš„WebUIç•Œé¢æ‰¾åˆ°promQLè¯­æ³•æŸ¥è¯¢æ”¾åœ¨211èŠ‚ç‚¹ä¸ŠéªŒè¯ï¼‰</span><br><span class="line">node_cpu_seconds_total&#123;apps=<span class="string">&quot;yaml&quot;</span>, cpu=<span class="string">&quot;0&quot;</span>, job=<span class="string">&quot;file-sd-discovery-213&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">åœ¨211ä¸ŠæŸ¥è¯¢æ˜¯å¦æœ‰ç»“æœ</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128112719771.png" alt="image-20241128112719771"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Prometheusè”é‚¦æ¨¡å¼ç¼“è§£æ•°æ®é‡‡é›†å‹åŠ›</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>09-Prometheusçš„æœåŠ¡å‘ç°</title>
    <link href="https://lukme.top/posts/86e5bc5f.html"/>
    <id>https://lukme.top/posts/86e5bc5f.html</id>
    <published>2024-11-23T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.739Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœåŠ¡å‘ç°çš„å¸¸è§ç±»åˆ«è¯´æ˜">æœåŠ¡å‘ç°çš„å¸¸è§ç±»åˆ«è¯´æ˜</h2><pre><code>- é™æ€é…ç½®ï¼š static_configsæ¯æ¬¡ä¿®æ”¹é…ç½®åï¼Œéƒ½éœ€è¦é‡æ–°åŠ è½½é…ç½®æˆ–è€…é‡å¯æœåŠ¡ã€‚- åŠ¨æ€é…ç½®æ¯æ¬¡ä¿®æ”¹åï¼Œæ— éœ€é‡æ–°åŠ è½½é…ç½®æˆ–è€…é‡å¯æœåŠ¡ã€‚å¸¸è§çš„åŠ¨æ€é…ç½®:&lt;file_sd_config&gt;åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#file_sd_config&lt;consul_sd_config&gt;åŸºäºconsulçš„æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#consul_sd_config&lt;kubernetes_sd_config&gt;åŸºäºK8Så®ç°çš„æœåŠ¡å‘ç°https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#kubernetes_sd_config&lt;dns_sd_config&gt;:åŸºäºDNSå®ç°æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#dns_sd_config&lt;docker_sd_config&gt;ï¼šåŸºäºdocker engineçš„æœåŠ¡å‘ç°https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#docker_sd_config&lt;http_sd_config&gt;ï¼šåŸºäºhttpçš„æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#http_sd_config</code></pre><h2 id="åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°">åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°</h2><p><strong>1.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">...</span><br><span class="line">  - job_name: <span class="string">&quot;linux-file-sd-config&quot;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">     - files:</span><br><span class="line">        -  /softwares/prometheus-2.53.2.linux-amd64/test.yaml</span><br><span class="line">        -  /softwares/prometheus-2.53.2.linux-amd64/test.json</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶è®¿é—®Prometheusçš„webuiï¼Œå‘ç°æ²¡æœ‰æ˜¾ç¤ºæ–°çš„æœåŠ¡</span><br><span class="line">http://10.0.0.211:9090/targets</span><br></pre></td></tr></table></figure><p><strong>2.ç¼–è¾‘æœåŠ¡å‘ç°æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">`yamlæ ¼å¼ï¼š`</span><br><span class="line">[root@elk01:5 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/test.yaml</span><br><span class="line">- targets:</span><br><span class="line">    - 10.0.0.213:9100</span><br><span class="line">    - 10.0.0.211:9100</span><br><span class="line">    - 10.0.0.212:3000</span><br><span class="line">    </span><br><span class="line">`jsonæ ¼å¼`</span><br><span class="line">[root@elk01:5 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/test.json</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;targets&quot;</span>: [ <span class="string">&quot;10.0.0.211:9100&quot;</span>,<span class="string">&quot;10.0.0.212:9100&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>3.æµ‹è¯•éªŒè¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶ä¿å­˜åç›´æ¥è®¿é—®webUIï¼Œå³å¯å‘ç°å°±å¯ä»¥æ˜¾ç¤ºäº†ï¼Œä¸éœ€è¦çƒ­åŠ è½½Prometheus</span><br><span class="line">http://10.0.0.211:9090/targets</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127135024922.png" alt="image-20241127135024922"></p><h2 id="åŸºäºæ–‡ä»¶å‘ç°å’ŒåŸºäºconsulå¯¹æ¯”">åŸºäºæ–‡ä»¶å‘ç°å’ŒåŸºäºconsulå¯¹æ¯”</h2><p>åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°æ˜¯åœ¨Prometheusæœ¬åœ°åŸºäºæŸä¸ªæ–‡ä»¶è¯»å–è¦ç›‘æ§çš„èŠ‚ç‚¹;</p><p>åŸºäºconsulæœåŠ¡å‘ç°æ˜¯éœ€è¦å•ç‹¬éƒ¨ç½²ä¸€å¥—consulé›†ç¾¤ï¼ŒPrometheus-serverå»å¯¹åº”çš„consulé›†ç¾¤è·å–éœ€è¦ç›‘æ§çš„èŠ‚ç‚¹ã€‚</p><h2 id="éƒ¨ç½²åŸºäºconsoleçš„æœåŠ¡å‘ç°">éƒ¨ç½²åŸºäºconsoleçš„æœåŠ¡å‘ç°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1 ä¸‹è½½consul</span><br><span class="line">wget https://releases.hashicorp.com/consul/1.19.2/consul_1.19.2_linux_amd64.zip</span><br><span class="line"></span><br><span class="line">2 è§£å‹consul</span><br><span class="line">unzip consul_1.19.2_linux_amd64.zip -d /usr/local/bin/</span><br><span class="line"></span><br><span class="line">3 è¿è¡Œconsul é›†ç¾¤</span><br><span class="line">æœåŠ¡ç«¯211:</span><br><span class="line">consul agent -server -bootstrap -<span class="built_in">bind</span>=10.0.0.211 -data-dir=/data/consul -client=10.0.0.211 -ui</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯212:</span><br><span class="line">consul agent  -<span class="built_in">bind</span>=10.0.0.212 -data-dir=/data/consul -client=10.0.0.212 -ui -retry-join=10.0.0.211</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯213:</span><br><span class="line">consul agent -server -<span class="built_in">bind</span>=10.0.0.213 -data-dir=/data/consul -client=10.0.0.213 -ui -retry-join=10.0.0.211</span><br><span class="line"></span><br><span class="line">4 æŸ¥çœ‹å„èŠ‚ç‚¹çš„ç›‘å¬ç«¯å£</span><br><span class="line">ss -ntl | grep 8500</span><br><span class="line"></span><br><span class="line">5 è®¿é—®consoleæœåŠ¡çš„WebUI</span><br><span class="line">http://10.0.0.213:8500/ui/dc1/nodes</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127144212517.png" alt="image-20241127144212517"></p><h2 id="åŸºäºconsulçš„æœåŠ¡å‘ç°åº”ç”¨">åŸºäºconsulçš„æœåŠ¡å‘ç°åº”ç”¨</h2><p><strong>1 ä¿®æ”¹prometheusçš„é…ç½®æ–‡ä»¶å¹¶é‡æ–°åŠ è½½é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">  ...</span><br><span class="line">  - job_name: <span class="string">&quot;Linux-consul-seriver-discovery&quot;</span></span><br><span class="line">    <span class="comment"># é…ç½®åŸºäºconsulçš„æœåŠ¡å‘ç°</span></span><br><span class="line">    consul_sd_configs:</span><br><span class="line">        <span class="comment"># æŒ‡å®šconsulçš„æœåŠ¡å™¨åœ°å€ï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤å€¼ä¸º&quot;localhost:8500&quot;.</span></span><br><span class="line">      - server: 10.0.0.213:8500</span><br><span class="line">      - server: 10.0.0.212:8500</span><br><span class="line">      - server: 10.0.0.211:8500</span><br><span class="line">    relabel_configs:</span><br><span class="line">        <span class="comment"># åŒ¹é…consulçš„æºæ ‡ç­¾å­—æ®µï¼Œè¡¨ç¤ºæœåŠ¡åç§°</span></span><br><span class="line">      - source_labels: [__meta_consul_service]</span><br><span class="line">        <span class="comment"># æŒ‡å®šæºæ ‡ç­¾çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè‹¥ä¸å®šä¹‰ï¼Œé»˜è®¤å€¼ä¸º&quot;(.*)&quot;</span></span><br><span class="line">        regex: consul</span><br><span class="line">        <span class="comment"># æ‰§è¡ŒåŠ¨ä½œä¸ºåˆ é™¤ï¼Œé»˜è®¤å€¼ä¸º&quot;replace&quot;,æœ‰æ•ˆå€¼æœ‰å¤šç§</span></span><br><span class="line">        <span class="comment">#   https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_action</span></span><br><span class="line">        action: drop</span><br><span class="line">        </span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br></pre></td></tr></table></figure><p><strong>2.è¢«ç›‘æ§èŠ‚ç‚¹æ³¨å†Œåˆ°consoleé›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk211&quot;,&quot;name&quot;:&quot;elk01&quot;,&quot;address&quot;:&quot;10.0.0.211&quot;,&quot;port&quot;:9100,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.211:9100&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line">[root@elk02 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk212&quot;,&quot;name&quot;:&quot;elk212&quot;,&quot;address&quot;:&quot;10.0.0.212&quot;,&quot;port&quot;:9100,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.212:9100&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line">[root@elk03 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk213&quot;,&quot;name&quot;:&quot;elk213&quot;,&quot;address&quot;:&quot;10.0.0.213&quot;,&quot;port&quot;:9100,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.213:9100&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`è¯¦è§£`</span><br><span class="line"><span class="string">&quot;id&quot;</span>:<span class="string">&quot;elk211&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;elk01&quot;</span>,<span class="string">&quot;address&quot;</span>:<span class="string">&quot;10.0.0.211&quot;</span>,<span class="string">&quot;port&quot;</span>:9100 ç›‘æ§211èŠ‚ç‚¹ï¼Œåœ°å€å’Œç«¯å£</span><br><span class="line">checks<span class="string">&quot;: [&#123;&quot;</span>http<span class="string">&quot;:&quot;</span>http://10.0.0.211:9100<span class="string">&quot;,&quot;</span>interval<span class="string">&quot;:&quot;</span>5m<span class="string">&quot;&#125;]&#125;&#x27;  æ£€æŸ¥èŠ‚ç‚¹ï¼Œå’Œé—´éš”æ—¶é—´</span></span><br><span class="line"><span class="string">http://10.0.0.213:8500/v1/agent/service/register                æ³¨å†Œåˆ°consoleé›†ç¾¤ï¼ˆå†™211,212,213éƒ½å¯ä»¥ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p><strong>3.æ£€æŸ¥consulçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.212:8500/ui/dc1/services</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127153448968.png" alt="image-20241127153448968"></p><p><strong>4 æ£€æŸ¥Prometheusçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.211:9090/targets?search=</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127153520806.png" alt="image-20241127153520806"></p><p><strong>5.æ³¨é”€èŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT http://10.0.0.213:8500/v1/agent/service/deregister/elk213</span><br><span class="line"></span><br><span class="line">elk213  `è¿™é‡Œå†™çš„æ˜¯<span class="built_in">id</span>ï¼Œè€Œä¸æ˜¯name`</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨POSTMANç›´æ¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼Œéœ€è¦ä½¿ç”¨PUTæ–¹æ³•ã€‚<br>PUT <a href="http://10.0.0.213:8500/v1/agent/service/deregister/elk213">http://10.0.0.213:8500/v1/agent/service/deregister/elk213</a></p><h2 id="Prometheusç›‘æ§consoleé›†ç¾¤">Prometheusç›‘æ§consoleé›†ç¾¤</h2><p>Prometheusç›‘æ§consulé›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½consul exporter</span><br><span class="line">[root@elk02:5 ~]# wget https://github.com/prometheus/consul_exporter/releases/download/v0.12.1/consul_exporter-0.12.1.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹è½¯ä»¶åŒ… </span><br><span class="line">[root@elk02:5 ~]# tar xf consul_exporter-0.12.1.linux-amd64.tar.gz  -C /usr/local/bin/ consul_exporter-0.12.1.linux-amd64/consul_exporter --strip-components=1</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨console exporter </span><br><span class="line">[root@elk02:5 ~]# consul_exporter --consul.server=<span class="string">&quot;http://10.0.0.213:8500&quot;</span> --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> --web.listen-address=:9107 </span><br><span class="line"></span><br><span class="line">4.è®¿é—®consul exporterçš„WebUI</span><br><span class="line">http://10.0.0.212:9107/metrics</span><br><span class="line"></span><br><span class="line">5.å‘consulæ³¨å†Œ(æˆ–è€…ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶ï¼Œé™æ€å‘ç°éœ€è¦çƒ­åŠ è½½Prometheus)</span><br><span class="line">[root@elk02:5 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk212-consul&quot;,&quot;name&quot;:&quot;consul-cluster&quot;,&quot;address&quot;:&quot;10.0.0.212&quot;,&quot;port&quot;:9107,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.212:9107&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line">6.è®¿é—®consulçš„WebUI</span><br><span class="line">http://10.0.0.212:8500/ui/dc1/services/consul-cluster/instances</span><br><span class="line"></span><br><span class="line">7.è®¿é—®prometheusçš„WebUI</span><br><span class="line">http://10.0.0.211:9090/targets</span><br><span class="line"></span><br><span class="line">8.grafanaå¯¼å…¥æ¨¡æ¿ID </span><br><span class="line">12049</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Prometheusçš„æœåŠ¡å‘ç°ï¼Œè®©ä½ ä¸å†éœ€è¦çƒ­åŠ è½½æˆ–è€…é‡å¯Prometheus</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>08-éƒ¨ç½²pushgetwayå’Œaltermanager</title>
    <link href="https://lukme.top/posts/2cdee406.html"/>
    <id>https://lukme.top/posts/2cdee406.html</id>
    <published>2024-11-22T03:23:03.000Z</published>
    <updated>2024-12-05T04:36:34.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨ç½²pushgatway">éƒ¨ç½²pushgatway</h2><p>Prometheusè‡ªå®šä¹‰ç›‘æ§ç»„ä»¶pushgateway<br>1.ä¸‹è½½pushgateway</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]# wget https://github.com/prometheus/pushgateway/releases/download/v1.9.0/pushgateway-1.9.0.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>2.è§£å‹è½¯ä»¶åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]# tar xf pushgateway-1.9.0.linux-amd64.tar.gz -C /softwares/</span><br></pre></td></tr></table></figure><p>3.è¿è¡Œpushgatewayç»„ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]# <span class="built_in">cd</span> /softwares/pushgateway-1.9.0.linux-amd64/</span><br><span class="line">[root@elk02:0 ~]# ./pushgateway --web.listen-address=:9091 --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> </span><br></pre></td></tr></table></figure><p>4.è®¿é—®pushgetwayç»„ä»¶çš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.212:9091</span><br></pre></td></tr></table></figure><p>5.æ¨é€æµ‹è¯•æ•°æ®åˆ°pushgatewayç»„ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk211 ~]# <span class="built_in">echo</span> <span class="string">&quot;student_online 75&quot;</span> | curl --data-binary @-  http://10.0.0.212:9091/metrics/job/student/instance/10.0.0.211</span><br></pre></td></tr></table></figure><p>6.å†æ¬¡è®¿é—®pushgetwayç»„ä»¶çš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.92:9091/#</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241124112052347.png" alt="image-20241124112052347"></p><p>7.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">...</span><br><span class="line">    - job_name: <span class="string">&quot;pushgateway&quot;</span></span><br><span class="line">      <span class="comment"># ç”¨äºè§£å†³æ ‡ç­¾çš„å†²çªé—®é¢˜ï¼Œæœ‰æ•ˆå€¼ä¸º: trueå’Œfalseï¼Œé»˜è®¤å€¼ä¸ºfalse</span></span><br><span class="line">      <span class="comment"># å½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†ä¿ç•™æŠ“å–çš„æ ‡ç­¾ä»¥å¿½ç•¥æœåŠ¡å™¨è‡ªèº«çš„æ ‡ç­¾ã€‚è¯´ç™½äº†ä¼šè¦†ç›–åŸæœ‰æ ‡ç­¾ã€‚</span></span><br><span class="line">      <span class="comment"># å½“è®¾ç½®ä¸ºfalseæ—¶ï¼Œåˆ™ä¸ä¼šè¦†ç›–åŸæœ‰æ ‡ç­¾ï¼Œè€Œæ˜¯åœ¨æ ‡ç‚¹å‰åŠ äº†ä¸€ä¸ª&quot;exported_&quot;å‰ç¼€ã€‚</span></span><br><span class="line">      honor_labels: <span class="literal">true</span></span><br><span class="line">      static_configs:</span><br><span class="line">        - targets: </span><br><span class="line">          - <span class="string">&quot;10.0.0.212:9091&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">http://10.0.0.211:9090/targets?search=</span><br></pre></td></tr></table></figure><h2 id="Alertmanagerç¯å¢ƒéƒ¨ç½²">Alertmanagerç¯å¢ƒéƒ¨ç½²</h2><p><strong>1.altermanageræ¦‚è¿°</strong><br>ç”¨äºprometheus serverçš„å‘Šè­¦åŠŸèƒ½çš„ç»„ä»¶ï¼Œç›®å‰æ”¯æŒå¤šç§å‘Šè­¦åª’ä»‹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºé‚®ä»¶å‘Šè­¦ï¼Œé’‰é’‰å‘Šè­¦ï¼Œä¼ä¸šå¾®ä¿¡å‘Šè­¦ç­‰ã€‚</p><p><strong>2.éƒ¨ç½²alermanagerç»„ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½è½¯ä»¶åŒ…</span><br><span class="line">[root@elk02:1 ~]# wget https://github.com/prometheus/alertmanager/releases/download/v0.27.0/alertmanager-0.27.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2. è§£å‹è½¯ä»¶åŒ…</span><br><span class="line">[root@elk02:1 ~]# tar xf alertmanager-0.27.0.linux-amd64.tar.gz  -C /softwares/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.ä¿®æ”¹alermanagerçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:1 ~]# vim /softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml </span><br><span class="line">global:</span><br><span class="line">  resolve_timeout: 5m</span><br><span class="line">  smtp_from: <span class="string">&#x27;1968554226@qq.com&#x27;</span></span><br><span class="line">  smtp_smarthost: <span class="string">&#x27;smtp.qq.com:465&#x27;</span></span><br><span class="line">  smtp_auth_username: <span class="string">&#x27;1968554226@qq.com&#x27;</span></span><br><span class="line">  smtp_auth_password: <span class="string">&#x27;xwghtaasufprewcb&#x27;</span></span><br><span class="line">  smtp_require_tls: <span class="literal">false</span></span><br><span class="line">  smtp_hello: <span class="string">&#x27;qq.com&#x27;</span></span><br><span class="line">route:</span><br><span class="line">  group_by: [<span class="string">&#x27;alertname&#x27;</span>]</span><br><span class="line">  group_wait: 5s</span><br><span class="line">  group_interval: 5s</span><br><span class="line">  repeat_interval: 30s</span><br><span class="line">  receiver: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">receivers:</span><br><span class="line">- name: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  email_configs:</span><br><span class="line">  - to: <span class="string">&#x27;3078155561@qq.com&#x27;</span></span><br><span class="line">    send_resolved: <span class="literal">true</span></span><br><span class="line">inhibit_rules:</span><br><span class="line">  - source_match:</span><br><span class="line">      severity: <span class="string">&#x27;critical&#x27;</span></span><br><span class="line">    target_match:</span><br><span class="line">      severity: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    equal: [<span class="string">&#x27;alertname&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;instance&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨alermanager</span><br><span class="line">[root@elk02:1 ~]# <span class="built_in">cd</span> /softwares/alertmanager-0.27.0.linux-amd64/</span><br><span class="line">[root@elk02:1 alertmanager-0.27.0.linux-amd64]# ./alertmanager </span><br><span class="line"></span><br><span class="line">5.è®¿é—®webui</span><br><span class="line">http://10.0.0.212:9093/#/status</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># Alertmanager configuration</span></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets:</span><br><span class="line">          - 10.0.0.212:9093</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load rules once and periodically evaluate them according to the global &#x27;evaluation_interval&#x27;.</span></span><br><span class="line">rule_files:</span><br><span class="line">  - <span class="string">&quot;/softwares/prometheus-2.53.2.linux-amd64/status-rules.yaml&quot;</span></span><br></pre></td></tr></table></figure><p><strong>4.ä¿®æ”¹å‘Šè­¦è§„åˆ™</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /softwares/prometheus-2.53.2.linux-amd64/status-rules.yaml &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">groups:</span></span><br><span class="line"><span class="string">- name: service_status</span></span><br><span class="line"><span class="string">  rules:</span></span><br><span class="line"><span class="string">  - alert: 10.0.0.213:9100èŠ‚ç‚¹æŒ‚æ‰å•¦</span></span><br><span class="line"><span class="string">    expr: up&#123;instance=&quot;10.0.0.213:9100&quot;&#125; == 0</span></span><br><span class="line"><span class="string">    for: 15s</span></span><br><span class="line"><span class="string">    labels:</span></span><br><span class="line"><span class="string">      service: node_exporter</span></span><br><span class="line"><span class="string">      porter: 9100</span></span><br><span class="line"><span class="string">    annotations:</span></span><br><span class="line"><span class="string">      summary: &quot;&#123;&#123; $labels.instance &#125;&#125; å·²åœæ­¢è¿è¡Œè¶…è¿‡ 15sï¼&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p><strong>5.é‡æ–°åŠ è½½Prometheusé…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127094655913.png" alt="image-20241127094655913"></p><p>6.éªŒè¯å‘Šè­¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœæ­¢elk3çš„node_exporteræœåŠ¡</span><br><span class="line">[root@elk03:0 ~]# systemctl stop node-exporter.service </span><br><span class="line"></span><br><span class="line">é—®é¢˜æœªä¿®å¤æ²¡é—´éš”30så‘ä¸€æ¬¡é‚®ä»¶ï¼ˆè‡ªå·±å¯è®¾ç½®ï¼‰</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127095054688.png" alt="image-20241127095054688"></p><p>å‘Šè­¦é‚®ä»¶</p><p><img src="https://cos.lukme.top/Pic/image-20241127095509855.png" alt="image-20241127095509855"></p><h2 id="ä¿®æ”¹å‘Šè­¦æ¨¡æ¿">ä¿®æ”¹å‘Šè­¦æ¨¡æ¿</h2><p><strong>1. å‘Šè­¦æ¨¡æ¿ä»‹ç»</strong><br>é»˜è®¤çš„å‘Šè­¦ä¿¡æ¯ç•Œé¢æœ‰äº›ç®€å•ï¼Œå¯ä»¥å€ŸåŠ©å‘Šè­¦çš„æ¨¡æ¿ä¿¡æ¯ï¼Œå¯¹å‘Šè­¦ä¿¡æ¯è¿›è¡Œä¸°å¯Œï¼Œéœ€è¦å€ŸåŠ©äºAlertmanagerçš„æ¨¡æ¿åŠŸèƒ½æ¥å®ç°ã€‚</p><p>å‘Šè­¦æ¨¡æ¿çš„ä½¿ç”¨æµç¨‹å¦‚ä¸‹:<br>- åˆ†æå…³é”®ä¿¡æ¯<br>- å®šåˆ¶æ¨¡æ¿å†…å®¹<br>- AlertmanageråŠ è½½æ¨¡æ¿æ–‡ä»¶<br>- å‘Šè­¦ä¿¡æ¯ä½¿ç”¨æ¨¡æ¿å†…å®¹å±æ€§</p><p>æ¨¡æ¿æ–‡ä»¶ä½¿ç”¨æ ‡å‡†Goæ¨¡æ¿è¯­æ³•ï¼Œå¹¶æš´éœ²ä¸€äº›åŒ…å«æ—¶é—´æ ‡ç­¾å’Œå€¼çš„å˜é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ ‡ç­¾å¼•ç”¨: &#123;&#123; <span class="variable">$label</span>.&lt;label_name&gt; &#125;&#125;</span><br><span class="line">æŒ‡æ ‡æ ·æœ¬å€¼å¼•ç”¨: &#123;&#123; <span class="variable">$value</span> &#125;&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ˜¾å¼æ•ˆæœï¼Œéœ€è¦äº†è§£ä¸€äº›htmlç›¸å…³æŠ€æœ¯ï¼Œå‚è€ƒé“¾æ¥:<br><a href="https://www.w3school.com.cn/html/index.asp">https://www.w3school.com.cn/html/index.asp</a></p><p><strong>2.è‡ªå®šä¹‰æ¨¡æ¿</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ç›®å½•</span><br><span class="line">[root@elk02:0 ~]# <span class="built_in">mkdir</span> /softwares/alertmanager-0.27.0.linux-amd64/tmpl</span><br><span class="line">[root@elk02:0 tmpl]# <span class="built_in">cat</span> email.tmpl</span><br><span class="line">&#123;&#123; define <span class="string">&quot;alert.html&quot;</span> &#125;&#125;</span><br><span class="line">&lt;h1 style=<span class="string">&#x27;color: red;&#x27;</span>&gt;æœåŠ¡å¼‚å¸¸å‘Šè­¦&lt;/h1&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="built_in">tr</span>&gt;</span><br><span class="line">                &lt;th&gt;æŠ¥è­¦é¡¹&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;å®ä¾‹&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;æŠ¥è­¦é˜€å€¼&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;å¼€å§‹æ—¶é—´&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &#123;&#123; range <span class="variable">$i</span>, <span class="variable">$alert</span> := .Alerts &#125;&#125;</span><br><span class="line">                &lt;<span class="built_in">tr</span>&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; index <span class="variable">$alert</span>.Labels <span class="string">&quot;alertname&quot;</span> &#125;&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; index <span class="variable">$alert</span>.Labels <span class="string">&quot;instance&quot;</span> &#125;&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; index <span class="variable">$alert</span>.Annotations <span class="string">&quot;value&quot;</span> &#125;&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; <span class="variable">$alert</span>.StartsAt &#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">        &#123;&#123; end &#125;&#125;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&#123;&#123; end &#125;&#125;</span><br></pre></td></tr></table></figure><p><strong>3.alertmanagerå¼•ç”¨è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 temp]# vim /softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml </span><br><span class="line"><span class="comment">#åŠ è½½æ¨¡æ¿</span></span><br><span class="line">templates:</span><br><span class="line">  - <span class="string">&#x27;./tmpl/*.tmpl&#x27;</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">receivers:</span><br><span class="line">- name: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  email_configs:</span><br><span class="line">  - to: <span class="string">&#x27;3078155561@qq.com&#x27;</span></span><br><span class="line">    send_resolved: <span class="literal">true</span></span><br><span class="line">    <span class="comment"># æ·»åŠ æ­¤è¡Œï¼Œå®šåˆ¶é‚®ä»¶çš„æ ‡é¢˜ï¼Œå¯¹äº&quot;&#123;&#123;&#125;&#125;&quot;å±æ€§ç”¨äºåŠ è½½å…¶ä»–ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨å•å¼•å·æ‹¬ä½ã€‚</span></span><br><span class="line">    headers: &#123; Subject: <span class="string">&quot;[WARN] æŠ¥è­¦é‚®ä»¶&quot;</span> &#125;</span><br><span class="line">    <span class="comment"># æ·»åŠ æ­¤è¡Œï¼Œè°ƒç”¨æ¨¡æ¿æ˜¾å¼é‚®ä»¶æ­£æ–‡ï¼Œå¯¹äº&quot;&#123;&#125;&quot;ä¸éœ€è¦ä½¿ç”¨å•å¼•å·ï¼Œå¦åˆ™æœåŠ¡å¯åŠ¨ä¸æˆåŠŸã€‚</span></span><br><span class="line">    html: <span class="string">&#x27;&#123;&#123; template &quot;alert.html&quot; . &#125;&#125;&#x27;</span></span><br><span class="line">      <span class="comment">#alter.htmlæ˜¯æ¨¡æ¿é‡Œå®šä¹‰çš„çš„defineï¼Œ.ä»£è¡¨çš„æ˜¯åŠ è½½</span></span><br></pre></td></tr></table></figure><p><strong>4.altermanagerè¯­æ³•æ£€æŸ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 alertmanager-0.27.0.linux-amd64]# <span class="built_in">pwd</span></span><br><span class="line">/softwares/alertmanager-0.27.0.linux-amd64</span><br><span class="line">[root@elk02:0 alertmanager-0.27.0.linux-amd64]# ./amtool check-config ./alertmanager.yml </span><br><span class="line">Checking <span class="string">&#x27;./alertmanager.yml&#x27;</span>  SUCCESS</span><br><span class="line">Found:</span><br><span class="line"> - global config</span><br><span class="line"> - route</span><br><span class="line"> - 1 inhibit rules</span><br><span class="line"> - 1 receivers</span><br><span class="line"> - 1 templates</span><br><span class="line">  SUCCESS</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">#altermanagerè‡ªå¸¦çš„è¯­æ³•æ£€æŸ¥</span></span><br></pre></td></tr></table></figure><p><strong>5.é‡æ–°å¯åŠ¨altermanager</strong></p><p>ä¸Šé¢æˆ‘ä»¬å®šåˆ¶é‚®ä»¶å†…å®¹ä¸­åŒ…å«é˜ˆå€¼çš„éƒ¨åˆ†ï¼Œè€Œæˆ‘ä»¬åœ¨è§„åˆ™ä¸­å¹¶æ²¡æœ‰æŒ‡å®šï¼Œæ‰€ä»¥prometheuséœ€è¦ä¿®æ”¹ä»¥ä¸‹è§„åˆ™æ–‡ä»¶ã€‚</p><p><strong>6.ä¿®æ”¹è§„åˆ™æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/status-rules.yaml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    annotations:</span><br><span class="line">      summary: <span class="string">&quot;&#123;&#123; .instance &#125;&#125; å·²åœæ­¢è¿è¡Œè¶…è¿‡ 15sï¼&quot;</span></span><br><span class="line">      value: <span class="string">&quot;&#123;&#123; <span class="variable">$value</span> &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>7.æ£€æŸ¥Prometheusé…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br></pre></td></tr></table></figure><p><strong>è®¿é—®prometheusçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.91:9090/rules</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127104621570.png" alt="image-20241127104621570"></p><p><strong>8.éªŒè¯æµ‹è¯•</strong></p><p>åœæ‰exporteræœåŠ¡</p><p><img src="https://cos.lukme.top/Pic/image-20241127110010277.png" alt="image-20241127110010277"></p><p>ä¾æ®æ¨¡æ¿å¯ä»¥å°†å‘Šè­¦å’Œæ¢å¤æ¨¡æ¿åˆ†å¼€ï¼Œä½¿ç”¨ä¸åŒæ¨¡æ¿é€šçŸ¥</p><p>æ¨èé˜…è¯»:<br><a href="https://prometheus.io/docs/alerting/latest/configuration/">https://prometheus.io/docs/alerting/latest/configuration/</a></p>]]></content>
    
    
    <summary type="html">éƒ¨ç½²ç›‘æ§ç»„å»ºpushgetwayå’Œå‘Šè­¦ç»„ä»¶altermanager</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>07-ç›‘æ§nginxå’Œtomcat</title>
    <link href="https://lukme.top/posts/750619ba.html"/>
    <id>https://lukme.top/posts/750619ba.html</id>
    <published>2024-11-21T03:23:03.000Z</published>
    <updated>2024-12-05T04:40:27.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Prometheusç›‘æ§nginx">Prometheusç›‘æ§nginx</h2><h3 id="1-ç¼–è¯‘å®‰è£…nginx">1 ç¼–è¯‘å®‰è£…nginx</h3><p>1.1 å®‰è£…ç¼–è¯‘å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CentOSï¼š</span><br><span class="line">yum -y install git wget gcc make zlib-devel gcc-c++ libtool openssl openssl-devel</span><br><span class="line"></span><br><span class="line">Ubuntuï¼š</span><br><span class="line">[root@elk93 ~]# apt -y install git wget gcc make zlib1g-dev build-essential libtool openssl libssl-dev</span><br></pre></td></tr></table></figure><p>1.2 å…‹éš†nginx-module-vtsæ¨¡å—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/vozlt/nginx-module-vts.git</span><br><span class="line"></span><br><span class="line">å¦‚æœä¸Šè¿°è¿æ¥ä¸å¥½ç”¨ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢ä»£ç :</span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/jasonyin2020/nginx-module-vts.git</span><br></pre></td></tr></table></figure><p>1.3 ä¸‹è½½nginxè½¯ä»¶åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 ~]# wget https://nginx.org/download/nginx-1.26.2.tar.gz</span><br></pre></td></tr></table></figure><p>1.4 è§£å‹nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 ~]# tar xf nginx-1.26.2.tar.gz </span><br><span class="line"></span><br><span class="line">[root@elk93 ~]# ll nginx-1.26.2</span><br><span class="line">total 860</span><br><span class="line">drwxr-xr-x  8  502 staff   4096 Aug 13 00:39 ./</span><br><span class="line">drwx------ 10 root root    4096 Sep  5 14:35 ../</span><br><span class="line">drwxr-xr-x  6  502 staff   4096 Sep  5 14:35 auto/</span><br><span class="line">-rw-r--r--  1  502 staff 327851 Aug 13 00:39 CHANGES</span><br><span class="line">-rw-r--r--  1  502 staff 501527 Aug 13 00:39 CHANGES.ru</span><br><span class="line">drwxr-xr-x  2  502 staff   4096 Sep  5 14:35 conf/</span><br><span class="line">-rwxr-xr-x  1  502 staff   2611 Aug 12 22:28 configure*</span><br><span class="line">drwxr-xr-x  4  502 staff   4096 Sep  5 14:35 contrib/</span><br><span class="line">drwxr-xr-x  2  502 staff   4096 Sep  5 14:35 html/</span><br><span class="line">-rw-r--r--  1  502 staff   1397 Aug 12 22:28 LICENSE</span><br><span class="line">drwxr-xr-x  2  502 staff   4096 Sep  5 14:35 man/</span><br><span class="line">-rw-r--r--  1  502 staff     49 Aug 12 22:28 README</span><br><span class="line">drwxr-xr-x  9  502 staff   4096 Aug 13 00:39 src/</span><br></pre></td></tr></table></figure><p>1.5 é…ç½®nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Centosï¼š</span><br><span class="line"><span class="built_in">cd</span> nginx-1.22.1</span><br><span class="line">./configure --prefix=/softwares/nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--without-http_gzip_module \</span><br><span class="line">--with-pcre \</span><br><span class="line">--with-file-aio \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-stream_ssl_module \</span><br><span class="line">--with-stream_realip_module \</span><br><span class="line">--add-module=/root/nginx-module-vts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ubuntu:</span><br><span class="line">[root@elk93 ~]# <span class="built_in">cd</span> nginx-1.26.2/</span><br><span class="line">[root@elk93 nginx-1.26.2]# </span><br><span class="line">[root@elk93 nginx-1.26.2]# ./configure --prefix=/softwares/nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --without-http_rewrite_module --with-http_stub_status_module --without-http_gzip_module  --with-file-aio --with-stream --with-stream_ssl_module --with-stream_realip_module --add-module=/root/nginx-module-vts</span><br></pre></td></tr></table></figure><p>1.6 ç¼–è¯‘å¹¶å®‰è£…nginx</p><pre><code>[root@elk93 nginx-1.26.2]# make -j 2 &amp;&amp; make install</code></pre><p>1.7 ä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 nginx-1.26.2]# vim /softwares/nginx/conf/nginx.conf</span><br><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">    vhost_traffic_status_zone;</span><br><span class="line">    upstream linux-promethues &#123;</span><br><span class="line">       server 10.0.0.31:9090;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    server &#123;</span><br><span class="line">        ...</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            <span class="comment"># index  index.html index.htm;</span></span><br><span class="line">            proxy_pass http://linux-promethues;</span><br><span class="line">        &#125;</span><br><span class="line">    location /status &#123;</span><br><span class="line">        vhost_traffic_status_display;</span><br><span class="line">        vhost_traffic_status_display_format html;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.8 æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 nginx-1.26.2]# /softwares/nginx/sbin/nginx -t</span><br><span class="line">nginx: the configuration file /softwares/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /softwares/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure><p>1.9 å¯åŠ¨nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 nginx-1.26.2]# /softwares/nginx/sbin/nginx</span><br></pre></td></tr></table></figure><p>1.10 è®¿é—®nginxçš„çŠ¶æ€é¡µé¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.93/status/format/prometheus</span><br></pre></td></tr></table></figure><h3 id="2-å®‰è£…nginx-vtx-exporter">2 å®‰è£…nginx-vtx-exporter</h3><p>2.1 ä¸‹è½½nginx-vtx-exporter</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CentOSï¼š</span><br><span class="line">wget https://github.com/hnlq715/nginx-vts-exporter/releases/download/v0.10.3/nginx-vts-exporter-0.10.3.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">ä¸å»ºè®®ä¸‹è½½æ›´é«˜ç‰ˆæœ¬ï¼Œå› ä¸ºå…¶ä¼šæå‡å¯¹GLICçš„ç‰ˆæœ¬è¦æ±‚ï¼Œå¯ä»¥é€šè¿‡<span class="string">&quot; strings /lib64/libc.so.6 | grep GLIBC_ &quot;</span>æŸ¥çœ‹é»˜è®¤æ˜¯2.17ç‰ˆæœ¬ï¼Œè‹¥ä½¿ç”¨è¾ƒé«˜ç‰ˆæœ¬åˆ™éœ€è¦2.32+</span><br><span class="line"></span><br><span class="line">Ubuntu:</span><br><span class="line">wget https://github.com/sysulq/nginx-vts-exporter/releases/download/v0.10.8/nginx-vtx-exporter_0.10.8_linux_amd64.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2.2 è§£å‹è½¯ä»¶åŒ…åˆ°pathè·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk92 ~]# tar xf nginx-vtx-exporter_0.10.8_linux_amd64.tar.gz -C /usr/local/bin/ nginx-vtx-exporter</span><br></pre></td></tr></table></figure><p>2.3 è¿è¡Œnginx-vtx-exporter</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk92 ~]# nginx-vtx-exporter -nginx.scrape_uri=http://10.0.0.93/status/format/json</span><br></pre></td></tr></table></figure><p>2.4 è®¿é—®æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.92:9913/metrics</span><br><span class="line">http://10.0.0.93/status/format/prometheus</span><br></pre></td></tr></table></figure><h3 id="3-é…ç½®prometheusé‡‡é›†nginxæ•°æ®">3 é…ç½®prometheusé‡‡é›†nginxæ•°æ®</h3><p>3.1 ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">scrape_configs:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;nginx-exporter&quot;</span></span><br><span class="line">    metrics_path: <span class="string">&quot;/status/format/prometheus&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.93:80&quot;</span></span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;nginx-vts-exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.92:9913&quot;</span></span><br><span class="line">          ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½         ï¼ˆå‰é¢æ–‡ç« éƒ½æœ‰æœªèµ˜è¿°ï¼‰</span></span><br></pre></td></tr></table></figure><p>3.2 æŸ¥çœ‹Prometheusçš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.91:9090/targets?</span><br></pre></td></tr></table></figure><p>3.3 å¯¼å…¥grafanaæ¨¡æ¿</p><pre><code>2949</code></pre><h2 id="prometheusç›‘æ§tomcat">prometheusç›‘æ§tomcat</h2><p>éƒ¨ç½²tomcat-exporter<br>1 åŸºäºDockerfileæ„å»ºtomcat-exporter<br>å‚è€ƒé“¾æ¥ï¼š<br>[root@elk93 ~]# git clone <a href="https://gitee.com/jasonyin2020/tomcat-exporter.git">https://gitee.com/jasonyin2020/tomcat-exporter.git</a></p><p>2 ç¼–è¯‘tomcat exporteré•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 ~]# <span class="built_in">cd</span> tomcat-exporter/</span><br><span class="line">[root@elk93 tomcat-exporter]# ll</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x  5 root root 4096 Sep  5 15:02 ./</span><br><span class="line">drwx------ 11 root root 4096 Sep  5 15:02 ../</span><br><span class="line">-rw-r--r--  1 root root   96 Sep  5 15:02 build.sh</span><br><span class="line">-rw-r--r--  1 root root  503 Sep  5 15:02 Dockerfile</span><br><span class="line">drwxr-xr-x  8 root root 4096 Sep  5 15:02 .git/</span><br><span class="line">drwxr-xr-x  2 root root 4096 Sep  5 15:02 libs/</span><br><span class="line">-rw-r--r--  1 root root 3407 Sep  5 15:02 metrics.war</span><br><span class="line">drwxr-xr-x  2 root root 4096 Sep  5 15:02 myapp/</span><br><span class="line">-rw-r--r--  1 root root  191 Sep  5 15:02 README.md</span><br><span class="line">-rw-r--r--  1 root root 7604 Sep  5 15:02 server.xml</span><br><span class="line">[root@elk93 tomcat-exporter]# </span><br><span class="line">[root@elk93 tomcat-exporter]# bash build.sh </span><br></pre></td></tr></table></figure><p>3.è¿è¡Œtomcat exporteré•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 tomcat-exporter]# docker run -p 28080:8080 -d --name tomcat-server registry.cn-hangzhou.aliyuncs.com/yinzhengjie-k8s/tomcat9-app:v1</span><br><span class="line">81926f3514f0531a462d289a022b6dbb12c4d68f2023e9c947ad9d8766d0fb90</span><br></pre></td></tr></table></figure><p>4.è®¿é—®tomcatåº”ç”¨</p><pre><code>http://10.0.0.93:28080/metrics/http://10.0.0.93:28080/myapp/</code></pre><p>5 é…ç½®prometheusç›‘æ§tomcatåº”ç”¨</p><p>5.1 ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">...</span><br><span class="line">scrape_configs:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;tomcat-exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: </span><br><span class="line">        - <span class="string">&quot;10.0.0.93:28080&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br></pre></td></tr></table></figure><p>5.2 æŸ¥çœ‹Prometheusçš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.91:9090/targets</span><br></pre></td></tr></table></figure><p>5.3 å¯¼å…¥grafanaæ¨¡æ¿</p><pre><code>ç”±äºå®˜æ–¹çš„æ”¯æŒå¹¶ä¸å‹å¥½ï¼Œå¯ä»¥åœ¨GitHubè‡ªè¡Œæœç´¢ç›¸åº”çš„tomcatç›‘æ§æ¨¡æ¿ã€‚ å‚è€ƒé“¾æ¥:https://github.com/nlighten/tomcat_exporter/blob/master/dashboard/example.json</code></pre>]]></content>
    
    
    <summary type="html">å¸¦ä½ äº†è§£ä½¿ç”¨Prometheusç›‘æ§ELKé›†ç¾¤</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>06-ç›‘æ§dockerå®¹å™¨åŠæ•°æ®åº“</title>
    <link href="https://lukme.top/posts/668ffa27.html"/>
    <id>https://lukme.top/posts/668ffa27.html</id>
    <published>2024-11-20T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.736Z</updated>
    
    <content type="html"><![CDATA[<h1>ç›‘æ§docker</h1><p><strong>ç¯å¢ƒå‡†å¤‡</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>elk01</td><td>10.0.0.211</td><td>PrometheusæœåŠ¡ç«¯</td></tr><tr><td>elk02</td><td>10.0.0.212</td><td>ä½œä¸ºdockerçš„è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…dockerï¼Œcadvisor</td></tr><tr><td>elk03</td><td>10.0.0.213</td><td>ä½œä¸ºdockerçš„è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…dockerï¼Œcadvisor</td></tr></tbody></table><p>Prometheusç›‘æ§dockerå®¹å™¨ç¯å¢ƒ<br>1.cadVisor<br>cadVisoræ˜¯Googleå…¬å¸å¼€æºçš„ä¸€æ¬¾å®¹å™¨ç›‘æ§å·¥å…·ï¼Œæ”¯æŒdockerï¼Œpodmanå®¹å™¨ç®¡ç†å·¥å…·çš„ç›‘æ§ã€‚</p><p>GitHubåœ°å€:<br><a href="https://github.com/google/cadvisor">https://github.com/google/cadvisor</a></p><p><strong>ä¸¤å°éœ€è¦æœºå™¨èƒ½å¤Ÿç¿»å¢™ï¼Œå› ä¸ºæ‹‰å–çš„æ˜¯è°·æ­Œå®¹å™¨é•œåƒä»“åº“</strong></p><p><strong>æˆ‘æœ‰cadvisoré•œåƒï¼Œæ‰€æœ‰ç›´æ¥å¯¼å…¥å°±è¡Œäº†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@elk02:~# docker load  &lt; cadvisor-amd64-0.49.1.tar.gz </span><br><span class="line">root@elk03:~# docker load  &lt; cadvisor-amd64-0.49.1.tar.gz </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">åç»­è€ƒè™‘æä¾›cadvisoré•œåƒ</span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">  -v /:/rootfs:ro \</span><br><span class="line">  -v /var/run:/var/run:ro \</span><br><span class="line">  -v /sys:/sys:ro \</span><br><span class="line">  -v /var/lib/docker/:/var/lib/docker:ro \</span><br><span class="line">  -v /dev/disk/:/dev/disk:ro \</span><br><span class="line">  -p 18080:8080 \</span><br><span class="line">  -d  \</span><br><span class="line">  --name=cadvisor \</span><br><span class="line">  --privileged \</span><br><span class="line">  --device=/dev/kmsg \</span><br><span class="line">  gcr.io/cadvisor/cadvisor-amd64:v0.49.1</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">å¯ä»¥å°ä½¿ç”¨dockerhubé‡Œçš„cadvisorï¼Œé•œåƒæ¢ä¸ºgoogle/cadvisor:latest  </span><br></pre></td></tr></table></figure><p><strong>è®¿é—®æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:1 ~]# curl -s 10.0.0.213:18080/metrics | <span class="built_in">head</span> -3</span><br><span class="line"><span class="comment"># HELP cadvisor_version_info A metric with a constant &#x27;1&#x27; value labeled by kernel version, OS version, docker version, cadvisor version &amp; cadvisor revision.</span></span><br><span class="line"><span class="comment"># TYPE cadvisor_version_info gauge</span></span><br><span class="line">cadvisor_version_info&#123;cadvisorRevision=<span class="string">&quot;6f3f25ba&quot;</span>,cadvisorVersion=<span class="string">&quot;v0.49.1&quot;</span>,dockerVersion=<span class="string">&quot;&quot;</span>,kernelVersion=<span class="string">&quot;5.15.0-124-generic&quot;</span>,osVersion=<span class="string">&quot;Alpine Linux v3.18&quot;</span>&#125; 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ–è€…æµè§ˆå™¨è®¿é—®</span><br><span class="line">http://10.0.0.212:18080/containers/</span><br></pre></td></tr></table></figure><p><strong>prometheuså®šä¹‰è¦ç›‘æ§çš„dockerä¸»æœº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;docker&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.212:18080</span><br><span class="line">        - 10.0.0.213:18080</span><br><span class="line">        </span><br><span class="line">2.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">3.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span><br><span class="line">[root@elk02 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">4.grafanaå¯¼å…¥å¯¹åº”çš„æ¨¡æ¿Id</span><br><span class="line">315</span><br><span class="line">10619</span><br></pre></td></tr></table></figure><h1>ç›‘æ§æ•°æ®åº“</h1><h2 id="ç›‘æ§MySQL">ç›‘æ§MySQL</h2><p><strong>mysqlæœ¬èº«å¹¶ä¸æ”¯æŒmetricsæ¥å£ï¼Œå› æ­¤éœ€è¦ç‹¬ç«‹éƒ¨ç½²mysql-exporteræ¥æä¾›metricsæ¥å£ã€‚</strong></p><p><strong>è¿™é‡Œä½¿ç”¨dockeréƒ¨ç½²MySQLï¼Œä½¿ç”¨Prometheusç›‘æ§MySQL(ä¸å†èµ˜è¿°dockerå®‰è£…éƒ¨ç½²äº†)</strong></p><p>GitHubåœ°å€:</p><p><a href="https://github.com/prometheus/mysqld_exporter/releases/download/v0.16.0/mysqld_exporter-0.16.0.linux-amd64.tar.gz">https://github.com/prometheus/mysqld_exporter/releases/download/v0.16.0/mysqld_exporter-0.16.0.linux-amd64.tar.gz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½mysql_exporter</span><br><span class="line">[root@elk02:1 ~]# wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.16.0/mysqld_exporter-0.16.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.æ‹‰å–é•œåƒ</span><br><span class="line">[root@elk02:1 ~]# docker pull mysql:8.3.0-oracle</span><br><span class="line"></span><br><span class="line">3.éƒ¨ç½²MySQLæ•°æ®åº“ </span><br><span class="line">[root@elk02:1 ~]# docker run --name mysql-server -t \</span><br><span class="line">             -e MYSQL_DATABASE=<span class="string">&quot;linux&quot;</span> \</span><br><span class="line">             -e MYSQL_USER=<span class="string">&quot;luay&quot;</span> \</span><br><span class="line">             -e MYSQL_PASSWORD=<span class="string">&quot;123&quot;</span> \</span><br><span class="line">             -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="string">&quot;yes&quot;</span> \</span><br><span class="line">             --restart unless-stopped \</span><br><span class="line"> --network host \</span><br><span class="line">             -d mysql:8.3.0-oracle \</span><br><span class="line">             --character-set-server=utf8mb4 --collation-server=utf8mb4_bin \</span><br><span class="line">             --default-authentication-plugin=mysql_native_password</span><br><span class="line"></span><br><span class="line">4.æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</span><br><span class="line">[root@elk02:1 ~]# docker ps -l</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS      </span><br><span class="line">a069ae1367ff   mysql:8.3.0-oracle   <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   5 seconds ago   Up 4 seconds</span><br><span class="line"></span><br><span class="line">[root@elk02:1 ~]# netstat -lntup|grep 3306</span><br><span class="line">tcp6       0      0 :::3306      :::*      LISTEN      38663/mysqld       </span><br><span class="line">tcp6       0      0 :::33060     :::*      LISTEN      38663/mysqld </span><br><span class="line"></span><br><span class="line">5.è§£å‹è½¯ä»¶åŒ…(åé¢æ­¥éª¤æ„æ€æ˜¯å°†mysqld_exporterç›´æ¥è§£å‹åˆ°/usr/local/bin/ä¸‹ï¼Œè·³è¿‡ä¸€å±‚ç›®å½•)</span><br><span class="line">tar xf mysqld_exporter-0.15.1.linux-amd64.tar.gz -C /usr/local/bin/ mysqld_exporter-0.15.1.linux-amd64/mysqld_exporter  --strip-components=1</span><br><span class="line"></span><br><span class="line">6.åˆ›å»ºMySQLçš„é…ç½®ï¼ŒæŒ‡å®šé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">[root@elk02:1 ~]#  <span class="built_in">cat</span> &gt; /root/.my.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">user=luay</span></span><br><span class="line"><span class="string">password=123</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">7.è¿è¡Œmysqld-exporter</span><br><span class="line">[root@elk02:1 ~]# mysqld_exporter --mysqld.address=<span class="string">&quot;10.0.0.212:3306&quot;</span> --web.listen-address=:9104 --config.my-cnf=<span class="string">&quot;/root/.my.cnf&quot;</span></span><br><span class="line"></span><br><span class="line">8.è®¿é—®mysqld-exporterçš„webui</span><br><span class="line">http://10.0.0.212:9104/metrics</span><br><span class="line"></span><br><span class="line">9.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;mysql&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.212:9104</span><br><span class="line">        </span><br><span class="line">10.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">11.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span><br><span class="line">[root@elk02 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">12.æ£€æŸ¥Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.211:9090/targets</span><br><span class="line"></span><br><span class="line">13.grafanaå¯¼å…¥å¯¹åº”çš„æ¨¡æ¿ID</span><br><span class="line">17320</span><br><span class="line">18949</span><br><span class="line">14057</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§redis">ç›‘æ§redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1.æ‹‰å–é•œåƒ</span><br><span class="line">[root@elk02:1 ~]# docker pull redis:7.2.5</span><br><span class="line"></span><br><span class="line">2.ä¸‹è½½redis_exporter</span><br><span class="line">[root@elk02:1 ~]# wget https://github.com/oliver006/redis_exporter/releases/download/v1.62.0/redis_exporter-v1.62.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨redis</span><br><span class="line">[root@elk02:1 ~]# docker run -d --name redis-sever --network host redis:7.2.5 </span><br><span class="line"></span><br><span class="line">[root@elk02:1 ~]# netstat -lntup|grep 6379</span><br><span class="line">tcp     0   0 0.0.0.0:6379     0.0.0.0:*   LISTEN      39212/redis-server</span><br><span class="line">tcp6    0   0 :::6379          :::*        LISTEN      39212/redis-server</span><br><span class="line"></span><br><span class="line">4.è§£å‹è½¯ä»¶åŒ… </span><br><span class="line">[root@elk02:1 ~]# tar xf redis_exporter-v1.62.0.linux-amd64.tar.gz -C /usr/local/bin/ redis_exporter-v1.62.0.linux-amd64/redis_exporter --strip-components=1</span><br><span class="line"></span><br><span class="line">5.å¯åŠ¨redis-exporter</span><br><span class="line">[root@elk92 ~]# redis_exporter -redis.addr redis://10.0.0.212:6379 -web.telemetry-path /metrics -web.listen-address :9121</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹redis_exporterå¸®åŠ©</span></span><br><span class="line">[root@elk02:1 ~]# redis_exporter -h</span><br><span class="line"></span><br><span class="line">5.æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.212:9121/metrics</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123135827708.png" alt="image-20241123135827708"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.è¿›å…¥redisæ•°æ®åº“</span><br><span class="line">[root@elk02:2 ~]# docker <span class="built_in">exec</span> -it redis-sever redis-cli --raw -n 1</span><br><span class="line">127.0.0.1:6379[1]&gt; </span><br><span class="line"></span><br><span class="line">2.å†™å…¥æ•°æ®</span><br><span class="line">127.0.0.1:6379[1]&gt; <span class="built_in">set</span> name zhangsan </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; get name</span><br><span class="line">zhangsan</span><br><span class="line">127.0.0.1:6379[1]&gt; <span class="built_in">set</span> age 18</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; get age</span><br><span class="line">18</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">name</span><br><span class="line">age</span><br><span class="line">127.0.0.1:6379[1]&gt; </span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123140117078.png" alt="image-20241123140117078"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;redis&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.212:9121</span><br><span class="line">        </span><br><span class="line">10.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">11.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span><br><span class="line">[root@elk02 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">12.æ£€æŸ¥Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.211:9021/targets</span><br><span class="line"></span><br><span class="line">13.grafanaå¯¼å…¥å¯¹åº”çš„æ¨¡æ¿ID</span><br><span class="line">763</span><br><span class="line">14091</span><br><span class="line">14615</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Prometheusç›‘æ§dockerå®¹å™¨åŠdockerèµ·çš„æ•°æ®åº“</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>05-ç›‘æ§CPU</title>
    <link href="https://lukme.top/posts/2471ba3e.html"/>
    <id>https://lukme.top/posts/2471ba3e.html</id>
    <published>2024-11-19T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.736Z</updated>
    
    <content type="html"><![CDATA[<p><strong>ç›‘æ§CPUçš„ä½¿ç”¨æƒ…å†µæ¡ˆä¾‹</strong><br>1 ç»Ÿè®¡å„ä¸ªèŠ‚ç‚¹CPUçš„ä½¿ç”¨ç‡<br>1.1 æˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°CPUç›¸å…³çš„KEY</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total</span><br></pre></td></tr></table></figure><p>1.2 è¿‡æ»¤å‡ºCPUçš„ç©ºé—²æ—¶é—´({mode=â€˜idleâ€™})å’Œå…¨éƒ¨CPUçš„æ—¶é—´(â€˜{}â€™)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;<span class="attribute">mode</span>=<span class="string">&#x27;idle&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤CPUçš„ç©ºé—²æ—¶é—´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;&#125;</span><br><span class="line">æ­¤å¤„çš„<span class="string">&#x27;&#123;&#125;&#x27;</span>å¯ä»¥ä¸å†™ï¼Œå› ä¸ºé‡Œé¢æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä»£è¡¨è·å–CPUçš„æ‰€æœ‰çŠ¶æ€æ—¶é—´ã€‚</span><br></pre></td></tr></table></figure><p>1.3 ç»Ÿè®¡1åˆ†é’Ÿå†…CPUçš„å¢é‡æ—¶é—´</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">increase</span><span class="params">(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[<span class="number">1</span>m])</span></span></span><br></pre></td></tr></table></figure><p>ç»Ÿè®¡1åˆ†é’Ÿå†…CPUç©ºé—²çŠ¶æ€çš„å¢é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">increase(node_cpu_seconds_total[1m])</span><br></pre></td></tr></table></figure><p>ç»Ÿè®¡1åˆ†é’Ÿå†…CPUæ‰€æœ‰çŠ¶æ€çš„å¢é‡ã€‚</p><p>1.4 å°†ç»“æœè¿›è¡ŒåŠ å’Œç»Ÿè®¡</p><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">sum</span><span class="params">(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[<span class="number">1</span>m])</span></span>)</span><br></pre></td></tr></table></figure><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total[1m]))</span><br></pre></td></tr></table></figure><p>1.5 æŒ‰ç…§ä¸åŒèŠ‚ç‚¹è¿›è¡Œåˆ†ç»„</p><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ï¼Œå¹¶æŒ‰ç…§æœºå™¨å®ä¾‹è¿›è¡Œåˆ†ç»„ã€‚</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>&#123;mode=&#x27;idle&#x27;&#125;[<span class="number">1</span>m])) by (<span class="name">instance</span>)</span><br></pre></td></tr></table></figure><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ï¼Œå¹¶æŒ‰ç…§æœºå™¨å®ä¾‹è¿›è¡Œåˆ†ç»„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total[1m])) by (instance)</span><br></pre></td></tr></table></figure><p>1.6 è®¡ç®—1åˆ†é’Ÿå†…CPUç©ºé—²æ—¶é—´çš„ç™¾åˆ†æ¯”</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>&#123;mode=&#x27;idle&#x27;&#125;[<span class="number">1</span>m])) by (<span class="name">instance</span>) / sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>[<span class="number">1</span>m])) by (<span class="name">instance</span>)</span><br></pre></td></tr></table></figure><p>1.7 ç»Ÿè®¡1å°æ—¶å†…CPUçš„ä½¿ç”¨ç‡ï¼Œè®¡ç®—å…¬å¼: (1 - CPUç©ºé—²æ—¶é—´çš„ç™¾åˆ†æ¯”) * 100%ã€‚</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span> - sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>&#123;mode=&#x27;idle&#x27;&#125;[<span class="number">1</span>h])) by (<span class="name">instance</span>) / sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>[<span class="number">1</span>h])) by (<span class="name">instance</span>)) * <span class="number">100</span></span><br></pre></td></tr></table></figure><p>1.8 ç»Ÿè®¡1åˆ†é’Ÿå†…CPUçš„ä½¿ç”¨ç‡ï¼Œè®¡ç®—å…¬å¼: (1 - CPUç©ºé—²æ—¶é—´çš„ç™¾åˆ†æ¯”) * 100%ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1 - <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total[1m])) by (instance)) * 100</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123101647287.png" alt="image-20241123101647287"></p><p>2 è®¡ç®—CPUç”¨æˆ·æ€çš„1åˆ†é’Ÿå†…ç™¾åˆ†æ¯”</p><pre><code>sum(increase(node_cpu_seconds_total&#123;mode='user'&#125;[1m])) by (instance) / sum(increase(node_cpu_seconds_total[1m])) by (instance) * 100</code></pre><p>3 è®¡ç®—CPUå†…æ ¸æ€çš„1åˆ†é’Ÿå†…ç™¾åˆ†æ¯”</p><pre><code>(sum(increase(node_cpu_seconds_total&#123;mode='system'&#125;[1m])) by (instance) / sum(increase(node_cpu_seconds_total[1m])) by (instance)) * 100</code></pre><p>4 è®¡ç®—CPU IOç­‰å¾…æ—¶é—´çš„1åˆ†é’Ÿå†…ç™¾åˆ†æ¯”</p><pre><code>(sum(increase(node_cpu_seconds_total&#123;mode='iowait'&#125;[1m])) by (instance) / sum(increase(node_cpu_seconds_total[1m])) by (instance)) * 100</code></pre><p><strong>ä»¥æ­¤æ·»åŠ ä»¥ä¸Š2,3,4è¯­æ³•æ•ˆæœå¦‚ä¸‹</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123101831485.png" alt="image-20241123101831485"></p><p><strong>ä¿å­˜dashboard</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123102158402.png" alt="image-20241123102158402"></p><p><strong>å¦‚ä½•å®ç°ç±»ä¼¼è¿™æ ·é€‰æ‹©æ•ˆæœï¼Ÿ</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123102014754.png" alt="image-20241123102014754"></p><h2 id="grafanaçš„å˜é‡å®šä¹‰">grafanaçš„å˜é‡å®šä¹‰</h2><p><img src="https://cos.lukme.top/Pic/image-20241123102621980.png" alt="image-20241123102621980"></p><p><img src="https://cos.lukme.top/Pic/image-20241123103440922.png" alt="image-20241123103440922"></p><p><strong>åº”ç”¨ä¿å­˜åå†æ¬¡æŸ¥çœ‹è¿™ä¸ªdashboard</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123103551574.png" alt="image-20241123103551574"></p><p>==ä¸è¿‡æ­¤æ—¶æˆ‘ä»¬ç‚¹å‡»æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰å†™çš„promQLæ˜¯ç›´æ¥å†™æ­»çš„æ²¡æœ‰ä½¿ç”¨å˜é‡==</p><p><strong>æ›¿æ¢å¦‚ä¸‹å˜é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;iowait&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance)) * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(1 - <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance)) * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;system&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance)) * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;user&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) * 100</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123104039207.png" alt="image-20241123104039207"></p><p><strong>å†æ¬¡å›åˆ°dashboardéªŒè¯ç‚¹å‡»æ˜¯å¦æœ‰å˜åŒ–ï¼ˆåªéªŒè¯äº†ä¸€ä¸ªï¼‰</strong></p><p>==å¾ˆæ˜æ˜¾å˜åŒ–äº†==</p><p><img src="D:/PixPin/History/recording.gif" alt="recording"></p><h2 id="è‡ªå®šä¹‰å˜é‡ç±»å‹">è‡ªå®šä¹‰å˜é‡ç±»å‹</h2><p><img src="https://cos.lukme.top/Pic/image-20241123105342511.png" alt="image-20241123105342511"></p><h2 id="dashboardå¤‡ä»½">dashboardå¤‡ä»½</h2><p><strong>ç‚¹å‡»åˆ°æ¨¡æ¿çš„è®¾ç½®ï¼Œé€‰æ‹©json model</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123111303063.png" alt="image-20241123111303063"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Prometheusç›‘æ§CPUå¹¶å‡ºå›¾å±•ç¤º</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>04-ç›‘æ§ELKç³»åˆ—</title>
    <link href="https://lukme.top/posts/750619ba.html"/>
    <id>https://lukme.top/posts/750619ba.html</id>
    <published>2024-11-18T03:23:03.000Z</published>
    <updated>2024-12-05T04:38:04.407Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›‘æ§zookeeperé›†ç¾¤">ç›‘æ§zookeeperé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ä¿®æ”¹zookeeperé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03:2 ~]# vim /app/zookeeper/conf/zoo.cfg </span><br><span class="line">Â·Â·Â·</span><br><span class="line">metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span><br><span class="line">metricsProvider.httpHost=0.0.0.0</span><br><span class="line">metricsProvider.httpPort=7000</span><br><span class="line">metricsProvider.exportJvmInfo=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg root@10.0.0.212:/app/zookeeper/conf/</span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg root@10.0.0.213:/app/zookeeper/conf/</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.é‡å¯zookeeperé›†ç¾¤</span></span><br><span class="line">[root@elk01 ~]# zkServer.sh restart</span><br><span class="line">[root@elk02 ~]# zkServer.sh restart</span><br><span class="line">[root@elk03 ~]# zkServer.sh restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æµ‹è¯•è®¿é—®zookeeperçš„ç›‘å¬ç«¯å£æ˜¯å¦æ­£å¸¸</span></span><br><span class="line">[root@elk03 ~]# curl -s 10.0.0.211:7000/metrics | <span class="built_in">head</span> -3</span><br><span class="line"><span class="comment"># HELP approximate_data_size approximate_data_size</span></span><br><span class="line"><span class="comment"># TYPE approximate_data_size gauge</span></span><br><span class="line">approximate_data_size 15794.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.Prometheusé…ç½®zookeeper </span></span><br><span class="line">[root@elk03:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;zookeeper&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.211:7000</span><br><span class="line">        - 10.0.0.212:7000</span><br><span class="line">        - 10.0.0.213:7000</span><br><span class="line">        </span><br><span class="line"><span class="comment">#6.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#7.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span></span><br><span class="line">[root@elk211 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#8. æµè§ˆå™¨åˆ·æ–°è®¿é—®,åœ¨targeté‡Œå³å¯çœ‹åˆ°è¢«ç›‘æ§ç«¯</span></span><br><span class="line">10.0.0.211:9090/targets</span><br><span class="line"></span><br><span class="line"><span class="comment">#grafanaå¯¼å…¥æ¨¡æ¿ID</span></span><br><span class="line">10465</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§kafkaé›†ç¾¤">ç›‘æ§kafkaé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®˜æ–¹  https://prometheus.io/docs/instrumenting/exporters/  æœç´¢kafka exporter</span></span><br><span class="line"></span><br><span class="line">1.ä¸‹è½½kafka exporter </span><br><span class="line">wget https://github.com/danielqsj/kafka_exporter/releases/download/v1.8.0/kafka_exporter-1.8.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹kafka exporterè½¯ä»¶åŒ… å¹¶åšè½¯è¿æ¥</span><br><span class="line">[root@elk01:3 ~]# tar xf kafka_exporter-1.8.0.linux-amd64.tar.gz -C /app/</span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">ln</span> -s  /app/kafka_exporter-1.8.0.linux-amd64/ /app/kafka-exporter</span><br><span class="line"></span><br><span class="line">3.è¿è¡Œkafka exporterç¨‹åºæš´éœ²kafkaé›†ç¾¤çš„æŒ‡æ ‡æä¾›httpæ¥å£ï¼Œä»¥ä¾›Prometheusè¯†åˆ«</span><br><span class="line">[root@elk01:3 ~]# /app/kafka-exporter/kafka_exporter \</span><br><span class="line">--web.listen-address=<span class="string">&quot;:9308&quot;</span> --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> \</span><br><span class="line">--kafka.server=elk211:9092 --kafka.server=elk212:9092  \</span><br><span class="line">--kafka.server=elk213:9092 --kafka.version=<span class="string">&quot;3.8.0&quot;</span></span><br><span class="line"></span><br><span class="line">4.è®¿é—®kafka exporteræµ‹è¯•</span><br><span class="line">http://10.0.0.213:9308/metrics</span><br><span class="line"></span><br><span class="line">5.Prometheusé…ç½®ç›‘æ§kafka</span><br><span class="line">[root@elk03:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    - job_name: <span class="string">&quot;kafka&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.213:9308 </span><br><span class="line">        </span><br><span class="line">6.æ£€æµ‹Prometheusè¯­æ³•</span><br><span class="line">7.çƒ­åŠ è½½Prometheus</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§elasticsearché›†ç¾¤">ç›‘æ§elasticsearché›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½elasticsearch exporter </span><br><span class="line">[root@elk01:3 ~]# wget https://github.com/prometheus-community/elasticsearch_exporter/releases/download/v1.7.0/elasticsearch_exporter-1.7.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹è½¯ä»¶åŒ…</span><br><span class="line">[root@elk01:3 ~]# tar xf elasticsearch_exporter-1.7.0.linux-amd64.tar.gz -C /app</span><br><span class="line"></span><br><span class="line">3.è¿è¡Œelasticsearch exporteræš´éœ²ESé›†ç¾¤çš„ç›‘æ§æŒ‡æ ‡ä¸ºhttpæ¥å£ï¼Œä¾›ç»™PrometheusæŠ“å–æ•°æ®</span><br><span class="line">[root@elk01:3 ~]# /app/elasticsearch_exporter-1.7.0.linux-amd64/elasticsearch_exporter \</span><br><span class="line">--web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> \</span><br><span class="line">--web.listen-address=:9114 \</span><br><span class="line">--es.all \</span><br><span class="line">--es.uri=<span class="string">&quot;http://elastic:123456@10.0.0.211:9200&quot;</span></span><br><span class="line"></span><br><span class="line">4.è®¿é—®elasticsearch exporterçš„WebUI</span><br><span class="line">http://10.0.0.212:9114/metrics</span><br><span class="line"></span><br><span class="line">5.Prometheusé…ç½®ç›‘æ§kafka</span><br><span class="line">[root@elk03:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    - job_name: <span class="string">&quot;es&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.213:9114</span><br><span class="line">        </span><br><span class="line">6.æ£€æµ‹Prometheusè¯­æ³•</span><br><span class="line">7.çƒ­åŠ è½½Prometheus</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¸¦ä½ äº†è§£ä½¿ç”¨Prometheusç›‘æ§ELKé›†ç¾¤</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>03-grafanaå‡ºå›¾</title>
    <link href="https://lukme.top/posts/c9c8c45c.html"/>
    <id>https://lukme.top/posts/c9c8c45c.html</id>
    <published>2024-11-17T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.733Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…éƒ¨ç½²grafana">å®‰è£…éƒ¨ç½²grafana</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç½‘å€ï¼š https://grafana.com/grafana/download/9.5.21?pg=get&amp;plcmt=selfmanaged-box1-cta1</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.å®‰è£…è½¯ä»¶åŒ…ï¼ˆé€‰æ‹©9ç‰ˆæœ¬çš„æœ€æ–°ç‰ˆï¼‰</span></span><br><span class="line">[root@elk01:0 ~]# yum install -y https://dl.grafana.com/enterprise/release/grafana-enterprise-9.5.21-1.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.é…ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">[root@elk01:0 ~]# systemctl <span class="built_in">enable</span> --now grafana-server </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.è®¿é—®grafanaçš„WebUI</span></span><br><span class="line">http://10.0.0.211:3000/login</span><br><span class="line"></span><br><span class="line">é¦–æ¬¡ç™»å½•ç”¨æˆ·åå’Œå¯†ç å‡ä¸ºadminï¼Œç™»å½•ç‚¹å‡»åé¢ç›´æ¥ç‚¹å‡»skipè·³è¿‡ä¿®æ”¹å¯†ç </span><br></pre></td></tr></table></figure><h2 id="é…ç½®Prometheusæ•°æ®æº">é…ç½®Prometheusæ•°æ®æº</h2><p><img src="https://cos.lukme.top/Pic/image-20241122135329713.png" alt="image-20241122135329713"></p><p><img src="https://cos.lukme.top/Pic/image-20241122135413189.png" alt="image-20241122135413189"></p><p><img src="https://cos.lukme.top/Pic/image-20241122135559291.png" alt="image-20241122135559291"></p><p><strong>ä¸‹æ‹‰æ‰¾åˆ°ä¿å­˜saveå³å¯</strong></p><h2 id="å¯¼å…¥æ¨¡æ¿">å¯¼å…¥æ¨¡æ¿</h2><p><a href="https://grafana.com/grafana/dashboards/?search=node">å®˜æ–¹dashboardï¼Œç‚¹å‡»ç›´è¾¾ï¼Œæœç´¢nodeæŸ¥çœ‹æ¨¡æ¿</a></p><p>æ‰¾åˆ°åˆé€‚æ¨¡æ¿çŸ¥é“æ¨¡æ¿idå¯¼å…¥grafana</p><p><img src="https://cos.lukme.top/Pic/image-20241122135814095.png" alt="image-20241122135814095"></p><p><img src="https://cos.lukme.top/Pic/image-20241122141944442.png" alt="image-20241122141944442"></p><blockquote><p>è¿˜æœ‰ä¸ªæ¨¡æ¿8919ä»…ä¾›å‚è€ƒ</p></blockquote><p><strong>CPUå‹æµ‹åæ•°æ®æ˜æ˜¾äº†</strong><img src="https://cos.lukme.top/Pic/image-20241122142250940.png" alt="image-20241122142250940"></p><h2 id="åˆ›å»ºè‡ªå·±çš„æ¨¡æ¿">åˆ›å»ºè‡ªå·±çš„æ¨¡æ¿</h2><p><img src="https://cos.lukme.top/Pic/image-20241123094852067.png" alt="image-20241123094852067"></p><p><strong>Add  visualization</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123095639123.png" alt="image-20241123095639123"></p><p><strong>==åˆ›å»ºdashboardä»¥åŠå‡ºå›¾è§05-ç›‘æ§CPUä½¿ç”¨æƒ…å†µ==</strong></p><h2 id="grafanaä¿®æ”¹æ¨¡æ¿">grafanaä¿®æ”¹æ¨¡æ¿</h2><p><strong>ä»¥æ™®ç½—ç±³æ¨¡æ¿11277ä¸ºä¾‹</strong></p><p><strong>å¯¼å…¥æ¨¡æ¿</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1726060882752.png" alt="QQ_1726060882752"></p><p><img src="https://cos.lukme.top/Pic/image-20240911212345131.png" alt="image-20240911212345131"></p><p><img src="https://cos.lukme.top/Pic/image-20240911212434248.png" alt="image-20240911212434248"></p><h2 id="ä¿®æ”¹æ¨¡æ¿">ä¿®æ”¹æ¨¡æ¿</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å»æ™®ç½—ç±³é‡Œå‘ç°æ–°ç°ç‰ˆprometheusçš„projectæ”¹ä¸ºäº†jobï¼Œæ‰€æœ‰ä¸‹ä¸€æ­¥ä¿®æ”¹å˜é‡</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/recording.gif" alt="recording"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°†projectæ”¹ä¸ºjobï¼Œå¹¶ä¸”åˆ æ‰ä¸æ”¯æŒçš„project</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Prometheusæ¥å…¥grafanaå‡ºå›¾å±•ç¤º</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>02-prometheuså¸¸ç”¨å‡½æ•°ä»‹ç»</title>
    <link href="https://lukme.top/posts/7c8bc612.html"/>
    <id>https://lukme.top/posts/7c8bc612.html</id>
    <published>2024-11-16T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.731Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Prometheuså¸¸ç”¨çš„å‡½æ•°</strong></p><h2 id="increase">increase</h2><p>increaseå‡½æ•°:<br>ç”¨æ¥é’ˆå¯¹counteræ•°æ®ç±»å‹ï¼Œæˆªå–å…¶ä¸­ä¸€æ®µæ—¶é—´æ€»çš„å¢é‡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ€»æ—¶é—´å¢é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;10.0.0.211:9100&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[1m])</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122125610115.png" alt="image-20241122125610115"></p><blockquote><p>ä¸€åˆ†é’Ÿå†…ç©ºé—²59sï¼ŒCPUå¤ªé—²äº†ï¼Œå‹æµ‹ä¸€æ³¢</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.å®‰è£…å‹åŠ›æµ‹è¯•å·¥å…·</span></span><br><span class="line">[root@elk02 ~]# yum install -y stress</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.å‹åŠ›æµ‹è¯•CPU</span></span><br><span class="line">[root@elk03:1 ~]# stress --cpu 8 --io 4 --vm 2 --vm-bytes 128M --<span class="built_in">timeout</span> 10m</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122130528444.png" alt="image-20241122130528444"></p><h2 id="sum">sum</h2><p>sumå‡½æ•°:<br>åŠ å’Œçš„ä½œç”¨ã€‚ ï¼ˆå°†ä¸‹æ–¹å›¾1æ‰€æœ‰ç»“æœç´¯åŠ ï¼Œä¸åˆ†ç»„ï¼‰</p><p>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ€»æ—¶é—´å¢é‡ï¼Œå¹¶å°†è¿”å›ç»“æœç´¯åŠ ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>,cpu=<span class="string">&#x27;0&#x27;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122131145124.png" alt="image-20241122131145124"></p><p><img src="https://cos.lukme.top/Pic/image-20241122131116002.png" alt="image-20241122131116002"></p><h2 id="by">by</h2><p>byå‡½æ•°:<br>å°†æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç±»ä¼¼äºMySQLçš„&quot;GROUP BY&quot;ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹CPUç©ºé—²çŠ¶æ€ï¼Œå¹¶å°†ç»“æœè¿›è¡Œç´¯åŠ ï¼ŒåŸºäºinstanceè¿›è¡Œåˆ†ç»„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>,cpu=<span class="string">&#x27;0&#x27;</span>&#125;[1m])) by (instance)</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122131653295.png" alt="image-20241122131653295"></p><h2 id="rate">rate</h2><p>rateå‡½æ•°:<br>å®ƒçš„åŠŸèƒ½æ˜¯æŒ‰ç…§è®¾ç½®çš„æ—¶é—´æ®µï¼Œå–counteråœ¨è¿™ä¸ªæ—¶é—´æ®µä¸­å¹³å‡æ¯ç§’çš„å¢é‡ã€‚<br>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.212:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ¯ç§’çš„å¢é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(node_cpu_seconds_total&#123;instance=<span class="string">&quot;10.0.0.212:9100&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>,cpu=<span class="string">&#x27;0&#x27;</span>&#125;[1m])</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122132326591.png" alt="image-20241122132326591"></p><p>increaseå’Œrateå¦‚ä½•é€‰æ‹©:<br>(1)å¯¹äºé‡‡é›†æ•°æ®é¢‘ç‡è¾ƒä½çš„åœºæ™¯å»ºè®®ä½¿ç”¨increaseå‡½æ•°ï¼Œå› ä¸ºä½¿ç”¨rateå‡½æ•°å¯èƒ½ä¼šå‡ºç°æ–­ç‚¹,æ¯”å¦‚é’ˆå¯¹ç¡¬ç›˜å®¹é‡ç›‘æ§ã€‚<br>(2)å¯¹äºé‡‡é›†æ•°æ®é¢‘ç‡è¾ƒé«˜çš„åœºæ™¯å»ºè®®ä½¿ç”¨rateå‡½æ•°ï¼Œæ¯”å¦‚é’ˆå¯¹CPUï¼Œå†…å­˜ï¼Œç½‘ç»œæµé‡ç­‰éƒ½æ˜¯å¯ä»¥åŸºäºrateå‡½æ•°æ¥é‡‡é›†ç­‰ã€‚</p><h2 id="topk">topk</h2><p>topkå‡½æ•°:<br>å–å‰å‡ ä½çš„æœ€é«˜å€¼ï¼Œå®é™…ä½¿ç”¨çš„æ—¶å€™ä¸€èˆ¬ä¼šç”¨è¯¥å‡½æ•°è¿›è¡Œç¬æ—¶æŠ¥è­¦ï¼Œè€Œä¸æ˜¯ä¸ºäº†è§‚å¯Ÿæ›²çº¿å›¾ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:<br>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹CPUï¼Œæ‰€æœ‰çŠ¶æ€ä½¿ç”¨çš„æ¯ç§’çš„å¢é‡ï¼ŒåªæŸ¥çœ‹å‰3ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topk(3,rate(node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122132911868.png" alt="image-20241122132911868"></p><p><img src="https://cos.lukme.top/Pic/image-20241122133011958.png" alt="image-20241122133011958"></p><h2 id="count">count</h2><p>countå‡½æ•°:<br>æŠŠæ•°å€¼ç¬¦åˆæ¡ä»¶çš„ï¼Œè¾“å‡ºæ•°ç›®è¿›è¡Œç´¯åŠ åŠ å’Œã€‚<br>æ¯”å¦‚è¯´ä¼ä¸šä¸­æœ‰100å°æœåŠ¡å™¨ï¼Œå¦‚æœåªæœ‰10å°æœåŠ¡å™¨CPUä½¿ç”¨ç‡é«˜äº80%æ—¶å€™æ˜¯ä¸éœ€è¦æŠ¥è­¦çš„ï¼Œä½†æ˜¯æ•°é‡è¶…è¿‡70å°æ—¶å°±éœ€è¦æŠ¥è­¦äº†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:<br>count(tcp_wait_conn &gt; 500):<br>å‡è®¾tcp_wait_connæ˜¯å’±ä»¬è‡ªå®šä¹‰çš„KEYã€‚<br>è‹¥TCPç­‰å¾…æ•°é‡å¤§äº500çš„æœºå™¨æ•°é‡å°±åˆ¤æ–­æ¡ä»¶ä¸ºçœŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¹ç»Ÿè®¡çš„ç»“æœè¿›è¡Œè®¡æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line">count(rate(node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122133509836.png" alt="image-20241122133509836"></p><p>7 å…¶ä»–å‡½æ•°</p><p>æ¨èé˜…è¯»:<br><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/">https://prometheus.io/docs/prometheus/latest/querying/functions/</a></p>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡ä»‹ç»äº†Prometheusçš„å¸¸ç”¨å‡½æ•°</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>01-prometheusä»‹ç»åŠéƒ¨ç½²</title>
    <link href="https://lukme.top/posts/d9386973.html"/>
    <id>https://lukme.top/posts/d9386973.html</id>
    <published>2024-11-15T03:23:03.000Z</published>
    <updated>2024-12-05T03:37:04.631Z</updated>
    
    <content type="html"><![CDATA[<h2 id="prometheusä»‹ç»">prometheusä»‹ç»</h2><p>1.ä»€ä¹ˆæ˜¯Prometheus<br>Prometheusæ˜¯ä¸€æ¬¾ç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥ç›‘æ§ä¼ ç»Ÿä¸šåŠ¡ï¼ˆtomcatï¼Œnginxï¼Œmysqlï¼Œredisï¼Œelasticsearchï¼‰ï¼Œè¿˜èƒ½å¤Ÿç›‘æ§äº‘åŸç”Ÿä¸šåŠ¡ï¼Œæ¯”å¦‚dockerï¼Œk8sç›‘æ§ã€‚</p><p><strong>å®˜æ–¹é“¾æ¥:</strong><br><a href="https://prometheus.io/docs/introduction/overview/#architecture">https://prometheus.io/docs/introduction/overview/#architecture</a></p><p>æ¨èé˜…è¯»:</p><pre><code>äº‘åŸç”ŸCNCFå®˜ç½‘:    https://landscape.cncf.io/Prometheusçš„GitHubåœ°å€:    https://github.com/prometheus/prometheusPrometheusçš„å®˜ç½‘åœ°å€:    https://prometheus.io/</code></pre><p><img src="https://cos.lukme.top/Pic/image-20241121163541907.png" alt="image-20241121163541907"></p><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>elk01</td><td>10.0.0.211</td><td>PrometheusæœåŠ¡ç«¯ï¼Œå®‰è£…Prometheusã€node exporeter</td></tr><tr><td>elk02</td><td>10.0.0.212</td><td>è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…node exporeter</td></tr><tr><td>elk03</td><td>10.0.0.213</td><td>è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…node exporeter</td></tr></tbody></table><blockquote><p>æˆ‘çš„ç¯å¢ƒä½¿ç”¨çš„æ˜¯ä¹‹å‰éƒ¨ç½²elkçš„ç¯å¢ƒï¼Œä¸»æœºåæ‰€ä»¥éƒ½æ˜¯elkï¼Œâ€”æ— å…³ç´§è¦</p></blockquote><h2 id="äºŒè¿›åˆ¶éƒ¨ç½²prometheus">äºŒè¿›åˆ¶éƒ¨ç½²prometheus</h2><p><strong>æœ¬ç¯‡ä½¿ç”¨çš„æ˜¯ä¸€é”®å®‰è£…æ–¹å¼è„šæœ¬éƒ¨ç½²ï¼Œå®‰è£…ç›®å½•éƒ½åœ¨/softwareç›®å½•ä¸‹</strong>k8sé˜¶æ®µå¯ä»¥ä½¿ç”¨äº‘åŸç”Ÿæ–¹å¼éƒ¨ç½²</p><p>**1.ä¸‹è½½Prometheus server **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# wget https://github.com/prometheus/prometheus/releases/download/v2.53.3/prometheus-2.53.3.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>**2.è§£å‹è½¯ä»¶åŒ… **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# tar xf prometheus-2.53.2.linux-amd64.tar.gz -C /app/</span><br><span class="line">[root@elk01 ~]# <span class="built_in">ln</span> -s /app/prometheus-2.53.2.linux-amd64/ /app/prometheus</span><br></pre></td></tr></table></figure><p>**3.å¯åŠ¨Prometheus server **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# <span class="built_in">cd</span> /app/prometheus/ &amp;&amp; ./prometheus </span><br></pre></td></tr></table></figure><p><strong>4.è®¿é—®Prometheusçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.211:9090</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨å®‰è£…è„šæœ¬ä¸€é”®å®‰è£…prometheus,è½¯ä»¶åŒ…æ”¾åœ¨åŒçº§ç›®å½•çš„downloadé‡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 auto_install_prometheus-server]# <span class="built_in">cat</span> install-prometheus-server.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># auther: lugaojie</span></span><br><span class="line"><span class="comment"># blog: www.lukme.top</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VERSION=2.53.2</span><br><span class="line">ARCH=amd64</span><br><span class="line">SOFTWARE=prometheus-<span class="variable">$&#123;VERSION&#125;</span>.linux-<span class="variable">$&#123;ARCH&#125;</span>.tar.gz</span><br><span class="line">URL=https://github.com/prometheus/prometheus/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line">DOWNLOAD=./download          <span class="comment">#æŒ‡å®šè½¯ä»¶ä¸‹è½½ç›®å½•</span></span><br><span class="line">INSTALLDIR=/softwares</span><br><span class="line">BASEDIR=<span class="variable">$&#123;INSTALLDIR&#125;</span>/prometheus-<span class="variable">$&#123;VERSION&#125;</span>.linux-amd64</span><br><span class="line">DATADIR=/data/prometheus</span><br><span class="line">LOGDIR=/var/log/prometheus</span><br><span class="line">HOSTIP=0.0.0.0</span><br><span class="line">PORT=9090</span><br><span class="line">HOSTNAME=`hostname`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">prepare</span></span>() &#123;</span><br><span class="line"><span class="comment"># åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œ-dæŒ‡å®šç›®å½•ï¼Œ-oå¯ä»¥æŒ‡å®šå±ä¸»ï¼Œ-gæŒ‡å®šæ•°ç»„</span></span><br><span class="line">[ -d <span class="variable">$INSTALLDIR</span> ] || install -d  <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line">[ -d <span class="variable">$DOWNLOAD</span> ] || install -d <span class="variable">$&#123;DOWNLOAD&#125;</span></span><br><span class="line">[ -d <span class="variable">$DATADIR</span> ] || install -d <span class="variable">$&#123;DATADIR&#125;</span></span><br><span class="line">[ -d <span class="variable">$LOGDIR</span> ] || install -d <span class="variable">$&#123;LOGDIR&#125;</span></span><br><span class="line"></span><br><span class="line">. /etc/os-release</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ID</span>&quot;</span> == <span class="string">&quot;centos&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"> <span class="comment"># åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å®‰è£…wget</span></span><br><span class="line"> [ -f /usr/bin/wget ] || yum -y install wget</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¸‹è½½</span></span><br><span class="line">[ -s <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> ] || wget <span class="variable">$URL</span> -O <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">deploy</span></span>() &#123;</span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¯å¢ƒ</span></span><br><span class="line">prepare</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹æ–‡ä»¶è½¯ä»¶åŒ…</span></span><br><span class="line">tar xf <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> -C <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯åŠ¨è„šæœ¬</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/prometheus-server.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description== Linux  Prometheus Server</span></span><br><span class="line"><span class="string">Documentation=https://prometheus.io/docs/introduction/overview/</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">ExecStart=/bin/bash -c &quot;$&#123;BASEDIR&#125;/prometheus \</span></span><br><span class="line"><span class="string">  --config.file=$&#123;BASEDIR&#125;/prometheus.yml \</span></span><br><span class="line"><span class="string">      --web.enable-lifecycle \</span></span><br><span class="line"><span class="string">      --storage.tsdb.path=$&#123;DATADIR&#125; \</span></span><br><span class="line"><span class="string">      --storage.tsdb.retention.time=60d  \</span></span><br><span class="line"><span class="string">      --web.listen-address=$&#123;HOSTIP&#125;:$&#123;PORT&#125;  \</span></span><br><span class="line"><span class="string">      --web.max-connections=65535  \</span></span><br><span class="line"><span class="string">      --storage.tsdb.retention.size=512MB \</span></span><br><span class="line"><span class="string">      --query.timeout=10s \</span></span><br><span class="line"><span class="string">      --query.max-concurrency=20 \</span></span><br><span class="line"><span class="string">      --log.level=info \</span></span><br><span class="line"><span class="string">      --log.format=json \</span></span><br><span class="line"><span class="string">      --web.read-timeout=5m &amp;&gt;&gt; $&#123;LOGDIR&#125;/prometheus-server.log&quot;</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -HUP \$MAINPID</span></span><br><span class="line"><span class="string">LimitNOFILE=65535</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  --web.enable-lifecycle                      æŒ‡å®šwebUIçš„çƒ­åŠ è½½åŠŸèƒ½</span></span><br><span class="line"><span class="comment">#  --storage.tsdb.path=$&#123;DATADIR&#125;     æŒ‡å®šå­˜å‚¨è·¯å¾„</span></span><br><span class="line"><span class="comment">#  --storage.tsdb.retention.time=60d  æŒ‡å®šä¿ç•™æ•°æ®æ—¶é—´ï¼Œé»˜è®¤15d</span></span><br><span class="line"><span class="comment">#  --web.max-connections=65535        æŒ‡å®šæœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="comment">#  --storage.tsdb.retention.size=512MBæŒ‡å®šå­˜å‚¨å—å¤§å°ï¼Œ512Mæ»šåŠ¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">#  --log.level=info                                  æŒ‡å®šæ—¥å¿—çº§åˆ«</span></span><br><span class="line"><span class="comment">#  --log.format=json                              æŒ‡å®šæ—¥å¿—æ ¼å¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æœåŠ¡è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now prometheus-server</span><br><span class="line">systemctl status prometheus-server</span><br><span class="line"><span class="built_in">sleep</span> 0.3</span><br><span class="line">ss -ntl | grep <span class="variable">$&#123;PORT&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">delete</span></span>()&#123;</span><br><span class="line">systemctl <span class="built_in">disable</span> --now prometheus-server.service</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/systemd/system/node-exporter.service <span class="variable">$BASEDIR</span> <span class="variable">$DATADIR</span> <span class="variable">$LOGDIR</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span> </span><br><span class="line"> deploy|i)</span><br><span class="line">   deploy</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;HOSTNAME&#125;</span> çš„prometheus-server å·²ç»éƒ¨ç½²æˆåŠŸ![successfully]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> delete|r)</span><br><span class="line">   delete</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;HOSTNAME&#125;</span> çš„prometheus-server å·²ç»å¸è½½æˆåŠŸ,æœŸå¾…ä¸‹æ¬¡ä½¿ç”¨~&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> *)</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> deploy[i]|delete[r]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main <span class="variable">$1</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="éƒ¨ç½²node-exporter">éƒ¨ç½²node exporter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">éƒ¨ç½²è¿‡ç¨‹åŒä¸Šï¼Œå®˜ç½‘æ‰¾åˆ°ä¸‹è½½</span><br><span class="line"></span><br><span class="line">1.#ä¸‹è½½node exporter</span><br><span class="line">[root@elk01 ~]# wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.#è§£å‹è‡³æŒ‡å®šç›®å½•</span><br><span class="line">[root@elk01 ~]# tar xf node_exporter-1.8.2.linux-amd64.tar.gz -C /app</span><br><span class="line">[root@elk01 ~]# <span class="built_in">ln</span> -s /app/node_exporter-1.8.2.linux-amd64 /app/node_exporter</span><br><span class="line"></span><br><span class="line">4.#å¯åŠ¨node_exporter</span><br><span class="line">[root@elk01 ~]# <span class="built_in">cd</span>  /app/node_exporter &amp;&amp; ./node_exporter </span><br><span class="line"></span><br><span class="line">5.#å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹åŒæ ·å®‰è£… node exporter</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨è®¿é—®ï¼ˆè¿™å°±æ˜¯æš´éœ²å‡ºæ¥çš„æ¥å£ï¼‰</span></span><br><span class="line">http://10.0.0.211:9100/metrics</span><br><span class="line">http://10.0.0.212:9100/metrics</span><br><span class="line">http://10.0.0.213:9100/metrics</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€é”®å®‰è£…exporter,è½¯ä»¶åŒ…æ”¾åœ¨åŒçº§ç›®å½•çš„downloadç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> auto-install-node-exporter/install-node-exporter.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># auther: lugaojie</span></span><br><span class="line"><span class="comment"># blog: https://www.lukme.top</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VERSION=1.8.2</span><br><span class="line">SOFTWARE=node_exporter-<span class="variable">$&#123;VERSION&#125;</span>.linux-amd64.tar.gz</span><br><span class="line">URL=https://github.com/prometheus/node_exporter/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line">DOWNLOAD=./download</span><br><span class="line">INSTALLDIR=/softwares</span><br><span class="line">BASEDIR=<span class="variable">$&#123;INSTALLDIR&#125;</span>/node_exporter-<span class="variable">$&#123;VERSION&#125;</span>.linux-amd64</span><br><span class="line">HOST=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">PORT=9100</span><br><span class="line">hostname=`hostname`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">prepare</span></span>() &#123;</span><br><span class="line"><span class="comment"># åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">[ -d <span class="variable">$INSTALLDIR</span> ] || <span class="built_in">mkdir</span> -pv <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line">[ -d <span class="variable">$DOWNLOAD</span> ] || <span class="built_in">mkdir</span> -pv <span class="variable">$&#123;DOWNLOAD&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ID</span>&quot;</span> == <span class="string">&quot;centos&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="comment"># åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å®‰è£…curl</span></span><br><span class="line">  [ -f /usr/bin/wget ] || yum -y install wget</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¸‹è½½</span></span><br><span class="line">[ -s <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> ] || wget <span class="variable">$URL</span> -O <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install</span></span>() &#123;</span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¯å¢ƒ</span></span><br><span class="line">prepare</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹æ–‡ä»¶è½¯ä»¶åŒ…</span></span><br><span class="line">tar xf <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> -C <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯åŠ¨è„šæœ¬</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/node-exporter.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description= Linux Node Exporter</span></span><br><span class="line"><span class="string">Documentation=https://prometheus.io/docs/introduction/overview/</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStart=$&#123;BASEDIR&#125;/node_exporter --web.telemetry-path=&quot;/metrics&quot; \</span></span><br><span class="line"><span class="string">--web.listen-address=$&#123;HOST&#125;:$&#123;PORT&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å°†æœåŠ¡è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">  systemctl daemon-reload</span><br><span class="line">  systemctl <span class="built_in">enable</span> --now node-exporter.service</span><br><span class="line">  systemctl status node-exporter.service</span><br><span class="line">  ss -ntl | grep 9100</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">remove</span></span>()&#123;</span><br><span class="line">systemctl <span class="built_in">disable</span> --now node-exporter.service</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/systemd/system/node-exporter.service <span class="variable">$BASEDIR</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span> </span><br><span class="line"> install|i)</span><br><span class="line">   install</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;hostname&#125;</span> çš„node-exporter å·²ç»éƒ¨ç½²æˆåŠŸ![successfully]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> remove|r)</span><br><span class="line">   remove</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;hostname&#125;</span> çš„node-exporter å·²ç»å¸è½½æˆåŠŸ,æœŸå¾…ä¸‹æ¬¡ä½¿ç”¨~&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> *)</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> install[i]|remove[r]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main <span class="variable">$1</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="ä¿®æ”¹Prometheusæ–‡ä»¶">ä¿®æ”¹Prometheusæ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01:0 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"><span class="comment">#ä¸ºäº†æµ‹è¯•ï¼Œæ‹‰å–é—´éš”æ—¶é—´å¯ä»¥è®¾ç½®ä¸º3s</span></span><br><span class="line">scrape_interval: 3s</span><br><span class="line">Â·Â·Â·æœ«å°¾åŠ ä¸Š</span><br><span class="line">    <span class="comment">#jobåéšä¾¿ï¼Œå‘Šè¯‰Prometheuså»å“ªæ‹‰å–æ•°æ®     </span></span><br><span class="line">  - job_name: <span class="string">&quot;elk&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.211:9100&quot;</span>,<span class="string">&quot;10.0.0.212:9100&quot;</span>,<span class="string">&quot;10.0.0.213:9100&quot;</span>]</span><br><span class="line">      </span><br><span class="line"><span class="comment">#2.ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼ˆPrometheusè‡ªå¸¦çš„ï¼‰</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Checking /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml</span><br><span class="line"> SUCCESS: /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml is valid prometheus config file syntax</span><br><span class="line"> </span><br><span class="line">`å¯ä»¥è®¾ç½®åˆ«åé’ˆå¯¹æ£€æŸ¥é…ç½®æ–‡ä»¶å‘½ä»¤å¤ªé•¿`</span><br><span class="line">[root@elk01:~]# vim /etc/profile</span><br><span class="line"><span class="built_in">alias</span> check=<span class="string">&#x27;/softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.é‡æ–°åŠ è½½é…ç½®ï¼ˆçƒ­åŠ è½½ï¼‰</span></span><br><span class="line">[root@elk211 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. æµè§ˆå™¨åˆ·æ–°è®¿é—®,åœ¨targeté‡Œå³å¯çœ‹åˆ°è¢«ç›‘æ§ç«¯</span></span><br><span class="line">10.0.0.211:9090/targets</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122111710195.png" alt="image-20241122111710195"></p><p><strong>å…³äºmetrics</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241122113152787.png" alt="image-20241122113152787"></p><p><strong>è¿‡æ»¤æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241122114130917.png" alt="image-20241122114130917"></p><h2 id="Prometheus-metrics-ç±»å‹">Prometheus metrics ç±»å‹</h2><ul><li>prometheus metrics type<br>prometheusç›‘æ§ä¸­é‡‡é›†è¿‡æ¥çš„æ•°æ®ç»Ÿä¸€ç§°ä¸ºMetricsæ•°æ®ï¼Œå…¶å¹¶ä¸æ˜¯ä»£è¡¨å…·ä½“çš„æ•°æ®æ ¼å¼ï¼Œè€Œæ˜¯ä¸€ç§ç»Ÿè®¡åº¦é‡è®¡ç®—å•ä½ã€‚</li></ul><p>å½“æˆ‘ä»¬éœ€è¦ä¸ºæŸä¸ªç³»ç»Ÿæˆ–è€…æŸä¸ªæœåŠ¡åšç›‘æ§æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°metricsã€‚</p><p>prometheusæ”¯æŒçš„metricsåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹:<br>guage:<br>æœ€ç®€å•çš„åº¦é‡æŒ‡æ ‡ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„è¿”å›å€¼ï¼Œæˆ–è€…å«ç¬æ—¶çŠ¶æ€ã€‚<br>æ¯”å¦‚è¯´ç»Ÿè®¡ç¡¬ç›˜ï¼Œå†…å­˜ç­‰ä½¿ç”¨æƒ…å†µã€‚<br>couter:<br>å°±æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä»æ•°æ®é‡0å¼€å§‹ç´¯ç§¯è®¡ç®—ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œåªèƒ½æ˜¯æ°¸è¿œçš„å¢é•¿ï¼Œä¸ä¼šé™ä½(æœ‰ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ç²‰ä¸é‡)ã€‚<br>æ¯”å¦‚ç»Ÿè®¡1å°æ—¶ï¼Œ1å¤©ï¼Œ1å‘¨ï¼Œ1ä¸€ä¸ªæœˆçš„ç”¨æˆ·è®¿é—®é‡ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç´¯åŠ çš„æ“ä½œã€‚<br>histograms:<br>æ˜¯ç»Ÿè®¡æ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼Œæ¯”å¦‚æœ€å°å€¼ï¼Œæœ€å¤§å€¼ï¼Œä¸­é—´å€¼ï¼Œä¸­ä½æ•°ç­‰ï¼Œä»£è¡¨çš„æ˜¯ä¸€ç§è¿‘ä¼¼ç™¾åˆ†æ¯”ä¼°ç®—æ•°å€¼ã€‚<br>é€šè¿‡histogramså¯ä»¥åˆ†åˆ«ç»Ÿè®¡å¤„åœ¨ä¸€ä¸ªæ—¶é—´æ®µ(1s,2s,5s,10s)å†…nginxè®¿é—®ç”¨æˆ·çš„å“åº”æ—¶é—´ã€‚<br>summary:<br>summaryæ˜¯histogramsçš„æ‰©å±•ç±»å‹ï¼Œä¸»è¦å¼¥è¡¥histogramsä¸è¶³ã€‚</p><h2 id="Prometheusçš„PromQLè¯­æ³•">Prometheusçš„PromQLè¯­æ³•</h2><p>1 æŸ¥çœ‹æŸä¸ªç‰¹å®šçš„key<br>node_cpu_seconds_total</p><p>2.æŸ¥çœ‹æŸä¸ªèŠ‚ç‚¹çš„æŒ‡æ ‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;instance=<span class="string">&quot;10.0.0.211:9100&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>3 æŸ¥çœ‹æŸä¸ªèŠ‚ç‚¹çš„æŸåˆ»CPUçš„æŸç§çŠ¶æ€</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode=&quot;idle&quot;,cpu=&quot;1&quot;&#125;</code></pre><p>4 æŸ¥è¯¢æœ€è¿‘10så†…æŸä¸ªèŠ‚ç‚¹CPUçš„æŸç§çŠ¶æ€æ—¶é—´</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode=&quot;idle&quot;,cpu=&quot;1&quot;&#125;[10s]</code></pre><p>5 ç»Ÿè®¡10så†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œéç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ€»æ—¶é—´</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode!=&quot;idle&quot;,cpu=&quot;1&quot;&#125;[10s]</code></pre><p>6 ç»Ÿè®¡10så†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œmodeåç§°ä»¥å­—æ¯&quot;i&quot;å¼€å¤´çš„æ‰€æœ‰CPUæ ¸å¿ƒã€‚</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode=~&quot;i.*&quot;,cpu=&quot;0&quot;&#125;[10s]</code></pre><p>7 ç»Ÿè®¡10så†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œmodeåç§°ä¸æ˜¯ä»¥å­—æ¯&quot;i&quot;å¼€å¤´çš„æ‰€æœ‰CPUæ ¸å¿ƒã€‚</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode!~&quot;i.*&quot;,cpu=&quot;0&quot;&#125;[10s]</code></pre>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡ä»‹ç»äº†Prometheusçš„éƒ¨ç½²åŠPrometheusçš„metricsç±»å‹å’ŒPromQLè¯­æ³•</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>14.åŸºäºkafkaçš„æ—¥å¿—æ”¶é›†</title>
    <link href="https://lukme.top/posts/b922fe1d.html"/>
    <id>https://lukme.top/posts/b922fe1d.html</id>
    <published>2024-10-30T02:46:01.000Z</published>
    <updated>2024-10-30T04:02:48.777Z</updated>
    
    <content type="html"><![CDATA[<h2 id="filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤">filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤</h2><p><strong>1. åˆ›å»ºtopic</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-topics.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic linux-study.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@elk01:5 ~]# kafka-topics.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --describe</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030003043850.png" alt="image-20241030003043850"></p><p><strong>2. filebeatå†™å…¥æ•°æ®åˆ°kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/20-filebeat-to-kafka.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">  - <span class="built_in">type</span>: filestream</span><br><span class="line">    paths:</span><br><span class="line">      - /opt/access.log*</span><br><span class="line">  </span><br><span class="line">output.kafka:</span><br><span class="line">  <span class="comment"># æŒ‡å®škafkaé›†ç¾¤åœ°å€</span></span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.211:9092&quot;</span>, <span class="string">&quot;10.0.0.212:9092&quot;</span>, <span class="string">&quot;10.0.0.213:9092&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># æŒ‡å®šå†™å…¥çš„topicåœ°å€</span></span><br><span class="line">  topic: <span class="string">&#x27;linux-study&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/20-filebeat-to-kafka.yaml</span><br></pre></td></tr></table></figure><p><strong>3. kafkaèŠ‚ç‚¹æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]#  kafka-console-consumer.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --from-beginning --group filebeat01</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030004427518.png" alt="image-20241030004427518"></p><h2 id="logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®">logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®</h2><p>**1.ç¼–å†™logstashå®ä¾‹ **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment"># elasticsearch&#123;</span></span><br><span class="line"> <span class="comment">#    hosts =&gt; [&quot;10.0.0.91:9200&quot;,&quot;10.0.0.92:9200&quot;,&quot;10.0.0.93:9200&quot;]</span></span><br><span class="line"> <span class="comment">#    index =&gt; &quot;oldboyedu-kafka-elk-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"> <span class="comment">#    user =&gt; &quot;elastic&quot;</span></span><br><span class="line"> <span class="comment">#    password =&gt; &quot;123456&quot;</span></span><br><span class="line"> <span class="comment">#  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. å¯åŠ¨logstashå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# logstash -rf /etc/logstash/conf.d/17-kafka-to-logstash.conf </span><br><span class="line"></span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T17:05:27.448Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;&#123;\&quot;@timestamp\&quot;:\&quot;2024-10-29T16:39:24.279Z\&quot;,\&quot;@metadata\&quot;:&#123;\&quot;beat\&quot;:\&quot;filebeat\&quot;,\&quot;type\&quot;:\&quot;_doc\&quot;,\&quot;version\&quot;:\&quot;7.17.23\&quot;&#125;,\&quot;log\&quot;:&#123;\&quot;offset\&quot;:20478,\&quot;file\&quot;:&#123;\&quot;path\&quot;:\&quot;/opt/access.log\&quot;&#125;&#125;,\&quot;message\&quot;:\&quot;109.110.162.51 - - [04/Oct/2024:10:00:41 +0800] \\\&quot;GET / HTTP/1.1\\\&quot; 304 0 \\\&quot;-\\\&quot; \\\&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1 Edg/129.0.0.0\\\&quot;\&quot;,\&quot;input\&quot;:&#123;\&quot;type\&quot;:\&quot;filestream\&quot;&#125;,\&quot;ecs\&quot;:&#123;\&quot;version\&quot;:\&quot;1.12.0\&quot;&#125;,\&quot;host\&quot;:&#123;\&quot;name\&quot;:\&quot;elk01\&quot;&#125;,\&quot;agent\&quot;:&#123;\&quot;id\&quot;:\&quot;0f020f85-7619-4e85-83ae-346d91b5ca57\&quot;,\&quot;name\&quot;:\&quot;elk01\&quot;,\&quot;type\&quot;:\&quot;filebeat\&quot;,\&quot;version\&quot;:\&quot;7.17.23\&quot;,\&quot;hostname\&quot;:\&quot;elk01\&quot;,\&quot;ephemeral_id\&quot;:\&quot;ed96638d-32ee-4ee0-afbb-504643c3d52a\&quot;&#125;&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030010834508.png" alt="image-20241030010834508"></p><p><strong>3. ä¼˜åŒ–logstash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹messageå­—æ®µè¿›è¡Œjsonæ ¼å¼åŒ–</span></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;message&quot;</span></span><br><span class="line">    <span class="comment">#ç§»é™¤ä¸éœ€è¦çš„å­—æ®µï¼Œä¸ç„¶åƒä¸‹é¢ä¸€æ ·å‡ºç°å¾ˆå¤šæ²¡æœ‰ä»·å€¼çš„å­—æ®µ</span></span><br><span class="line">   <span class="comment"># remove_field =&gt; [ &quot;input&quot;,&quot;host&quot;,&quot;agent&quot;,&quot;@version&quot;,&quot;log&quot;, &quot;ecs&quot; ]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºç»“æœå±•ç¤º</span></span><br><span class="line"></span><br><span class="line">         <span class="string">&quot;agent&quot;</span> =&gt; &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">             <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ephemeral_id&quot;</span> =&gt; <span class="string">&quot;9a1e6795-8fe4-476b-ba6b-9d91b41f282c&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;id&quot;</span> =&gt; <span class="string">&quot;1b86f9d4-c41a-4c30-8b3c-c921ed07d026&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">         <span class="string">&quot;input&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filestream&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T16:40:45.156Z,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="string">&quot;ecs&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="string">&quot;log&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;offset&quot;</span> =&gt; 27088,</span><br><span class="line">          <span class="string">&quot;file&quot;</span> =&gt; &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;/opt/access.log&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#ç§»é™¤å­—æ®µåå±•ç¤º</span></span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T16:40:45.156Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;150.109.253.34 - - [04/Oct/2024:10:01:27 +0800] \&quot;GET /app HTTP/1.1\&quot; 404 197 \&quot;-\&quot; \&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36 Edg/129.0.0.0\&quot;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>4. æ­£å¸¸æ“ä½œä¼˜åŒ–,å¹¶è¾“å‡ºåˆ°esé›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹messageå­—æ®µè¿›è¡Œjsonæ ¼å¼åŒ–</span></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;message&quot;</span></span><br><span class="line">    <span class="comment">#ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;input&quot;</span>,<span class="string">&quot;host&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;@version&quot;</span>,<span class="string">&quot;log&quot;</span>, <span class="string">&quot;ecs&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># åŸºäºæ­£åˆ™åŒ¹é…ä»»æ„æ–‡æœ¬ï¼Œgrokå†…ç½®äº†120ç§åŒ¹é…æ¨¡å¼</span></span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;HTTPD_COMBINEDLOG&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  useragent &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;agent&quot;</span></span><br><span class="line">    target =&gt; <span class="string">&quot;agent-kind&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  geoip &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;clientip&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">date</span> &#123;</span><br><span class="line">    match =&gt; [ <span class="string">&quot;timestamp&quot;</span>, <span class="string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">     hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">     index =&gt; <span class="string">&quot;kafka-elk-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">     user =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">     password =&gt; <span class="string">&quot;123456&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030013045764.png" alt="image-20241030013045764"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†åŸºäºELFKæ¶æ„+kafkaæ”¶é›†æ—¥å¿—å¤„ç†</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>13.ä½¿ç”¨supervisorç®¡ç†æœåŠ¡</title>
    <link href="https://lukme.top/posts/1267bcfa.html"/>
    <id>https://lukme.top/posts/1267bcfa.html</id>
    <published>2024-10-30T02:45:01.000Z</published>
    <updated>2024-10-30T04:02:43.037Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨supervisorç®¡ç†æœåŠ¡">ä½¿ç”¨supervisorç®¡ç†æœåŠ¡</h2><p><strong>1. ä¸‹è½½supervisor</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]#  apt -y install supervisor</span><br></pre></td></tr></table></figure><p><strong>2. å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]#  systemctl start supervisor</span><br><span class="line">[root@elk02:0 ~]#  systemctl <span class="built_in">enable</span> supervisor</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹supervisoré…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# vim /etc/supervisor/supervisord.conf</span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># ä»¥åéœ€è¦é…ç½®çš„æœåŠ¡åªéœ€è¦æ”¾åœ¨/etc/supervisor/ä¸‹ï¼Œä»¥.iniç»“å°¾çš„éƒ½å¯è¢«supervisorç®¡ç†</span></span><br><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/*.ini</span><br></pre></td></tr></table></figure><p><strong>4.ç¼–è¾‘inié…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/supervisor/zk.ini </span><br><span class="line">[program:zookeeper]</span><br><span class="line"><span class="built_in">command</span>=/app/zookeeper/bin/zkServer.sh start-foreground</span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stderr_logfile=/var/log/zookeeper.err.log</span><br><span class="line">stdout_logfile=/var/log/zookeeper.out.log</span><br><span class="line">user=root</span><br><span class="line">priority=1</span><br><span class="line">environment=JAVA_HOME=<span class="string">&quot;/usr/share/elasticsearch/jdk/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ä¿®æ”¹zookeeperçš„å®‰è£…è·¯å¾„ï¼Œä»¥åŠjavahomeè·¯å¾„   ï¼ˆä½¿ç”¨  echo $JAVA_HOME æŸ¥çœ‹javaç¯å¢ƒ ï¼‰</span></span><br><span class="line">[root@elk01:2 ~]# <span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br><span class="line">/usr/share/elasticsearch/jdk</span><br></pre></td></tr></table></figure><p><strong>5. æ›´æ–°supervisoré…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# supervisorctl update</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šæ¯æ¬¡è·Ÿæ–°æœåŠ¡é…ç½®éƒ½éœ€è¦update</span><br></pre></td></tr></table></figure><p><strong>6.supervisorç®¡ç†å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl start zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl stop zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æˆ–è€…åœæ­¢æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl start/stop all</span><br><span class="line"></span><br><span class="line">å‹æƒ…æç¤ºï¼š</span><br><span class="line">  å¦‚æœä½ çš„zookeeperæ˜¯ä½¿ç”¨zkServer.sh start å¯åŠ¨çš„ï¼Œè¦å…ˆä½¿ç”¨zkServer.sh stopå…³é—­æœåŠ¡ï¼Œä¸èƒ½ä½¿ç”¨zkServerå¯åŠ¨æœåŠ¡ï¼Œä½¿ç”¨supervisorå»å…³é—­æœåŠ¡</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†ä½¿ç”¨supervisorç»Ÿä¸€ç®¡ç†zookeeperå’Œkafkaï¼Œç›¸æ¯”systemdç®¡ç†æ›´åŠ æ–¹ä¾¿</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>12.kafkaçš„è„šæœ¬ç®¡ç†åŠæ•°æ®å»¶è¿Ÿã€ä¸¢å¤±åˆ†æ</title>
    <link href="https://lukme.top/posts/70dc5443.html"/>
    <id>https://lukme.top/posts/70dc5443.html</id>
    <published>2024-10-30T02:44:01.000Z</published>
    <updated>2024-10-30T04:02:38.055Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kafkaçš„è„šæœ¬ç®¡ç†">kafkaçš„è„šæœ¬ç®¡ç†</h2><h3 id="topicç®¡ç†">topicç®¡ç†</h3><p><strong>1.æŸ¥çœ‹topicåˆ—è¡¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --list </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>**2.åˆ›å»ºtopic **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic luay.</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Šï¼š</span></span><br><span class="line">--topic  luay           <span class="comment">#æŒ‡å®štopicä¸ºluay</span></span><br><span class="line">--partitions 3          <span class="comment">#åˆ›å»º3ä¸ªåˆ†åŒº</span></span><br><span class="line">--replication-factor 2  <span class="comment">#åˆ›å»º2ä¸ªå‰¯æœ¬</span></span><br><span class="line">--create                <span class="comment">#åŠ¨ä½œ--åˆ›å»º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶å®ƒé€‰é¡¹</span></span><br><span class="line">--delete                <span class="comment">#åˆ é™¤</span></span><br><span class="line">--alter                 <span class="comment">#ä¿®æ”¹</span></span><br><span class="line">--describe              <span class="comment">#è¾“å‡ºè¯¦ç»†ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029180717295.png" alt="image-20241029180717295"></p><p><strong>3.ä¿®æ”¹åˆ†åŒºæ•°é‡ã€åªèƒ½ç”±å°å˜å¤§ï¼Œä¸èƒ½ç”±å¤§å˜å°ã€‘</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --partitions 5 --alter</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029180957289.png" alt="image-20241029180957289"></p><p><strong>4.æŸ¥çœ‹æŒ‡å®štopicçš„è¯¦ç»†ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --describe</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029181157071.png" alt="image-20241029181157071"></p><p><strong>5.åˆ é™¤topic</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --delete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#kafkaæ•°æ®ç›®å½•é‡Œtopicä¼šè¢«æ ‡è®°-deleteï¼Œç­‰å¾…ä¸€ä¼šä¾¿ä¼šè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">[root@elk01:1 ~]# ll /app/data/kafka/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 29 18:15 luay-1.2baa4b610f314befbfbed58aaad84052-delete/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 29 18:15 luay-2.0f44f4821a1849ccb7e0e37e1fe65ff4-delete/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="producerç®¡ç†">producerç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt;999999</span><br><span class="line">[2024-10-29 20:49:30,357] WARN [Producer clientId=console-producer] Error <span class="keyword">while</span> fetching metadata with correlation <span class="built_in">id</span> 7 : &#123;<span class="built_in">test</span>=LEADER_NOT_AVAILABLE&#125; (org.apache.kafka.clients.NetworkClient)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é¦–æ¬¡å†™å…¥æ—¶ï¼Œè‹¥topicä¸å­˜åœ¨ï¼Œåˆ™kafkaé›†ç¾¤é»˜è®¤ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line">[root@elk02:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --list</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="kafkaçš„consumerç®¡ç†">kafkaçš„consumerç®¡ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt;12112112</span><br><span class="line">&gt;666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯---æ¥æ”¶ç°åœ¨å¼€å§‹çš„æ¶ˆæ¯</span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯---ä»å¤´æ¥æ”¶æ¶ˆæ¯    --from-beginning </span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span> --from-beginning </span><br><span class="line">999999</span><br><span class="line">12112112</span><br><span class="line">666666</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…ç»„ç†å¿µ">æ¶ˆè´¹è€…ç»„ç†å¿µ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- kafkaçš„æ¶ˆè´¹è€…ç»„æ¦‚å¿µ</span><br><span class="line">1.kafkaçš„offsetå­˜å‚¨ä½ç½®</span><br><span class="line">kafkaæ—©æœŸç‰ˆæœ¬ 0.9-ç‰ˆæœ¬ï¼Œoffsetè®°å½•å­˜å‚¨åœ¨zookeeperé›†ç¾¤ã€‚</span><br><span class="line">ä»kafka 0.10+ç‰ˆæœ¬ï¼Œé»˜è®¤çš„offsetå­˜å‚¨åœ¨kafkaé›†ç¾¤ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<span class="string">&quot;__consumer_offsets&quot;</span>å†…ç½®çš„topicã€‚(å½“æ¶ˆè´¹è€…å‡ºç°å®•æœºï¼Œå½“å‰å½“å‰ç»„é‡Œçš„å…¶å®ƒæ¶ˆè´¹è€…ä¼šä»_consumer_offsetsè®°å½•çš„åç§»é‡é‡Œï¼Œæ‰¾åˆ°å·²ç»å–åˆ°å“ªé‡Œçš„æ•°æ®ï¼Œä»æ­¤ç‚¹ç»§ç»­å¾€åå–æ•°æ®ï¼Œè€Œä¸æ˜¯ä»æ–°å–æ‰€æœ‰æ•°æ®ï¼Œé¿å…æ•°æ®é‡å¤é‡‡é›†)</span><br><span class="line"></span><br><span class="line">2.ç›¸å…³æœ¯è¯­</span><br><span class="line">consumer groupï¼š    æ¶ˆè´¹è€…ç»„ï¼Œä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½éš¶å±äºä¸€ä¸ªæ¶ˆè´¹è€…ç»„ã€‚</span><br><span class="line"></span><br><span class="line">1.è€Œ<span class="string">&quot;__consumer_offsets&quot;</span>å†…ç½®çš„topicè®°å½•çš„åç§»é‡å¹¶ä¸å±äºæŸä¸ªæ¶ˆè´¹è€…ï¼Œè€Œæ˜¯åŸºäºæ¶ˆè´¹è€…è¿›è¡Œè®°å½•çš„ã€‚</span><br><span class="line">2.å½“æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘é‡å¹³è¡¡(Rebalance);</span><br><span class="line">  1.æ¯”å¦‚æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…ï¼ˆC1/C2ï¼‰æ–°å¢æˆ–è€…ä¸‹çº¿ï¼Œæ‰€è°“çš„é‡å¹³è¡¡æŒ‡çš„æ˜¯è¯¥æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…é‡æ–°åˆ†é…åˆ†åŒºï¼ˆ0åˆ†åŒº,1åˆ†åŒº,2åˆ†åŒºè¿‡ç¨‹ã€‚</span><br><span class="line">  2.è¯¥æ¶ˆè´¹è€…ç»„è‹¥æ–°å¢äº†æ¶ˆè´¹è€…ï¼Œä¹Ÿä¼šè§¦å‘é‡å¹³è¡¡;</span><br><span class="line">  3.å½“æ¶ˆè´¹è€…ç»„çš„æ•°é‡å¤šä½™partitionæ•°é‡æ—¶ï¼Œåˆ™ä¼šå¯¼è‡´è¯¥æ¶ˆè´¹è€…ç»„æœ‰ç©ºé—²çš„æ¶ˆè´¹è€…;ï¼ˆå‡è®¾5ä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯åªæœ‰3ä¸ªåˆ†åŒº)</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/consumer_group.png" alt="consumer_group"></p><h2 id="kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ">kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ</h2><p>ç”±å›¾è§£ï¼Œkafkaçš„æ¶ˆè´¹è€…æ˜¯logstashï¼Œæ€ä¹ˆä¼šå‡ºç°æ•°æ®å»¶è¿Ÿå‘¢ï¼Ÿ</p><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/ElasticStack_MQ.png" alt="ElasticStack_MQ"></p><blockquote><p>å½“ç”Ÿäº§è€…è¿‡å¤šï¼Œlogstashå¿™ä¸è¿‡æ¥æ—¶å€™æ”¶é›†ï¼Œå°±ä¼šå‡ºç°æ•°æ®å»¶è¿Ÿå¯èƒ½</p></blockquote><p>ç†è®ºå­˜åœ¨ï¼Œåˆ†æå®è·µ</p><p><strong>1. æŸ¥çœ‹ç°æœ‰çš„æ¶ˆè´¹è€…ç»„åˆ—è¡¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --list</span><br><span class="line">console-consumer-10558</span><br><span class="line">console-consumer-73547</span><br><span class="line">console-consumer-4558</span><br></pre></td></tr></table></figure><p><strong>2.åˆ›å»ºtopicæŒ‡å®šåˆ†åŒºå’Œå‰¯æœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:0 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic new --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic new.</span><br></pre></td></tr></table></figure><p><strong>3.å¯åŠ¨ç”Ÿäº§è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999</span><br></pre></td></tr></table></figure><p><strong>4.å¯åŠ¨æ¶ˆè´¹è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. å¯åŠ¨ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ŒæŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic new --from-beginning --group dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹æ¶ˆè´¹è€…åˆ—è¡¨</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --list</span><br><span class="line">dev</span><br><span class="line">console-consumer-10558</span><br><span class="line">console-consumer-73547</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹æŒ‡å®šæ¶ˆè´¹è€…çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --group dev --describe</span><br><span class="line">GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG</span><br><span class="line">dev             new             0          0               0               0  </span><br><span class="line">dev             new             1          0               0               0  </span><br><span class="line">dev             new             2          1               0               0  </span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029224849054.png" alt="image-20241029224849054"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.ç”Ÿäº§è€…ç»§ç»­å†™å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999999</span><br><span class="line">&gt;aaaaaaaa</span><br><span class="line">&gt;vbbbbbb</span><br><span class="line">&gt;ccccc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å¯åŠ¨æ–°çš„æ¶ˆè´¹è€…</span></span><br><span class="line">[root@elk02:1 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic new --from-beginning --group dev</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶æ²¡æœ‰æ–°çš„æ•°æ®ï¼Œå› ä¸ºè¢«åŒä¸€ä¸ªç»„ï¼ˆdevï¼‰çš„ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…å·²ç»é‡‡é›†è¿‡äº†</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. å†™å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999999</span><br><span class="line">&gt;aaaaaaaa</span><br><span class="line">&gt;vbbbbbb</span><br><span class="line">&gt;ccccc</span><br><span class="line">&gt;9999999999</span><br><span class="line">&gt;69696969696</span><br></pre></td></tr></table></figure><p><strong>åœæ­¢æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œåªå†™å…¥æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;h</span><br><span class="line">&gt;h</span><br><span class="line">&gt;asasasasasasas</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹è¯¦ç»†æ•°æ®</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --group dev --describe</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029230457830.png" alt="image-20241029230457830"></p><h2 id="kafkaæ•°æ®ä¸¢å¤±åˆ†æ">kafkaæ•°æ®ä¸¢å¤±åˆ†æ</h2><blockquote><p>è§å›¾è§£</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kafkaçš„ISRåˆ—è¡¨å¯¼è‡´æ•°æ®ä¸¢å¤±çš„åŸå› ï¼š</span><br><span class="line">ISR:</span><br><span class="line">å’Œleaderå‰¯æœ¬åŒæ­¥çš„æ‰€æœ‰å‰¯æœ¬é›†åˆã€‚</span><br><span class="line">OSR:</span><br><span class="line">å’Œleaderå‰¯æœ¬ä¸åŒæ­¥æ‰€æœ‰å‰¯æœ¬é›†åˆã€‚</span><br><span class="line">AR:</span><br><span class="line">æ‰€æœ‰å‰¯æœ¬ï¼ŒæŒ‡çš„æ˜¯leader  + followerï¼Œå³AR = ISR + OSR </span><br><span class="line">LEO:</span><br><span class="line">è‹±æ–‡å…¨ç§°ä¸º: LOG-END-OFFSETï¼Œè¡¨ç¤ºæ¯ä¸ªpartitionæœ€åä¸€ä¸ªOffsetã€‚</span><br><span class="line">HW:</span><br><span class="line">è¡¨ç¤ºåœ¨ISRåˆ—è¡¨ä¸­æ‰€æœ‰LEOä¸­æœ€å°çš„LEOã€‚</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/kafka-ISR.png" alt="kafka-ISR"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†Kafkaçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¦‚ä½•å‘èµ·æ•°æ®å’Œæ”¶é›†æ•°æ®ï¼Œå¹¶ä¸”åˆ†ææ•°æ®å»¶è¿Ÿ</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>11.kafkaä»‹ç»åŠéƒ¨ç½²</title>
    <link href="https://lukme.top/posts/35ea5361.html"/>
    <id>https://lukme.top/posts/35ea5361.html</id>
    <published>2024-10-30T02:43:01.000Z</published>
    <updated>2024-11-17T16:05:52.434Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kafkaä»‹ç»">kafkaä»‹ç»</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Kafka è¢«ç§°ä¸ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œç”± Scala å’Œ Javaç¼–å†™ï¼Œæ˜¯éè¥åˆ©æ€§ç»„ç»‡ASF(Apache Software Foundation)åŸºé‡‘ä¼šä¸­çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚:HTTP Serverã€Tomcatã€Hadoopã€ActiveMQç­‰å¼€æºè½¯ä»¶éƒ½å±äº ApacheåŸºé‡‘ä¼šçš„å¼€æºè½¯ä»¶ï¼Œç±»ä¼¼çš„æ¶ˆæ¯ç³»ç»Ÿè¿˜æœ‰RabbitMQã€ActiveMQã€ZeroMQã€‚</span><br><span class="line">Kafkaç”¨äºæ„å»ºå®æ—¶æ•°æ®ç®¡é“å’Œæµåº”ç”¨ç¨‹åºã€‚ å®ƒå…·æœ‰æ°´å¹³å¯ä¼¸ç¼©æ€§ï¼Œå®¹é”™æ€§ï¼Œå¿«é€Ÿæ€§ï¼Œå¯åœ¨æ•°åƒå®¶ç»„ç»‡ä¸­åŒæ—¶æŠ•å…¥ç”Ÿäº§ååŒå·¥ä½œã€‚</span><br></pre></td></tr></table></figure><h2 id="kafkaå¸¸è§æœ¯è¯­">kafkaå¸¸è§æœ¯è¯­</h2><p>:dango:  <strong>1.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- topic:</span><br><span class="line">è¡¨ç¤ºæ˜¯ä¸»é¢˜ï¼Œå¯¹åº”æ˜¯é€»è¾‘å­˜å‚¨å•å…ƒï¼Œä¸€èˆ¬ç”¨äºåŒºåˆ†ä¸šåŠ¡ç±»å‹ã€‚å¯ä»¥å’ŒESçš„ç´¢å¼•å¯¹åº”ã€‚</span><br><span class="line">- partition</span><br><span class="line">åˆ†åŒºï¼Œä¸€ä¸ªtopicå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚</span><br><span class="line">- replica:</span><br><span class="line">æ˜¯æ•°æ®çš„å®é™…è½½ä½“ï¼ŒçœŸæ­£å­˜å‚¨æ•°æ®çš„èµ„æºï¼Œåˆ†ä¸ºleaderå’Œfollowerï¼Œå…¶ä¸­leaderå¯¹å¤–æä¾›è¯»å†™ï¼Œè€Œfollowerè´Ÿè´£æ•°æ®çš„åŒæ­¥ã€‚</span><br><span class="line">- producer:</span><br><span class="line">ç”Ÿäº§è€…ï¼Œå¾€kafkaé›†ç¾¤å†™æ•°æ®çš„ä¸€æ–¹ã€‚</span><br><span class="line">- consumer:</span><br><span class="line">æ¶ˆè´¹è€…ï¼Œä»kafkaè¯»å–æ•°æ®çš„ä¸€æ–¹ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/topic.png" alt="topic"></p><blockquote><p>è¯»å–æ•°æ®åªèƒ½å»leaderè¯»å–ï¼Œfollowå€¼è´Ÿè´£åŒæ­¥æ•°æ®</p></blockquote><p>:dango:<strong>2. è§’è‰²ä»‹ç»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰Producerï¼šProducerå³ç”Ÿäº§è€…ï¼Œæ¶ˆæ¯çš„äº§ç”Ÿè€…ï¼Œæ˜¯æ¶ˆæ¯çš„å…¥å£ã€‚è´Ÿè´£å‘å¸ƒæ¶ˆæ¯åˆ°Kafka broker</span><br><span class="line">ï¼ˆ2ï¼‰Consumerï¼šæ¶ˆè´¹è€…ï¼Œç”¨äºæ¶ˆè´¹æ¶ˆæ¯ï¼Œå³å¤„ç†æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">Brokerï¼šBrokeræ˜¯kafkaå®ä¾‹ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸Šå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªkafkaçš„å®ä¾‹ï¼Œå‡è®¾æ¯ä¸ªbrokerå¯¹åº”ä¸€å°æœåŠ¡å™¨ã€‚æ¯ä¸ªkafkaé›†ç¾¤å†…çš„brokeréƒ½æœ‰ä¸€ä¸ªä¸é‡å¤çš„ç¼–å·ï¼Œå¦‚: broker-0ã€broker-1ç­‰â€¦â€¦</span><br><span class="line"></span><br><span class="line">ï¼ˆ3ï¼‰Topic ï¼šæ¶ˆæ¯çš„ä¸»é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯çš„åˆ†ç±»ï¼Œä¸€ä¸ªTopicç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨,ä¸€æ¡æ¶ˆæ¯ç›¸å½“äºå…³ç³»æ•°æ®åº“çš„ä¸€æ¡è®°å½•ï¼Œä¸€ä¸ªTopicæˆ–è€…ç›¸å½“äºRedisä¸­åˆ—è¡¨ç±»å‹çš„ä¸€ä¸ªKeyï¼Œä¸€æ¡æ¶ˆæ¯å³ä¸ºåˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚kafkaçš„æ•°æ®å°±ä¿å­˜åœ¨topicã€‚åœ¨æ¯ä¸ªbrokerä¸Šéƒ½å¯ä»¥åˆ›å»ºå¤šä¸ªtopicã€‚ç‰©ç†ä¸Šä¸åŒ topic çš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶å¤¹ï¼Œé€»è¾‘ä¸Šä¸€ä¸ª topicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbroker ä¸Š, ä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼Œtopic åœ¨é€»è¾‘ä¸Šå¯¹record(è®°å½•ã€æ—¥å¿—)è¿›è¡Œåˆ†ç»„ä¿å­˜ï¼Œæ¶ˆè´¹è€…éœ€è¦è®¢é˜…ç›¸åº”çš„topic æ‰èƒ½æ¶ˆè´¹topicä¸­çš„æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">ï¼ˆ4ï¼‰Consumer group: æ¯ä¸ªconsumer å±äºä¸€ä¸ªç‰¹å®šçš„consumer groupï¼ˆå¯ä¸ºæ¯ä¸ªconsumer æŒ‡å®š group nameï¼Œè‹¥ä¸æŒ‡å®š group name åˆ™å±äºé»˜è®¤çš„groupï¼‰ï¼ŒåŒä¸€topicçš„ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«åŒä¸€ä¸ªconsumer group å†…çš„ä¸€ä¸ªconsumer æ¶ˆè´¹ï¼Œç±»ä¼¼äºä¸€å¯¹ä¸€çš„å•æ’­æœºåˆ¶ï¼Œä½†å¤šä¸ªconsumer group å¯åŒæ—¶æ¶ˆè´¹è¿™ä¸€æ¶ˆæ¯ï¼Œç±»ä¼¼äºä¸€å¯¹å¤šçš„å¤šæ’­æœºåˆ¶</span><br><span class="line"></span><br><span class="line">ï¼ˆ5ï¼‰Partition ï¼šæ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ªtopic åˆ†å‰²ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼Œå³ä¸€ä¸ªtopicåˆ‡åˆ†ä¸ºå¤šä»½.åˆ›å»º topicæ—¶å¯æŒ‡å®š partition æ•°é‡ï¼Œpartitionçš„è¡¨ç°å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ–‡ä»¶å¤¹,è¯¥æ–‡ä»¶å¤¹ä¸‹å­˜å‚¨è¯¥partitionçš„æ•°æ®å’Œç´¢å¼•æ–‡ä»¶ï¼Œåˆ†åŒºçš„ä½œç”¨è¿˜å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œæé«˜kafkaçš„ååé‡ã€‚åŒä¸€ä¸ªtopicåœ¨ä¸åŒçš„åˆ†åŒºçš„æ•°æ®æ˜¯ä¸é‡å¤çš„,ä¸€èˆ¬Partitionæ•°ä¸è¦è¶…è¿‡èŠ‚ç‚¹æ•°ï¼Œæ³¨æ„åŒä¸€ä¸ªpartitionæ•°æ®æ˜¯æœ‰é¡ºåºçš„ï¼Œä½†ä¸åŒçš„partitionåˆ™æ˜¯æ— åºçš„</span><br><span class="line"></span><br><span class="line">ï¼ˆ6ï¼‰Replication: åŒæ ·æ•°æ®çš„å‰¯æœ¬ï¼ŒåŒ…æ‹¬leaderå’Œfollowerçš„å‰¯æœ¬æ•°,åŸºæœ¬äºæ•°æ®å®‰å…¨,å»ºè®®è‡³å°‘2ä¸ª,æ˜¯Kafkaçš„é«˜å¯é æ€§çš„ä¿éšœï¼Œå’ŒESçš„å‰¯æœ¬æœ‰æ‰€ä¸åŒï¼ŒKafkaä¸­çš„å‰¯æœ¬æ•°åŒ…æ‹¬ä¸»åˆ†ç‰‡æ•°,è€ŒESä¸­çš„å‰¯æœ¬æ•°ä¸åŒ…æ‹¬ä¸»åˆ†ç‰‡æ•°</span><br><span class="line"></span><br><span class="line">ä¸ºäº†å®ç°æ•°æ®çš„é«˜å¯ç”¨ï¼Œæ¯”å¦‚å°†åˆ†åŒº 0 çš„æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„kafka èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª broker ä½œä¸º Leader å’Œä¸€ä¸ª broker ä½œä¸ºFollowerï¼Œç±»ä¼¼äºESä¸­çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ã€‚</span><br><span class="line"></span><br><span class="line">å‡è®¾åˆ†åŒºä¸º 3, å³åˆ†ä¸‰ä¸ªåˆ†åŒº0-2ï¼Œå‰¯æœ¬ä¸º3ï¼Œå³æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª leaderï¼Œå†åŠ ä¸¤ä¸ªfollowerï¼Œåˆ†åŒº 0 çš„leaderä¸ºæœåŠ¡å™¨Aï¼Œåˆ™æœåŠ¡å™¨ B å’ŒæœåŠ¡å™¨ C ä¸º A çš„followerï¼Œè€Œåˆ†åŒº 1 çš„leaderä¸ºæœåŠ¡å™¨Bï¼Œåˆ™æœåŠ¡å™¨ A å’ŒC ä¸ºæœåŠ¡å™¨B çš„followerï¼Œè€Œåˆ†åŒº 2 çš„leader ä¸ºCï¼Œåˆ™æœåŠ¡å™¨A å’Œ B ä¸ºC çš„followerã€‚</span><br><span class="line"></span><br><span class="line">ARï¼š Assigned Replicasï¼Œåˆ†åŒºä¸­çš„æ‰€æœ‰å‰¯æœ¬çš„ç»Ÿç§°ï¼ŒåŒ…æ‹¬leaderå’Œ followerï¼ŒAR= lSR+ OSR</span><br><span class="line">lSRï¼š<span class="built_in">ln</span> Sync Replicasï¼Œæ‰€æœ‰ä¸leaderå‰¯æœ¬ä¿æŒåŒæ­¥çš„å‰¯æœ¬ followerå’Œleaderæœ¬èº«ç»„æˆçš„é›†åˆï¼ŒåŒ…æ‹¬leaderå’Œ followerï¼Œæ˜¯ARçš„å­é›†</span><br><span class="line">OSRï¼šout-of-Sync Repliedï¼Œæ‰€æœ‰ä¸leaderå‰¯æœ¬åŒæ­¥ä¸èƒ½åŒæ­¥çš„ followerçš„é›†åˆï¼Œæ˜¯ARçš„å­é›†</span><br></pre></td></tr></table></figure><p>:dango: 3. åˆ†åŒºå’Œå‰¯æœ¬çš„ä¼˜åŠ¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®ç°å­˜å‚¨ç©ºé—´çš„æ¨ªå‘æ‰©å®¹ï¼Œå³å°†å¤šä¸ªkafkaæœåŠ¡å™¨çš„ç©ºé—´ç»„åˆåˆ©ç”¨</span><br><span class="line">æå‡æ€§èƒ½ï¼Œå¤šæœåŠ¡å™¨å¹¶è¡Œè¯»å†™</span><br><span class="line">å®ç°é«˜å¯ç”¨ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªä¸»åˆ†åŒºå³ leader åˆ†å¸ƒåœ¨ä¸åŒçš„kafka æœåŠ¡å™¨ï¼Œå¹¶ä¸”æœ‰å¯¹åº”follower åˆ†å¸ƒåœ¨å’Œleaderä¸åŒçš„æœåŠ¡å™¨ä¸Š</span><br></pre></td></tr></table></figure><p>:dango: <strong>4. kafkaå†™å…¥æ¶ˆæ¯æµç¨‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç”Ÿäº§è€…ï¼ˆproducterï¼‰å…ˆä»kafkaé›†ç¾¤è·å–åˆ†åŒºçš„leader</span><br><span class="line">ç”Ÿäº§è€…ï¼ˆproducterï¼‰å°†æ¶ˆæ¯å‘é€ç»™leader</span><br><span class="line">leaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶</span><br><span class="line">followersä»leader pullæ¶ˆæ¯</span><br><span class="line">followerså°†æ¶ˆæ¯å†™å…¥æœ¬åœ°åå‘leaderå‘é€ACK</span><br><span class="line">leaderæ”¶åˆ°æ‰€æœ‰å‰¯æœ¬çš„ACKåå‘producterå‘é€ACK</span><br></pre></td></tr></table></figure><p>:dango:  <strong>5. kafkaç‰¹ç‚¹å’Œä¼˜åŠ¿</strong></p><blockquote><p><code>ç‰¹ç‚¹ï¼š</code><br>åˆ†å¸ƒå¼: å¤šæœºå®ç°,ä¸å…è®¸å•æœº<br>åˆ†åŒº: ä¸€ä¸ªæ¶ˆæ¯.å¯ä»¥æ‹†åˆ†å‡ºå¤šä¸ªï¼Œåˆ†åˆ«å­˜å‚¨åœ¨å¤šä¸ªä½ç½®<br>å¤šå‰¯æœ¬: é˜²æ­¢ä¿¡æ¯ä¸¢å¤±ï¼Œå¯ä»¥å¤šæ¥å‡ ä¸ªå¤‡ä»½<br>å¤šè®¢é˜…è€…: å¯ä»¥æœ‰å¾ˆå¤šåº”ç”¨è¿æ¥kafka<br>Zookeeper: æ—©æœŸç‰ˆæœ¬çš„Kafkaä¾èµ–äºzookeeperï¼Œ 2021å¹´4æœˆ19æ—¥Kafka 2.8.0æ­£å¼å‘å¸ƒï¼Œæ­¤ç‰ˆæœ¬åŒ…æ‹¬äº†å¾ˆå¤šé‡è¦æ”¹åŠ¨ï¼Œæœ€ä¸»è¦çš„æ˜¯kafkaé€šè¿‡è‡ªæˆ‘ç®¡ç†çš„ä»²è£æ¥æ›¿ä»£ZooKeeperï¼Œå³Kafkaå°†ä¸å†éœ€è¦ZooKeeperï¼ï¼ï¼</p></blockquote><blockquote><p><code>ä¼˜åŠ¿ï¼š</code><br>é«˜ååé‡ï¼šå³ä½¿æ˜¯éå¸¸æ™®é€šçš„ç¡¬ä»¶Kafkaä¹Ÿå¯ä»¥æ”¯æŒæ¯ç§’æ•°ç™¾ä¸‡çš„æ¶ˆæ¯ã€‚æ”¯æŒé€šè¿‡Kafka æœåŠ¡å™¨åˆ†åŒºæ¶ˆæ¯ã€‚<br>åˆ†å¸ƒå¼ï¼š Kafka åŸºäºåˆ†å¸ƒå¼é›†ç¾¤å®ç°é«˜å¯ç”¨çš„å®¹é”™æœºåˆ¶ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨çš„æ•…éšœè½¬ç§»ã€‚<br>é¡ºåºä¿è¯ï¼šåœ¨å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ•°æ®å¤„ç†çš„é¡ºåºéƒ½å¾ˆé‡è¦ã€‚å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æœ¬æ¥å°±æ˜¯æ’åºçš„ï¼Œå¹¶ä¸”èƒ½ä¿è¯æ•°æ®ä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ¥å¤„ç†ã€‚ Kafkaä¿è¯ä¸€ä¸ªPartitonå†…çš„æ¶ˆæ¯çš„æœ‰åºæ€§ï¼ˆåˆ†åŒºé—´æ•°æ®æ˜¯æ— åºçš„ï¼Œå¦‚æœå¯¹æ•°æ®çš„é¡ºåºæœ‰è¦æ±‚ï¼Œåº”å°†åœ¨åˆ›å»ºä¸»é¢˜æ—¶å°†åˆ†åŒºæ•°partitionsè®¾ç½®ä¸º1ï¼‰ã€‚<br>æ”¯æŒ Hadoop å¹¶è¡Œæ•°æ®åŠ è½½ã€‚<br>é€šå¸¸ç”¨äºå¤§æ•°æ®åœºåˆ,ä¼ é€’å•æ¡æ¶ˆæ¯æ¯”è¾ƒå¤§ï¼Œè€ŒRabbitmq æ¶ˆæ¯ä¸»è¦æ˜¯ä¼ è¾“ä¸šåŠ¡çš„æŒ‡ä»¤æ•°æ®,å•æ¡æ•°æ®è¾ƒå°ã€‚</p></blockquote><h2 id="å•ç‚¹éƒ¨ç½²kafka">å•ç‚¹éƒ¨ç½²kafka</h2><p><strong>1.ä¸‹è½½kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]#wget https://downloads.apache.org/kafka/3.8.0/kafka_2.13-3.8.0.tgz</span><br></pre></td></tr></table></figure><p><strong>2.è§£å‹kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# tar xf kafka_2.13-3.8.0.tgz -C /app/</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹kafkaçš„é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# vim /app/kafka_2.13-3.8.0/config/server.properties </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># ä¿®æ”¹kafkaçš„brokerçš„IDä¿¡æ¯</span></span><br><span class="line">broker.id=211</span><br><span class="line"><span class="comment"># ä¿®æ”¹æ•°æ®ç›®å½•</span></span><br><span class="line">log.dirs=/app/data/kafka</span><br><span class="line"><span class="comment"># ä¿®æ”¹å…ƒæ•°æ®å­˜å‚¨zookeeperé›†ç¾¤åœ°å€</span></span><br><span class="line">zookeeper.connect=10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181/kafka380</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;æ³¨é‡Šï¼š&#x27;</span></span><br><span class="line">/kafka380   æ˜¯å°†ä»¥åçš„znodeéƒ½æ”¾åœ¨kafka380ä¸‹ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤éƒ½åœ¨zookeeperçš„ / ä¸‹</span><br></pre></td></tr></table></figure><p><strong>4.é…ç½®ç¯å¢ƒå˜é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# <span class="built_in">cat</span>  /etc/profile.d/kafka.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_HOME=/app/kafka_2.13-3.8.0</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$KAFKA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:4 ~]# <span class="built_in">source</span> /etc/profile.d/kafka.sh </span><br></pre></td></tr></table></figure><p><strong>5.å¯åŠ¨kafkaèŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:4 ~]# kafka-server-start.sh -daemon <span class="variable">$KAFKA_HOME</span>/config/server.properties</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241029000747486.png" alt="image-20241029000747486"></p><h2 id="kafkaé…ç½®æ–‡ä»¶è¯¦è§£">kafkaé…ç½®æ–‡ä»¶è¯¦è§£</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment"># contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment"># this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment"># the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This configuration file is intended for use in ZK-based mode, where Apache ZooKeeper is required.</span></span><br><span class="line"><span class="comment"># See kafka.server.KafkaConfig for additional details and defaults</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Server Basics #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># broker çš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚</span></span><br><span class="line">broker.id=0</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Socket Server Settings #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¥—æ¥å­—æœåŠ¡å™¨ä¾¦å¬çš„åœ°å€ã€‚å¦‚æœæœªé…ç½®ï¼Œä¸»æœºåå°†ç­‰äºçš„å€¼</span></span><br><span class="line"><span class="comment"># java.net.InetAddress.getCanonicalHostName(), with PLAINTEXT listener name, and port 9092.</span></span><br><span class="line"><span class="comment">#   FORMAT:</span></span><br><span class="line"><span class="comment">#     listeners = listener_name://host_name:port</span></span><br><span class="line"><span class="comment">#   EXAMPLE:</span></span><br><span class="line"><span class="comment">#     listeners = PLAINTEXT://your.host.name:9092</span></span><br><span class="line"><span class="comment">#listeners=PLAINTEXT://:9092</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾¦å¬å™¨åç§°ã€ä¸»æœºåå’Œä»£ç†å°†å‘å®¢æˆ·ç«¯å…¬å¸ƒçš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨â€œlistenersâ€çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¾¦å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒä»¬æ˜¯ç›¸åŒçš„ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é…ç½®æ–‡æ¡£</span></span><br><span class="line"><span class="comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤„ç†ç½‘ç»œè¯·æ±‚çš„çº¿ç¨‹æ•°é‡(æœåŠ¡å™¨ç”¨äºä»ç½‘ç»œæ¥æ”¶è¯·æ±‚å¹¶å‘ç½‘ç»œå‘é€å“åº”çš„çº¿ç¨‹æ•°)</span></span><br><span class="line">num.network.threads=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æ¥å¤„ç†ç£ç›˜ IO çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line">num.io.threads=8</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚å¥—æ¥å­—çš„ç¼“å†²åŒºæœ€å¤§å¤§å°</span></span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Log Basics #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kafka è¿è¡Œæ—¥å¿—(æ•°æ®)å­˜æ”¾çš„è·¯å¾„,è·¯å¾„ä¸éœ€è¦æå‰åˆ›å»º,kafka è‡ªåŠ¨å¸®ä½ åˆ›å»º,å¯ä»¥é…ç½®å¤šä¸ªç£ç›˜è·¯å¾„,è·¯å¾„ä¸è·¯å¾„ä¹‹é—´å¯ä»¥ç”¨&quot;,&quot;åˆ†éš”</span></span><br><span class="line">log.dirs=/usr/kafka/kafka_2.13-3.6.1/datas</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªtopicåœ¨å½“å‰ brokerä¸Šçš„é»˜è®¤åˆ†åŒºæ•°ã€‚æ›´å¤šçš„åˆ†åŒºå…è®¸æ›´å¤§çš„å¹¶è¡Œæ€§ä»¥ä¾›ä½¿ç”¨ï¼Œä½†è¿™ä¹Ÿä¼šå¯¼è‡´ä»£ç†ä¹‹é—´æœ‰æ›´å¤šçš„æ–‡ä»¶ã€‚</span></span><br><span class="line">num.partitions=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æ—¶ç”¨äºæ—¥å¿—æ¢å¤å’Œå…³é—­æ—¶ç”¨äºåˆ·æ–°çš„æ¯ä¸ªæ•°æ®ç›®å½•çš„çº¿ç¨‹æ•°ã€‚(ç”¨æ¥æ¢å¤å’Œæ¸…ç† data ä¸‹æ•°æ®çš„çº¿ç¨‹æ•°é‡)å¯¹äºæ•°æ®ç›®å½•ä½äºRAIDé˜µåˆ—ä¸­çš„å®‰è£…ï¼Œå»ºè®®å¢åŠ æ­¤å€¼ã€‚</span></span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Internal Topic Settings  #############################</span></span><br><span class="line"><span class="comment"># æ¯ä¸ª topic åˆ›å»ºæ—¶çš„å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ—¶ 1 ä¸ªå‰¯æœ¬,å¯¹äºå¼€å‘æµ‹è¯•ä»¥å¤–çš„ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨å¤§äº1çš„å€¼ä»¥ç¡®ä¿å¯ç”¨æ€§ï¼Œå¦‚3</span></span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Log Flush Policy #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Messages are immediately written to the filesystem but by default we only fsync() to sync</span></span><br><span class="line"><span class="comment"># the OS cache lazily. The following configurations control the flush of data to disk.</span></span><br><span class="line"><span class="comment"># There are a few important trade-offs here:</span></span><br><span class="line"><span class="comment">#    1. Durability: Unflushed data may be lost if you are not using replication.</span></span><br><span class="line"><span class="comment">#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.</span></span><br><span class="line"><span class="comment">#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.</span></span><br><span class="line"><span class="comment"># The settings below allow one to configure the flush policy to flush data after a period of time or</span></span><br><span class="line"><span class="comment"># every N messages (or both). This can be done globally and overridden on a per-topic basis.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼ºåˆ¶å°†æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¹‹å‰è¦æ¥å—çš„æ¶ˆæ¯æ•°</span></span><br><span class="line"><span class="comment">#log.flush.interval.messages=10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å¼ºåˆ¶åˆ·æ–°ä¹‹å‰ï¼Œæ¶ˆæ¯å¯ä»¥åœ¨æ—¥å¿—ä¸­åœç•™çš„æœ€é•¿æ—¶é—´</span></span><br><span class="line"><span class="comment">#log.flush.interval.ms=1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Log Retention Policy #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The following configurations control the disposal of log segments. The policy can</span></span><br><span class="line"><span class="comment"># be set to delete segments after a period of time, or after a given size has accumulated.</span></span><br><span class="line"><span class="comment"># A segment will be deleted whenever *either* of these criteria are met. Deletion always happens</span></span><br><span class="line"><span class="comment"># from the end of the log.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># segment æ–‡ä»¶ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼Œè¶…æ—¶å°†è¢«åˆ é™¤</span></span><br><span class="line">log.retention.hours=168</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºäºå¤§å°çš„æ—¥å¿—ä¿ç•™ç­–ç•¥ã€‚é™¤éå‰©ä½™çš„</span></span><br><span class="line"><span class="comment"># segmentsä¸‹é™åˆ° log.retention.bytes ä»¥ä¸‹ã€‚ç‹¬ç«‹äºlog.retention.hoursçš„å‡½æ•°.</span></span><br><span class="line"><span class="comment">#log.retention.bytes=1073741824</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ª segment æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼Œé»˜è®¤æœ€å¤§ 1G ï¼Œå½“è¾¾åˆ°æ­¤å¤§å°æ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ªæ–°çš„segmentã€‚</span></span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ—¥å¿—æ®µä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥æ ¹æ®ä¿ç•™ç­–ç•¥åˆ é™¤å®ƒä»¬çš„é—´éš”(æ£€æŸ¥è¿‡æœŸæ•°æ®çš„æ—¶é—´ï¼Œé»˜è®¤ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æ•°æ®è¿‡æœŸ)</span></span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Zookeeper #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Zookeeperé›†ç¾¤è¿æ¥å­—ç¬¦ä¸²,ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„&#x27;ä¸»æœº:ç«¯å£&#x27;å¯¹ï¼Œæ¯ä¸ªå¯¹å¯¹åº”ä¸€ä¸ªzkæœåŠ¡å™¨ã€‚å¯ä»¥åœ¨urlä¸­é™„åŠ ä¸€ä¸ªå¯é€‰çš„chrootå­—ç¬¦ä¸²ï¼Œä»¥æŒ‡å®šæ‰€æœ‰kafka-znodeçš„æ ¹ç›®å½•ã€‚</span></span><br><span class="line">zookeeper.connect=10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ°zookeeper çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">zookeeper.connection.timeout.ms=18000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Group Coordinator Settings #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹é…ç½®æŒ‡å®šGroupCoordinatorå°†å»¶è¿Ÿåˆå§‹ä½¿ç”¨è€…é‡æ–°å¹³è¡¡çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># éšç€æ–°æˆå‘˜åŠ å…¥ç»„ï¼Œå†å¹³è¡¡å°†è¿›ä¸€æ­¥å»¶è¿Ÿgroup.initial.rebalance.delay.msçš„å€¼ï¼Œæœ€å¤§å€¼ä¸ºmax.poll.interval.msã€‚</span></span><br><span class="line"><span class="comment"># é»˜è®¤å€¼ä¸º3ç§’ã€‚</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬åœ¨è¿™é‡Œå°†å…¶è¦†ç›–ä¸º0ï¼Œå› ä¸ºå®ƒä¸ºå¼€å‘å’Œæµ‹è¯•æä¾›äº†æ›´å¥½çš„å¼€ç®±å³ç”¨ä½“éªŒã€‚</span></span><br><span class="line"><span class="comment"># ä½†æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé»˜è®¤å€¼3ç§’æ›´åˆé€‚ï¼Œå› ä¸ºè¿™å°†æœ‰åŠ©äºé¿å…åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æœŸé—´è¿›è¡Œä¸å¿…è¦çš„ã€å¯èƒ½ä»£ä»·é«˜æ˜‚çš„é‡æ–°å¹³è¡¡ã€‚</span></span><br><span class="line">group.initial.rebalance.delay.ms=3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²kafkaé›†ç¾¤">éƒ¨ç½²kafkaé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é‡å¤å•ç‚¹éƒ¨ç½²çš„1-6æ­¥éª¤ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé…ç½®æ–‡ä»¶çš„broker.id=211/212/213  æ ¹æ®ä½ çš„ipåå°¾è‡ªè¡Œä¿®æ”¹(ä¸‰ä¸ªèŠ‚ç‚¹ä¸ç›¸åŒï¼Œä¸”ä¸ºæ­£æ•´æ•°å°±è¡Œ)</span><br></pre></td></tr></table></figure><blockquote><p>æ¸©é¦¨æç¤ºï¼šä¸‰ä¸ª  èŠ‚ç‚¹åšhostsè§£æ,å°†ä¸»æœºåè§£æåˆ°ä½ çš„ipä¸Šï¼Œå·¨å‘ï¼Œä¸€å¼€å§‹å¿˜è®°åå‘è§£æè¿™ä¸ªé—®é¢˜äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk211 ~]# <span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">10.0.0.211 elk01</span></span><br><span class="line"><span class="string">10.0.0.212 elk02</span></span><br><span class="line"><span class="string">10.0.0.213 elk03</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241029185857776.png" alt="image-20241029185857776"></p><p>ä»¥æ­¤ä¸ºæˆ’ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å·¨å‘</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241029002841827.png" alt="image-20241029002841827"></p><blockquote><p>æˆ‘ä»¬é…ç½®æ–‡ä»¶é‡Œæ²¡æœ‰æŒ‡å®šæ¯ä¸ªkafkaçš„åœ°å€ï¼Œé‚£å®ƒä»¬æ˜¯å¦‚ä½•æ‰¾åˆ°å½¼æ­¤çš„å‘¢ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:4 ~]# grep -Ev <span class="string">&#x27;^#|^$&#x27;</span> /app/kafka_2.13-3.8.0/config/server.properties </span><br><span class="line">broker.id=211</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/app/data/kafka</span><br><span class="line">num.partitions=1</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181/kafka380</span><br><span class="line">zookeeper.connection.timeout.ms=18000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br></pre></td></tr></table></figure><p><font color=red>kafkaé€šè¿‡è¿æ¥zookeeperï¼Œå»æ‰¾åˆ°å„ä¸ªkafka</font></p></blockquote>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†Kafkaçš„ä½œç”¨,ä¼˜åŠ¿,è§’è‰²ä»¥åŠå¦‚ä½•éƒ¨ç½²kafkaé›†ç¾¤</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>10.zookeeperçš„å›¾å½¢åŒ–ç®¡ç†</title>
    <link href="https://lukme.top/posts/da2b0f43.html"/>
    <id>https://lukme.top/posts/da2b0f43.html</id>
    <published>2024-10-30T02:42:01.000Z</published>
    <updated>2024-10-30T04:02:29.309Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zookeeperçš„ç±»å‹">zookeeperçš„ç±»å‹</h2><ol><li>ä¸´æ—¶znodeç±»å‹</li></ol><p>å½“å®¢æˆ·ç«¯ä¼šè¯æ–­å¼€è¿æ¥ï¼Œè‹¥åœ¨è§„å®šæ—¶é—´(é»˜è®¤æ˜¯30s)å†…æ²¡æœ‰é‡æ–°è¿æ¥åˆ™è¯¥å®¢æˆ·ç«¯åˆ›å»ºçš„æ‰€æœ‰znodeéƒ½ä¼šè¢«åˆ é™¤ã€‚</p><ol start="2"><li>æ°¸ä¹…znode</li></ol><p>å½“å®¢æˆ·ç«¯ä¼šè¯æ–­å¼€è¿æ¥ï¼Œznodeä¸ä¼šè¢«åˆ é™¤ã€‚</p><blockquote><p>é»˜è®¤åˆ›å»ºçš„znodeéƒ½æ˜¯æ°¸ä¹…çš„ï¼Œå¦‚æœæƒ³è¦åˆ›å»ºä¸´æ—¶znodeï¼Œåˆ™éœ€è¦æŒ‡å®š&quot;-e&quot;å‚æ•°ã€‚</p></blockquote><p><strong>éªŒè¯æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹znodeçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] <span class="built_in">stat</span> /luay</span><br><span class="line">cZxid = 0x400000002</span><br><span class="line">ctime = Mon Oct 28 13:09:07 UTC 2024</span><br><span class="line">mZxid = 0x40000000e</span><br><span class="line">mtime = Mon Oct 28 13:11:34 UTC 2024</span><br><span class="line">pZxid = 0x40000000b</span><br><span class="line">cversion = 5</span><br><span class="line">dataVersion = 3</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸´æ—¶åˆ›å»ºznode</span></span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] create -e /abc</span><br><span class="line">Created /abc</span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 6] <span class="built_in">stat</span> /abc</span><br><span class="line">cZxid = 0xf00000002</span><br><span class="line">ctime = Mon Oct 28 14:23:04 UTC 2024</span><br><span class="line">mZxid = 0xf00000002</span><br><span class="line">mtime = Mon Oct 28 14:23:04 UTC 2024</span><br><span class="line">pZxid = 0xf00000002</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0xd500028c8caa0000</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 0</span><br><span class="line"></span><br><span class="line">`æ³¨æ„ï¼šephemeralOwnerè¿™ä¸€è¡Œï¼Œä¸æ˜¯å’Œä¸Šé¢æ°¸ä¹…znodeçŠ¶æ€ä¸€æ ·ï¼Œä¸Šé¢æ°¸ä¹…çš„æ˜¯0x0`</span><br><span class="line"></span><br><span class="line"><span class="comment">#é€€å‡ºè¿æ¥ç­‰å¾…30så†æ¬¡è¿æ¥æŸ¥çœ‹--æ²¡äº†</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 0] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;é‡æ–°å»ºç«‹é“¾æ¥ï¼Œé»˜è®¤30såæ•°æ®å°±è‡ªåŠ¨åˆ é™¤ï¼&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="zookeeperçš„JVMè°ƒä¼˜">zookeeperçš„JVMè°ƒä¼˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.zookeeperçš„å †å†…å­˜è°ƒä¼˜æ€è·¯ï¼ˆè¿™é‡Œè°ƒè¯•128mæµ‹è¯•ï¼‰</span><br><span class="line">ç”Ÿæˆç¯å¢ƒä¸­ï¼Œå»ºè®®é…ç½®2GB-4GBå³å¯ã€‚é»˜è®¤æ˜¯1GBã€‚</span><br><span class="line"></span><br><span class="line">2.æŸ¥çœ‹é»˜è®¤çš„å †å†…å­˜å¤§å°</span><br><span class="line">[root@elk03:1 ~]#  ps -ef | grep zookeeper | grep -i xmx</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241028223011825.png" alt="image-20241028223011825"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">3.ä¿®æ”¹å®˜æ–¹çš„ç¯å¢ƒå˜é‡è„šæœ¬</span><br><span class="line">[root@elk03:1 ~]# <span class="built_in">cat</span> /app/zookeeper/bin/zkEnv.sh </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># default heap for zookeeper server</span></span><br><span class="line">ZK_SERVER_HEAP=<span class="string">&quot;<span class="variable">$&#123;ZK_SERVER_HEAP:-128&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># default heap for zookeeper client</span></span><br><span class="line">ZK_CLIENT_HEAP=<span class="string">&quot;<span class="variable">$&#123;ZK_CLIENT_HEAP:-128&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">4. åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹</span><br><span class="line">[root@elk03 ~]# scp /app/zookeeper/bin/zkEnv.sh 10.0.0.211:/app/zookeeper/bin/  </span><br><span class="line">[root@elk03 ~]# scp /app/zookeeper/bin/zkEnv.sh 10.0.0.212:/app/zookeeper/bin/</span><br><span class="line"></span><br><span class="line">5.é‡å¯zookeeperé›†ç¾¤ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br><span class="line">[root@elk03:1 ~]# zkServer.sh restart</span><br><span class="line"></span><br><span class="line">6.å†æ¬¡æŸ¥çœ‹å ç”¨å†…å­˜å¤§å°</span><br><span class="line">[root@elk03 ~]# ps -ef | grep zookeeper | grep -i xmx</span><br></pre></td></tr></table></figure><h2 id="zookeeperçš„å›¾å½¢åŒ–ç®¡ç†">zookeeperçš„å›¾å½¢åŒ–ç®¡ç†</h2><p><strong>äº†è§£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¾èµ–1.8ç‰ˆæœ¬jdk</span></span><br><span class="line">https://github.com/zhitom/zkweb/releases/download/zkWeb-v1.2.1/zkWeb-v1.2.1.jar</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.è§£å‹jdk</span><br><span class="line">[root@elk01 ~]#tar xf jdk-8u291-linux-x64.tar.gz -C /app/</span><br><span class="line"></span><br><span class="line">2.å‰å°å¯åŠ¨zkweb</span><br><span class="line">[root@elk01 ~]# /app/jdk1.8.0_291/bin/java -jar /app/zkWeb-v1.2.1.jar </span><br><span class="line"></span><br><span class="line">åå°å¯åŠ¨ï¼š</span><br><span class="line">[root@elk01 ~]# <span class="built_in">nohup</span> /app/jdk1.8.0_291/bin/java -jar /app/zkWeb-v1.2.1.jar &amp;&gt; /tmp/zkweb.log</span><br><span class="line"></span><br><span class="line">3.æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.211:8099/</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šå¤šä¸ªèŠ‚ç‚¹ç›´æ¥ä»¥   ,  åˆ†å¼€  10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181</p></blockquote><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241028231813958.png" alt="image-20241028231813958"></p><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241028232321533.png" alt="image-20241028232321533"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†zookeeperä½¿ç”¨å›¾å½¢åŒ–ç®¡ç†ä»¥åŠJVMå†…å­˜è°ƒä¼˜</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>09.zookeeperé›†ç¾¤éƒ¨ç½²</title>
    <link href="https://lukme.top/posts/1c1f467f.html"/>
    <id>https://lukme.top/posts/1c1f467f.html</id>
    <published>2024-10-30T02:41:01.000Z</published>
    <updated>2024-10-30T04:02:23.769Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zookeeperä½œç”¨å’Œåº”ç”¨åœºæ™¯">zookeeperä½œç”¨å’Œåº”ç”¨åœºæ™¯</h2><p><strong>1.zookeeperå­˜å‚¨ä»€ä¹ˆæ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å­˜å‚¨çš„ä¸»è¦æ˜¯ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºæœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡å‘ç°ç­‰å¸¸è§ã€‚</span><br><span class="line">zookeeperçš„å­˜å‚¨ç»“æ„å’ŒLinuxæ–‡ä»¶ç³»ç»Ÿå¾ˆç›¸ä¼¼ï¼Œæœ‰å¤šçº§ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">å’ŒLinuxçš„æ ¹æ–‡ä»¶ç³»ç»Ÿå’Œç±»ä¼¼ï¼Œåˆ†ä¸ºç›®å½•å’Œæ–‡ä»¶ï¼Œzookeeperä¹Ÿç±»ä¼¼ï¼Œåªä¸è¿‡æ²¡æœ‰æ–‡ä»¶å’Œç›®å½•çš„åŒºåˆ«ï¼Œè€Œæ˜¯éƒ½ç§°ä¹‹ä¸ºzookeeper nodeï¼Œç®€ç§°znodeã€‚</span><br><span class="line"></span><br><span class="line">znodeä¸é€‚åˆå­˜å‚¨å¤§é‡æ•°æ®ï¼Œä¸€ä¸ªznodeé»˜è®¤æœ€å¤§å­˜å‚¨2MBçš„æ•°æ®ã€‚</span><br></pre></td></tr></table></figure><p><strong>2.zookeeperçš„åº”ç”¨åœºæ™¯</strong></p><p>å’Œkafkaï¼Œhbaseï¼ŒHDFSï¼ŒYARNï¼ŒDubboï¼ŒSolrç­‰æœåŠ¡ï¼Œæä¾›äº†é…ç½®ä¿¡æ¯ï¼Œæ³¨å†Œä¸­å¿ƒç­‰è¾…åŠ©åŠŸèƒ½ã€‚</p><p><strong>ElasticStackæ¶æ„å‡çº§â€“MQ</strong></p><blockquote><p>filebeatæ•°æ®é‡‡é›†äº¤ç»™Kafkaæ¶ˆæ¯é˜Ÿåˆ—ï¼Œlogstashå»æ‹‰å–Kafkaé‡Œçš„æ•°æ®å¤„ç†äº¤ç»™ESé›†ç¾¤</p></blockquote><p><img src="https://cos.lukme.top/Pic/ElasticStack_MQ.png" alt="ElasticStack_MQ"></p><p>æ¶ˆæ¯é˜Ÿåˆ—äº§å“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rocket MQ</span><br><span class="line">Active MQ</span><br><span class="line">Kafka</span><br><span class="line">Rebbit MQ</span><br></pre></td></tr></table></figure><h2 id="zookeeperå•ç‚¹éƒ¨ç½²">zookeeperå•ç‚¹éƒ¨ç½²</h2><p><code>è¿™é‡Œä»…ä¸ºæµ‹è¯•ï¼Œå¯è·³è¿‡æ­¥éª¤ 4,5 ç›´æ¥éƒ¨ç½²é›†ç¾¤ï¼Œé¿å…å•ç‚¹æ•…éšœ</code></p><blockquote><p>å®˜æ–¹ç‰ˆæœ¬é€‰æ‹©ï¼š<a href="https://zookeeper.apache.org/releases.html">https://zookeeper.apache.org/releases.html</a></p><p>zookeeperé›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡é€‰æ‹©</p><p>å½“æ¯ç§’è¯·æ±‚é‡ä½äº6w/sï¼Œè¯»å–æ•°æ®å æ®70%ï¼Œå¤§å¤šæ•°æ˜¯è¯»çš„åœºæ™¯ï¼Œå®˜æ–¹æµ‹è¯•æ•°æ®å»ºè®®é€‰æ‹©3å°é›†ç¾¤ã€‚</p></blockquote><p><strong>1.ä¸‹è½½zookeeper</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br></pre></td></tr></table></figure><p>**2.è§£å‹è½¯ä»¶åŒ… **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# tar xf apache-zookeeper-3.8.4-bin.tar.gz -C /app/</span><br><span class="line"></span><br><span class="line"><span class="comment">#åšè½¯é“¾æ¥</span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">ln</span> -s /app/apache-zookeeper-3.8.4-bin/ /app/zookeeper</span><br></pre></td></tr></table></figure><p><strong>3.é…ç½®ç¯å¢ƒå˜é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# <span class="built_in">cat</span> /etc/profile.d/zk.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/share/elasticsearch/jdk</span><br><span class="line"><span class="built_in">export</span> ZK_HOME=/app/zookeeper</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZK_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">source</span> /etc/profile.d/zk.sh</span><br></pre></td></tr></table></figure><p><strong>4.å‡†å¤‡é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]#  <span class="built_in">cp</span> /app/zookeeper/conf/zoo&#123;_sample,&#125;.cfg </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™é‡Œåªæ˜¯å¯¹é…ç½®æ–‡ä»¶çš„è§£è¯»ï¼Œæœªä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¤åˆ¶å‡ºæ¥é»˜è®¤å³å¯</span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">cat</span> /app/zookeeper/conf/zoo.cfg </span><br><span class="line"><span class="comment"># æŒ‡å®šæœ€å°çš„æ—¶é—´å•ä½tickï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ï¼Œæ­¤å¤„æœ€å°å•ä½æ˜¯1  tick=2s</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="comment"># åœ¨é›†ç¾¤åˆå§‹åŒ–æ—¶çš„æ—¶é—´é»˜è®¤æ˜¯10 tickï¼Œåˆ™è¡¨ç¤º20s</span></span><br><span class="line">initLimit=10</span><br><span class="line"><span class="comment"># æ•°æ®åŒæ­¥æ—¶é—´5 tickï¼Œåˆ™è¡¨ç¤º10s</span></span><br><span class="line">syncLimit=5</span><br><span class="line"><span class="comment"># æ•°æ®çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line">dataDir=/tmp/zookeeper</span><br><span class="line"><span class="comment"># æœåŠ¡ç›‘å¬çš„ç«¯å£</span></span><br><span class="line">clientPort=2181</span><br></pre></td></tr></table></figure><p><strong>5.å¯åŠ¨æµ‹è¯•</strong></p><blockquote><p>æ³¨æ„ï¼Œzookeeperå¯åŠ¨ä¼šç›‘å¬8080ç«¯å£ï¼Œå¯åŠ¨å¤±è´¥æ³¨æ„æŸ¥çœ‹ç«¯å£å†²çª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ’é”™çœ‹æ—¥å¿—</span></span><br><span class="line">[root@elk01:3 ~]# ll /app/zookeeper/logs/</span><br><span class="line">-rw-r--r-- 1 root root 16469 Oct 28 17:12 zookeeper-root-server-elk01.out</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">[root@elk01:3 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: standalone</span><br><span class="line"></span><br><span class="line"><span class="comment">#standalone  å•ç‚¹çŠ¶æ€</span></span><br></pre></td></tr></table></figure><p><strong>è¿æ¥æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# zkCli.sh      æˆ–è€…</span><br><span class="line">[root@elk01:3 ~]# zkCli.sh -server 10.0.0.211</span><br><span class="line"></span><br><span class="line">2024-10-28 17:06:31,811 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn<span class="variable">$SendThread</span>@1453] - Session establishment complete on server localhost/127.0.0.1:2181, session <span class="built_in">id</span> = 0x10001704a360000, negotiated <span class="built_in">timeout</span> = 30000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:None path:null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] <span class="built_in">ls</span> /      <span class="comment">#lså‘½ä»¤æµ‹è¯•ä¸‹</span></span><br><span class="line">[zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‡ºç°å®ƒçš„session id  å³ä¸ºéƒ¨ç½²æˆåŠŸ</span></span><br></pre></td></tr></table></figure><h2 id="zookeeperé›†ç¾¤éƒ¨ç½²">zookeeperé›†ç¾¤éƒ¨ç½²</h2><blockquote><p>å¦‚æœzookeeperå•ç‚¹æœªåšï¼Œæ­¥éª¤1,3å¯è·³è¿‡</p></blockquote><p><strong>1. åœæ­¢æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# zkServer.sh stop</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Stopping zookeeper ... STOPPED</span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /app/zookeeper/conf/zoo.cfg </span><br><span class="line"><span class="comment"># å®šä¹‰æœ€å°å•å…ƒçš„æ—¶é—´èŒƒå›´tickã€‚</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="comment"># å¯åŠ¨æ—¶æœ€é•¿ç­‰å¾…tickæ•°é‡ã€‚</span></span><br><span class="line">initLimit=5</span><br><span class="line"><span class="comment"># æ•°æ®åŒæ­¥æ—¶æœ€é•¿ç­‰å¾…çš„tickæ—¶é—´è¿›è¡Œå“åº”ACK</span></span><br><span class="line">syncLimit=2</span><br><span class="line"><span class="comment"># æŒ‡å®šæ•°æ®ç›®å½•</span></span><br><span class="line">dataDir=/app/data/zk</span><br><span class="line"><span class="comment"># ç›‘å¬ç«¯å£</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># å¼€å¯å››å­—å‘½ä»¤å…è®¸æ‰€æœ‰çš„èŠ‚ç‚¹è®¿é—®ã€‚</span></span><br><span class="line">4lw.commands.whitelist=*</span><br><span class="line"><span class="comment"># server.ID=A:B:C[:D]</span></span><br><span class="line"><span class="comment"># ID:</span></span><br><span class="line"><span class="comment">#    zkçš„å”¯ä¸€ç¼–å·ã€‚</span></span><br><span class="line"><span class="comment"># A:</span></span><br><span class="line"><span class="comment">#    zkçš„ä¸»æœºåœ°å€ã€‚</span></span><br><span class="line"><span class="comment"># B:</span></span><br><span class="line"><span class="comment">#    leaderçš„é€‰ä¸¾ç«¯å£ï¼Œæ˜¯è°leaderè§’è‰²ï¼Œå°±ä¼šç›‘å¬è¯¥ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># C: </span></span><br><span class="line"><span class="comment">#    æ•°æ®é€šä¿¡ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># D:</span></span><br><span class="line"><span class="comment">#    å¯é€‰é…ç½®ï¼ŒæŒ‡å®šè§’è‰²ã€‚</span></span><br><span class="line">server.91=10.0.0.211:2888:3888</span><br><span class="line">server.92=10.0.0.212:2888:3888</span><br><span class="line">server.93=10.0.0.213:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="comment">## Metrics Providers</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://prometheus.io Metrics Exporter</span></span><br><span class="line"><span class="comment">#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span></span><br><span class="line"><span class="comment">#metricsProvider.httpHost=0.0.0.0</span></span><br><span class="line"><span class="comment">#metricsProvider.httpPort=7000</span></span><br><span class="line"><span class="comment">#metricsProvider.exportJvmInfo=true</span></span><br></pre></td></tr></table></figure><p><strong>3.æ¢å¤åŸç¯å¢ƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# <span class="built_in">rm</span> -fr /app/zookeeper/logs/*</span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">rm</span> -fr tmp/zookeeper/*</span><br></pre></td></tr></table></figure><p><strong>4. åŒæ­¥æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ‹·è´ç¯å¢ƒå˜é‡æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]# scp /etc/profile.d/zk.sh 10.0.0.212:/etc/profile.d/</span><br><span class="line">[root@elk01 ~]# scp /etc/profile.d/zk.sh 10.0.0.213:/etc/profile.d/</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‹·è´zookeeperæ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]# scp apache-zookeeper-3.8.4-bin.tar.gz 10.0.0.212:/root</span><br><span class="line">[root@elk01 ~]# scp apache-zookeeper-3.8.4-bin.tar.gz 10.0.0.213:/root</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨å¯¹ç«¯è§£å‹zookeeperï¼Œåšè½¯é“¾æ¥ï¼ˆä¸¤ä¸ªèŠ‚ç‚¹åŒæ­¥æ“åšï¼‰</span></span><br><span class="line">[root@elk02 ~]# tar xf apache-zookeeper-3.8.4-bin.tar.gz -C /app/</span><br><span class="line"></span><br><span class="line">[root@elk02 ~]# <span class="built_in">ln</span> -s /app/apache-zookeeper-3.8.4-bin/ /app/zookeeper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‹·è´zookeeperé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg 10.0.0.212:/app/zookeeper/conf/</span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg 10.0.0.213:/app/zookeeper/conf/</span><br></pre></td></tr></table></figure><p><strong>5.ç”Ÿæˆmyidæ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºæ•°æ®ç›®å½•ï¼ˆé…ç½®æ–‡ä»¶é‡Œå£°æ˜çš„ç›®å½•ï¼‰  </span></span><br><span class="line">`è¿™é‡Œä½¿ç”¨å¾ªç¯æ˜¯å› ä¸ºä¸‰å°æœºå™¨æˆ‘å·²ä¸¤ä¸¤åšäº†å…å¯†,å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä½¿ç”¨å‘½ä»¤  <span class="built_in">mkdir</span> /app/data/zk -p`</span><br><span class="line">[root@elk01:3 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 211 213` ;<span class="keyword">do</span> ssh 10.0.0.<span class="variable">$i</span> <span class="built_in">mkdir</span> /app/data/zk -p ;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆmyidæ–‡ä»¶</span></span><br><span class="line">[root@elk01:3 ~]# <span class="keyword">for</span> n <span class="keyword">in</span> `<span class="built_in">seq</span> 211 213` ;<span class="keyword">do</span> ssh 10.0.0.<span class="variable">$n</span> <span class="string">&quot;echo <span class="variable">$n</span> &gt; /app/data/zk/myid&quot;</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#myidæ–‡ä»¶ä½œç”¨</span></span><br><span class="line">å¦‚æœé¦–æ¬¡å¯åŠ¨æ—¶å€™æ²¡æœ‰äº‹åŠ¡æ–‡ä»¶ï¼Œåˆ™ä¼šæ¯”è¾ƒmyidæ–‡ä»¶é‡Œï¼Œè°æœ€å¤§è°å°±æ˜¯master</span><br></pre></td></tr></table></figure><p><strong>6.å¯åŠ¨æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# zkServer.sh start</span><br><span class="line">[root@elk02 ~]# zkServer.sh start</span><br><span class="line">[root@elk03 ~]# zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæŠ¥é”™æ‰¾ä¸åˆ°å‘½ä»¤ï¼Œå¯èƒ½æ˜¯é…ç½®çš„ç¯å¢ƒå˜é‡æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ‰§è¡Œå¦‚ä¸‹</span></span><br><span class="line">[root@elk03 ~]# <span class="built_in">source</span> /etc/profile.d/zk.sh </span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">[root@elk03:1 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: leader</span><br></pre></td></tr></table></figure><p><strong>7.é¿å‘æŒ‡å—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘æ‰€é‡åˆ°çš„å‘ï¼š</span><br><span class="line"> 1.å¦‚æœåšé›†ç¾¤ï¼Œä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œå¦åˆ™ä¼šæœ‰zookeeperèµ·ä¸æ¥æƒ…å†µ</span><br><span class="line"> 2.åˆ é™¤å¦‚æœä½ æƒ³æ¸…ç©ºç¯å¢ƒé‡æ–°å¯åŠ¨zookeeperï¼Œè®°å¾—æ—¥å¿—å’Œæ•°æ®ç›®å½•ä¸€èµ·æ¸…é™¤ï¼Œå¦åˆ™æœåŠ¡èµ·ä¸æ¥</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯zookeeperé›†ç¾¤é«˜å¯ç”¨">éªŒè¯zookeeperé›†ç¾¤é«˜å¯ç”¨</h2><p><strong>1.è¿æ¥æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# zkCli.sh -server 10.0.0.212:2181</span><br><span class="line">[root@elk01 ~]# zkCli.sh -server 10.0.0.213:2181</span><br><span class="line">Â·Â·Â·</span><br><span class="line">ablishment complete on server elk03/10.0.0.213:2181, session <span class="built_in">id</span> = 0xd40001f2a52b0000, negotiated <span class="built_in">timeout</span> = 30000</span><br></pre></td></tr></table></figure><p><strong>2. å°†leaderèŠ‚ç‚¹æŒ‚æ‰ï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨é€‰ä¸¾å‡ºæ–°çš„leaderï¼Œé›†ç¾¤æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å½“å‰leaderèŠ‚ç‚¹æ˜¯elk03</span></span><br><span class="line">[root@elk03 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: leader</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢elk03çš„zookeeper</span></span><br><span class="line">[root@elk03 ~]# zkServer.sh stop</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Stopping zookeeper ... STOPPED</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»æŸ¥çœ‹leaderåœ¨elk02èŠ‚ç‚¹ä¸Š</span></span><br><span class="line">[root@elk02 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: leader</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæ­¤æ—¶å†æ¬¡åœæ­¢leaderèŠ‚ç‚¹ï¼Œé‚£è¿˜ä¼šä¸ä¼šå†é€‰ä¸¾ï¼Ÿ</span></span><br><span class="line">`ç»æµ‹è¯•ï¼Œåœæ‰elk02èŠ‚ç‚¹çš„zookeeperæ—¶å€™ï¼Œelk01èŠ‚ç‚¹ä¸ä¼šé€‰ä¸¾ä¸ºleaderï¼Œè€Œæ˜¯ä¼šåœæ­¢zookeeperæœåŠ¡`</span><br><span class="line">è¿™ä¹Ÿæ˜¯æˆ‘å‰é¢çŒœçš„å‘ï¼Œåªæœ‰ä¸€å°zookeeperæ—¶å€™æ˜¯èµ·ä¸æ¥æœåŠ¡çš„</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¢å¤  ä¸¤ä¸ªèŠ‚ç‚¹åœæ­¢çš„æœåŠ¡é‡æ–°å¯ç”¨å³å¯</span></span><br></pre></td></tr></table></figure><blockquote><p>æ€»ç»“ï¼š</p><p>1.zookeeperåˆ†å¸ƒå¼é›†ç¾¤çš„ç‰¹ç‚¹ï¼ŒåŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»æ‰èƒ½å¯¹å¤–æä¾›æœåŠ¡;<br>2.zookeeperä¸€ä¸ªé›†ç¾¤ä¸­ä»…æœ‰ä¸€ä¸ªleaderå’Œå¤šä¸ªfollower;<br>3.å¦‚æœä¸€ä¸ªzookeeperé›†ç¾¤æƒ³è¦å®¹å¿Nå°æ•…éšœï¼Œè¯¥é›†ç¾¤æœ€å°‘è¦æœ‰2N+1ä¸ªèŠ‚ç‚¹</p></blockquote><h2 id="zookeeperåŸºç¡€å‘½ä»¤">zookeeperåŸºç¡€å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿æ¥zookeeper</span></span><br><span class="line">[root@elk02:1 ~]# zkCli.sh</span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:None path:null</span><br><span class="line"></span><br><span class="line"><span class="comment">#1. æŸ¥çœ‹znodeåˆ—è¡¨</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] <span class="built_in">ls</span> /</span><br><span class="line">[zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. åˆ›å»ºznode</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] create /luay</span><br><span class="line">Created /luay</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. åˆ›å»ºznodeæ—¶æŒ‡å®šæ•°æ®</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] create /test abc</span><br><span class="line">Created /test</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. æŸ¥çœ‹znodeçš„æ•°æ®</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] get /test</span><br><span class="line">abc</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. ä¿®æ”¹znodeçš„å€¼</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 7] get /luay</span><br><span class="line">null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 8] <span class="built_in">set</span> /luay new</span><br><span class="line">[zk: localhost:2181(CONNECTED) 9] get /luay</span><br><span class="line">new</span><br><span class="line"></span><br><span class="line"><span class="comment">#6. åˆ›å»ºå­znode</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 10] <span class="built_in">ls</span> /luay </span><br><span class="line">[]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] create /luay/happy xixi</span><br><span class="line">Created /luay/happy</span><br><span class="line">[zk: localhost:2181(CONNECTED) 12] get /luay/happy</span><br><span class="line">xixi</span><br><span class="line"></span><br><span class="line"><span class="comment">#7. åˆ é™¤znodeï¼Œå‰ææ˜¯è¯¥znodeæ²¡æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 13] <span class="built_in">ls</span> /test</span><br><span class="line">[] </span><br><span class="line">[zk: localhost:2181(CONNECTED) 14] delete /test</span><br><span class="line">[zk: localhost:2181(CONNECTED) 15] <span class="built_in">ls</span> /test</span><br><span class="line">Node does not exist: /test</span><br><span class="line">[zk: localhost:2181(CONNECTED) 16] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#8. åˆ é™¤éç©ºznodeï¼Œè¯¥znodeæœ‰å­èŠ‚ç‚¹ï¼Œä¼šæŠ¥é”™</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 17] delete /luay</span><br><span class="line">Node not empty: /luay</span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] </span><br></pre></td></tr></table></figure><blockquote><p>ä½ ä¼šå‘ç°æˆ‘è¿æ¥zookeeperæ—¶å€™æ˜¯è¿˜æœ‰æœ¬åœ°è¿æ¥æ–¹å¼ï¼Œå½“æˆ‘ä½¿ç”¨è¿œç¨‹æ–¹å¼è¿æ¥elk01æ—¶å€™ä¹Ÿä¼šæœ‰æ•°æ®ï¼Œå› ä¸ºzookeeperåšäº†é›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03 ~]# zkCli.sh -server 10.0.0.211:2181</span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br></pre></td></tr></table></figure></blockquote><h2 id="zookeeperçš„watchæœºåˆ¶ï¼ˆäº†è§£ï¼‰">zookeeperçš„watchæœºåˆ¶ï¼ˆäº†è§£ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œå…¶ä¸­ä¸€ä¸ªç»ˆç«¯ä½¿ç”¨watchï¼Œå¦ä¸€ä¸ªç»ˆç«¯åˆ›å»ºå­znode</span><br><span class="line"></span><br><span class="line"><span class="comment">#1. ç›‘æ§ä¸€ä¸ªznodeä¸‹å­èŠ‚ç‚¹çš„å˜åŒ–</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 0] <span class="built_in">ls</span> -w /luay</span><br><span class="line">[]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘èµ·åˆ›å»ºåŠ¨ä½œ</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 11] create /luay/abc</span><br><span class="line">Created /luay/abc</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›‘æ§ç»ˆç«¯åˆ™è¾“å‡º</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 1] </span><br><span class="line">WATCHER::</span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:NodeChildrenChanged path:/luay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç›‘æ§znodeçš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ– ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯åªéœ€è¦ä¿®æ”¹znodeå€¼å³å¯ç›‘æ§åˆ°ï¼‰</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 0] get -w /luay</span><br><span class="line">[]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼š</span></span><br><span class="line">- 1.watchäº‹ä»¶æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œåªè®°å½•ç¬¬ä¸€æ¬¡åˆ›å»ºæˆ–è€…ä¿®æ”¹åŠ¨ä½œ;</span><br><span class="line">- 2.watchäº‹ä»¶ä¸€æ—¦è§¦å‘ï¼Œå°±ä¼šé€šçŸ¥ç›‘æ§è€…ç¨‹åºï¼Œç”±è¯¥ç¨‹åºå»è´Ÿè´£ç›¸åº”çš„é€»è¾‘å¤„ç†;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†zookeeperé›†ç¾¤çš„éƒ¨ç½²åŠåŸºäºkafkaæ¶æ„å›¾</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>08.æ–‡æ¡£è¯»å†™æµç¨‹</title>
    <link href="https://lukme.top/posts/cfedfcaa.html"/>
    <id>https://lukme.top/posts/cfedfcaa.html</id>
    <published>2024-10-30T02:40:01.000Z</published>
    <updated>2024-10-30T04:02:17.234Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="ce8649610c701f3708bbd23f88d3c1e9008927ca3698c07b84a347bc963191c5">410fa1838f124ea5ac656ff0dc0984fe4470cc585ff257fdda3d3583f45908bb850cfcf9a51c23fc8a55ff84b4e6e27df94ca98ba14ea1d297b3e8b70e9bea7a1474236149082d0911fc5a3d8e00a27d0b982c3ed00e847d4729006cc158aa07e8587bc1f402f37255301c51246228886368208b80e98152c3136ede0651c3551d3586ea2b0452074da05e43a1e1ebad6cb20aa6c0dfb57b12114f073835a96fe371cb615651ed87dc9a1c964c7b6e4538635dc4f5ae11e3e671cf889a6c5720e20ae12049d046ad03c30a6be4857e95c4d91af895436a2004b4f82163dc3dfa4d8beb8ea8753a1940632e9337686184d092625b128007a0e031a54056f1f9809e4df1893613fb49e334de4b17c06969a1696c690f54bf6ba0db7350819925133af8ed6a9ac71e0520ab729b178362f6e6c857a00d6bfded6bcce1b59ca145fe12bc9097575dc0b7a68eb202f135bcddf59c42301360407c75bec3f3cfcd876c0d33b97477f3de1711094069735061a933d250283972016957409d3b5a0bdf09106e73a024981da8f793ace4c295e3c09fbe5aae74528b496a7fb47b4f285f0bc489f6a5e783f23d2ab6a50c8e351a3da8e2a8c6b76224ef5841ee59764864370162e37763c5aaec52ce8eb32615f0783edd55f26f4ce0db5b26a1e9ccfc92475d852ee103a6bb2e923a5c4dee66c242467341271847f34c0f7f1000b57df7fa6fa88e58778838ab42376d539873ae9c201f0642f7a17bae9202a9c271e6bc9968d3ff70aa9784d0d1662e37c6d56ca295314575e3cedc5c909011a91f548f8d218e182c61ebecc0f94a99e74f4508b047517ab72b58a71aec5f95814ff7ff8f468db8d4af1bcb5cf9c172d818d3da273cdd5357ac05db58774928755fc4caaf56d13059eac973f57e4dfd253057d86caadefc455b672e00e0d312ff43650a495d9c1259ed706f75fbf5e7bcf3ba5d37454e83e370222dbf5b8e81358533591a0644682c18ef5b74ea39777d33f802c007f533ea9c03e505d664b3c5871452d6feb15b18b228502fadda2fe2b4b184dcd00607fc4fcedd87032e2933b297d46be31068b7e5d4abaebc89220786b4820527f390d74a7f755b834bf083b611b43bbbc3ff980ec0fdfffdfa7482881fc95033db261bd8655f27b214d18df8d981473a2b50dec0a154ee54746c7155397cfd6284685d2177acca4cf634c052ad2d656a8a5a457b39f9e58c35de974d8fcdb6cadc3f3ff46746943ed6981dcfdea564db24649cc48d89fd5bd1dadcfd43159530987176484fa0a495e91189b6651d87945b72294962a42edbb199a0ce9aa299f22e6a2093f40d0369bc516bdcb34339c4a4c965c29baedb67786164a8289d2b880762722423766f24ed5af9481826ba59af5b1eff7a953793069139e3438fba72624288e7388a057a4d165b529e63f93566baa28cbcd664642a5e6e3bcd60b47ea112e9cdc85828f110c0b1ca10d8aca17084544eaeac3aad1d570186bfc6a76f0fd594d56c9bb3a58da36ed0394c5aa199e5a1e193da7d81e9271bc48369b50699b254aaebe77ab6a918ed32f0362bb56d1353de4d8ee419ff57c79f5b87e4497bd5ae9b08b3b0e55ed88df5f8867c3092148f77fa00493eac5aa4b581ae9516a4db456a316c1e14cde5db8148985c64c5f279e30262f0526c61194a335a80ac5ae836b7d13a1349bb3c05fdf88e2a57c9ff8aa855083a55862c70f065d975a699ea1138f9eb945a521b7ee1b7798b7449a450738587dd4d1a1eb87c66332a61aa286dd20a43429ac3e320cf9fb8e480d37692dab587b7e6c709f05dcafede114c265104a678d88f571a2f0c91ac42d82f0483c6610988c77a10a212c2181f40d98d443f9ef42235d9b35ad7e5e682cbf2fae3d4610e86923fd23a2fe0cf515e57b55ae46a12187a0b01cbd76342c9f64e62cd2151da8bb431ef838f4b60aa58a84243d8b7a4095a41fe1e16139cbd87912c6be1541fe34e0c711df26036678d3aef47df38ae2514e9955e316de8c7a2420fba2447e160bd0654a6dfaaa06dc2f9b5a021aae21b55768848eed619d7750f6747d3a9abfa9010c12ccf4c0be9d152c8acb35f16ca10765d302fd00ad094facdb63bfd187934c615ab42bb35623a9b53d76a2155db4aca353406e774d5c5245d1faf18047d80a2f56124b0b838bfd73ded750a2718115926b7036e3c74202a57c62f0e517a3f4207fb4f48e2f9d5ca325d6f11d5b16813f9c0baa4a41642e40d51b866a8aeed4730b16f59ab7af829b039ba547863a7bb89a74fc3c1649e5e71926a85716eac0dc816f748fc87b3cef1b1d150a1f0a7052c8c9129b3e4f18927c57c5d23f2004157bba9746742d1a04cdb710d41a8dddbfa7a2743cfbbce111ee7b21dae3497c93114841ba504be82319fdc4e38f387b30ea9363c53d7e6906a864289689ab61a0ac4f69b64495fd71c6f41115c9841d52e2a7c054265e3e00d8d8e07a699b09f9138d495d0b0962fd3cae50f787c00950d43aac93c81c355f557061e40b3b0262b07a4d13030e2caf1ae4be95ea1c749ad1369a88c545f41f0872b1e5f028b2518aa1dae3324b338b2b43853e35eee3e23d99b39090526b4b1f5e0b5954e62412ad241a186ceb9dc42b4982d560d26c40470dc380a49f89e921f9d95d948650e77cb4b0841652c364f6254df0ea1b0ba8c8db4c2fbfe407954857f67fa0f9520f7d77aea933729d464c97251bc9a2cd4f1c06fa237b8da05b17e1a28f1ab294dc3612bdb5b83d942f2dcaf30a6b2b98f37e7620acba822a401d8dd34b3acebba90dbc5db534ebcbdc4e74d9ea458225eca0b2130ea57089d1bb369c2fe5d6659b2471a3272c1772491f8b81a32bc5dab89e24f2196e3d5fe1ec8534b0c385e69ac88c2a0c723a3b9036912ee2ce051dfc886c686ba88ba9deb0fd6e4663a7f161a79e3ef03f3b19e9f9741990391b2188fd7170c4f2defc46507c0d76c7ee17acecd7f59bd9bf268376677ca001a2fafa25d3fda87fe61654415ca95b94e5788dd83d9459649890341f137138705a551aebaf1b619896e27cd5f436bc1ea6d8bc99edd8db42554c8162bf5568cea739fc2f0da464ba391ef76e2b1ea63b125fed2c152da38d3cc47a38a83e97ea1ab03e3b7c64dc6976dd85a68b0a4d425290bcac62bf16fa29cac96fd8f74092bed2166a82c86df2314bb56911b7fde07bc6b288c30128fef9a764b4236c2898e1419f237e2b53e995c5accc5d9a17214813c060c94a54cd51e1abef81a20c1f5c2343e0526650a914cc2ae5022087e2f1f44149dcf8be21d8019db87ca29d359959f9df67ab493dd188fbc78e80db878b241f468325d4b28f219461e2694f774282124452efbe708dd567ff796399de37852c93b5a9fa9f2a1fb0f3719fa385b950b8422038a8f1113a3d40bfc7c4be2f96288e7c21e771e97707934cac08d5f41ee0e08417accea5925727161dc0d625de7eed4c434daa21fa31b96d38a50506003cea309a3c0244c1137d93b133a4dac11d95e68cc36a7ff067f36d65bd0173f629be7b19d51b0b10ba2aed790eedb565d5067118dbb7a23d71d744c8d4f6dec3fdec948e2ffe12c255177cfd9963491c158bfd4fe92c02d3edd3f246e5da068636bcb2dcb3579bce8e90810474429952c90feff0458ef2a4d15c59ee1787fd3a93d302ee0678aa6bb0a6eb04fd5ba7219ed0fc4783de741ab03cfe7215eba2f8aa8dd2ef065527fcc0213c1091f7d69002f81dd448ccaddca452ce482d88be9413f1f9ffb565c37a9682cad76f9d1688ab273f27e962a0edf308bd4f8521b5cd4641bab9d8e261f8f2dfdcf72fec29648bc0f8991065465a2fc2a066967c9ae6bf89f647d18942b34c5657d3694a0c842f25e2b59441d5847c067cdd7749c55880e87ef19778c3a7b05cb24ad333eb2bef311ce30c2c32f8674349a2b40346c14a302cabbb5022154eb383fc43c14a9677edb2769854311983bd62981d28a330d400659ba28719d6f4763959b97e41aae7dfe2b984b4515fe5a4775918212dfe2f233c1f5926e9f80f01cab0876b906bb4776040897fe3bf2d1c238a3ce90723ebee7902dc7f27924e44e5c31f83b50dfb8c30a8fc225e6a17047ff1d3def3901d53c2daac9c68e65288c0ce826b3bca9a4d3711d48373def8cd841758ffab566a28e516504c98f0412d17a4d1d5504f90351ced8ee51bd5f29553076bcf9bb8af14d12467184904a4a9687eb1a5c74468d629398b092a110f401fd5ca9961b9b7897710a870b9b8ba09100d7c3fde5b91802c79c20d2f37ab2677026ef13768af3f14174940b3df73c85c5e376950d579044efd668a3600c1c2a289dc1ad44029d41ac4f7974ef1f091ba68d315182ed364d5c7daba7a43c7324446a604966cc9f12120e32d814a326a9563b05773635d993a36879cd0516bbaa37becd2824ed25a857ef4029f02adf91846298dfe47318dc0f3f96c052ad432282bf484bc5395020b6087c04fc2facb92d991bd7758ee06bdfa2bd40972c85035e95b7de73d909661200287d5880998f020d485ade74a1faa97da4a05a414dd517c268b408b5bebf7669aaeb18a0cd80dd5f53d7f34790b53db6ca216f6973ee3b24d01c6e32a1763e29a2e683a56f07116d941720b5ba9376b4258dba4b73aac1fa2f9aa55143f77abf12b64afeb2478d3015e5e945f3bdf09179688b1d33de5a35eab48069ed7294acba6f5ea2ac0dff02e8188d48203b5da70ea56a62ab9dbc6e5cdd1e922f8e53483e9607cd80f5526412a5ccc76dd9aa3365b8043544c4a3b7cc99bad6b146a581e69811ea59bf9ba6fe4c260567bf754b28378664d1829bd09b14d5fd183cc14799ffbf9d2f6d1e734fad3399dd86ec6946f71cc88cfcec7b174c4c04073a0b2429317901e07490c736f75f3e4777a3016cc6aaa3a2b88fe0c8fa4efafbbf3e20131c2b3843eab9aa1bd68d5436854f01f69084054356431a990f220883bd25d62ec0a7767e0087ed6fff8fc199bdce865899ac57795da5a2596443cb703a71c7c0e6c56a56916d46f2e2f2d60ea3baf08c740001b82f2b721392ccd939643754b7289b37e397baea1429895ff7ef546a007d23e7e2dc9bfbd5928673b51081735ec384eac9bb1074795580095810623b7f3d07025cf4079738ca38f5b930130d56a5721c1d4bab520e3e12ec8d29a8e988b40209e3e802a30385f78bc54ff62cf0d64503aaaaebc1c4d78b50346d3bce081fdd5d807d8905d19afcbd4ac4f835f8a89c87cdeb65f4b7eebc8c2400c832513b265b15ad7aa23e661fec4257fa6875646293cf441d85eeaefad35a80fba513831cc31fe4c0c3cb4e23fa7e2d5db7995c09fc08477cf25bea565fbca573f91759f59650bd960518eb9b60094f351e8f8784f15a198957643bd4dc46ef7e57466c1e1011f375e7b2a634ee042dcc4516c235dd6a82d6435e2a715dad4ad0bde5396b3875dd5383f2a55ef2b096157f1ebc06a4f7650ba31ddba0efa4c84baa85bcf19170a89f8b9d36076026f31ed71b0e0df7103e0d0575cc109009ea0a46b5a52142ccb8aee4ebe57ea5fc408792e88b37a744682c3d2ec36d0c8d6597efadcf7e7f2512345e65a56e397737f60e60ddcc7811c2fcef7928ac5c555b41c3d3514e746ca9a331263091862d69702cdce2ac3564cd387f6aad4b1c847063b36625410772a17709541944e12fa7c1f775b19e71a92408a6968388ab7434553efe99d223530900966e92afed04626e2d2b104b1d2a4c66cbdbcc37f2c1ee37b5e0e044ef2822b54619f433caf4f916ee84867ae8a8850d706826104be349e081ce136ffadf0bdcbf9ccd3fa941c422aa7fb76ba7b92ec59704aa6a216460e52ab116dbcfddce377eb05c977a0d78695df01a02d67b67fc6ae9f80f4c674ccedfad1ffbb05cb565db3b7eea8e993ab79d3de22c56aa8965e929626c7246532e292b8a70785f03cc0c1fd2d9f8d7a9e0b8a231bc40842cdff37b30b115f4f5ab81ec9f18d9e57249b81356e3769d5115261e19d53a1f45d306765bf1106fb977ad74857ab47e02ae04d8e9acb29777bf8447cdf25c5a8d09669d02f3c44b0280e05998e861184b424d73bb8b42312c99823a98ac04f635a9cc3bec6e5267cd953f1424ade9a1069aff13c2c31877a9ffa0dacdff94c0a5b31d3d6119f993368d40bf215931691d286bb80bef60ee351af940480e37951b323247e63b058ef39d4c2d1f7a8a173970a600e816bfaf9d44278f23ecc5ef629adc99b41a6ec79468bd038f3bcd56d6b22e27713dd20be0689753c0f9637a252568415d570ccc90cbe3b7c5316822509cfb09b37054661b1a5483cc7290ccafd2fb5c29f4b7b39f09cf039b5b2a511e1f48a4486ea68b55295b21693ba8d4b7cd99f89a460bd355a22ba06a3988241d46f77161e5a92434e6884f99a34031dab0ecd5c7026b61648fe428bd736703853caa546de7c61392f34be80cad49111f58793b62c1f42460b0c7ae1c8a73e3817d5dcbca99a2a7725ffea5eb2872a7b94680b9f07eb0f12ee04ca3f3ded2e89307be1e127593324c59e5091231248f0853a0a3d404aafee727ed6fd71616ed2b5b6c69c20283217e4028ab54f53985ccfeee057427ba0c3a32f23f3f731ef4e247befcf6bb997d4afc793503c3169cbd998bc246d685054c1c0bc111b976369b0cf38c197e9558a0ca99cecc96c24a4f1d25d20793cb0cc824ad2f6aae5a3a59336a6a7cc369ce79d5ffc4100f77c02289320fbd3da06e818aaa3947b8f5ddd76f7cb24f5157d722c5e2d56a61d2cb699a25054139ac27f047b045a2393689526ca23f4e3dff38cfe5677f38bce4983ea0b0d9497d2eab5be4c0ed564e69ad5225abbe9e8a88e64f64933c539a96de16e8ef2a91dfe3b3102cd072e3601e982814c43a38cd34c43dba167762de4c43ed0869756407461c101b179ddab6b698fe2c458064bd27ea5ac3a68d9ff7a112271b435ff3e33aedc388a2744e4751ebf7a1848655893cf15690e3e7680e301a065c3ea397952a6a4592bc959483b29ee023d8bde9599c9cd5ea3b97a8c7ea110c05c000753cd0706f2eb01adf736dd78a9b2d43132a582653e9edcff1968e28e2e1ef4ce0791e0671a6a5f70e9c86dc96941ecb1e2ab4f7235d7b2934a73b7be6743ae58b5a2e737a9c78d65718cd3dfd19115322001556a369e1c72bf299ad0942aed9be1a06a8594fbf45dcf098bda83c3959f19258c790f9da45319f0d5deedc360f05835fbc0d90b9b2dc6f1edf4f10bc8c81872a5ffd6118099bf6356f8ea3009ea7288e4342f7bb44fe90a7bdbddcf64ccd67c2b9b454d0d4a50f529416ed05052b4e91012ae76aa4b65ae08a9433bdcfefaeec1682b2d52c3a55c4112288686b8a39dc76e4f694393199806fd5582a38baba460f22e08b248eb66bf7384414be1797e7cb9579ea3ae74367ff316e455e4d50fc4f617c806673d9761165fa3c04044ac06c9e9d1dc2a6ddc8ad1cb75690f175bcc337cdddacf8d661a2a5c102d9fd1c54cf68f52bd65dc5f041b154483194c25bb1ee67847b93094b361973597c3c7c1dc67a9792a2ba316a365189d5f65959a998e851ce72ee58309b37e78848089763ad69683f60a9b43e49c75ae43f34d592de09c7c0924f172e1ee47b741d8724d5558e63e380a10843fbaddd0614d3f1f4d64ca43953b4044338fad50b9bc22feb10568bdf3feb911fdc73ad37c3cff74b2d8ea56272caeb6c8bb8b23da528e91ebb85975f8fab72120442a383991b18a6887984a2b241c468e55effe759487ad618249b9a3a1031a19a9669fe7f2ee7b6804d61b3c5e3ac20c7ac2f38a1278572208680c804944d6a151b4125186949377847b963139fde996425452a5c961556b4715c5d0f292ec5d40b8f79904cff287e4b3dd49e5830f888510b883cc7b3e6e24e032a7e10848bd0a10eff856f69745901d5f6645effd47897bc4f35acc85b1b9e06249d35ad5c3f7301f13503a5a99b3c16cd8c94b9020258ac1d774cf1c7796ddcd8675f60951571aa004572d8ba4ede20718186e28b8a8dc9151d18bf124c98f367505195cdc0a0be34984ddc90e5326a550619287d4bf154819685e8e312b3210df2bca8741e43adc5354c1dfa0489efb845d971fc4f5a7ddd697640f4e002f4aa27b4abb3757163abd6957c02ad954f17a60d2ac9a8cc4fe6c082f4cc6413aa0fbbac78f47664d2fa6982eed2ef715ac4dcb90b28b7bc240cf71ee1e2a06a07ad25a5c3f1b224ba1debfec03f54d231fd10955ec4817b24408fdf6f1b777e12cec227bbfacda251167a714f3f44681d8295fbdb379c9bf7c4df53211b41ef22f171ad034df2342bed53fb256bf68fe5d55ef787803be6f2f98cc5a4663dd9aceb7139a6b9835f30ce5bd35a48709bdf38188cbbf7046db8a92bdcccea8516531910c232dc87cf8c5d617b2f604c92e0aadc06dfe23090d3f2bc6aa5a7a10a3dcbf5af0432ce3c133e50f6ac0c11c4f865251585a8db59e9f76d74ec6b5f2526d0fb7fff5039fb1013a44d9759aac8fdce7e578e92dccc07a6ce79de4b5bbae7d9e16d00f14b77e4ad47039b43681168c695dc6c7a911f6cbf3fe386d2ce804b5a40ea1bf16daf8606502a5c627bbe886d7244cf432b194658e4ff1ea888f09bfb131d8be46bb6d9d372599bebdc1ee02df4f48adeb028cab050f96e3ea7d0f3ed9e578317f85b4a7603a85dacb2e821911a8a98e412e66249edad61b5f8529c2e3a070695544fcb6b58a33e4d2922e0450e348a41b638e4e4018bd797cb06e90da0a9888a88e004ae1458fa5aca80173f45a03c01e03982931d9bf92d9c264ae096c6a32477dc86aecf33e9dfb0efa13b72487271477b05b30270dcc938f65c34e39d198ea6fe21330ab0e3d3ce5e28be70f557fd02142f243503724ee75132f512dd620719f9c56a41221d36542d0b2c542ad527f3a72eaf6410c8e207f6d8b14e06bea0aa533d5646d2e86ae6ddee8e9da03de8a26b8eb186a65d3a4580b9fc45be968601cad7072542069f7e177106f13fd9ae9b75631fcf57327cb4b5dacea375cc91f07d34d85e97aca4ebdd8e891a76e6e73c2fbe0d997b23adb3cacfdf9155dc43d53f86719ba35af8f0b5576e96357b1ecc9d0f15c286e39ff4df9ae93a3e106cd5be303a2c57de4ca01023a9e4efa01c26193cdc6c4c392b773c1bd9d3458e7f4849c68d529d424cc7c5fddda13b427a0f66047671b16d6f8718f436622c2a23afe7b2cb665369f5d7b1fe755014ab2088ce63913f2afd8fe004d9b6db00b675626bee8cff5b9213eb3213b80722dc84a635c819188ddc7100d952b1741b698c96eabafd87833f81cf94916a4aa4f13ec22f83c869dc765b4fba1c0ee5b7526ff6270629a5868415a44b5671a8454534e07f5690d185f7e25c61f6c9f64a1daf839ad6d26a31932898d4c1442893d5e37cfafedb2905949d62b01458b171f1cbc9bfd256e21bcfd0360413b2c36fd4964c007843e69baaaa5645993912e4e645e48744456bb7fa31931d68158f959df0730128458b3e14bb5f20444db4af47904413641a2d53ae5366a1643904a5ad166dadcb56cbfaf61d566d0156793dcb4f786ebb516f249af3abef8efc8fe5056180750d745bfb043119a562835060ccafea1d410a125958f1d84954369b8f0d3d222a7d4c186e770a57bd01a3316d5958e057cd36a26599d84c32efa5f82577794245bf5e3c164eea8fefa70c145d3155296374703fc6071ae26ace5692941982c92722e058b7812ebc74b9fc9238b3d8892e630519b8f224e76a50b0c0afd99f1fc6f2485404d6719ced4b8da8a468b6dd3ac0f1e5ebdd7d3715ef05ff006ddc84717dd1b29da88aebd29d17c8bf11f1b592da0a11d11a842324dd163def5c192251d46b2ca465b9d1f1fb534548af085282b9dc62e91b8ebba0d7eb0ef26d75260743973d27049bcf642cefea784a5f12b62751b9ad37d68de70986654a0b9cf1ef996888b72f286bbbb890a3d006edb534cbb1340c27c5d09edd11a57cdbbf2f5dd1b3644c2657e99dfc82ed9529ecf15ae708ac9f22412bda7ec550e1003f6829049bbb98d7c93e1a966fe42caa39ac9ab5e4a77c8346bb8b05e5d9f3cad36424e8b9d695ad151f4570146587709ffa895c1c821bd88dc3ab13910292127ecfec641b29cbbd06a366746d2af2c750a5fd93a345a551a159b03981e52258b092d121211494796bbed15e4afcb987d3430d06de3a07121997d94b0794fa2710de301e4ea9c9ca07672001476d847443a0d11221ad6da6cf645f9cfc9846ec0fedad518de95ffdb31ec0bc29979a16948284a81f044381e77c0a4c5171fad73d06a4dad2c12ea38354b71c99797dc7e5af4578d0c5feb7953a66df8fbaa8d3a63553c5216e5894be93ba40245473c8768264b272f4ddd800c6bb88836b27c49935a86e8d7ce08bdcebd86adfd005ee0817eb8189a9a978445894a362c6a2e5b4483711b137b029da1a60c8242a62a27a6303006a824918c1f8b43cdd5e3404d9138c3a0e1a99f6995b5082c366117637a2d76c6a8f4301ec4bca0f91fba5f3889e683667baa4aa6f77bfe41b0be082fa9586608469266b373c7a0bfa56d5baf175dafcdf85ae46b6f50f402e608d509414bceac3e89b65a345ae09d00abb46830e43e0abb6a135d11e7d0dd9d5219dc962ebdfb277e128bf66d286e556c84e543cf1995fdfb16169d8a9da64a1c9b782b31481edff553662599f0ad8ab82bd74969de6992b1a9a30aaf4842b5988c383f93b372cae56d422fa4247c555234d0349e5941341e558523daa9f727fd1def0a3e60f6cc64b597d50db0056c08f9ab8838f8ba1c8ac0593a0915292d63eb284328110f0ab11fd0d4e9c54d7093abf7c1e2fa1c1e6808cd05ea15a32b48f1764637f6b949a4c5fbd8eb7cee64c77eff7aa2ac4f709766563ebedf0be9de579a2b264bdab474e8c94c9a39db4a134b3ff81cb6457eaf6a2251fd6fd9b44fb48cc7806ac86e5db8ef3a394a1a0ac6b357d28febf3462653f8742ae86029e23e04945641c80c62dbf498b1882803b8274b9ffc5585c60e9c4102a908a326ad50b58ed53e25dd99dc38fd15e945d1dedfdbf01715684d6d31c0130d211d37adb198eeb0491369d1b7d9b6cec66dc33dc65bc4fa10bbb1a096c6c9118bfeb9ea2a894de6454cf269e3088ddedaf1f90e6676bdf17c820c5e37677c058e2f0414181f4aaac28151b308e315d7e19bb22f6c18865fdc009abc42763705890c43e485f5dac253b2ad8c9d40a4d2efb25f8e6b18a192a39625001af82df38eec5ebb59386c0e242626f50575a7d81d12d8217de8828800518f13ce107c7d3f0889011a28e99a970ac3b3ef60ee8cb04c6024878a794a135ec07ebc1e78091b6c9205aadfdfe45702d0c4b91fe90bb2683aca3862fc4fcde6483cd678b8cb02bef6e58564e78366a2ba9c048386b1dbe73801965499fad9682aca444612e127a5a54e21796c2274dcc64b5e33f3801f482f4e6be29fa29bac1a2d61a0b5305a1878cdce31b1fec64936992b3bae29fd69cab0066337a318afe2dd8a05addf8ba14c5be038862ccf8051c505eb1f640c4872fca6f730d7d2d632d604e7f4b84e8d1b324914c9e44cb5c35e57ca9a3454b98421b889735797ea5b71f13e2b5e0d0b7aaace7deb471962e25e6ebd66894ccf4b0dd5ac6aa122e1872dd91c29ed070bd7b44e12449af602763028bd48d53f79084cfdaa85070d8f6ed5cd3363961143d7b3d489bc368484e3ba355eb26ca3d5ac7b418807e3b6292909b9906561772885698f25358abffd483e6f28a7144bb1f4d77a9f0e382390b232e53976059f484d7d3c002a281cb86ca789c0e2d5ddcf54abe52626103db8839b6f4cb96e67eedfdec5e943268a6a48dd882d1970cec7451fb8932f7076f89cffecc77f228bd5db553bad05f0b557cfbbbca4101ff455d4959a045acd413fd7a352c3ffee2b0510d673ebc095153ec0b9ea44a4dec7d9f62d32df03307c08fea8b36be38fec5159f46821573f674b56adee8650bd01380aa14abbefa9bf47dbc424d441b6abe299b5ffee196e96047e40855b7a4abc6b043fb09432d82bc36fd855ed7a3c80aa4e5740e6aa531046d7013f699ee477cc96546279b103134986aee3172ccbeb1e7434828b6a95409fc12511dc9ec3c019a4d04cd5b732b26838aaa87d23be7d27280263709c3ecfc18cd0c192d307b5cc341c95e5274105b5e1900ca553856a6d74e0ab6702d69a5f6b6ce5091e6e50a992aa984e6b081c2e96906df469f041c4f92dd8e45db7152f2ba0612021c20a6d55e56ed1ac9af8e38553fd1dda8099a329217c3a8c5611664010e68a71c55a2275a8e1a4932d4cfba37938649b27204f853b6cac4e7d2c349a2a1a212393d484fec27b8a035786fd3bccd43dadd19e9f3e5e9963027612ff5b67f22c8056fc61b9ceea90e8ab4a8ab0bfa52958527a3bb72392304c29b772e3eba1095fb42c4417b065ad37cef9c6f45108fd685a69cdbee5dcd1b10d388a55467e5dbcb5c33e6153633668e5f1125f2d1d4b12d283543be1699d8003ef63735e7c734303be25e26505a4a295a18b9848bc40dca49d98b7b4d383e61e7553f6c4b643a6ec64a4453cd0fd64f75fd4cf00c1319a5a0bb565c48a468e4a4946228a1d0fd722cc0fce2fe48251b859fbbd075a01d9e151f5f7f1a6a09181377513e061dc7f1f03aba9f036b52d647338596d9d18f4da9c38bb807008c1c86c0ec47bbcc28f937c75d37c461e15f643b6ed80b9b08e35b8632182554cb67b1061a6f1f78a8697bd00b0475fe2a734f7353a49a609dbf0c075787fa10b914dc56da2f22a0f1ef0dc9e50550214a62b40db63e56a2640586e4530de575808c85d3cdefa82b2e39645efa2aab97f82197a27aadd8f1887dd81f899fa859f21489cd3c5860ecb014828575e6440821c07d114e008f352b43247f88b8f569f447b9e0276e76a1083947ac4ccc59435e66d3cc6c7a4b34672e318eafbdc4699cff168e23145fc9c29a3a33ce4adce8c815fb58c6a142aec10a6e0a82cf7edfb4cff14a3b493486f5a8f94a3a6d88afda15d8b4bcfe90b6ee291b7ec84aa4c40e959abc472dece21d5fdcd7f7cad23231c2aaadf21a2c615324fe564bb00041bd105d0c2408df29ceb47e9fece5f0e956321fca60e679ca66ca1c8865f0e66e7f92fb9ea1e955fde5749a28881a84b69f4d3777aab0254998f1994e7b3aa3c0c391ebb5137167acdef058335948ed14a6515e8f12c6edb4659bd8ef42b1b0c5406ffc1b91f9af76ae1c0c9ba0de7bdb71a6f634f63e51c58fe950b8008e9db9c73fb3f50a5fe005a11cd3dbf8a52d96b5cc0c451e23726bf9c8926129f91e43dc97e7270503ee5c9641c0a90d4d5f3db5f8832fdf4243ba43e8d9198e77bd0890f33be16b8e022cb7c9dcba247f0d8e3c4fd8bdfa61dd97ff30da8ee45a6140591f39966898cd49d076d8ecf6315c2cb05c0e80ad9dc60061da3176fe81ad024e02c1c85ec6d01dd5488b218b17eb5a698db8cb925dd5ed979d94e94f5d0c41e0ad97fef5051a9ea018b1930897e19414baf1e0b88d95cdcbd62ce48101d1a9b6845e4fe579fe13160d324b6b864162327ca68b1ae32cbb09156b72a7bc1ba99c975d6b3e9519158bc187635110664f14885e3b0424415057c2feccb628a29a94a758a332b8726577ae5b1d42493ee3a11ba5add9dcfb0a26de2870725e378870841af623d5fecc6148fe3123dae4ae5c838027ad67ea8a2629e967700faeffdbb5abc45d8ea4f2da0825f815d7208505bb58386109f14e619a350f1c2c01fb9108b2d91714bb5d3840adf6bdc23143ddcaed698a290aabba763486db1435f5f93760e0e0e6fe4407ece616cb98a54f2a5a857689b8b717b42c086e4874a93058f250ee8ced0edefee560dd44fe3c678c0b0d249dbb8f65c07bfed7a995db95e70453980a812a6cb39d5a3aca928a7f53d77ecbf652832291ccc957316874b4b5e395de693ae0a99c1e4016d3d94d26fa89c34ce7b1b90711bacc6522f56d6216c87a3c2e25c60fa28c607134068d915a2fbb218f937ff84b577eea67b67e3d3d7485691bf3e4aaff1ddb67261ce15065e93800e657423131d2a017d9f0bdd3810dc24043c15df59455555ff525724e20725cbd8fd4369cb9183bf728ad58249ba34c65a62a5c221d1e563bd54bbc8ba639737d847aa9cc07bdfcb1870f52b28fe573dd7e5c1f08770f31dbd84b82c299782cd463cc3f7006b8c47c1fe4df31eaec4dfbb8d8273355f3a0523585f671b8619b92c150d0a8104c7cc42948a2ba951e816278347552bd71f46c6a7ca1a41b745f320d06c643f16513336446b933825e48213dd741c98efe56be05f22175a2f1e8256d86c03bf54fd8ed70db018ae15dd27973e6cc6a131b51bf6fea8400b60d0eba5e590d72079e884f3149639fd510889978b8a58efb10e4ac0a72141b758e8823be9478cc79856851c06ca61d0abd23c9c402a67624b09de284a29efff98c96ba681544e00bedb0507e41894f937d59c40366a77aa753dd60d448d0b3fc07faccbf1bc5c116c0e5699fb37183835a1df8c0d5f1acfb50b13efa47f6b10124ba3de36ea957a27bc53d06a4162db0c9aa86c5bb8efeed7b60cc7656d787d51d89e0ac48366e8eb43099d8da1fce8ea4346d3aff8e32497cdf8704736202f188aadf8583936df97e60816869f8e4fd84494282056b905e1e599170b8922b6b0146a9b3c8c8ab2d431bbcaac13c2b57912c377af9f07eba1d2472630b41f344fd4b7790d34b430dcbf5ac8af553e14bdf6d9360271ee87c88fee4206c4e0c3fca0cfcdfac64465a2e26a483d4541d2ec164fc3cbec166e7a444857d29b5988a07d182f9bc42dc9d8487d3c30dc0d93c3a6d382aae9f065450592294c43c8523bf6dfa352f2873a41eed01486403d2e5976d2217ce12db1ff4d4c35a9399071b7d97d029623647ef285e23f415285057377458f4e31154a8828f6b918344db32bfe3d47283aa88a112ff02ecf83c3f9a34aee0158e4b0ad7a790defe39c9148527c58ffa6d4184dfedf67510a092f9b1153ea51653b493d495acfd1635bb66a6e83b28f4a8bc407ac00e6f271ae3bb6458029002c9bdb282cd6d7fed10b7307e04723978e97687445c97e776b6a70b2f8e2967dacbbd6c4259e7d6a783bc3e354694580d0cdea0018b1f66c6115fd6bae46a8dbd488d9e4cbd733a3a93a6bb051c9356415aa19176bb134c044ffb22ec4107aef88e7baebd206d05667d079b9c655c4d5ebf7db7010fab4e54fff21c85a3940eb097172247c206ea7496cd89db4caf58004f05c2e2b40c9f21d70e6660f1631ba9a146beac63ae06923930c929c0cb30425e77acabe38b11a5afc48c3424eaae4645c98ce6fbef16df381f34580f106133ff602bc2526162d6ad600eb9319960bb8cf35d89f2c087974e521b572496d4d3d9c8836f9949c814c862e698506dc3c00f5907494046c991db9182bd4c88af55a9f1dc3fae202d62196ec2c3648c5273851ada032f61711a54bf0eec75da5ce0e82de7a74826eaf8e108fac80efa40ff4fb067ab21fdde69e611d14ac718b4b5d175734b8c1c1d38d429faa096bc95725f9bdfa2af3410154444a824211af899da920e5a16dd64fc34227a18a2fb56f7418442c34b9a2dda04f240cc73c76541146f0571c9b99634ecd755052dd5fbca002bf6f2eb3024b6c1ddc149089e9b78eb4ff3d163e5c84261f83ef8f90690159a0fb0d7be3f03d31eb545a977a355ff5286763af5abd4ef23f89bb81c06a8c7e0f848db75406d67721ff7385c9b3dd478ab01e32bc8b31f1aa3a0f269d20947c0f06b0cd4efe57ee260468efb701a63b23b8b4d3b45455ced2f222482fa083135b0e33446f5f906ab665e20641feade49fa2f74d15e64b1a442b64d2d6139bfa43710abe346aa1f2b39aa65ee751d3a18be8bcfde29838245ea7cc7d219b09f871cb2fea05d81b50e75809e8efd84106c2803aa22fb46e4706eba31f4ab18cf6006fa502a571761722ceffad4f99944b4b558a767a38d2ba64f056ff1963b8e0af64019e84c250af06a70680f78d220bc6263ebff0ce2394c3c2601fdf4845c0effc25e817d6efbd1e81b8526bf2632b9f496d7665eefe7a9ec7bd21d29dcdccd5a7283ab24691e6185ba808e753129b8a184e3fbcd00766ccee6f82457b509060057e30406c0a952c9862d99b35e383e1612cd6e7f0340cb17c74ef82c7c5d7ae9c94c018e2a89f26b89fda6d626977860d0ffc2084257a48376522ae434998c4a02c15bb6bae60e445b346495d2348361f19a3e6a82e9c437aa11af0995b843996a4106a3df5b4297e8775d4caf5cb2d01099e8505ccef2f2f5e7926a223fdb7595d89208a748d4ca57640206c8e07705e6dfaf918dfed8f0a2a26a923e14f0df749b51daa0566e800a1380419affaa2a4580be63e8d2b3bc1b56abae84a5ae8af7baf7d6cda42b6698aba130c38b5d591023347629f200ec77549572107d1a7b1d377b0b80fab22adeee0b0066c579f32b2e3d6ca1b2207b3038cfb7b3293812d30f99403039991214db930868d2a77068b481ea7ebcd33ce972910c1bcddb17467f697a2eb8e3c23276c55978ebafab124342798b804f4796d2b8c863e0d56ec6fc8861e738ee968db41470164dd6e91fbed86c7a7beb0ab72c8c8a34d4b6b780ca85bbd121be8d66fa9d17a3d31124aae7cc6e75251cd80aadff717eaff7bf2fcdee466e707239f278cb133f0000014750e25f8b52b325bfe199acc6ba9352a49d2f11f50b0f7c5f5f60f68666bff4c1443a3b5892d3308d6e8a30f85af5e7f272bd72b456a86f97f19ecef55a4d21182c6bcbd191cdbb238639387824a11aa191da99e05b2cd8bf356c106ed8fc3bbabec1a54271b08c8e91111a4183263c903dd0bb1fb5fe75521ecadbe88397970b18a6b97270b3b8262f3fac588ee27b209a6319942d9ffc51896877056910ae412744def28820ef61254af21cb0bd60b317693a36f2404cbcb29a87e6d75bd99beda95b4ea0210f3954d33872da4808c724081520f90a94601e084b4a312d2c64fdfac6af2be1a8fda90cf20b12bfe462010a50d36b5ff8ba08a590d51be83753e4b15d7c35ce5a89200e8cc66cf6e1d822cbab01e24cd83c3babc6f2685b7ddd0948f360ae2e8b5065df675792a4aa9717cbf98473481c6b5f8a3f93a4ec75679d681ca9aa1ccbbd9c661c1906023ea2e660e41b39cf13fcd3528b03cb4295e0f1c1abca1c136db4b054a4f5c3d9a03d6c8972eefa72d0b98f543c0f20f1c08d2408b386c731f2ab7697f4db095dd77a03c7e645654c5662446a475885735cb45c4ee37dcdcf758e4b45e9bcdd774df61a62e7cda2ed75885d2f54edfc4ff53774df8e1ace64b30bbe7f3b3a66a1e4dc1352fa0dcf060163779345a26a08924dc9e56660535467531646a9ae5d50423b68d217f44fcc8189a21b68beca197f4404c4be1d89c90e3afd74185ed2f91d9f52455df031eb5143051257caa0a1b426c867d4881313ab51af6194c48ddc0874cee89de35a7c03b780d0ccd55319251e97a17024362c2e7b8a9ca774e1eaff7cb58524562475a282cffdb61148017c95e473e27784c3484eb98a37d3c872f9c4d4cd384cd52d2b6316dffb6646cfcc75566fde996b2a06b01996fca5d8421f8ba1ac8a20d866399841236d1fad90e3a53947c3024f7158</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">æœ¬ç¯‡ä»‹ç»äº†ESè¯»å†™æ–‡æ¡£æµç¨‹ä»¥åŠåº•å±‚åˆ†ç‰‡åŸç†</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>07.Elasticsearchå‚æ•°è°ƒä¼˜</title>
    <link href="https://lukme.top/posts/793b821e.html"/>
    <id>https://lukme.top/posts/793b821e.html</id>
    <published>2024-10-30T02:39:01.000Z</published>
    <updated>2024-10-30T04:02:11.629Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Elasticsearchå‚æ•°è°ƒä¼˜">Elasticsearchå‚æ•°è°ƒä¼˜</h2><h3 id="1-ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜">1. ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜</h3><p>ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜ä¸»è¦æ˜¯<code>å†…å­˜çš„è®¾å®š</code>ä¸<code>é¿å…äº¤æ¢å†…å­˜</code>ã€‚</p><p>ES å®‰è£…åé»˜è®¤è®¾ç½®çš„å †å†…å­˜æ˜¯ <code>1GB</code>ï¼Œè¿™å¾ˆæ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜å‡ºç°ï¼šæˆ‘ä»¬è¦è®¾ç½®å¤šå°‘å†…å­˜ç»™ ES å‘¢ï¼Ÿ</p><p>å…¶å®è¿™æ˜¯è¦çœ‹æˆ‘ä»¬é›†ç¾¤èŠ‚ç‚¹çš„å†…å­˜å¤§å°ï¼Œè¿˜å–å†³äºæˆ‘ä»¬æ˜¯å¦åœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šè¿˜æ˜¯å¦è¦éƒ¨ç½²å…¶ä»–æœåŠ¡ã€‚</p><ul><li>å¦‚æœå†…å­˜ç›¸å¯¹å¾ˆå¤§ï¼Œå¦‚ 64G åŠä»¥ä¸Šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸åœ¨ ES é›†ç¾¤ä¸Šéƒ¨ç½²å…¶ä»–æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘å»ºè®® ES å†…å­˜å¯ä»¥è®¾ç½®ä¸º 31G-32Gï¼Œå› ä¸ºè¿™é‡Œæœ‰ä¸€ä¸ª 32G æ€§èƒ½ç“¶é¢ˆé—®é¢˜ï¼Œç›´ç™½çš„è¯´å°±æ˜¯å³ä½¿ä½ ç»™äº† ES é›†ç¾¤å¤§äº 32G çš„å†…å­˜ï¼Œå…¶æ€§èƒ½ä¹Ÿä¸ä¸€å®šä¼šæ›´åŠ ä¼˜è‰¯ï¼Œç”šè‡³ä¼šä¸å¦‚è®¾ç½®ä¸º 31G-32G æ—¶å€™çš„æ€§èƒ½ã€‚<br>ä»¥æˆ‘è°ƒä¼˜çš„é›†ç¾¤ä¸ºä¾‹ï¼Œæˆ‘æ‰€è°ƒä¼˜çš„æœåŠ¡å™¨èŠ‚ç‚¹å†…å­˜ä¸º 64Gï¼ŒæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šä¹ŸåŸºæœ¬ä¸è·‘å…¶ä»–æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘æŠŠ ES é›†ç¾¤å†…å­˜å¤§å°è®¾ç½®ä¸ºäº† 31Gï¼Œä»¥å……åˆ†å‘æŒ¥é›†ç¾¤æ€§èƒ½ã€‚</li><li>è®¾ç½® ES é›†ç¾¤å†…å­˜çš„æ—¶å€™ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ç¡®ä¿å †å†…å­˜æœ€å°å€¼ï¼ˆXmsï¼‰ä¸æœ€å¤§å€¼ï¼ˆXmxï¼‰çš„å¤§å°æ˜¯ç›¸åŒçš„ï¼Œé˜²æ­¢ç¨‹åºåœ¨è¿è¡Œæ—¶æ”¹å˜å †å†…å­˜å¤§å°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆè€—ç³»ç»Ÿèµ„æºçš„è¿‡ç¨‹ã€‚</li><li>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯é¿å…äº¤æ¢å†…å­˜ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¹å†…å­˜è¿›è¡Œé”å®šï¼Œä»¥é¿å…äº¤æ¢å†…å­˜ï¼ˆä¹Ÿå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚é¢è¿›è¡Œå…³é—­å†…å­˜äº¤æ¢ï¼‰ã€‚å¯¹åº”çš„å‚æ•°ï¼š<code>bootstrap.mlockall: true</code></li></ul><h3 id="2-åˆ†ç‰‡ä¸å‰¯æœ¬">2. åˆ†ç‰‡ä¸å‰¯æœ¬</h3><ul><li><code>åˆ†ç‰‡ (shard)</code>ï¼šES æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æœç´¢å¼•æ“, ç´¢å¼•é€šå¸¸éƒ½ä¼šåˆ†è§£æˆä¸åŒéƒ¨åˆ†, åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹çš„éƒ¨åˆ†æ•°æ®å°±æ˜¯åˆ†ç‰‡ã€‚ES è‡ªåŠ¨ç®¡ç†å’Œç»„ç»‡åˆ†ç‰‡, å¹¶åœ¨å¿…è¦çš„æ—¶å€™å¯¹åˆ†ç‰‡æ•°æ®è¿›è¡Œå†å¹³è¡¡åˆ†é…, æ‰€ä»¥ç”¨æˆ·åŸºæœ¬ä¸Šä¸ç”¨æ‹…å¿ƒåˆ†ç‰‡çš„å¤„ç†ç»†èŠ‚ã€‚åˆ›å»ºç´¢å¼•æ—¶é»˜è®¤çš„åˆ†ç‰‡æ•°ä¸º 5 ä¸ªï¼Œå¹¶ä¸”ä¸€æ—¦åˆ›å»ºä¸èƒ½æ›´æ”¹ã€‚</li><li><code>å‰¯æœ¬ (replica)</code>ï¼šES é»˜è®¤åˆ›å»ºä¸€ä»½å‰¯æœ¬ï¼Œå°±æ˜¯è¯´åœ¨ 5 ä¸ªä¸»åˆ†ç‰‡çš„åŸºç¡€ä¸Šï¼Œæ¯ä¸ªä¸»åˆ†ç‰‡éƒ½ç›¸åº”çš„æœ‰ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚é¢å¤–çš„å‰¯æœ¬æœ‰åˆ©æœ‰å¼Šï¼Œæœ‰å‰¯æœ¬å¯ä»¥æœ‰æ›´å¼ºçš„æ•…éšœæ¢å¤èƒ½åŠ›ï¼Œä½†ä¹Ÿå äº†ç›¸åº”å‰¯æœ¬å€æ•°çš„ç£ç›˜ç©ºé—´ã€‚</li></ul><p>é‚£æˆ‘ä»¬åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œåº”è¯¥åˆ›å»ºå¤šå°‘ä¸ªåˆ†ç‰‡ä¸å‰¯æœ¬æ•°å‘¢ï¼Ÿ</p><ul><li>å¯¹äºå‰¯æœ¬æ•°ï¼Œæ¯”è¾ƒå¥½ç¡®å®šï¼Œå¯ä»¥æ ¹æ®æˆ‘ä»¬é›†ç¾¤èŠ‚ç‚¹çš„å¤šå°‘ä¸æˆ‘ä»¬çš„å­˜å‚¨ç©ºé—´å†³å®šï¼Œæˆ‘ä»¬çš„é›†ç¾¤æœåŠ¡å™¨å¤šï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿå¤§å¤šå­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥å¤šè®¾ç½®å‰¯æœ¬æ•°ï¼Œä¸€èˆ¬æ˜¯ 1-3 ä¸ªå‰¯æœ¬æ•°ï¼Œå¦‚æœé›†ç¾¤æœåŠ¡å™¨ç›¸å¯¹è¾ƒå°‘å¹¶ä¸”å­˜å‚¨ç©ºé—´æ²¡æœ‰é‚£ä¹ˆå®½æ¾ï¼Œåˆ™å¯ä»¥åªè®¾å®šä¸€ä»½å‰¯æœ¬ä»¥ä¿è¯å®¹ç¾ï¼ˆå‰¯æœ¬æ•°å¯ä»¥åŠ¨æ€è°ƒæ•´ï¼‰ã€‚</li><li>å¯¹äºåˆ†ç‰‡æ•°ï¼Œæ˜¯æ¯”è¾ƒéš¾ç¡®å®šçš„ã€‚å› ä¸ºä¸€ä¸ªç´¢å¼•åˆ†ç‰‡æ•°ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸èƒ½æ›´æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºç´¢å¼•å‰ï¼Œè¦å……åˆ†çš„è€ƒè™‘åˆ°ï¼Œä»¥åæˆ‘ä»¬åˆ›å»ºçš„ç´¢å¼•æ‰€å­˜å‚¨çš„æ•°æ®é‡ï¼Œå¦åˆ™åˆ›å»ºäº†ä¸åˆé€‚çš„åˆ†ç‰‡æ•°ï¼Œä¼šå¯¹æˆ‘ä»¬çš„æ€§èƒ½é€ æˆå¾ˆå¤§çš„å½±å“ã€‚</li></ul><h3 id="3-å‚æ•°è°ƒä¼˜">3. å‚æ•°è°ƒä¼˜</h3><p>ä¸‹é¢æˆ‘ä¼šä»‹ç»ä¸€äº› ES å…³é”®å‚æ•°çš„è°ƒä¼˜ã€‚</p><p>æœ‰å¾ˆå¤šåœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬çš„ ES é›†ç¾¤å ç”¨äº†å¤šå¤§çš„ cpu ä½¿ç”¨ç‡ï¼Œè¯¥å¦‚ä½•è°ƒèŠ‚å‘¢ã€‚cpu ä½¿ç”¨ç‡é«˜ï¼Œæœ‰å¯èƒ½æ˜¯å†™å…¥å¯¼è‡´çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æŸ¥è¯¢å¯¼è‡´çš„ï¼Œé‚£è¦æ€ä¹ˆæŸ¥çœ‹å‘¢ï¼Ÿ</p><p>å¯ä»¥å…ˆé€šè¿‡ <code>GET _nodes/&#123;node&#125;/hot_threads</code> æŸ¥çœ‹çº¿ç¨‹æ ˆï¼ŒæŸ¥çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹å ç”¨ <code>cpu</code> é«˜ï¼Œå¦‚æœæ˜¯ <code>elasticsearch[&#123;node&#125;][search][T#10]</code> åˆ™æ˜¯æŸ¥è¯¢å¯¼è‡´çš„ï¼Œå¦‚æœæ˜¯ <code>elasticsearch[&#123;node&#125;][bulk][T#1]</code> åˆ™æ˜¯æ•°æ®å†™å…¥å¯¼è‡´çš„ã€‚</p><p>åœ¨å®é™…è°ƒä¼˜ä¸­ï¼Œcpu ä½¿ç”¨ç‡å¾ˆé«˜ï¼Œå¦‚æœä¸æ˜¯ SSDï¼Œå»ºè®®æŠŠ <code>index.merge.scheduler.max_thread_count: 1</code> ç´¢å¼• merge æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®ä¸º 1 ä¸ªï¼Œè¯¥å‚æ•°å¯ä»¥æœ‰æ•ˆè°ƒèŠ‚å†™å…¥çš„æ€§èƒ½ã€‚å› ä¸ºåœ¨å­˜å‚¨ä»‹è´¨ä¸Šå¹¶å‘å†™ï¼Œç”±äºå¯»å€çš„åŸå› ï¼Œå†™å…¥æ€§èƒ½ä¸ä¼šæå‡ï¼Œåªä¼šé™ä½ã€‚</p><p>è¿˜æœ‰å‡ ä¸ªé‡è¦å‚æ•°å¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œå„ä½åŒå­¦å¯ä»¥è§†è‡ªå·±çš„é›†ç¾¤æƒ…å†µä¸æ•°æ®æƒ…å†µè€Œå®šã€‚</p><ul><li><code>index.refresh_interval</code>ï¼šè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯æ•°æ®å†™å…¥åå‡ ç§’å¯ä»¥è¢«æœç´¢åˆ°ï¼Œé»˜è®¤æ˜¯ 1sã€‚æ¯æ¬¡ç´¢å¼•çš„ refresh ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ lucene æ®µ, è¿™ä¼šå¯¼è‡´é¢‘ç¹çš„åˆå¹¶è¡Œä¸ºï¼Œå¦‚æœä¸šåŠ¡éœ€æ±‚å¯¹å®æ—¶æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼Œå¯ä»¥å°†æ­¤å‚æ•°è°ƒå¤§ï¼Œå®é™…è°ƒä¼˜å‘Šè¯‰æˆ‘ï¼Œè¯¥å‚æ•°ç¡®å®å¾ˆç»™åŠ›ï¼Œcpu ä½¿ç”¨ç‡ç›´çº¿ä¸‹é™ã€‚</li><li><code>indices.memory.index_buffer_size</code>ï¼šå¦‚æœæˆ‘ä»¬è¦è¿›è¡Œéå¸¸é‡çš„é«˜å¹¶å‘å†™å…¥æ“ä½œï¼Œé‚£ä¹ˆæœ€å¥½å°† <code>indices.memory.index_buffer_size</code> è°ƒå¤§ä¸€äº›ï¼Œindex buffer çš„å¤§å°æ˜¯æ‰€æœ‰çš„ shard å…¬ç”¨çš„ï¼Œä¸€èˆ¬å»ºè®®ï¼ˆçœ‹çš„å¤§ç‰›åšå®¢ï¼‰ï¼Œå¯¹äºæ¯ä¸ª shard æ¥è¯´ï¼Œæœ€å¤šç»™ <code>512mb</code>ï¼Œå› ä¸ºå†å¤§æ€§èƒ½å°±æ²¡ä»€ä¹ˆæå‡äº†ã€‚ES ä¼šå°†è¿™ä¸ªè®¾ç½®ä½œä¸ºæ¯ä¸ª shard å…±äº«çš„ index bufferï¼Œé‚£äº›ç‰¹åˆ«æ´»è·ƒçš„ shard ä¼šæ›´å¤šçš„ä½¿ç”¨è¿™ä¸ª bufferã€‚é»˜è®¤è¿™ä¸ªå‚æ•°çš„å€¼æ˜¯ 10%ï¼Œä¹Ÿå°±æ˜¯ jvm heap çš„ 10%ã€‚</li><li><code>translog</code>ï¼šES ä¸ºäº†ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæ¯æ¬¡ indexã€bulkã€deleteã€update å®Œæˆçš„æ—¶å€™ï¼Œä¸€å®šä¼šè§¦å‘åˆ·æ–° translog åˆ°ç£ç›˜ä¸Šã€‚åœ¨æé«˜æ•°æ®å®‰å…¨æ€§çš„åŒæ—¶å½“ç„¶ä¹Ÿé™ä½äº†ä¸€ç‚¹æ€§èƒ½ã€‚å¦‚æœä½ ä¸åœ¨æ„è¿™ç‚¹å¯èƒ½æ€§ï¼Œè¿˜æ˜¯å¸Œæœ›æ€§èƒ½ä¼˜å…ˆï¼Œå¯ä»¥è®¾ç½®å¦‚ä¸‹å‚æ•°ï¼š</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;index.translog&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;sync_interval&quot;</span>: <span class="string">&quot;120s&quot;</span>,     <span class="comment">--syncé—´éš”è°ƒé«˜</span></span><br><span class="line">        <span class="string">&quot;durability&quot;</span>: <span class="string">&quot;async&quot;</span>,       -â€“ å¼‚æ­¥æ›´æ–°</span><br><span class="line">        <span class="string">&quot;flush_threshold_size&quot;</span>:<span class="string">&quot;1g&quot;</span>  <span class="comment">--logæ–‡ä»¶å¤§å°</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·è®¾å®šçš„æ„æ€æ˜¯å¼€å¯å¼‚æ­¥å†™å…¥ç£ç›˜ï¼Œå¹¶è®¾å®šå†™å…¥çš„æ—¶é—´é—´éš”ä¸å¤§å°ï¼Œæœ‰åŠ©äºå†™å…¥æ€§èƒ½çš„æå‡ã€‚</li></ul><p><strong>è¿˜æœ‰ä¸€äº›è¶…æ—¶å‚æ•°çš„è®¾ç½®ï¼š</strong></p><ul><li><code>discovery.zen.ping_timeout</code> åˆ¤æ–­ master é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œå‘ç°å…¶ä»– node å­˜æ´»çš„è¶…æ—¶è®¾ç½®</li><li><code>discovery.zen.fd.ping_interval</code> èŠ‚ç‚¹è¢« ping çš„é¢‘ç‡ï¼Œæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜æ´»</li><li><code>discovery.zen.fd.ping_timeout</code> èŠ‚ç‚¹å­˜æ´»å“åº”çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º 30sï¼Œå¦‚æœç½‘ç»œå¯èƒ½å­˜åœ¨éšæ‚£ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§</li><li><code>discovery.zen.fd.ping_retries ping</code> å¤±è´¥/è¶…æ—¶å¤šå°‘å¯¼è‡´èŠ‚ç‚¹è¢«è§†ä¸ºå¤±è´¥ï¼Œé»˜è®¤ä¸º 3</li></ul><h3 id="4-å…¶ä»–å»ºè®®">4. å…¶ä»–å»ºè®®</h3><p>è¿˜æœ‰ä¸€äº›é›¶ç¢çš„ä¼˜åŒ–å»ºè®®å–”ã€‚</p><ul><li><code>æ’å…¥ç´¢å¼•è‡ªåŠ¨ç”Ÿæˆ id</code>ï¼šå½“å†™å…¥ç«¯ä½¿ç”¨ç‰¹å®šçš„ id å°†æ•°æ®å†™å…¥ ES æ—¶ï¼ŒES ä¼šæ£€æŸ¥å¯¹åº”çš„ç´¢å¼•ä¸‹æ˜¯å¦å­˜åœ¨ç›¸åŒçš„ idï¼Œè¿™ä¸ªæ“ä½œä¼šéšç€æ–‡æ¡£æ•°é‡çš„å¢åŠ ä½¿æ¶ˆè€—è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥å¦‚æœä¸šåŠ¡ä¸Šæ²¡æœ‰ç¡¬æ€§éœ€æ±‚å»ºè®®ä½¿ç”¨ ES è‡ªåŠ¨ç”Ÿæˆçš„ idï¼ŒåŠ å¿«å†™å…¥é€Ÿç‡ã€‚</li><li><code>é¿å…ç¨€ç–ç´¢å¼•</code>ï¼šç´¢å¼•ç¨€ç–ä¹‹åï¼Œä¼šå¯¼è‡´ç´¢å¼•æ–‡ä»¶å¢å¤§ã€‚ES çš„ keywordï¼Œæ•°ç»„ç±»å‹é‡‡ç”¨ doc_values ç»“æ„ï¼Œå³ä½¿å­—æ®µæ˜¯ç©ºå€¼ï¼Œæ¯ä¸ªæ–‡æ¡£ä¹Ÿä¼šå ç”¨ä¸€å®šçš„ç©ºé—´ï¼Œæ‰€ä»¥ç¨€ç–ç´¢å¼•ä¼šé€ æˆç£ç›˜å¢å¤§ï¼Œå¯¼è‡´æŸ¥è¯¢å’Œå†™å…¥æ•ˆç‡é™ä½ã€‚</li></ul><h2 id="jvmè°ƒä¼˜">jvmè°ƒä¼˜</h2><blockquote><p>ä»…æä¾›æ€è·¯ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç»™åˆ°ç‰©ç†æœºå†…å­˜ä¸€åŠï¼Œä¸Šé™32Gå³å¯</p></blockquote><p>1.JVMè°ƒä¼˜ç­–ç•¥</p><p>æ¨èè®¾ç½®æ˜¯ç‰©ç†æœºçš„ä¸€åŠå†…å­˜ï¼Œä½†æ˜¯å½“ç‰©ç†æœºçš„å†…å­˜å¤§äº32GBçš„æ—¶å€™ï¼Œè‹¥å†…å­˜æ˜¯64GBï¼Œåˆ™å°±æ˜¯32GBå†…å­˜ã€‚é»˜è®¤å°±æ˜¯ç‰©ç†æœºå†…å­˜çš„ä¸€åŠã€‚</p><p>ä½†æ˜¯å½“å¤§äº64GBæ—¶ï¼Œæ¯”å¦‚ç‰©ç†æœºæ˜¯256GBå†…å­˜ï¼Œæ­¤æ—¶ä¸åº”è¯¥è®¾ç½®å†…å­˜ä¸ºå®¿ä¸»æœºçš„ä¸€åŠï¼Œåº”è¯¥æœ€å¤§ä¸Šé™è®¾ç½®ä¸º32GBã€‚</p><p>2.ä¿®æ”¹å †å†…å­˜å¤§å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨çŠ¶æ€</span></span><br><span class="line">[root@elk01:0 ~]# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       2.2Gi       1.2Gi       0.0Ki       388Mi       1.4Gi</span><br><span class="line">Swap:          2.7Gi       736Mi       2.0Gi</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹javaç¨‹åºå·²å ç”¨å†…å­˜</span></span><br><span class="line">[root@elk92 ~]# ps -ef | grep java | grep -i xms</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘ç»™çš„æ˜¯4Gå†…å­˜ï¼Œå ç”¨ä¸€åŠå†…å­˜</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027215156903.png" alt="image-20241027215156903"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹å†…å­˜å¤§å°</span></span><br><span class="line">[root@elk01:0 ~]# vim /etc/elasticsearch/jvm.options</span><br><span class="line">Â·Â·Â·</span><br><span class="line">-Xms256m</span><br><span class="line">-Xmx256m</span><br></pre></td></tr></table></figure><p><strong>æ‹·è´æ–‡ä»¶åˆ°å…¶ä»–2ä¸ªèŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# scp /etc/elasticsearch/jvm.options 10.0.0.212:/etc/elasticsearch/</span><br><span class="line">[root@elk01:0 ~]# scp /etc/elasticsearch/jvm.options 10.0.0.213:/etc/elasticsearch/</span><br></pre></td></tr></table></figure><p><strong>é‡å¯ESé›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]#  systemctl restart elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒæœ€å¥½æ»šåŠ¨é‡å¯ï¼Œå½“å‰é‡å¯å®Œæ¯•åå†é‡å¯å…¶å®ƒèŠ‚ç‚¹ï¼ˆé˜²æ­¢æ‰€æœ‰é›†ç¾¤å®•æœºï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€æ˜¯å¦OK</span></span><br><span class="line">[root@elk01:2 ~]# curl 10.0.0.211:9200/_cat/nodes</span><br><span class="line">10.0.0.213 42 97 0 0.25 0.30 0.28 cdfhilmrstw * elk03</span><br><span class="line">10.0.0.211 75 48 3 1.38 0.81 0.64 cdfhilmrstw - elk01</span><br><span class="line">10.0.0.212 52 97 0 0.34 0.31 0.28 cdfhilmrstw - elk02</span><br></pre></td></tr></table></figure><p><strong>å†æ¬¡æŸ¥çœ‹å†…å­˜å ç”¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       1.1Gi       2.0Gi       0.0Ki       771Mi       2.5Gi</span><br><span class="line">Swap:          2.7Gi        60Mi       2.7Gi</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">é’ˆå¯¹Elasticsearchå‚æ•°è°ƒä¼˜ï¼Œä»ç³»ç»Ÿï¼Œåˆ†ç‰‡ä¸Šåˆ†æ</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>06.ESé›†ç¾¤åŠ å¯†</title>
    <link href="https://lukme.top/posts/de7fd46f.html"/>
    <id>https://lukme.top/posts/de7fd46f.html</id>
    <published>2024-10-30T02:38:01.000Z</published>
    <updated>2024-10-30T04:02:06.950Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ESé›†ç¾¤åŠ å¯†">ESé›†ç¾¤åŠ å¯†</h2><p><strong>æœªåŠ å¯†å‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@elk91 ~]# curl 10.0.0.211:9200/_cat/nodes?v</span><br><span class="line">ip        heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line">10.0.0.92           78          66   0    0.01    0.02     0.03 cdfhilmrstw -      elk01</span><br><span class="line">10.0.0.93           44          47   1    0.02    0.02     0.01 cdfhilmrstw -      elk02</span><br><span class="line">10.0.0.91           54          68   1    0.22    0.17     0.12 cdfhilmrstw *      elk03</span><br></pre></td></tr></table></figure><p><strong>1. ç”Ÿæˆè¯ä¹¦æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# /usr/share/elasticsearch/bin/elasticsearch-certutil cert --days 3650 -out /etc/elasticsearch/elastic-certificates.p12 -pass <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹è¯ä¹¦æƒé™ï¼ˆå¦åˆ™esæ²¡æœ‰æƒé™è¯»å–è¯ä¹¦ï¼‰</span></span><br><span class="line">[root@elk91 ~]# <span class="built_in">chown</span> elasticsearch:elasticsearch /etc/elasticsearch/elastic-certificates.p12</span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š:`</span><br><span class="line">[root@elk01:1 ~]# /usr/share/elasticsearch/bin/elasticsearch-certutil cert -h æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">--days   æŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸå¤šä¹…</span><br><span class="line">--out    æŒ‡å®šè¯ä¹¦å­˜æ”¾è·¯å¾„</span><br><span class="line">--pass   æŒ‡å®šè¯ä¹¦å¯†ç ï¼ˆä¸ºç©ºå³å¯ï¼‰</span><br></pre></td></tr></table></figure><p><strong>2. åŒæ­¥è¯ä¹¦æ–‡ä»¶åˆ°å…¶ä»–èŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elastic-certificates.p12 10.0.0.212:/etc/elasticsearch/</span><br><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elastic-certificates.p12 10.0.0.213:/etc/elasticsearch/</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨ï¼šæ³¨æ„æ£€æŸ¥å…¶å®ƒèŠ‚ç‚¹çš„è¯ä¹¦æƒé™æ˜¯å¦æ˜¯elasticsearchï¼Œè‹¥ä¸æ˜¯åˆ™ä¿®æ”¹ï¼ˆè§ä¸Šä¸€æ­¥ï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>4. ä¿®æ”¹ESé…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#åŒæ­¥é…ç½®æ–‡ä»¶åˆ°å…¶å®ƒèŠ‚ç‚¹</span></span><br><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elasticsearch.yml 10.0.0.212:/etc/elasticsearch/</span><br><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elasticsearch.yml 10.0.0.213:/etc/elasticsearch/</span><br></pre></td></tr></table></figure><p><strong>5. æ‰€æœ‰èŠ‚ç‚¹é‡å¯elasticsearch</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]#  systemctl restart elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒæœ€å¥½æ»šåŠ¨é‡å¯ï¼Œå½“å‰é‡å¯å®Œæ¯•åå†é‡å¯å…¶å®ƒèŠ‚ç‚¹ï¼ˆé˜²æ­¢æ‰€æœ‰é›†ç¾¤å®•æœºï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>6. æµ‹è¯•è®¿é—®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# curl 10.0.0.211:9200/_cat/nodes</span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:&#123;<span class="string">&quot;root_cause&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missing authentication credentials for REST request [/_cat/nodes]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;],<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missing authentication credentials for REST request [/_cat/nodes]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;,<span class="string">&quot;status&quot;</span>:401&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ²¡æœ‰æƒé™è®¿é—®å³ä¸ºæˆåŠŸ</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆå¯†ç ">ç”Ÿæˆå¯†ç </h2><p><strong>æ³¨æ„ä¿å­˜å¯†ç </strong></p><blockquote><p>auto  éäº¤äº’å¼ï¼Œè‡ªåŠ¨ç”Ÿæˆéšæœºå¯†ç </p><p>interactive äº¤äº’å¼ï¼Œè‡ªå·±è¾“å…¥å¯†ç ï¼ˆæœ‰7é¡¹ï¼‰</p><p><code>æ³¨æ„ä¿å­˜å¯†ç </code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto</span><br><span class="line">Initiating the setup of passwords <span class="keyword">for</span> reserved <span class="built_in">users</span> elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.</span><br><span class="line">The passwords will be randomly generated and printed to the console.</span><br><span class="line">Please confirm that you would like to <span class="built_in">continue</span> [y/N]y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user apm_system</span><br><span class="line">PASSWORD apm_system = ZY6QTWFDqGv64uVzB2PR</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user kibana_system</span><br><span class="line">PASSWORD kibana_system = BtaZLprbzzF1tYXSaCld</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user kibana</span><br><span class="line">PASSWORD kibana = BtaZLprbzzF1tYXSaCld</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user logstash_system</span><br><span class="line">PASSWORD logstash_system = ykztlETUjj9bu7zDF9Fw</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user beats_system</span><br><span class="line">PASSWORD beats_system = Fe075On7ZgmleYNkS9in</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user remote_monitoring_user</span><br><span class="line">PASSWORD remote_monitoring_user = J7bkmxKsrhUKhLJyksMD</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user elastic</span><br><span class="line">PASSWORD elastic = pNcoJpSv0j1Qp9ZZ4N5G</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•è¿æ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŠ ä¸Šç”¨æˆ·å’Œå¯†ç æµ‹è¯•</span></span><br><span class="line">[root@elk01:1 ~]# curl -u elastic:pNcoJpSv0j1Qp9ZZ4N5G 10.0.0.211:9200/_cat/nodes</span><br><span class="line">10.0.0.212 19 97 3 0.23 0.50 0.71 cdfhilmrstw * elk02</span><br><span class="line">10.0.0.211 12 91 3 0.31 0.46 0.53 cdfhilmrstw - elk01</span><br><span class="line">10.0.0.213 43 90 3 0.27 0.61 0.89 cdfhilmrstw - elk03</span><br></pre></td></tr></table></figure><h2 id="kibanaé›†æˆESåŠ å¯†é›†ç¾¤">kibanaé›†æˆESåŠ å¯†é›†ç¾¤</h2><p><strong>1. ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# vim /etc/kibana/kibana.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">elasticsearch.username: <span class="string">&quot;kibana_system&quot;</span></span><br><span class="line">elasticsearch.password: <span class="string">&quot;BtaZLprbzzF1tYXSaCld&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯†ç è§ä¸Šé¢ç”Ÿæˆçš„</span></span><br></pre></td></tr></table></figure><p>**2. é‡å¯kibanaæœåŠ¡ **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]#  systemctl restart kibana</span><br></pre></td></tr></table></figure><p><strong>3. è®¿é—®kibanaçš„webUIç™»å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.211:5601</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨elasticç”¨æˆ·ç™»å½•</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027222304410.png" alt="image-20241027222304410"></p><p><img src="https://cos.lukme.top/Pic/image-20241027222417898.png" alt="image-20241027222417898"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•åå¦‚æœæ²¡æœ‰å‡ºç°å³ä¸Šè§’eæ ‡å¿—ï¼Œå°è¯•æ¸…é™¤ç¼“å­˜ï¼Œæˆ–è€…ä½¿ç”¨æ— ç—•æ¨¡å¼ç™»å½•</span></span><br><span class="line">è¿™é‡Œä¿®æ”¹å¯†ç ä¸º   123456</span><br></pre></td></tr></table></figure><h2 id="filebeatå†™å…¥ESåŠ å¯†é›†ç¾¤">filebeatå†™å…¥ESåŠ å¯†é›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/filebeat/19-tcp_es_secret.yaml </span><br><span class="line"><span class="comment"># æ•°æ®ä»ç›‘å¬çš„æŒ‡å®štcpç«¯å£æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output:</span><br><span class="line">  elasticsearch:</span><br><span class="line">    hosts:</span><br><span class="line">    - <span class="string">&quot;http://10.0.0.211:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.212:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.213:9200&quot;</span></span><br><span class="line">    index: <span class="string">&quot;linux-tcp-secret-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    username: elastic</span><br><span class="line">    password: <span class="string">&quot;123456&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;linux-tcp-secret&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;linux-tcp-secret*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]# filebeat -e -c /etc/filebeat/19-tcp_es_secret.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•å®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]#  <span class="built_in">echo</span> 7890 |nc 10.0.0.211 9000</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027224350997.png" alt="image-20241027224350997"></p><p><strong>ä½¿ç”¨å¼€å‘å·¥å…·ç®€å•æŸ¥çœ‹æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027224929276.png" alt="image-20241027224929276"></p><h2 id="logstashå†™å…¥ESåŠ å¯†é›†ç¾¤">logstashå†™å…¥ESåŠ å¯†é›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/16-tcp-es-secret.conf</span><br><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; 8888</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">   elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;logstach-tcp-secret-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      user =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      password =&gt; <span class="string">&quot;123456&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# logstash -rf /etc/logstash/conf.d/16-tcp-es-secret.conf </span><br><span class="line"></span><br><span class="line"><span class="comment">#å†™å…¥æ•°æ®æµ‹è¯•</span></span><br><span class="line">[root@elk02:0 ~]# <span class="built_in">echo</span> 666666 |nc 10.0.0.211 8888</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027225729785.png" alt="image-20241027225729785"></p><h2 id="è§’è‰²è®¿é—®">è§’è‰²è®¿é—®</h2><p><strong>åˆ›å»ºè§’è‰²ï¼Œç»™å¼€å‘æˆ–è€…è¿ç»´ä¸åŒæƒé™</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027231430903.png" alt="image-20241027231430903"></p><p><img src="https://cos.lukme.top/Pic/image-20241027232332394.png" alt="image-20241027232332394"></p><p><img src="https://cos.lukme.top/Pic/image-20241027232500498.png" alt="image-20241027232500498"></p><p><strong>åˆ›å»ºè¿ç»´è§’è‰²</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027232645991.png" alt="image-20241027232645991"></p><p><strong>è¿˜æœ‰kibanaçš„æƒé™é€‰æ‹©allå®Œäº‹</strong>  <em><strong>å›¾ç•¥</strong></em></p><p><strong>åˆ›å»ºç”¨æˆ·</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027232837646.png" alt="image-20241027232837646"></p><p><strong>ç™»å½•ææ˜Ÿæ˜Ÿç”¨æˆ·   æƒé™ç¡®å®å°‘</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027233121133.png" alt="image-20241027233121133"></p>]]></content>
    
    
    <summary type="html">é’ˆå¯¹ESé›†ç¾¤åŠ å¯†ï¼Œè®¾ç½®æƒé™è®¿é—®</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
</feed>
