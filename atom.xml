<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£ç­ä¸Šçš„çŒ«</title>
  
  
  <link href="https://lukme.top/atom.xml" rel="self"/>
  
  <link href="https://lukme.top/"/>
  <updated>2024-10-30T04:02:48.777Z</updated>
  <id>https://lukme.top/</id>
  
  <author>
    <name>LuayğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>14.åŸºäºkafkaçš„æ—¥å¿—æ”¶é›†</title>
    <link href="https://lukme.top/posts/b922fe1d.html"/>
    <id>https://lukme.top/posts/b922fe1d.html</id>
    <published>2024-10-30T02:46:01.000Z</published>
    <updated>2024-10-30T04:02:48.777Z</updated>
    
    <content type="html"><![CDATA[<h2 id="filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤"><a href="#filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤" class="headerlink" title="filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤"></a>filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤</h2><p><strong>1. åˆ›å»ºtopic</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-topics.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic linux-study.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@elk01:5 ~]# kafka-topics.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --describe</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030003043850.png" alt="image-20241030003043850"></p><p><strong>2. filebeatå†™å…¥æ•°æ®åˆ°kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/20-filebeat-to-kafka.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">  - <span class="built_in">type</span>: filestream</span><br><span class="line">    paths:</span><br><span class="line">      - /opt/access.log*</span><br><span class="line">  </span><br><span class="line">output.kafka:</span><br><span class="line">  <span class="comment"># æŒ‡å®škafkaé›†ç¾¤åœ°å€</span></span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.211:9092&quot;</span>, <span class="string">&quot;10.0.0.212:9092&quot;</span>, <span class="string">&quot;10.0.0.213:9092&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># æŒ‡å®šå†™å…¥çš„topicåœ°å€</span></span><br><span class="line">  topic: <span class="string">&#x27;linux-study&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/20-filebeat-to-kafka.yaml</span><br></pre></td></tr></table></figure><p><strong>3. kafkaèŠ‚ç‚¹æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]#  kafka-console-consumer.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --from-beginning --group filebeat01</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030004427518.png" alt="image-20241030004427518"></p><h2 id="logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®"><a href="#logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®" class="headerlink" title="logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®"></a>logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®</h2><p><strong>1.ç¼–å†™logstashå®ä¾‹ </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment"># elasticsearch&#123;</span></span><br><span class="line"> <span class="comment">#    hosts =&gt; [&quot;10.0.0.91:9200&quot;,&quot;10.0.0.92:9200&quot;,&quot;10.0.0.93:9200&quot;]</span></span><br><span class="line"> <span class="comment">#    index =&gt; &quot;oldboyedu-kafka-elk-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"> <span class="comment">#    user =&gt; &quot;elastic&quot;</span></span><br><span class="line"> <span class="comment">#    password =&gt; &quot;123456&quot;</span></span><br><span class="line"> <span class="comment">#  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. å¯åŠ¨logstashå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# logstash -rf /etc/logstash/conf.d/17-kafka-to-logstash.conf </span><br><span class="line"></span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T17:05:27.448Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;&#123;\&quot;@timestamp\&quot;:\&quot;2024-10-29T16:39:24.279Z\&quot;,\&quot;@metadata\&quot;:&#123;\&quot;beat\&quot;:\&quot;filebeat\&quot;,\&quot;type\&quot;:\&quot;_doc\&quot;,\&quot;version\&quot;:\&quot;7.17.23\&quot;&#125;,\&quot;log\&quot;:&#123;\&quot;offset\&quot;:20478,\&quot;file\&quot;:&#123;\&quot;path\&quot;:\&quot;/opt/access.log\&quot;&#125;&#125;,\&quot;message\&quot;:\&quot;109.110.162.51 - - [04/Oct/2024:10:00:41 +0800] \\\&quot;GET / HTTP/1.1\\\&quot; 304 0 \\\&quot;-\\\&quot; \\\&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1 Edg/129.0.0.0\\\&quot;\&quot;,\&quot;input\&quot;:&#123;\&quot;type\&quot;:\&quot;filestream\&quot;&#125;,\&quot;ecs\&quot;:&#123;\&quot;version\&quot;:\&quot;1.12.0\&quot;&#125;,\&quot;host\&quot;:&#123;\&quot;name\&quot;:\&quot;elk01\&quot;&#125;,\&quot;agent\&quot;:&#123;\&quot;id\&quot;:\&quot;0f020f85-7619-4e85-83ae-346d91b5ca57\&quot;,\&quot;name\&quot;:\&quot;elk01\&quot;,\&quot;type\&quot;:\&quot;filebeat\&quot;,\&quot;version\&quot;:\&quot;7.17.23\&quot;,\&quot;hostname\&quot;:\&quot;elk01\&quot;,\&quot;ephemeral_id\&quot;:\&quot;ed96638d-32ee-4ee0-afbb-504643c3d52a\&quot;&#125;&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030010834508.png" alt="image-20241030010834508"></p><p><strong>3. ä¼˜åŒ–logstash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹messageå­—æ®µè¿›è¡Œjsonæ ¼å¼åŒ–</span></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;message&quot;</span></span><br><span class="line">    <span class="comment">#ç§»é™¤ä¸éœ€è¦çš„å­—æ®µï¼Œä¸ç„¶åƒä¸‹é¢ä¸€æ ·å‡ºç°å¾ˆå¤šæ²¡æœ‰ä»·å€¼çš„å­—æ®µ</span></span><br><span class="line">   <span class="comment"># remove_field =&gt; [ &quot;input&quot;,&quot;host&quot;,&quot;agent&quot;,&quot;@version&quot;,&quot;log&quot;, &quot;ecs&quot; ]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºç»“æœå±•ç¤º</span></span><br><span class="line"></span><br><span class="line">         <span class="string">&quot;agent&quot;</span> =&gt; &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">             <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ephemeral_id&quot;</span> =&gt; <span class="string">&quot;9a1e6795-8fe4-476b-ba6b-9d91b41f282c&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;id&quot;</span> =&gt; <span class="string">&quot;1b86f9d4-c41a-4c30-8b3c-c921ed07d026&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">         <span class="string">&quot;input&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filestream&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T16:40:45.156Z,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="string">&quot;ecs&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="string">&quot;log&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;offset&quot;</span> =&gt; 27088,</span><br><span class="line">          <span class="string">&quot;file&quot;</span> =&gt; &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;/opt/access.log&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#ç§»é™¤å­—æ®µåå±•ç¤º</span></span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T16:40:45.156Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;150.109.253.34 - - [04/Oct/2024:10:01:27 +0800] \&quot;GET /app HTTP/1.1\&quot; 404 197 \&quot;-\&quot; \&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36 Edg/129.0.0.0\&quot;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>4. æ­£å¸¸æ“ä½œä¼˜åŒ–,å¹¶è¾“å‡ºåˆ°esé›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹messageå­—æ®µè¿›è¡Œjsonæ ¼å¼åŒ–</span></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;message&quot;</span></span><br><span class="line">    <span class="comment">#ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;input&quot;</span>,<span class="string">&quot;host&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;@version&quot;</span>,<span class="string">&quot;log&quot;</span>, <span class="string">&quot;ecs&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># åŸºäºæ­£åˆ™åŒ¹é…ä»»æ„æ–‡æœ¬ï¼Œgrokå†…ç½®äº†120ç§åŒ¹é…æ¨¡å¼</span></span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;HTTPD_COMBINEDLOG&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  useragent &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;agent&quot;</span></span><br><span class="line">    target =&gt; <span class="string">&quot;agent-kind&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  geoip &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;clientip&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">date</span> &#123;</span><br><span class="line">    match =&gt; [ <span class="string">&quot;timestamp&quot;</span>, <span class="string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">     hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">     index =&gt; <span class="string">&quot;kafka-elk-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">     user =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">     password =&gt; <span class="string">&quot;123456&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030013045764.png" alt="image-20241030013045764"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†åŸºäºELFKæ¶æ„+kafkaæ”¶é›†æ—¥å¿—å¤„ç†</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>13.ä½¿ç”¨supervisorç®¡ç†æœåŠ¡</title>
    <link href="https://lukme.top/posts/1267bcfa.html"/>
    <id>https://lukme.top/posts/1267bcfa.html</id>
    <published>2024-10-30T02:45:01.000Z</published>
    <updated>2024-10-30T04:02:43.037Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨supervisorç®¡ç†æœåŠ¡"><a href="#ä½¿ç”¨supervisorç®¡ç†æœåŠ¡" class="headerlink" title="ä½¿ç”¨supervisorç®¡ç†æœåŠ¡"></a>ä½¿ç”¨supervisorç®¡ç†æœåŠ¡</h2><p><strong>1. ä¸‹è½½supervisor</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]#  apt -y install supervisor</span><br></pre></td></tr></table></figure><p><strong>2. å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]#  systemctl start supervisor</span><br><span class="line">[root@elk02:0 ~]#  systemctl <span class="built_in">enable</span> supervisor</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹supervisoré…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# vim /etc/supervisor/supervisord.conf</span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># ä»¥åéœ€è¦é…ç½®çš„æœåŠ¡åªéœ€è¦æ”¾åœ¨/etc/supervisor/ä¸‹ï¼Œä»¥.iniç»“å°¾çš„éƒ½å¯è¢«supervisorç®¡ç†</span></span><br><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/*.ini</span><br></pre></td></tr></table></figure><p><strong>4.ç¼–è¾‘inié…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/supervisor/zk.ini </span><br><span class="line">[program:zookeeper]</span><br><span class="line"><span class="built_in">command</span>=/app/zookeeper/bin/zkServer.sh start-foreground</span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stderr_logfile=/var/log/zookeeper.err.log</span><br><span class="line">stdout_logfile=/var/log/zookeeper.out.log</span><br><span class="line">user=root</span><br><span class="line">priority=1</span><br><span class="line">environment=JAVA_HOME=<span class="string">&quot;/usr/share/elasticsearch/jdk/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ä¿®æ”¹zookeeperçš„å®‰è£…è·¯å¾„ï¼Œä»¥åŠjavahomeè·¯å¾„   ï¼ˆä½¿ç”¨  echo $JAVA_HOME æŸ¥çœ‹javaç¯å¢ƒ ï¼‰</span></span><br><span class="line">[root@elk01:2 ~]# <span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br><span class="line">/usr/share/elasticsearch/jdk</span><br></pre></td></tr></table></figure><p><strong>5. æ›´æ–°supervisoré…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# supervisorctl update</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šæ¯æ¬¡è·Ÿæ–°æœåŠ¡é…ç½®éƒ½éœ€è¦update</span><br></pre></td></tr></table></figure><p><strong>6.supervisorç®¡ç†å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl start zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl stop zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æˆ–è€…åœæ­¢æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl start/stop all</span><br><span class="line"></span><br><span class="line">å‹æƒ…æç¤ºï¼š</span><br><span class="line">  å¦‚æœä½ çš„zookeeperæ˜¯ä½¿ç”¨zkServer.sh start å¯åŠ¨çš„ï¼Œè¦å…ˆä½¿ç”¨zkServer.sh stopå…³é—­æœåŠ¡ï¼Œä¸èƒ½ä½¿ç”¨zkServerå¯åŠ¨æœåŠ¡ï¼Œä½¿ç”¨supervisorå»å…³é—­æœåŠ¡</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†ä½¿ç”¨supervisorç»Ÿä¸€ç®¡ç†zookeeperå’Œkafkaï¼Œç›¸æ¯”systemdç®¡ç†æ›´åŠ æ–¹ä¾¿</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>12.kafkaçš„è„šæœ¬ç®¡ç†åŠæ•°æ®å»¶è¿Ÿã€ä¸¢å¤±åˆ†æ</title>
    <link href="https://lukme.top/posts/70dc5443.html"/>
    <id>https://lukme.top/posts/70dc5443.html</id>
    <published>2024-10-30T02:44:01.000Z</published>
    <updated>2024-10-30T04:02:38.055Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kafkaçš„è„šæœ¬ç®¡ç†"><a href="#kafkaçš„è„šæœ¬ç®¡ç†" class="headerlink" title="kafkaçš„è„šæœ¬ç®¡ç†"></a>kafkaçš„è„šæœ¬ç®¡ç†</h2><h3 id="topicç®¡ç†"><a href="#topicç®¡ç†" class="headerlink" title="topicç®¡ç†"></a>topicç®¡ç†</h3><p><strong>1.æŸ¥çœ‹topicåˆ—è¡¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --list </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>2.åˆ›å»ºtopic </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic luay.</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Šï¼š</span></span><br><span class="line">--topic  luay           <span class="comment">#æŒ‡å®štopicä¸ºluay</span></span><br><span class="line">--partitions 3          <span class="comment">#åˆ›å»º3ä¸ªåˆ†åŒº</span></span><br><span class="line">--replication-factor 2  <span class="comment">#åˆ›å»º2ä¸ªå‰¯æœ¬</span></span><br><span class="line">--create                <span class="comment">#åŠ¨ä½œ--åˆ›å»º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶å®ƒé€‰é¡¹</span></span><br><span class="line">--delete                <span class="comment">#åˆ é™¤</span></span><br><span class="line">--alter                 <span class="comment">#ä¿®æ”¹</span></span><br><span class="line">--describe              <span class="comment">#è¾“å‡ºè¯¦ç»†ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029180717295.png" alt="image-20241029180717295"></p><p><strong>3.ä¿®æ”¹åˆ†åŒºæ•°é‡ã€åªèƒ½ç”±å°å˜å¤§ï¼Œä¸èƒ½ç”±å¤§å˜å°ã€‘</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --partitions 5 --alter</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029180957289.png" alt="image-20241029180957289"></p><p><strong>4.æŸ¥çœ‹æŒ‡å®štopicçš„è¯¦ç»†ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --describe</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029181157071.png" alt="image-20241029181157071"></p><p><strong>5.åˆ é™¤topic</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --delete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#kafkaæ•°æ®ç›®å½•é‡Œtopicä¼šè¢«æ ‡è®°-deleteï¼Œç­‰å¾…ä¸€ä¼šä¾¿ä¼šè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">[root@elk01:1 ~]# ll /app/data/kafka/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 29 18:15 luay-1.2baa4b610f314befbfbed58aaad84052-delete/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 29 18:15 luay-2.0f44f4821a1849ccb7e0e37e1fe65ff4-delete/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="producerç®¡ç†"><a href="#producerç®¡ç†" class="headerlink" title="producerç®¡ç†"></a>producerç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt;999999</span><br><span class="line">[2024-10-29 20:49:30,357] WARN [Producer clientId=console-producer] Error <span class="keyword">while</span> fetching metadata with correlation <span class="built_in">id</span> 7 : &#123;<span class="built_in">test</span>=LEADER_NOT_AVAILABLE&#125; (org.apache.kafka.clients.NetworkClient)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é¦–æ¬¡å†™å…¥æ—¶ï¼Œè‹¥topicä¸å­˜åœ¨ï¼Œåˆ™kafkaé›†ç¾¤é»˜è®¤ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line">[root@elk02:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --list</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="kafkaçš„consumerç®¡ç†"><a href="#kafkaçš„consumerç®¡ç†" class="headerlink" title="kafkaçš„consumerç®¡ç†"></a>kafkaçš„consumerç®¡ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt;12112112</span><br><span class="line">&gt;666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯---æ¥æ”¶ç°åœ¨å¼€å§‹çš„æ¶ˆæ¯</span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯---ä»å¤´æ¥æ”¶æ¶ˆæ¯    --from-beginning </span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span> --from-beginning </span><br><span class="line">999999</span><br><span class="line">12112112</span><br><span class="line">666666</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…ç»„ç†å¿µ"><a href="#æ¶ˆè´¹è€…ç»„ç†å¿µ" class="headerlink" title="æ¶ˆè´¹è€…ç»„ç†å¿µ"></a>æ¶ˆè´¹è€…ç»„ç†å¿µ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- kafkaçš„æ¶ˆè´¹è€…ç»„æ¦‚å¿µ</span><br><span class="line">1.kafkaçš„offsetå­˜å‚¨ä½ç½®</span><br><span class="line">kafkaæ—©æœŸç‰ˆæœ¬ 0.9-ç‰ˆæœ¬ï¼Œoffsetè®°å½•å­˜å‚¨åœ¨zookeeperé›†ç¾¤ã€‚</span><br><span class="line">ä»kafka 0.10+ç‰ˆæœ¬ï¼Œé»˜è®¤çš„offsetå­˜å‚¨åœ¨kafkaé›†ç¾¤ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<span class="string">&quot;__consumer_offsets&quot;</span>å†…ç½®çš„topicã€‚(å½“æ¶ˆè´¹è€…å‡ºç°å®•æœºï¼Œå½“å‰å½“å‰ç»„é‡Œçš„å…¶å®ƒæ¶ˆè´¹è€…ä¼šä»_consumer_offsetsè®°å½•çš„åç§»é‡é‡Œï¼Œæ‰¾åˆ°å·²ç»å–åˆ°å“ªé‡Œçš„æ•°æ®ï¼Œä»æ­¤ç‚¹ç»§ç»­å¾€åå–æ•°æ®ï¼Œè€Œä¸æ˜¯ä»æ–°å–æ‰€æœ‰æ•°æ®ï¼Œé¿å…æ•°æ®é‡å¤é‡‡é›†)</span><br><span class="line"></span><br><span class="line">2.ç›¸å…³æœ¯è¯­</span><br><span class="line">consumer groupï¼š    æ¶ˆè´¹è€…ç»„ï¼Œä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½éš¶å±äºä¸€ä¸ªæ¶ˆè´¹è€…ç»„ã€‚</span><br><span class="line"></span><br><span class="line">1.è€Œ<span class="string">&quot;__consumer_offsets&quot;</span>å†…ç½®çš„topicè®°å½•çš„åç§»é‡å¹¶ä¸å±äºæŸä¸ªæ¶ˆè´¹è€…ï¼Œè€Œæ˜¯åŸºäºæ¶ˆè´¹è€…è¿›è¡Œè®°å½•çš„ã€‚</span><br><span class="line">2.å½“æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘é‡å¹³è¡¡(Rebalance);</span><br><span class="line">  1.æ¯”å¦‚æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…ï¼ˆC1/C2ï¼‰æ–°å¢æˆ–è€…ä¸‹çº¿ï¼Œæ‰€è°“çš„é‡å¹³è¡¡æŒ‡çš„æ˜¯è¯¥æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…é‡æ–°åˆ†é…åˆ†åŒºï¼ˆ0åˆ†åŒº,1åˆ†åŒº,2åˆ†åŒºè¿‡ç¨‹ã€‚</span><br><span class="line">  2.è¯¥æ¶ˆè´¹è€…ç»„è‹¥æ–°å¢äº†æ¶ˆè´¹è€…ï¼Œä¹Ÿä¼šè§¦å‘é‡å¹³è¡¡;</span><br><span class="line">  3.å½“æ¶ˆè´¹è€…ç»„çš„æ•°é‡å¤šä½™partitionæ•°é‡æ—¶ï¼Œåˆ™ä¼šå¯¼è‡´è¯¥æ¶ˆè´¹è€…ç»„æœ‰ç©ºé—²çš„æ¶ˆè´¹è€…;ï¼ˆå‡è®¾5ä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯åªæœ‰3ä¸ªåˆ†åŒº)</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/consumer_group.png" alt="consumer_group"></p><h2 id="kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ"><a href="#kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ" class="headerlink" title="kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ"></a>kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ</h2><p>ç”±å›¾è§£ï¼Œkafkaçš„æ¶ˆè´¹è€…æ˜¯logstashï¼Œæ€ä¹ˆä¼šå‡ºç°æ•°æ®å»¶è¿Ÿå‘¢ï¼Ÿ</p><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/ElasticStack_MQ.png" alt="ElasticStack_MQ"></p><blockquote><p>å½“ç”Ÿäº§è€…è¿‡å¤šï¼Œlogstashå¿™ä¸è¿‡æ¥æ—¶å€™æ”¶é›†ï¼Œå°±ä¼šå‡ºç°æ•°æ®å»¶è¿Ÿå¯èƒ½</p></blockquote><p>ç†è®ºå­˜åœ¨ï¼Œåˆ†æå®è·µ</p><p><strong>1. æŸ¥çœ‹ç°æœ‰çš„æ¶ˆè´¹è€…ç»„åˆ—è¡¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --list</span><br><span class="line">console-consumer-10558</span><br><span class="line">console-consumer-73547</span><br><span class="line">console-consumer-4558</span><br></pre></td></tr></table></figure><p><strong>2.åˆ›å»ºtopicæŒ‡å®šåˆ†åŒºå’Œå‰¯æœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:0 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic new --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic new.</span><br></pre></td></tr></table></figure><p><strong>3.å¯åŠ¨ç”Ÿäº§è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999</span><br></pre></td></tr></table></figure><p><strong>4.å¯åŠ¨æ¶ˆè´¹è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. å¯åŠ¨ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ŒæŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic new --from-beginning --group dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹æ¶ˆè´¹è€…åˆ—è¡¨</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --list</span><br><span class="line">dev</span><br><span class="line">console-consumer-10558</span><br><span class="line">console-consumer-73547</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹æŒ‡å®šæ¶ˆè´¹è€…çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --group dev --describe</span><br><span class="line">GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG</span><br><span class="line">dev             new             0          0               0               0  </span><br><span class="line">dev             new             1          0               0               0  </span><br><span class="line">dev             new             2          1               0               0  </span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029224849054.png" alt="image-20241029224849054"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.ç”Ÿäº§è€…ç»§ç»­å†™å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999999</span><br><span class="line">&gt;aaaaaaaa</span><br><span class="line">&gt;vbbbbbb</span><br><span class="line">&gt;ccccc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å¯åŠ¨æ–°çš„æ¶ˆè´¹è€…</span></span><br><span class="line">[root@elk02:1 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic new --from-beginning --group dev</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶æ²¡æœ‰æ–°çš„æ•°æ®ï¼Œå› ä¸ºè¢«åŒä¸€ä¸ªç»„ï¼ˆdevï¼‰çš„ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…å·²ç»é‡‡é›†è¿‡äº†</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. å†™å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999999</span><br><span class="line">&gt;aaaaaaaa</span><br><span class="line">&gt;vbbbbbb</span><br><span class="line">&gt;ccccc</span><br><span class="line">&gt;9999999999</span><br><span class="line">&gt;69696969696</span><br></pre></td></tr></table></figure><p><strong>åœæ­¢æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œåªå†™å…¥æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;h</span><br><span class="line">&gt;h</span><br><span class="line">&gt;asasasasasasas</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹è¯¦ç»†æ•°æ®</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --group dev --describe</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029230457830.png" alt="image-20241029230457830"></p><h2 id="kafkaæ•°æ®ä¸¢å¤±åˆ†æ"><a href="#kafkaæ•°æ®ä¸¢å¤±åˆ†æ" class="headerlink" title="kafkaæ•°æ®ä¸¢å¤±åˆ†æ"></a>kafkaæ•°æ®ä¸¢å¤±åˆ†æ</h2><blockquote><p>è§å›¾è§£</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kafkaçš„ISRåˆ—è¡¨å¯¼è‡´æ•°æ®ä¸¢å¤±çš„åŸå› ï¼š</span><br><span class="line">ISR:</span><br><span class="line">å’Œleaderå‰¯æœ¬åŒæ­¥çš„æ‰€æœ‰å‰¯æœ¬é›†åˆã€‚</span><br><span class="line">OSR:</span><br><span class="line">å’Œleaderå‰¯æœ¬ä¸åŒæ­¥æ‰€æœ‰å‰¯æœ¬é›†åˆã€‚</span><br><span class="line">AR:</span><br><span class="line">æ‰€æœ‰å‰¯æœ¬ï¼ŒæŒ‡çš„æ˜¯leader  + followerï¼Œå³AR = ISR + OSR </span><br><span class="line">LEO:</span><br><span class="line">è‹±æ–‡å…¨ç§°ä¸º: LOG-END-OFFSETï¼Œè¡¨ç¤ºæ¯ä¸ªpartitionæœ€åä¸€ä¸ªOffsetã€‚</span><br><span class="line">HW:</span><br><span class="line">è¡¨ç¤ºåœ¨ISRåˆ—è¡¨ä¸­æ‰€æœ‰LEOä¸­æœ€å°çš„LEOã€‚</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/kafka-ISR.png" alt="kafka-ISR"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†Kafkaçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¦‚ä½•å‘èµ·æ•°æ®å’Œæ”¶é›†æ•°æ®ï¼Œå¹¶ä¸”åˆ†ææ•°æ®å»¶è¿Ÿ</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>11.kafkaä»‹ç»åŠéƒ¨ç½²</title>
    <link href="https://lukme.top/posts/35ea5361.html"/>
    <id>https://lukme.top/posts/35ea5361.html</id>
    <published>2024-10-30T02:43:01.000Z</published>
    <updated>2024-11-17T16:05:52.434Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kafkaä»‹ç»"><a href="#kafkaä»‹ç»" class="headerlink" title="kafkaä»‹ç»"></a>kafkaä»‹ç»</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Kafka è¢«ç§°ä¸ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œç”± Scala å’Œ Javaç¼–å†™ï¼Œæ˜¯éè¥åˆ©æ€§ç»„ç»‡ASF(Apache Software Foundation)åŸºé‡‘ä¼šä¸­çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚:HTTP Serverã€Tomcatã€Hadoopã€ActiveMQç­‰å¼€æºè½¯ä»¶éƒ½å±äº ApacheåŸºé‡‘ä¼šçš„å¼€æºè½¯ä»¶ï¼Œç±»ä¼¼çš„æ¶ˆæ¯ç³»ç»Ÿè¿˜æœ‰RabbitMQã€ActiveMQã€ZeroMQã€‚</span><br><span class="line">Kafkaç”¨äºæ„å»ºå®æ—¶æ•°æ®ç®¡é“å’Œæµåº”ç”¨ç¨‹åºã€‚ å®ƒå…·æœ‰æ°´å¹³å¯ä¼¸ç¼©æ€§ï¼Œå®¹é”™æ€§ï¼Œå¿«é€Ÿæ€§ï¼Œå¯åœ¨æ•°åƒå®¶ç»„ç»‡ä¸­åŒæ—¶æŠ•å…¥ç”Ÿäº§ååŒå·¥ä½œã€‚</span><br></pre></td></tr></table></figure><h2 id="kafkaå¸¸è§æœ¯è¯­"><a href="#kafkaå¸¸è§æœ¯è¯­" class="headerlink" title="kafkaå¸¸è§æœ¯è¯­"></a>kafkaå¸¸è§æœ¯è¯­</h2><p>:dango:  <strong>1.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- topic:</span><br><span class="line">è¡¨ç¤ºæ˜¯ä¸»é¢˜ï¼Œå¯¹åº”æ˜¯é€»è¾‘å­˜å‚¨å•å…ƒï¼Œä¸€èˆ¬ç”¨äºåŒºåˆ†ä¸šåŠ¡ç±»å‹ã€‚å¯ä»¥å’ŒESçš„ç´¢å¼•å¯¹åº”ã€‚</span><br><span class="line">- partition</span><br><span class="line">åˆ†åŒºï¼Œä¸€ä¸ªtopicå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚</span><br><span class="line">- replica:</span><br><span class="line">æ˜¯æ•°æ®çš„å®é™…è½½ä½“ï¼ŒçœŸæ­£å­˜å‚¨æ•°æ®çš„èµ„æºï¼Œåˆ†ä¸ºleaderå’Œfollowerï¼Œå…¶ä¸­leaderå¯¹å¤–æä¾›è¯»å†™ï¼Œè€Œfollowerè´Ÿè´£æ•°æ®çš„åŒæ­¥ã€‚</span><br><span class="line">- producer:</span><br><span class="line">ç”Ÿäº§è€…ï¼Œå¾€kafkaé›†ç¾¤å†™æ•°æ®çš„ä¸€æ–¹ã€‚</span><br><span class="line">- consumer:</span><br><span class="line">æ¶ˆè´¹è€…ï¼Œä»kafkaè¯»å–æ•°æ®çš„ä¸€æ–¹ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/topic.png" alt="topic"></p><blockquote><p>è¯»å–æ•°æ®åªèƒ½å»leaderè¯»å–ï¼Œfollowå€¼è´Ÿè´£åŒæ­¥æ•°æ®</p></blockquote><p>:dango:<strong>2. è§’è‰²ä»‹ç»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰Producerï¼šProducerå³ç”Ÿäº§è€…ï¼Œæ¶ˆæ¯çš„äº§ç”Ÿè€…ï¼Œæ˜¯æ¶ˆæ¯çš„å…¥å£ã€‚è´Ÿè´£å‘å¸ƒæ¶ˆæ¯åˆ°Kafka broker</span><br><span class="line">ï¼ˆ2ï¼‰Consumerï¼šæ¶ˆè´¹è€…ï¼Œç”¨äºæ¶ˆè´¹æ¶ˆæ¯ï¼Œå³å¤„ç†æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">Brokerï¼šBrokeræ˜¯kafkaå®ä¾‹ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸Šå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªkafkaçš„å®ä¾‹ï¼Œå‡è®¾æ¯ä¸ªbrokerå¯¹åº”ä¸€å°æœåŠ¡å™¨ã€‚æ¯ä¸ªkafkaé›†ç¾¤å†…çš„brokeréƒ½æœ‰ä¸€ä¸ªä¸é‡å¤çš„ç¼–å·ï¼Œå¦‚: broker-0ã€broker-1ç­‰â€¦â€¦</span><br><span class="line"></span><br><span class="line">ï¼ˆ3ï¼‰Topic ï¼šæ¶ˆæ¯çš„ä¸»é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯çš„åˆ†ç±»ï¼Œä¸€ä¸ªTopicç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨,ä¸€æ¡æ¶ˆæ¯ç›¸å½“äºå…³ç³»æ•°æ®åº“çš„ä¸€æ¡è®°å½•ï¼Œä¸€ä¸ªTopicæˆ–è€…ç›¸å½“äºRedisä¸­åˆ—è¡¨ç±»å‹çš„ä¸€ä¸ªKeyï¼Œä¸€æ¡æ¶ˆæ¯å³ä¸ºåˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚kafkaçš„æ•°æ®å°±ä¿å­˜åœ¨topicã€‚åœ¨æ¯ä¸ªbrokerä¸Šéƒ½å¯ä»¥åˆ›å»ºå¤šä¸ªtopicã€‚ç‰©ç†ä¸Šä¸åŒ topic çš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶å¤¹ï¼Œé€»è¾‘ä¸Šä¸€ä¸ª topicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbroker ä¸Š, ä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼Œtopic åœ¨é€»è¾‘ä¸Šå¯¹record(è®°å½•ã€æ—¥å¿—)è¿›è¡Œåˆ†ç»„ä¿å­˜ï¼Œæ¶ˆè´¹è€…éœ€è¦è®¢é˜…ç›¸åº”çš„topic æ‰èƒ½æ¶ˆè´¹topicä¸­çš„æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">ï¼ˆ4ï¼‰Consumer group: æ¯ä¸ªconsumer å±äºä¸€ä¸ªç‰¹å®šçš„consumer groupï¼ˆå¯ä¸ºæ¯ä¸ªconsumer æŒ‡å®š group nameï¼Œè‹¥ä¸æŒ‡å®š group name åˆ™å±äºé»˜è®¤çš„groupï¼‰ï¼ŒåŒä¸€topicçš„ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«åŒä¸€ä¸ªconsumer group å†…çš„ä¸€ä¸ªconsumer æ¶ˆè´¹ï¼Œç±»ä¼¼äºä¸€å¯¹ä¸€çš„å•æ’­æœºåˆ¶ï¼Œä½†å¤šä¸ªconsumer group å¯åŒæ—¶æ¶ˆè´¹è¿™ä¸€æ¶ˆæ¯ï¼Œç±»ä¼¼äºä¸€å¯¹å¤šçš„å¤šæ’­æœºåˆ¶</span><br><span class="line"></span><br><span class="line">ï¼ˆ5ï¼‰Partition ï¼šæ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ªtopic åˆ†å‰²ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼Œå³ä¸€ä¸ªtopicåˆ‡åˆ†ä¸ºå¤šä»½.åˆ›å»º topicæ—¶å¯æŒ‡å®š partition æ•°é‡ï¼Œpartitionçš„è¡¨ç°å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ–‡ä»¶å¤¹,è¯¥æ–‡ä»¶å¤¹ä¸‹å­˜å‚¨è¯¥partitionçš„æ•°æ®å’Œç´¢å¼•æ–‡ä»¶ï¼Œåˆ†åŒºçš„ä½œç”¨è¿˜å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œæé«˜kafkaçš„ååé‡ã€‚åŒä¸€ä¸ªtopicåœ¨ä¸åŒçš„åˆ†åŒºçš„æ•°æ®æ˜¯ä¸é‡å¤çš„,ä¸€èˆ¬Partitionæ•°ä¸è¦è¶…è¿‡èŠ‚ç‚¹æ•°ï¼Œæ³¨æ„åŒä¸€ä¸ªpartitionæ•°æ®æ˜¯æœ‰é¡ºåºçš„ï¼Œä½†ä¸åŒçš„partitionåˆ™æ˜¯æ— åºçš„</span><br><span class="line"></span><br><span class="line">ï¼ˆ6ï¼‰Replication: åŒæ ·æ•°æ®çš„å‰¯æœ¬ï¼ŒåŒ…æ‹¬leaderå’Œfollowerçš„å‰¯æœ¬æ•°,åŸºæœ¬äºæ•°æ®å®‰å…¨,å»ºè®®è‡³å°‘2ä¸ª,æ˜¯Kafkaçš„é«˜å¯é æ€§çš„ä¿éšœï¼Œå’ŒESçš„å‰¯æœ¬æœ‰æ‰€ä¸åŒï¼ŒKafkaä¸­çš„å‰¯æœ¬æ•°åŒ…æ‹¬ä¸»åˆ†ç‰‡æ•°,è€ŒESä¸­çš„å‰¯æœ¬æ•°ä¸åŒ…æ‹¬ä¸»åˆ†ç‰‡æ•°</span><br><span class="line"></span><br><span class="line">ä¸ºäº†å®ç°æ•°æ®çš„é«˜å¯ç”¨ï¼Œæ¯”å¦‚å°†åˆ†åŒº 0 çš„æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„kafka èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª broker ä½œä¸º Leader å’Œä¸€ä¸ª broker ä½œä¸ºFollowerï¼Œç±»ä¼¼äºESä¸­çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ã€‚</span><br><span class="line"></span><br><span class="line">å‡è®¾åˆ†åŒºä¸º 3, å³åˆ†ä¸‰ä¸ªåˆ†åŒº0-2ï¼Œå‰¯æœ¬ä¸º3ï¼Œå³æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª leaderï¼Œå†åŠ ä¸¤ä¸ªfollowerï¼Œåˆ†åŒº 0 çš„leaderä¸ºæœåŠ¡å™¨Aï¼Œåˆ™æœåŠ¡å™¨ B å’ŒæœåŠ¡å™¨ C ä¸º A çš„followerï¼Œè€Œåˆ†åŒº 1 çš„leaderä¸ºæœåŠ¡å™¨Bï¼Œåˆ™æœåŠ¡å™¨ A å’ŒC ä¸ºæœåŠ¡å™¨B çš„followerï¼Œè€Œåˆ†åŒº 2 çš„leader ä¸ºCï¼Œåˆ™æœåŠ¡å™¨A å’Œ B ä¸ºC çš„followerã€‚</span><br><span class="line"></span><br><span class="line">ARï¼š Assigned Replicasï¼Œåˆ†åŒºä¸­çš„æ‰€æœ‰å‰¯æœ¬çš„ç»Ÿç§°ï¼ŒåŒ…æ‹¬leaderå’Œ followerï¼ŒAR= lSR+ OSR</span><br><span class="line">lSRï¼š<span class="built_in">ln</span> Sync Replicasï¼Œæ‰€æœ‰ä¸leaderå‰¯æœ¬ä¿æŒåŒæ­¥çš„å‰¯æœ¬ followerå’Œleaderæœ¬èº«ç»„æˆçš„é›†åˆï¼ŒåŒ…æ‹¬leaderå’Œ followerï¼Œæ˜¯ARçš„å­é›†</span><br><span class="line">OSRï¼šout-of-Sync Repliedï¼Œæ‰€æœ‰ä¸leaderå‰¯æœ¬åŒæ­¥ä¸èƒ½åŒæ­¥çš„ followerçš„é›†åˆï¼Œæ˜¯ARçš„å­é›†</span><br></pre></td></tr></table></figure><p>:dango: 3. åˆ†åŒºå’Œå‰¯æœ¬çš„ä¼˜åŠ¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®ç°å­˜å‚¨ç©ºé—´çš„æ¨ªå‘æ‰©å®¹ï¼Œå³å°†å¤šä¸ªkafkaæœåŠ¡å™¨çš„ç©ºé—´ç»„åˆåˆ©ç”¨</span><br><span class="line">æå‡æ€§èƒ½ï¼Œå¤šæœåŠ¡å™¨å¹¶è¡Œè¯»å†™</span><br><span class="line">å®ç°é«˜å¯ç”¨ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªä¸»åˆ†åŒºå³ leader åˆ†å¸ƒåœ¨ä¸åŒçš„kafka æœåŠ¡å™¨ï¼Œå¹¶ä¸”æœ‰å¯¹åº”follower åˆ†å¸ƒåœ¨å’Œleaderä¸åŒçš„æœåŠ¡å™¨ä¸Š</span><br></pre></td></tr></table></figure><p>:dango: <strong>4. kafkaå†™å…¥æ¶ˆæ¯æµç¨‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç”Ÿäº§è€…ï¼ˆproducterï¼‰å…ˆä»kafkaé›†ç¾¤è·å–åˆ†åŒºçš„leader</span><br><span class="line">ç”Ÿäº§è€…ï¼ˆproducterï¼‰å°†æ¶ˆæ¯å‘é€ç»™leader</span><br><span class="line">leaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶</span><br><span class="line">followersä»leader pullæ¶ˆæ¯</span><br><span class="line">followerså°†æ¶ˆæ¯å†™å…¥æœ¬åœ°åå‘leaderå‘é€ACK</span><br><span class="line">leaderæ”¶åˆ°æ‰€æœ‰å‰¯æœ¬çš„ACKåå‘producterå‘é€ACK</span><br></pre></td></tr></table></figure><p>:dango:  <strong>5. kafkaç‰¹ç‚¹å’Œä¼˜åŠ¿</strong></p><blockquote><p><code>ç‰¹ç‚¹ï¼š</code><br>åˆ†å¸ƒå¼: å¤šæœºå®ç°,ä¸å…è®¸å•æœº<br>åˆ†åŒº: ä¸€ä¸ªæ¶ˆæ¯.å¯ä»¥æ‹†åˆ†å‡ºå¤šä¸ªï¼Œåˆ†åˆ«å­˜å‚¨åœ¨å¤šä¸ªä½ç½®<br>å¤šå‰¯æœ¬: é˜²æ­¢ä¿¡æ¯ä¸¢å¤±ï¼Œå¯ä»¥å¤šæ¥å‡ ä¸ªå¤‡ä»½<br>å¤šè®¢é˜…è€…: å¯ä»¥æœ‰å¾ˆå¤šåº”ç”¨è¿æ¥kafka<br>Zookeeper: æ—©æœŸç‰ˆæœ¬çš„Kafkaä¾èµ–äºzookeeperï¼Œ 2021å¹´4æœˆ19æ—¥Kafka 2.8.0æ­£å¼å‘å¸ƒï¼Œæ­¤ç‰ˆæœ¬åŒ…æ‹¬äº†å¾ˆå¤šé‡è¦æ”¹åŠ¨ï¼Œæœ€ä¸»è¦çš„æ˜¯kafkaé€šè¿‡è‡ªæˆ‘ç®¡ç†çš„ä»²è£æ¥æ›¿ä»£ZooKeeperï¼Œå³Kafkaå°†ä¸å†éœ€è¦ZooKeeperï¼ï¼ï¼</p><p><code>ä¼˜åŠ¿ï¼š</code><br>é«˜ååé‡ï¼šå³ä½¿æ˜¯éå¸¸æ™®é€šçš„ç¡¬ä»¶Kafkaä¹Ÿå¯ä»¥æ”¯æŒæ¯ç§’æ•°ç™¾ä¸‡çš„æ¶ˆæ¯ã€‚æ”¯æŒé€šè¿‡Kafka æœåŠ¡å™¨åˆ†åŒºæ¶ˆæ¯ã€‚<br>åˆ†å¸ƒå¼ï¼š Kafka åŸºäºåˆ†å¸ƒå¼é›†ç¾¤å®ç°é«˜å¯ç”¨çš„å®¹é”™æœºåˆ¶ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨çš„æ•…éšœè½¬ç§»ã€‚<br>é¡ºåºä¿è¯ï¼šåœ¨å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ•°æ®å¤„ç†çš„é¡ºåºéƒ½å¾ˆé‡è¦ã€‚å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æœ¬æ¥å°±æ˜¯æ’åºçš„ï¼Œå¹¶ä¸”èƒ½ä¿è¯æ•°æ®ä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ¥å¤„ç†ã€‚ Kafkaä¿è¯ä¸€ä¸ªPartitonå†…çš„æ¶ˆæ¯çš„æœ‰åºæ€§ï¼ˆåˆ†åŒºé—´æ•°æ®æ˜¯æ— åºçš„ï¼Œå¦‚æœå¯¹æ•°æ®çš„é¡ºåºæœ‰è¦æ±‚ï¼Œåº”å°†åœ¨åˆ›å»ºä¸»é¢˜æ—¶å°†åˆ†åŒºæ•°partitionsè®¾ç½®ä¸º1ï¼‰ã€‚<br>æ”¯æŒ Hadoop å¹¶è¡Œæ•°æ®åŠ è½½ã€‚<br>é€šå¸¸ç”¨äºå¤§æ•°æ®åœºåˆ,ä¼ é€’å•æ¡æ¶ˆæ¯æ¯”è¾ƒå¤§ï¼Œè€ŒRabbitmq æ¶ˆæ¯ä¸»è¦æ˜¯ä¼ è¾“ä¸šåŠ¡çš„æŒ‡ä»¤æ•°æ®,å•æ¡æ•°æ®è¾ƒå°ã€‚</p></blockquote><h2 id="å•ç‚¹éƒ¨ç½²kafka"><a href="#å•ç‚¹éƒ¨ç½²kafka" class="headerlink" title="å•ç‚¹éƒ¨ç½²kafka"></a>å•ç‚¹éƒ¨ç½²kafka</h2><p><strong>1.ä¸‹è½½kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]#wget https://downloads.apache.org/kafka/3.8.0/kafka_2.13-3.8.0.tgz</span><br></pre></td></tr></table></figure><p><strong>2.è§£å‹kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# tar xf kafka_2.13-3.8.0.tgz -C /app/</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹kafkaçš„é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# vim /app/kafka_2.13-3.8.0/config/server.properties </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># ä¿®æ”¹kafkaçš„brokerçš„IDä¿¡æ¯</span></span><br><span class="line">broker.id=211</span><br><span class="line"><span class="comment"># ä¿®æ”¹æ•°æ®ç›®å½•</span></span><br><span class="line">log.dirs=/app/data/kafka</span><br><span class="line"><span class="comment"># ä¿®æ”¹å…ƒæ•°æ®å­˜å‚¨zookeeperé›†ç¾¤åœ°å€</span></span><br><span class="line">zookeeper.connect=10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181/kafka380</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;æ³¨é‡Šï¼š&#x27;</span></span><br><span class="line">/kafka380   æ˜¯å°†ä»¥åçš„znodeéƒ½æ”¾åœ¨kafka380ä¸‹ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤éƒ½åœ¨zookeeperçš„ / ä¸‹</span><br></pre></td></tr></table></figure><p><strong>4.é…ç½®ç¯å¢ƒå˜é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# <span class="built_in">cat</span>  /etc/profile.d/kafka.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_HOME=/app/kafka_2.13-3.8.0</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$KAFKA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:4 ~]# <span class="built_in">source</span> /etc/profile.d/kafka.sh </span><br></pre></td></tr></table></figure><p><strong>5.å¯åŠ¨kafkaèŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:4 ~]# kafka-server-start.sh -daemon <span class="variable">$KAFKA_HOME</span>/config/server.properties</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241029000747486.png" alt="image-20241029000747486"></p><h2 id="kafkaé…ç½®æ–‡ä»¶è¯¦è§£"><a href="#kafkaé…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="kafkaé…ç½®æ–‡ä»¶è¯¦è§£"></a>kafkaé…ç½®æ–‡ä»¶è¯¦è§£</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment"># contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment"># this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment"># the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This configuration file is intended for use in ZK-based mode, where Apache ZooKeeper is required.</span></span><br><span class="line"><span class="comment"># See kafka.server.KafkaConfig for additional details and defaults</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Server Basics #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># broker çš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚</span></span><br><span class="line">broker.id=0</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Socket Server Settings #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¥—æ¥å­—æœåŠ¡å™¨ä¾¦å¬çš„åœ°å€ã€‚å¦‚æœæœªé…ç½®ï¼Œä¸»æœºåå°†ç­‰äºçš„å€¼</span></span><br><span class="line"><span class="comment"># java.net.InetAddress.getCanonicalHostName(), with PLAINTEXT listener name, and port 9092.</span></span><br><span class="line"><span class="comment">#   FORMAT:</span></span><br><span class="line"><span class="comment">#     listeners = listener_name://host_name:port</span></span><br><span class="line"><span class="comment">#   EXAMPLE:</span></span><br><span class="line"><span class="comment">#     listeners = PLAINTEXT://your.host.name:9092</span></span><br><span class="line"><span class="comment">#listeners=PLAINTEXT://:9092</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾¦å¬å™¨åç§°ã€ä¸»æœºåå’Œä»£ç†å°†å‘å®¢æˆ·ç«¯å…¬å¸ƒçš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨â€œlistenersâ€çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¾¦å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒä»¬æ˜¯ç›¸åŒçš„ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é…ç½®æ–‡æ¡£</span></span><br><span class="line"><span class="comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤„ç†ç½‘ç»œè¯·æ±‚çš„çº¿ç¨‹æ•°é‡(æœåŠ¡å™¨ç”¨äºä»ç½‘ç»œæ¥æ”¶è¯·æ±‚å¹¶å‘ç½‘ç»œå‘é€å“åº”çš„çº¿ç¨‹æ•°)</span></span><br><span class="line">num.network.threads=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æ¥å¤„ç†ç£ç›˜ IO çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line">num.io.threads=8</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚å¥—æ¥å­—çš„ç¼“å†²åŒºæœ€å¤§å¤§å°</span></span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Log Basics #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kafka è¿è¡Œæ—¥å¿—(æ•°æ®)å­˜æ”¾çš„è·¯å¾„,è·¯å¾„ä¸éœ€è¦æå‰åˆ›å»º,kafka è‡ªåŠ¨å¸®ä½ åˆ›å»º,å¯ä»¥é…ç½®å¤šä¸ªç£ç›˜è·¯å¾„,è·¯å¾„ä¸è·¯å¾„ä¹‹é—´å¯ä»¥ç”¨&quot;,&quot;åˆ†éš”</span></span><br><span class="line">log.dirs=/usr/kafka/kafka_2.13-3.6.1/datas</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªtopicåœ¨å½“å‰ brokerä¸Šçš„é»˜è®¤åˆ†åŒºæ•°ã€‚æ›´å¤šçš„åˆ†åŒºå…è®¸æ›´å¤§çš„å¹¶è¡Œæ€§ä»¥ä¾›ä½¿ç”¨ï¼Œä½†è¿™ä¹Ÿä¼šå¯¼è‡´ä»£ç†ä¹‹é—´æœ‰æ›´å¤šçš„æ–‡ä»¶ã€‚</span></span><br><span class="line">num.partitions=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æ—¶ç”¨äºæ—¥å¿—æ¢å¤å’Œå…³é—­æ—¶ç”¨äºåˆ·æ–°çš„æ¯ä¸ªæ•°æ®ç›®å½•çš„çº¿ç¨‹æ•°ã€‚(ç”¨æ¥æ¢å¤å’Œæ¸…ç† data ä¸‹æ•°æ®çš„çº¿ç¨‹æ•°é‡)å¯¹äºæ•°æ®ç›®å½•ä½äºRAIDé˜µåˆ—ä¸­çš„å®‰è£…ï¼Œå»ºè®®å¢åŠ æ­¤å€¼ã€‚</span></span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Internal Topic Settings  #############################</span></span><br><span class="line"><span class="comment"># æ¯ä¸ª topic åˆ›å»ºæ—¶çš„å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ—¶ 1 ä¸ªå‰¯æœ¬,å¯¹äºå¼€å‘æµ‹è¯•ä»¥å¤–çš„ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨å¤§äº1çš„å€¼ä»¥ç¡®ä¿å¯ç”¨æ€§ï¼Œå¦‚3</span></span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Log Flush Policy #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Messages are immediately written to the filesystem but by default we only fsync() to sync</span></span><br><span class="line"><span class="comment"># the OS cache lazily. The following configurations control the flush of data to disk.</span></span><br><span class="line"><span class="comment"># There are a few important trade-offs here:</span></span><br><span class="line"><span class="comment">#    1. Durability: Unflushed data may be lost if you are not using replication.</span></span><br><span class="line"><span class="comment">#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.</span></span><br><span class="line"><span class="comment">#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.</span></span><br><span class="line"><span class="comment"># The settings below allow one to configure the flush policy to flush data after a period of time or</span></span><br><span class="line"><span class="comment"># every N messages (or both). This can be done globally and overridden on a per-topic basis.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼ºåˆ¶å°†æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¹‹å‰è¦æ¥å—çš„æ¶ˆæ¯æ•°</span></span><br><span class="line"><span class="comment">#log.flush.interval.messages=10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å¼ºåˆ¶åˆ·æ–°ä¹‹å‰ï¼Œæ¶ˆæ¯å¯ä»¥åœ¨æ—¥å¿—ä¸­åœç•™çš„æœ€é•¿æ—¶é—´</span></span><br><span class="line"><span class="comment">#log.flush.interval.ms=1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Log Retention Policy #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The following configurations control the disposal of log segments. The policy can</span></span><br><span class="line"><span class="comment"># be set to delete segments after a period of time, or after a given size has accumulated.</span></span><br><span class="line"><span class="comment"># A segment will be deleted whenever *either* of these criteria are met. Deletion always happens</span></span><br><span class="line"><span class="comment"># from the end of the log.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># segment æ–‡ä»¶ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼Œè¶…æ—¶å°†è¢«åˆ é™¤</span></span><br><span class="line">log.retention.hours=168</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºäºå¤§å°çš„æ—¥å¿—ä¿ç•™ç­–ç•¥ã€‚é™¤éå‰©ä½™çš„</span></span><br><span class="line"><span class="comment"># segmentsä¸‹é™åˆ° log.retention.bytes ä»¥ä¸‹ã€‚ç‹¬ç«‹äºlog.retention.hoursçš„å‡½æ•°.</span></span><br><span class="line"><span class="comment">#log.retention.bytes=1073741824</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ª segment æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼Œé»˜è®¤æœ€å¤§ 1G ï¼Œå½“è¾¾åˆ°æ­¤å¤§å°æ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ªæ–°çš„segmentã€‚</span></span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ—¥å¿—æ®µä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥æ ¹æ®ä¿ç•™ç­–ç•¥åˆ é™¤å®ƒä»¬çš„é—´éš”(æ£€æŸ¥è¿‡æœŸæ•°æ®çš„æ—¶é—´ï¼Œé»˜è®¤ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æ•°æ®è¿‡æœŸ)</span></span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Zookeeper #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Zookeeperé›†ç¾¤è¿æ¥å­—ç¬¦ä¸²,ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„&#x27;ä¸»æœº:ç«¯å£&#x27;å¯¹ï¼Œæ¯ä¸ªå¯¹å¯¹åº”ä¸€ä¸ªzkæœåŠ¡å™¨ã€‚å¯ä»¥åœ¨urlä¸­é™„åŠ ä¸€ä¸ªå¯é€‰çš„chrootå­—ç¬¦ä¸²ï¼Œä»¥æŒ‡å®šæ‰€æœ‰kafka-znodeçš„æ ¹ç›®å½•ã€‚</span></span><br><span class="line">zookeeper.connect=10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ°zookeeper çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">zookeeper.connection.timeout.ms=18000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Group Coordinator Settings #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹é…ç½®æŒ‡å®šGroupCoordinatorå°†å»¶è¿Ÿåˆå§‹ä½¿ç”¨è€…é‡æ–°å¹³è¡¡çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># éšç€æ–°æˆå‘˜åŠ å…¥ç»„ï¼Œå†å¹³è¡¡å°†è¿›ä¸€æ­¥å»¶è¿Ÿgroup.initial.rebalance.delay.msçš„å€¼ï¼Œæœ€å¤§å€¼ä¸ºmax.poll.interval.msã€‚</span></span><br><span class="line"><span class="comment"># é»˜è®¤å€¼ä¸º3ç§’ã€‚</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬åœ¨è¿™é‡Œå°†å…¶è¦†ç›–ä¸º0ï¼Œå› ä¸ºå®ƒä¸ºå¼€å‘å’Œæµ‹è¯•æä¾›äº†æ›´å¥½çš„å¼€ç®±å³ç”¨ä½“éªŒã€‚</span></span><br><span class="line"><span class="comment"># ä½†æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé»˜è®¤å€¼3ç§’æ›´åˆé€‚ï¼Œå› ä¸ºè¿™å°†æœ‰åŠ©äºé¿å…åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æœŸé—´è¿›è¡Œä¸å¿…è¦çš„ã€å¯èƒ½ä»£ä»·é«˜æ˜‚çš„é‡æ–°å¹³è¡¡ã€‚</span></span><br><span class="line">group.initial.rebalance.delay.ms=3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²kafkaé›†ç¾¤"><a href="#éƒ¨ç½²kafkaé›†ç¾¤" class="headerlink" title="éƒ¨ç½²kafkaé›†ç¾¤"></a>éƒ¨ç½²kafkaé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é‡å¤å•ç‚¹éƒ¨ç½²çš„1-6æ­¥éª¤ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé…ç½®æ–‡ä»¶çš„broker.id=211/212/213  æ ¹æ®ä½ çš„ipåå°¾è‡ªè¡Œä¿®æ”¹(ä¸‰ä¸ªèŠ‚ç‚¹ä¸ç›¸åŒï¼Œä¸”ä¸ºæ­£æ•´æ•°å°±è¡Œ)</span><br></pre></td></tr></table></figure><blockquote><p>æ¸©é¦¨æç¤ºï¼šä¸‰ä¸ª  èŠ‚ç‚¹åšhostsè§£æ,å°†ä¸»æœºåè§£æåˆ°ä½ çš„ipä¸Šï¼Œå·¨å‘ï¼Œä¸€å¼€å§‹å¿˜è®°åå‘è§£æè¿™ä¸ªé—®é¢˜äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk211 ~]# <span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">10.0.0.211 elk01</span></span><br><span class="line"><span class="string">10.0.0.212 elk02</span></span><br><span class="line"><span class="string">10.0.0.213 elk03</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241029185857776.png" alt="image-20241029185857776"></p><p>ä»¥æ­¤ä¸ºæˆ’ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å·¨å‘</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241029002841827.png" alt="image-20241029002841827"></p><blockquote><p>æˆ‘ä»¬é…ç½®æ–‡ä»¶é‡Œæ²¡æœ‰æŒ‡å®šæ¯ä¸ªkafkaçš„åœ°å€ï¼Œé‚£å®ƒä»¬æ˜¯å¦‚ä½•æ‰¾åˆ°å½¼æ­¤çš„å‘¢ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:4 ~]# grep -Ev <span class="string">&#x27;^#|^$&#x27;</span> /app/kafka_2.13-3.8.0/config/server.properties </span><br><span class="line">broker.id=211</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/app/data/kafka</span><br><span class="line">num.partitions=1</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181/kafka380</span><br><span class="line">zookeeper.connection.timeout.ms=18000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br></pre></td></tr></table></figure><font color=red>kafkaé€šè¿‡è¿æ¥zookeeperï¼Œå»æ‰¾åˆ°å„ä¸ªkafka</font></blockquote>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†Kafkaçš„ä½œç”¨,ä¼˜åŠ¿,è§’è‰²ä»¥åŠå¦‚ä½•éƒ¨ç½²kafkaé›†ç¾¤</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>10.zookeeperçš„å›¾å½¢åŒ–ç®¡ç†</title>
    <link href="https://lukme.top/posts/da2b0f43.html"/>
    <id>https://lukme.top/posts/da2b0f43.html</id>
    <published>2024-10-30T02:42:01.000Z</published>
    <updated>2024-10-30T04:02:29.309Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zookeeperçš„ç±»å‹"><a href="#zookeeperçš„ç±»å‹" class="headerlink" title="zookeeperçš„ç±»å‹"></a>zookeeperçš„ç±»å‹</h2><ol><li>ä¸´æ—¶znodeç±»å‹</li></ol><p>å½“å®¢æˆ·ç«¯ä¼šè¯æ–­å¼€è¿æ¥ï¼Œè‹¥åœ¨è§„å®šæ—¶é—´(é»˜è®¤æ˜¯30s)å†…æ²¡æœ‰é‡æ–°è¿æ¥åˆ™è¯¥å®¢æˆ·ç«¯åˆ›å»ºçš„æ‰€æœ‰znodeéƒ½ä¼šè¢«åˆ é™¤ã€‚</p><ol><li>æ°¸ä¹…znode</li></ol><p>å½“å®¢æˆ·ç«¯ä¼šè¯æ–­å¼€è¿æ¥ï¼Œznodeä¸ä¼šè¢«åˆ é™¤ã€‚</p><blockquote><p>é»˜è®¤åˆ›å»ºçš„znodeéƒ½æ˜¯æ°¸ä¹…çš„ï¼Œå¦‚æœæƒ³è¦åˆ›å»ºä¸´æ—¶znodeï¼Œåˆ™éœ€è¦æŒ‡å®šâ€-eâ€å‚æ•°ã€‚</p></blockquote><p><strong>éªŒè¯æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹znodeçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] <span class="built_in">stat</span> /luay</span><br><span class="line">cZxid = 0x400000002</span><br><span class="line">ctime = Mon Oct 28 13:09:07 UTC 2024</span><br><span class="line">mZxid = 0x40000000e</span><br><span class="line">mtime = Mon Oct 28 13:11:34 UTC 2024</span><br><span class="line">pZxid = 0x40000000b</span><br><span class="line">cversion = 5</span><br><span class="line">dataVersion = 3</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸´æ—¶åˆ›å»ºznode</span></span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] create -e /abc</span><br><span class="line">Created /abc</span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 6] <span class="built_in">stat</span> /abc</span><br><span class="line">cZxid = 0xf00000002</span><br><span class="line">ctime = Mon Oct 28 14:23:04 UTC 2024</span><br><span class="line">mZxid = 0xf00000002</span><br><span class="line">mtime = Mon Oct 28 14:23:04 UTC 2024</span><br><span class="line">pZxid = 0xf00000002</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0xd500028c8caa0000</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 0</span><br><span class="line"></span><br><span class="line">`æ³¨æ„ï¼šephemeralOwnerè¿™ä¸€è¡Œï¼Œä¸æ˜¯å’Œä¸Šé¢æ°¸ä¹…znodeçŠ¶æ€ä¸€æ ·ï¼Œä¸Šé¢æ°¸ä¹…çš„æ˜¯0x0`</span><br><span class="line"></span><br><span class="line"><span class="comment">#é€€å‡ºè¿æ¥ç­‰å¾…30så†æ¬¡è¿æ¥æŸ¥çœ‹--æ²¡äº†</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 0] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;é‡æ–°å»ºç«‹é“¾æ¥ï¼Œé»˜è®¤30såæ•°æ®å°±è‡ªåŠ¨åˆ é™¤ï¼&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="zookeeperçš„JVMè°ƒä¼˜"><a href="#zookeeperçš„JVMè°ƒä¼˜" class="headerlink" title="zookeeperçš„JVMè°ƒä¼˜"></a>zookeeperçš„JVMè°ƒä¼˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.zookeeperçš„å †å†…å­˜è°ƒä¼˜æ€è·¯ï¼ˆè¿™é‡Œè°ƒè¯•128mæµ‹è¯•ï¼‰</span><br><span class="line">ç”Ÿæˆç¯å¢ƒä¸­ï¼Œå»ºè®®é…ç½®2GB-4GBå³å¯ã€‚é»˜è®¤æ˜¯1GBã€‚</span><br><span class="line"></span><br><span class="line">2.æŸ¥çœ‹é»˜è®¤çš„å †å†…å­˜å¤§å°</span><br><span class="line">[root@elk03:1 ~]#  ps -ef | grep zookeeper | grep -i xmx</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241028223011825.png" alt="image-20241028223011825"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">3.ä¿®æ”¹å®˜æ–¹çš„ç¯å¢ƒå˜é‡è„šæœ¬</span><br><span class="line">[root@elk03:1 ~]# <span class="built_in">cat</span> /app/zookeeper/bin/zkEnv.sh </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># default heap for zookeeper server</span></span><br><span class="line">ZK_SERVER_HEAP=<span class="string">&quot;<span class="variable">$&#123;ZK_SERVER_HEAP:-128&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># default heap for zookeeper client</span></span><br><span class="line">ZK_CLIENT_HEAP=<span class="string">&quot;<span class="variable">$&#123;ZK_CLIENT_HEAP:-128&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">4. åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹</span><br><span class="line">[root@elk03 ~]# scp /app/zookeeper/bin/zkEnv.sh 10.0.0.211:/app/zookeeper/bin/  </span><br><span class="line">[root@elk03 ~]# scp /app/zookeeper/bin/zkEnv.sh 10.0.0.212:/app/zookeeper/bin/</span><br><span class="line"></span><br><span class="line">5.é‡å¯zookeeperé›†ç¾¤ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br><span class="line">[root@elk03:1 ~]# zkServer.sh restart</span><br><span class="line"></span><br><span class="line">6.å†æ¬¡æŸ¥çœ‹å ç”¨å†…å­˜å¤§å°</span><br><span class="line">[root@elk03 ~]# ps -ef | grep zookeeper | grep -i xmx</span><br></pre></td></tr></table></figure><h2 id="zookeeperçš„å›¾å½¢åŒ–ç®¡ç†"><a href="#zookeeperçš„å›¾å½¢åŒ–ç®¡ç†" class="headerlink" title="zookeeperçš„å›¾å½¢åŒ–ç®¡ç†"></a>zookeeperçš„å›¾å½¢åŒ–ç®¡ç†</h2><p><strong>äº†è§£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¾èµ–1.8ç‰ˆæœ¬jdk</span></span><br><span class="line">https://github.com/zhitom/zkweb/releases/download/zkWeb-v1.2.1/zkWeb-v1.2.1.jar</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.è§£å‹jdk</span><br><span class="line">[root@elk01 ~]#tar xf jdk-8u291-linux-x64.tar.gz -C /app/</span><br><span class="line"></span><br><span class="line">2.å‰å°å¯åŠ¨zkweb</span><br><span class="line">[root@elk01 ~]# /app/jdk1.8.0_291/bin/java -jar /app/zkWeb-v1.2.1.jar </span><br><span class="line"></span><br><span class="line">åå°å¯åŠ¨ï¼š</span><br><span class="line">[root@elk01 ~]# <span class="built_in">nohup</span> /app/jdk1.8.0_291/bin/java -jar /app/zkWeb-v1.2.1.jar &amp;&gt; /tmp/zkweb.log</span><br><span class="line"></span><br><span class="line">3.æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.211:8099/</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šå¤šä¸ªèŠ‚ç‚¹ç›´æ¥ä»¥   ,  åˆ†å¼€  10.0.0.211:2181,10.0.0.212:2181,10.0.0.213:2181</p></blockquote><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241028231813958.png" alt="image-20241028231813958"></p><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241028232321533.png" alt="image-20241028232321533"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†zookeeperä½¿ç”¨å›¾å½¢åŒ–ç®¡ç†ä»¥åŠJVMå†…å­˜è°ƒä¼˜</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>09.zookeeperé›†ç¾¤éƒ¨ç½²</title>
    <link href="https://lukme.top/posts/1c1f467f.html"/>
    <id>https://lukme.top/posts/1c1f467f.html</id>
    <published>2024-10-30T02:41:01.000Z</published>
    <updated>2024-10-30T04:02:23.769Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zookeeperä½œç”¨å’Œåº”ç”¨åœºæ™¯"><a href="#zookeeperä½œç”¨å’Œåº”ç”¨åœºæ™¯" class="headerlink" title="zookeeperä½œç”¨å’Œåº”ç”¨åœºæ™¯"></a>zookeeperä½œç”¨å’Œåº”ç”¨åœºæ™¯</h2><p><strong>1.zookeeperå­˜å‚¨ä»€ä¹ˆæ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å­˜å‚¨çš„ä¸»è¦æ˜¯ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºæœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡å‘ç°ç­‰å¸¸è§ã€‚</span><br><span class="line">zookeeperçš„å­˜å‚¨ç»“æ„å’ŒLinuxæ–‡ä»¶ç³»ç»Ÿå¾ˆç›¸ä¼¼ï¼Œæœ‰å¤šçº§ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">å’ŒLinuxçš„æ ¹æ–‡ä»¶ç³»ç»Ÿå’Œç±»ä¼¼ï¼Œåˆ†ä¸ºç›®å½•å’Œæ–‡ä»¶ï¼Œzookeeperä¹Ÿç±»ä¼¼ï¼Œåªä¸è¿‡æ²¡æœ‰æ–‡ä»¶å’Œç›®å½•çš„åŒºåˆ«ï¼Œè€Œæ˜¯éƒ½ç§°ä¹‹ä¸ºzookeeper nodeï¼Œç®€ç§°znodeã€‚</span><br><span class="line"></span><br><span class="line">znodeä¸é€‚åˆå­˜å‚¨å¤§é‡æ•°æ®ï¼Œä¸€ä¸ªznodeé»˜è®¤æœ€å¤§å­˜å‚¨2MBçš„æ•°æ®ã€‚</span><br></pre></td></tr></table></figure><p><strong>2.zookeeperçš„åº”ç”¨åœºæ™¯</strong></p><p>å’Œkafkaï¼Œhbaseï¼ŒHDFSï¼ŒYARNï¼ŒDubboï¼ŒSolrç­‰æœåŠ¡ï¼Œæä¾›äº†é…ç½®ä¿¡æ¯ï¼Œæ³¨å†Œä¸­å¿ƒç­‰è¾…åŠ©åŠŸèƒ½ã€‚</p><p><strong>ElasticStackæ¶æ„å‡çº§â€”MQ</strong></p><blockquote><p>filebeatæ•°æ®é‡‡é›†äº¤ç»™Kafkaæ¶ˆæ¯é˜Ÿåˆ—ï¼Œlogstashå»æ‹‰å–Kafkaé‡Œçš„æ•°æ®å¤„ç†äº¤ç»™ESé›†ç¾¤</p></blockquote><p><img src="https://cos.lukme.top/Pic/ElasticStack_MQ.png" alt="ElasticStack_MQ"></p><p>æ¶ˆæ¯é˜Ÿåˆ—äº§å“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rocket MQ</span><br><span class="line">Active MQ</span><br><span class="line">Kafka</span><br><span class="line">Rebbit MQ</span><br></pre></td></tr></table></figure><h2 id="zookeeperå•ç‚¹éƒ¨ç½²"><a href="#zookeeperå•ç‚¹éƒ¨ç½²" class="headerlink" title="zookeeperå•ç‚¹éƒ¨ç½²"></a>zookeeperå•ç‚¹éƒ¨ç½²</h2><p><code>è¿™é‡Œä»…ä¸ºæµ‹è¯•ï¼Œå¯è·³è¿‡æ­¥éª¤ 4,5 ç›´æ¥éƒ¨ç½²é›†ç¾¤ï¼Œé¿å…å•ç‚¹æ•…éšœ</code></p><blockquote><p>å®˜æ–¹ç‰ˆæœ¬é€‰æ‹©ï¼š<a href="https://zookeeper.apache.org/releases.html">https://zookeeper.apache.org/releases.html</a></p><p>zookeeperé›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡é€‰æ‹©</p><p>å½“æ¯ç§’è¯·æ±‚é‡ä½äº6w/sï¼Œè¯»å–æ•°æ®å æ®70%ï¼Œå¤§å¤šæ•°æ˜¯è¯»çš„åœºæ™¯ï¼Œå®˜æ–¹æµ‹è¯•æ•°æ®å»ºè®®é€‰æ‹©3å°é›†ç¾¤ã€‚</p></blockquote><p><strong>1.ä¸‹è½½zookeeper</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br></pre></td></tr></table></figure><p><strong>2.è§£å‹è½¯ä»¶åŒ… </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# tar xf apache-zookeeper-3.8.4-bin.tar.gz -C /app/</span><br><span class="line"></span><br><span class="line"><span class="comment">#åšè½¯é“¾æ¥</span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">ln</span> -s /app/apache-zookeeper-3.8.4-bin/ /app/zookeeper</span><br></pre></td></tr></table></figure><p><strong>3.é…ç½®ç¯å¢ƒå˜é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# <span class="built_in">cat</span> /etc/profile.d/zk.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/share/elasticsearch/jdk</span><br><span class="line"><span class="built_in">export</span> ZK_HOME=/app/zookeeper</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZK_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">source</span> /etc/profile.d/zk.sh</span><br></pre></td></tr></table></figure><p><strong>4.å‡†å¤‡é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]#  <span class="built_in">cp</span> /app/zookeeper/conf/zoo&#123;_sample,&#125;.cfg </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™é‡Œåªæ˜¯å¯¹é…ç½®æ–‡ä»¶çš„è§£è¯»ï¼Œæœªä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¤åˆ¶å‡ºæ¥é»˜è®¤å³å¯</span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">cat</span> /app/zookeeper/conf/zoo.cfg </span><br><span class="line"><span class="comment"># æŒ‡å®šæœ€å°çš„æ—¶é—´å•ä½tickï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ï¼Œæ­¤å¤„æœ€å°å•ä½æ˜¯1  tick=2s</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="comment"># åœ¨é›†ç¾¤åˆå§‹åŒ–æ—¶çš„æ—¶é—´é»˜è®¤æ˜¯10 tickï¼Œåˆ™è¡¨ç¤º20s</span></span><br><span class="line">initLimit=10</span><br><span class="line"><span class="comment"># æ•°æ®åŒæ­¥æ—¶é—´5 tickï¼Œåˆ™è¡¨ç¤º10s</span></span><br><span class="line">syncLimit=5</span><br><span class="line"><span class="comment"># æ•°æ®çš„å­˜å‚¨ç›®å½•</span></span><br><span class="line">dataDir=/tmp/zookeeper</span><br><span class="line"><span class="comment"># æœåŠ¡ç›‘å¬çš„ç«¯å£</span></span><br><span class="line">clientPort=2181</span><br></pre></td></tr></table></figure><p><strong>5.å¯åŠ¨æµ‹è¯•</strong></p><blockquote><p>æ³¨æ„ï¼Œzookeeperå¯åŠ¨ä¼šç›‘å¬8080ç«¯å£ï¼Œå¯åŠ¨å¤±è´¥æ³¨æ„æŸ¥çœ‹ç«¯å£å†²çª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ’é”™çœ‹æ—¥å¿—</span></span><br><span class="line">[root@elk01:3 ~]# ll /app/zookeeper/logs/</span><br><span class="line">-rw-r--r-- 1 root root 16469 Oct 28 17:12 zookeeper-root-server-elk01.out</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">[root@elk01:3 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: standalone</span><br><span class="line"></span><br><span class="line"><span class="comment">#standalone  å•ç‚¹çŠ¶æ€</span></span><br></pre></td></tr></table></figure><p><strong>è¿æ¥æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# zkCli.sh      æˆ–è€…</span><br><span class="line">[root@elk01:3 ~]# zkCli.sh -server 10.0.0.211</span><br><span class="line"></span><br><span class="line">2024-10-28 17:06:31,811 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):o.a.z.ClientCnxn<span class="variable">$SendThread</span>@1453] - Session establishment complete on server localhost/127.0.0.1:2181, session <span class="built_in">id</span> = 0x10001704a360000, negotiated <span class="built_in">timeout</span> = 30000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:None path:null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] <span class="built_in">ls</span> /      <span class="comment">#lså‘½ä»¤æµ‹è¯•ä¸‹</span></span><br><span class="line">[zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‡ºç°å®ƒçš„session id  å³ä¸ºéƒ¨ç½²æˆåŠŸ</span></span><br></pre></td></tr></table></figure><h2 id="zookeeperé›†ç¾¤éƒ¨ç½²"><a href="#zookeeperé›†ç¾¤éƒ¨ç½²" class="headerlink" title="zookeeperé›†ç¾¤éƒ¨ç½²"></a>zookeeperé›†ç¾¤éƒ¨ç½²</h2><blockquote><p>å¦‚æœzookeeperå•ç‚¹æœªåšï¼Œæ­¥éª¤1,3å¯è·³è¿‡</p></blockquote><p><strong>1. åœæ­¢æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# zkServer.sh stop</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Stopping zookeeper ... STOPPED</span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /app/zookeeper/conf/zoo.cfg </span><br><span class="line"><span class="comment"># å®šä¹‰æœ€å°å•å…ƒçš„æ—¶é—´èŒƒå›´tickã€‚</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="comment"># å¯åŠ¨æ—¶æœ€é•¿ç­‰å¾…tickæ•°é‡ã€‚</span></span><br><span class="line">initLimit=5</span><br><span class="line"><span class="comment"># æ•°æ®åŒæ­¥æ—¶æœ€é•¿ç­‰å¾…çš„tickæ—¶é—´è¿›è¡Œå“åº”ACK</span></span><br><span class="line">syncLimit=2</span><br><span class="line"><span class="comment"># æŒ‡å®šæ•°æ®ç›®å½•</span></span><br><span class="line">dataDir=/app/data/zk</span><br><span class="line"><span class="comment"># ç›‘å¬ç«¯å£</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># å¼€å¯å››å­—å‘½ä»¤å…è®¸æ‰€æœ‰çš„èŠ‚ç‚¹è®¿é—®ã€‚</span></span><br><span class="line">4lw.commands.whitelist=*</span><br><span class="line"><span class="comment"># server.ID=A:B:C[:D]</span></span><br><span class="line"><span class="comment"># ID:</span></span><br><span class="line"><span class="comment">#    zkçš„å”¯ä¸€ç¼–å·ã€‚</span></span><br><span class="line"><span class="comment"># A:</span></span><br><span class="line"><span class="comment">#    zkçš„ä¸»æœºåœ°å€ã€‚</span></span><br><span class="line"><span class="comment"># B:</span></span><br><span class="line"><span class="comment">#    leaderçš„é€‰ä¸¾ç«¯å£ï¼Œæ˜¯è°leaderè§’è‰²ï¼Œå°±ä¼šç›‘å¬è¯¥ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># C: </span></span><br><span class="line"><span class="comment">#    æ•°æ®é€šä¿¡ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># D:</span></span><br><span class="line"><span class="comment">#    å¯é€‰é…ç½®ï¼ŒæŒ‡å®šè§’è‰²ã€‚</span></span><br><span class="line">server.91=10.0.0.211:2888:3888</span><br><span class="line">server.92=10.0.0.212:2888:3888</span><br><span class="line">server.93=10.0.0.213:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="comment">## Metrics Providers</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://prometheus.io Metrics Exporter</span></span><br><span class="line"><span class="comment">#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span></span><br><span class="line"><span class="comment">#metricsProvider.httpHost=0.0.0.0</span></span><br><span class="line"><span class="comment">#metricsProvider.httpPort=7000</span></span><br><span class="line"><span class="comment">#metricsProvider.exportJvmInfo=true</span></span><br></pre></td></tr></table></figure><p><strong>3.æ¢å¤åŸç¯å¢ƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# <span class="built_in">rm</span> -fr /app/zookeeper/logs/*</span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">rm</span> -fr tmp/zookeeper/*</span><br></pre></td></tr></table></figure><p><strong>4. åŒæ­¥æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ‹·è´ç¯å¢ƒå˜é‡æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]# scp /etc/profile.d/zk.sh 10.0.0.212:/etc/profile.d/</span><br><span class="line">[root@elk01 ~]# scp /etc/profile.d/zk.sh 10.0.0.213:/etc/profile.d/</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‹·è´zookeeperæ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]# scp apache-zookeeper-3.8.4-bin.tar.gz 10.0.0.212:/root</span><br><span class="line">[root@elk01 ~]# scp apache-zookeeper-3.8.4-bin.tar.gz 10.0.0.213:/root</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨å¯¹ç«¯è§£å‹zookeeperï¼Œåšè½¯é“¾æ¥ï¼ˆä¸¤ä¸ªèŠ‚ç‚¹åŒæ­¥æ“åšï¼‰</span></span><br><span class="line">[root@elk02 ~]# tar xf apache-zookeeper-3.8.4-bin.tar.gz -C /app/</span><br><span class="line"></span><br><span class="line">[root@elk02 ~]# <span class="built_in">ln</span> -s /app/apache-zookeeper-3.8.4-bin/ /app/zookeeper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‹·è´zookeeperé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg 10.0.0.212:/app/zookeeper/conf/</span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg 10.0.0.213:/app/zookeeper/conf/</span><br></pre></td></tr></table></figure><p><strong>5.ç”Ÿæˆmyidæ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºæ•°æ®ç›®å½•ï¼ˆé…ç½®æ–‡ä»¶é‡Œå£°æ˜çš„ç›®å½•ï¼‰  </span></span><br><span class="line">`è¿™é‡Œä½¿ç”¨å¾ªç¯æ˜¯å› ä¸ºä¸‰å°æœºå™¨æˆ‘å·²ä¸¤ä¸¤åšäº†å…å¯†,å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä½¿ç”¨å‘½ä»¤  <span class="built_in">mkdir</span> /app/data/zk -p`</span><br><span class="line">[root@elk01:3 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 211 213` ;<span class="keyword">do</span> ssh 10.0.0.<span class="variable">$i</span> <span class="built_in">mkdir</span> /app/data/zk -p ;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆmyidæ–‡ä»¶</span></span><br><span class="line">[root@elk01:3 ~]# <span class="keyword">for</span> n <span class="keyword">in</span> `<span class="built_in">seq</span> 211 213` ;<span class="keyword">do</span> ssh 10.0.0.<span class="variable">$n</span> <span class="string">&quot;echo <span class="variable">$n</span> &gt; /app/data/zk/myid&quot;</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#myidæ–‡ä»¶ä½œç”¨</span></span><br><span class="line">å¦‚æœé¦–æ¬¡å¯åŠ¨æ—¶å€™æ²¡æœ‰äº‹åŠ¡æ–‡ä»¶ï¼Œåˆ™ä¼šæ¯”è¾ƒmyidæ–‡ä»¶é‡Œï¼Œè°æœ€å¤§è°å°±æ˜¯master</span><br></pre></td></tr></table></figure><p><strong>6.å¯åŠ¨æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# zkServer.sh start</span><br><span class="line">[root@elk02 ~]# zkServer.sh start</span><br><span class="line">[root@elk03 ~]# zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæŠ¥é”™æ‰¾ä¸åˆ°å‘½ä»¤ï¼Œå¯èƒ½æ˜¯é…ç½®çš„ç¯å¢ƒå˜é‡æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ‰§è¡Œå¦‚ä¸‹</span></span><br><span class="line">[root@elk03 ~]# <span class="built_in">source</span> /etc/profile.d/zk.sh </span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">[root@elk03:1 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: leader</span><br></pre></td></tr></table></figure><p><strong>7.é¿å‘æŒ‡å—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘æ‰€é‡åˆ°çš„å‘ï¼š</span><br><span class="line"> 1.å¦‚æœåšé›†ç¾¤ï¼Œä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œå¦åˆ™ä¼šæœ‰zookeeperèµ·ä¸æ¥æƒ…å†µ</span><br><span class="line"> 2.åˆ é™¤å¦‚æœä½ æƒ³æ¸…ç©ºç¯å¢ƒé‡æ–°å¯åŠ¨zookeeperï¼Œè®°å¾—æ—¥å¿—å’Œæ•°æ®ç›®å½•ä¸€èµ·æ¸…é™¤ï¼Œå¦åˆ™æœåŠ¡èµ·ä¸æ¥</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯zookeeperé›†ç¾¤é«˜å¯ç”¨"><a href="#éªŒè¯zookeeperé›†ç¾¤é«˜å¯ç”¨" class="headerlink" title="éªŒè¯zookeeperé›†ç¾¤é«˜å¯ç”¨"></a>éªŒè¯zookeeperé›†ç¾¤é«˜å¯ç”¨</h2><p><strong>1.è¿æ¥æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# zkCli.sh -server 10.0.0.212:2181</span><br><span class="line">[root@elk01 ~]# zkCli.sh -server 10.0.0.213:2181</span><br><span class="line">Â·Â·Â·</span><br><span class="line">ablishment complete on server elk03/10.0.0.213:2181, session <span class="built_in">id</span> = 0xd40001f2a52b0000, negotiated <span class="built_in">timeout</span> = 30000</span><br></pre></td></tr></table></figure><p><strong>2. å°†leaderèŠ‚ç‚¹æŒ‚æ‰ï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨é€‰ä¸¾å‡ºæ–°çš„leaderï¼Œé›†ç¾¤æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å½“å‰leaderèŠ‚ç‚¹æ˜¯elk03</span></span><br><span class="line">[root@elk03 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: leader</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢elk03çš„zookeeper</span></span><br><span class="line">[root@elk03 ~]# zkServer.sh stop</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Stopping zookeeper ... STOPPED</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»æŸ¥çœ‹leaderåœ¨elk02èŠ‚ç‚¹ä¸Š</span></span><br><span class="line">[root@elk02 ~]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /app/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: <span class="literal">false</span>.</span><br><span class="line">Mode: leader</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæ­¤æ—¶å†æ¬¡åœæ­¢leaderèŠ‚ç‚¹ï¼Œé‚£è¿˜ä¼šä¸ä¼šå†é€‰ä¸¾ï¼Ÿ</span></span><br><span class="line">`ç»æµ‹è¯•ï¼Œåœæ‰elk02èŠ‚ç‚¹çš„zookeeperæ—¶å€™ï¼Œelk01èŠ‚ç‚¹ä¸ä¼šé€‰ä¸¾ä¸ºleaderï¼Œè€Œæ˜¯ä¼šåœæ­¢zookeeperæœåŠ¡`</span><br><span class="line">è¿™ä¹Ÿæ˜¯æˆ‘å‰é¢çŒœçš„å‘ï¼Œåªæœ‰ä¸€å°zookeeperæ—¶å€™æ˜¯èµ·ä¸æ¥æœåŠ¡çš„</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¢å¤  ä¸¤ä¸ªèŠ‚ç‚¹åœæ­¢çš„æœåŠ¡é‡æ–°å¯ç”¨å³å¯</span></span><br></pre></td></tr></table></figure><blockquote><p>æ€»ç»“ï¼š</p><pre><code>1.zookeeperåˆ†å¸ƒå¼é›†ç¾¤çš„ç‰¹ç‚¹ï¼ŒåŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»æ‰èƒ½å¯¹å¤–æä¾›æœåŠ¡;2.zookeeperä¸€ä¸ªé›†ç¾¤ä¸­ä»…æœ‰ä¸€ä¸ªleaderå’Œå¤šä¸ªfollower;3.å¦‚æœä¸€ä¸ªzookeeperé›†ç¾¤æƒ³è¦å®¹å¿Nå°æ•…éšœï¼Œè¯¥é›†ç¾¤æœ€å°‘è¦æœ‰2N+1ä¸ªèŠ‚ç‚¹</code></pre></blockquote><h2 id="zookeeperåŸºç¡€å‘½ä»¤"><a href="#zookeeperåŸºç¡€å‘½ä»¤" class="headerlink" title="zookeeperåŸºç¡€å‘½ä»¤"></a>zookeeperåŸºç¡€å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿æ¥zookeeper</span></span><br><span class="line">[root@elk02:1 ~]# zkCli.sh</span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:None path:null</span><br><span class="line"></span><br><span class="line"><span class="comment">#1. æŸ¥çœ‹znodeåˆ—è¡¨</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] <span class="built_in">ls</span> /</span><br><span class="line">[zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. åˆ›å»ºznode</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] create /luay</span><br><span class="line">Created /luay</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. åˆ›å»ºznodeæ—¶æŒ‡å®šæ•°æ®</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] create /test abc</span><br><span class="line">Created /test</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. æŸ¥çœ‹znodeçš„æ•°æ®</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] get /test</span><br><span class="line">abc</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. ä¿®æ”¹znodeçš„å€¼</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 7] get /luay</span><br><span class="line">null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 8] <span class="built_in">set</span> /luay new</span><br><span class="line">[zk: localhost:2181(CONNECTED) 9] get /luay</span><br><span class="line">new</span><br><span class="line"></span><br><span class="line"><span class="comment">#6. åˆ›å»ºå­znode</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 10] <span class="built_in">ls</span> /luay </span><br><span class="line">[]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] create /luay/happy xixi</span><br><span class="line">Created /luay/happy</span><br><span class="line">[zk: localhost:2181(CONNECTED) 12] get /luay/happy</span><br><span class="line">xixi</span><br><span class="line"></span><br><span class="line"><span class="comment">#7. åˆ é™¤znodeï¼Œå‰ææ˜¯è¯¥znodeæ²¡æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 13] <span class="built_in">ls</span> /test</span><br><span class="line">[] </span><br><span class="line">[zk: localhost:2181(CONNECTED) 14] delete /test</span><br><span class="line">[zk: localhost:2181(CONNECTED) 15] <span class="built_in">ls</span> /test</span><br><span class="line">Node does not exist: /test</span><br><span class="line">[zk: localhost:2181(CONNECTED) 16] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br><span class="line"></span><br><span class="line"><span class="comment">#8. åˆ é™¤éç©ºznodeï¼Œè¯¥znodeæœ‰å­èŠ‚ç‚¹ï¼Œä¼šæŠ¥é”™</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 17] delete /luay</span><br><span class="line">Node not empty: /luay</span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] </span><br></pre></td></tr></table></figure><blockquote><p>ä½ ä¼šå‘ç°æˆ‘è¿æ¥zookeeperæ—¶å€™æ˜¯è¿˜æœ‰æœ¬åœ°è¿æ¥æ–¹å¼ï¼Œå½“æˆ‘ä½¿ç”¨è¿œç¨‹æ–¹å¼è¿æ¥elk01æ—¶å€™ä¹Ÿä¼šæœ‰æ•°æ®ï¼Œå› ä¸ºzookeeperåšäº†é›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03 ~]# zkCli.sh -server 10.0.0.211:2181</span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] <span class="built_in">ls</span> /</span><br><span class="line">[luay, zookeeper]</span><br></pre></td></tr></table></figure></blockquote><h2 id="zookeeperçš„watchæœºåˆ¶ï¼ˆäº†è§£ï¼‰"><a href="#zookeeperçš„watchæœºåˆ¶ï¼ˆäº†è§£ï¼‰" class="headerlink" title="zookeeperçš„watchæœºåˆ¶ï¼ˆäº†è§£ï¼‰"></a>zookeeperçš„watchæœºåˆ¶ï¼ˆäº†è§£ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œå…¶ä¸­ä¸€ä¸ªç»ˆç«¯ä½¿ç”¨watchï¼Œå¦ä¸€ä¸ªç»ˆç«¯åˆ›å»ºå­znode</span><br><span class="line"></span><br><span class="line"><span class="comment">#1. ç›‘æ§ä¸€ä¸ªznodeä¸‹å­èŠ‚ç‚¹çš„å˜åŒ–</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 0] <span class="built_in">ls</span> -w /luay</span><br><span class="line">[]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘èµ·åˆ›å»ºåŠ¨ä½œ</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 11] create /luay/abc</span><br><span class="line">Created /luay/abc</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›‘æ§ç»ˆç«¯åˆ™è¾“å‡º</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 1] </span><br><span class="line">WATCHER::</span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:NodeChildrenChanged path:/luay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç›‘æ§znodeçš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ– ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯åªéœ€è¦ä¿®æ”¹znodeå€¼å³å¯ç›‘æ§åˆ°ï¼‰</span></span><br><span class="line">[zk: 10.0.0.211:2181(CONNECTED) 0] get -w /luay</span><br><span class="line">[]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼š</span></span><br><span class="line">- 1.watchäº‹ä»¶æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œåªè®°å½•ç¬¬ä¸€æ¬¡åˆ›å»ºæˆ–è€…ä¿®æ”¹åŠ¨ä½œ;</span><br><span class="line">- 2.watchäº‹ä»¶ä¸€æ—¦è§¦å‘ï¼Œå°±ä¼šé€šçŸ¥ç›‘æ§è€…ç¨‹åºï¼Œç”±è¯¥ç¨‹åºå»è´Ÿè´£ç›¸åº”çš„é€»è¾‘å¤„ç†;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†zookeeperé›†ç¾¤çš„éƒ¨ç½²åŠåŸºäºkafkaæ¶æ„å›¾</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>08.æ–‡æ¡£è¯»å†™æµç¨‹</title>
    <link href="https://lukme.top/posts/cfedfcaa.html"/>
    <id>https://lukme.top/posts/cfedfcaa.html</id>
    <published>2024-10-30T02:40:01.000Z</published>
    <updated>2024-10-30T04:02:17.234Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="3d22dfc375f9b9913df28f3cec8f8b567c74caa9748ae5afc2a0b158dc13c682">410fa1838f124ea5ac656ff0dc0984fe4470cc585ff257fdda3d3583f45908bb850cfcf9a51c23fc8a55ff84b4e6e27d60930b08e6d8b20b7b9ca56416b957ae952cede1929a83ad2b8ef8603302a9864ff39f4dc616dbeeb5a75aee24cfde1fa12428fc864889b618177944d69a04418417dcbac8dc839cd47f7c100594d6e563e9aeaa061ce61ebe17efbe1bb55a6f99ecfbb0ca32d703c418023ae608823c6f98548ae84d99137a962f4a34a531a256cb866ed141d1b8fe9d34060f21cd24fad5ca4e664c4bc324dbbc1f6f17768bf731a68d595e466eb531682aa1ca6e1154cb36423b3cbea73c7723a10e7417c7c22fa8b7faf3ea5afd0b25e61b072571544f0dd6ed76a258c85a6d0839047b97df9455a26015af335522117a9dc3c2b64b7303000a82550723f02f14fe8d37dd3024750202a34ebce76c95ff105196eb9b83bf27dd2ad7982d509c938b5be74789c841eff2ea2dedc42783bfbed6ce3c4578c58e066f5b7db3375143ec9946130ad9d0b66b8189e011c113abf4be565046501522ab19ece4b4cd231b1b7fbf8cfebc6d33ffcafc699447ead320ea8c3adfc432553f77f30e7510d30e661be95e61f17657407af0591357750d2da3b1b6f78f2d871973aa54eab1f0c88241d6e9d87f740d3343f0b05fceac02d50865c52871b1e35d05a7ed5f4ae35c59a22522b4b6ec0b5a3290410e20dc3b3cc1cea5d8c356ed6e884a8e810bb1298fc4029cb2da9fb155195779481bfffe35f93ac4c14a29d34a67edb405b6f7a11e3254820cfa6b2b279454c8d670acbd80107debd75449da37f8e00118d9d36695877791f6ace454c2d85a6bb54853b6c91624e5c3477e7d19668875aefcf13a285ca37a8ebc0fffe46d1ca0d6b1f03223d8fac905d99ed2129cfe6e1134c15b4835c7c4d2d0db52b67340bec4a18ab028b38a6339c9bac5355a4826d5fb6510d540aa30ae3ab71aaa349e73469f3b8a758b5693b1ac1ec27bfd5fea51a8cf905347ed2f13718c0c0b8d473b07dd8e4820bc95a6fdd21cad2b161d39c37b03323a5a5ec44f101c0ba605ac2c63e4357ed47fd5c67952b6014c4fe852ce52afba6b5c5c368c040c6d0261337d7e1d061e3eb2c826a8ce59cf1c6f45a4adc1793de028ce527ca9a5f0869738814a72db0d6f4e011f9b83fa5bbb7f4680070dd04b0b691c2f07af7d42ca9839b265592ab1aacffbe6f641183eabbeac4b235c46b040b963e7d74b8d8a13dc630c7142fd3bf1b4f010ef7f2a9914e56c91f19950a1d71afe530eb1d7db2d482ed51a8edc512499910832b1f1cc842b90ee841425bf8118f42ab3fee892f1f93801c05ea815bbbfa9b08083dae8d8fe904ddb5d9acd7e5b2d6d36f4336c3c79cc247796cd84b0fab5bb9c027b056f4b3b03fe85dafc3baa5290e9e843671960f84b6a6cb0b4eb3ae4acf3d40953b2a68a5d3ff31aae6db9622929885d83e678f2260ca94bbc4264e960f68a178495fb380e8d9ed30eac9247786deed9cb5eba8699691bd15f844723e3bd39734ce3cc44c888e0cea95de60f7f57aef91481ce5a6479e3c2858d8e8853d51ed1846730daa79a1b4416e045df8fef9f5eeb3d6d9f02aa70582bdce79971d60c150b1c6e377f2caf370479e998d794dae59948a4ac4d6b6b48551070b900e2a2ab87de4fcb3e40a0bb048475bf6cbba2284ffacb00bb0b287012154ce22fded421293db51d7968cdc2888dfe21021f42247c3674f12b98f09f68810cdd9c698bb4d3515034f575d3139638446a3cd9e405fc8d17e995ec8b5b8d2844d24fb2f6087641528e133c209222f6f2d4d76287a6d37e21c233bae287d4b87ca077a94a4e15ec4952c2ea7299c64487eefa2a10906df1dbdd33d42795e1475755e79545be1cfafeaf8bbbf84c2adfff7e228b16bad85a5b451543f4ecf2c72573052a8c1224102e192df95e98e4d4e1a92b5c231657211a7c5fcc639dccf8dec4568da75a7df198ebbddc568260538011ccbf71bbbc30ebadd4b31875d1305f76ba31baea1fbcef2875992e4ab64a762349e7746e09b72f8563915c0866c40eb71996381d464b0a196881f588629dca8afe5bed2e284aee184221b8a08452d63fa19e0299c02f4f86dc31563f1491d91739e2ebf09de052159e92f06dfa6c1ab3c0c9bc5cac314857cbccbeafc9f9d2f26592a62bbe2e65676b38f33069db406d8e1e2ec59d95f6b5e8e072eee328fc9b7de75bfd38324b0f78550465eea5370fb4669196cbb000287f044f6ad55e78c825e690c944c2ee557e7c847b5ae39fe8984fd1ab05abd39baee13d15e7d0cdb79312863e2b36d2f0610a82c0a7652afdc742bfe25dbbcb906ee325744cb6bcd0b70d1dd1d58c366d538396052b56c0c281ef2377f3978df8c7dd6d395a0c76afe05a4bc730f8331c47aae3d4ef3260e86b76a4f0b1ef6c7c5e8fb6c07fb51c3f5a957202abfb9ca7d055b8d78d6e6b762eef832a75cd1abeef9ee0599637c74200f293819f75763c9d3da9646662c7a8fcdb0446285517a26d22941fe4f92dff5ce698d738d93fca4807b8d68cff5e2ccc6c3ca9fdcaaada9a75199b8801d40f0accee85cd49712f261629f916260c4c4c74ccfbb0cb85eedf936d5c097377e3b8444749fd63fb88b9f7e90f1e7891a0baf53e90aac66313744522553ac1d48048165bf40af5c75e785a6e757e659f2fcc010e62706a9e9847ceb6284fa703c167def8dbfe977d7a1510820c17b5f0c1a036fc24647f4bddce3c88ea05bbc33f0237a07d227026978f2410adb5419ba659fcc27272b169f3e40bf028fc124e3da1a2982b43bb4a08fc3104d16fac7561b6cd15ffbecb93c4cd708a21229593e6a746400f1c46de6d02e5b19baf6e6268d21a21bc2a023044b16ffc72fe925f8a51ba68d7bf4d149c5c85e170ad6c4a36197b2ad83428d685acb5ce7e9db78da8a7e1232e696ffe55e7184cff823b85954ba1cb8038e71a1a7290e15231bcd75651dbff0852f455c539856179faa85c2cbec19f1b3113a323f7c855fc2e7999b1dcf01395add42d8c3b75c357e442cbaf4d17cec0bbbf251989b004c5650b43f5c6ed2d407b6635fe7d40445f4fc6635b43c76e00915a21c26d18b87d6f92db320810dae00bd2cdcec2250353036b5d0a1f3e55cc7825e80ee3fd753f76e5d27bd00e7284d47237fe57278bbc89445e235eacc95fe43fe73e1691361b1fe0b0ca1f0474ef8296ab974f054efd115bbc114a00d5102971f67de208fafa37618932a222d8b21c0620a24f12bfe4de2548cb20e374828b45362cd4b27a5eb6c6358c2cfcb6c0cc940c3378ac829e7e52faab799020ac58aa0e6417260c509c8e0586ca281b028c2034218cfdd352869059ef10e022dcd70e7a417935fc03dfe4fa4990076834497c3c46c7d52417d434e100797bd0dc67370eb402697f85fba686c55bbbb17b59acc44d8939be55686db6b084de3e4f46207a2b501e92de55cec0b734b85645482455c40fbcb9ec46c0c8b1d71eb2475442fa47eca2695887c63728a1626f3a3e8414a6447e9ec46d5df7747a6435feda1529958f6e8f99e644e7d23f300ac956155bfbb11dc8da21190968f5f0d5ea7cf62baec1bc09ca44f0d96cf12dfba24120692444904b3d69b95f38caaa74e091669d5612b25ddc0b5f9723e736a167b1fc99d099fcfa573e4ff3177b2827c88a9f4cda2dca5041690646ce4fa8c2bc06604d20959921ac38391597f18728f0011f82d4271db43b1fcee81c3ac1fc01995a7e798a6c7c95cca1249c477b203a3f46cee8939aae54ef58738006ee5b1385c4013171f8c9d3921e477f1b2164d4097a63dc809422d42109bfa323b67ff5977b09e18cee3a820606a50c2038b0c83af4be1456be6f23c63da6164494535b54445b059d24f1c35262434af54f0fdbd1e486baca597bb18c015532b8e33736c406b6e8900d07c49dfc08b96b38001ab0ec10b9ccb263553d21cadfebee0cf44b67da1745aebf2a98925b02d807b2b0b876d4de1dcf9a585d3a29aad70202878aae11a639dcf960752da431bb71f6b1527d1dc732b1e9377c450c2a32884d0669e0ef5da3b4055a18c70f9eeb3d01227967212c666920cf422969e5335d007ee2452ecb76a3dcc33160f9cd56b208d4a1c80af220652a1725e03caabd55c4dd673f31d137cf28fb3f30be4a3c5a36fd348efc2696a391d57d5b5aa3574798dd792196400cdd5438ab0747265be4a08047cb60bf31adddd6690f3a62cb550b262a937e01cf3ca9d38c5bf68378f1b9b14baa52fb0974804b011f737b38297731cdc1d8bc301d64fa9eeb10e335b32f5eacc9cacda5e54dda297136e6672d201c30fa3596440b37551ac49066c408fb4822eb50e1e326949a984e6525843c0ce6f3afbde16b559a214233ff13a521a9e47a7fdcb3259a8bed4ef5b972a6bcd9fe7e58ec41debed614fc3df42e3de76dc38c7fe5856a8ab3975e509e5ae13989eb538c894b7c14f08b62f75253a6eb8851e94f32420c80e2d52ab18adfaf7cc751730b2958915a09f5f7d2664a1498986dd36608032f1f29eb02bb5619b684d02b556feba13c0368c356dabc89c106f6b33bcd9e86a42ccba214db96c2f67a20e0fbaed3c9d7e4c3307dd1ff314091c0e7b52d05ec2010d49b5ecf0aaa889faa7423af145fb38af4691f3fb260b197d39e3598e1af609805a895e634edcdb5247f9773645dbff34dae8642f1332897e0d9685e0fa74dee3bbfa0b7472304eb2ccf1f073bf6f2e8f30d25da076c4dab242a2cb755bcbeca34908d0e39846f6a31f9d22f686dc3ae4445ac8eac7cd46d6f658cf47a25261a76875b96d77a9a8cdd6996127968a979e66928e4ba780b2854b25f5d73311595083d9ff750b6063ba10e3883bef96ab8d2ec0df74919fb8a70a5281c13e6bcc6643078ae0844758aa72a8331d35b5a9a35264459eb84f2086110d463f881b17aca9ef8bbc1d69f3c13f3b403df6a1c8d888a5534f8e21425336a1cf6e6861c294dcb70e7576fe7be136717b8c7b9f1f06aa75d18d23feb148e5112775971a80cb5f3ee9705d111a34e368a8c1a9b24d98244728baedf90f4f854b27e59fcc5179f5588df73ae58b089e889ccfe992dd349c21bc005065da81d5a6a726668ae1cbb6c6f011523b18c674fbe4471c81dce77fa8a7bde6bcbc8e5c9bd31c8512e45fbb341a5194224cdfb4ecd475c4a3cd7dc59daefc9cb1a73065daad2a57468c41f23e02d3212a82c79de5867418d8d1006fd207beb7ad110c1da1af5169d43a1c42c8d6170825345c25465a5963635905fb4c9f04c2343eef2289760842354691e4e2c4005184a47e915b7f2005cfbf016260ec4019a222208825f488c019f45f9da161a4c724ea57d14dcd97ce001de2cc07e4a10c28a903c5146f6f8ae8229e2843e77c5504a21432aba10d69e8b0d96b873a9511b692532485f4b53e223051301bd0af958dc94c9b98a4e57921e7c01dfa63efa824ef9f49e7aa0282e07eac19bfd16ed943c42c032ca8bda8583e80ef3bb676426017e20ba36256efbe549a70b2622fc1c98b0c1fc7d60440efd6160b1b58f24db18fb68c137075d73271716fff659c583511a14b63c7a6e07b66887aa13b774bad43c4904375fc7e960b2151b1db7ceda166e8c90cb3bf5475b7500761227e936b05e84b274daaee7c376ff780fc9ed27e4a158c2bdb21c923d164119bf3585baaec54929e968c5abaad3b1249945ed0bf525521a6eac16d483dd57a0be3c7efbc3283da26a0c8d2715bda30f4d3c4ef55448dad78f8edeb16620881f6a6f2fca74fbe6f9f4d2166eb6bad7c0cb209183d3b2aaebd37d819764069de2938bea15d4011ccb5f44f6ec3f3afa7c053e1356422535894c4462310ff3ed4db95337a9bda4080fb38d8d8bf0db732c3e11e6a2c26c151c217e0cbc010cc6f13ed9f085a471b022abdb22945b5546d0d274b3856ee207197b779fb2993163116416bbac52afdeb20e0ecfd7900dac3a8c2cd6b32e15a190b10c996e53e766dfc0fbd063da40237b5f10a2e92f86a4efb582ed1b998d49d01bd1ffcfceb2b0960399a0dea11a2d9fe2bb8f8e3dee0b6f103dcba24936e597b177a1cacb0e4fba41d1d5328f4298f2fc948a7e5bcde3e36bc20c99d8ca59b730fc1c6e6178e7d3b15ed477c1dc49d99409fd787442599858cef9fea4655de6f97a8dbf7755f50e9c562c3328013cbfeae03582e8a1a3aa01326885f66e83981b9dc6b90abc939aa9f6123578714c01195bd3a6a4582c6357f815ff9e8a7331dfb9fa492d27e9dc7d27409d92440240bbc75123e3e2a793100bf4d2f171c8eb265f631eed805cc0169bcc5a99f85be0a61ed8aa5359bfeec34591a8b38c6d76db2dfaf114b6cf3d30450ccd6126d88c582fba0b75afca3b8f6c065e988b3c4dec07a5e1ff15c97901b89f4848eb46091df486b192efab39682a8a0ae6f97f7b77eb8c39f0d39cc12ce89892400bce422aa2bc41b171fcf844d2285251ad903048999ed05ac61e1a82911e3ed718298ad3a40283378ccb322f507ec6f979772801d96889b8b1c967eaf409e0df9f6ac83bd94e588635db9d22da39d98ae9b10ad524d3d50a626d8f223932ae0820e5d0ce33dd4de4dac79c828c92a94259df85b336a6737e3190a6dbeb7dafb86edb6a3e1c4013d32a532c069a170e6958c71aff29a5ce2ca1184b81c17939d6964359fdc5222058bade06b472154e6d47cfd1de9578a400a2821e315997d531b2dd38f90454a3ddfcb19b75cdfc9f61db6cc41962e5148c21bbf1a104dbc35f1cc86587506094c0bc718557034a98630d1072fea88e9b7664e2c135d1651ed97485f5e55c9d3e4400b9ba7ab7c359e16daef47fe8dd860b5731fa29b4cfd816435dc5b2d0c425a7cc2f25e8f9c63e508ca355b7361c885057d29f5dee0f4e4eb9b4c94256dcf9bfa83f106cefb5d1b212b32796ab36ae8dc08fbf3cce9e86a00bf7298c4e9ba5849b347351598caf49b17da1fcf4b1164dbb8d87cf3e9463d98154fa5e1639c3755c0e516cce5c9e85eed4881b4db6333a4019d325f7fe82f68eca87d5dd682a72e7a2ba4106800a5d452f95d516b5f542e36ca80dfdffa0013d14848893b9f78233acff8854e88748cae8a7057944e77749d2959791c8bad011fd18a256fc8807afb1c1de8857ef915af5f60fe460f0a6823c16e7846e12fc7c94511aa90e41308a1fdb88336204027b46929d3fb1b5155b8294163af2e83658fc0dd0b4207bb4dab742b31cd0cf2cb782fff755460940dd854cb8ae8d7694094e1dd910d67f132717463b43482e656578c35ad4b8c00f48c74eb5bb457ebd2a0bcc1db7d350da0dd3ce13d53c992062a1f34ab1d6da7fdf5f93a0c1d8bea48a28b4672550da54043a4efbbecebcb41f3ee8c2296931e022da2570c24ab287787020c0ac7538aa9085e56a7a80e82d6b3d694725b9341fec3aa3851229c5b77b365299fbb6ac0c5fc905e3f44432610e0556460817ab466af175d39ffcebc05f98376b881cf635611db46f1c2b27807cc2adc647419889fffe4d89482f6e39d1758b253c403a70307449dec89859ffc54605c665ced7a194a946d9d2465a6b8f1349e6741187972b172391e9b4a9812583398c2073cd76a20737d85d4dc61de522ab64dcc7eb1393ffc688569deea2195c6e4485efa4e09db969b2e834caeae9b3d7db68468c06ee6ce80ee26eb3066600772e504a2704bd9a8004d580dee6d3ea4902e8e581d601e4a238545fd75ec3f2b4c3bd22caca96b7fb2ab0ebda3fffcebed5d986f0a696fe5e0a1a65d5e7b6ab7df01db54b8386a0f15e59904c958a6c27614a62616fb2476f9146bbda0e793c5e9d086f2e39cfa48cbccd67055a0620b70d7a36f57e43b0c27064ebc09dfc676a8cc9dd3188bab43f69691f618352d78dcba49eee4831cbefbe84fd529900fd980ca6ae9a72cb126655b27e251e4c681ddef53d5de24406f7adbb250d341245847a17e225af12b991411d0a47e12322dc5504a06e19e14064f7a85e37f00f631e7558d83e344bbd1c245987168ecdb27ef305ee992c78b2d146be46638bafb37cab955f20f50d2e56915a4bf7028969417df28d04f01199f3547ccf5cb2e93ba1199178fe9e1b630c3175c338197e8b65b34d927057d8f62af9ae82a32b19a58d21971e8b2cd4955deed17abd176268d39fdb6a6165b8c5a5834632b77246020996ec9565038225e89e9e5e5c7f3f38ae90670991bec3807aeb934e3c1177c8dd04347533285d6484fc41f37b8f980b3fb6b7c4a202330d9f73816f97350dd8ba1abf7e18e6c41f19da2be6b26edc5a89619d1178f4fa22421f1dbce0c8e2e9e386885ca97e7719904cb8dce8283acc81e53ecb8e146a0c4e1c596a98245b8b29ea23abff912f5b9237b011363c245a6aef16dc441a1eaf6c7f1e080b31dfc820b88734467973b01906b21dfccf271f5ff5a4fa5d3473462ae1c53f32ffa07b5849dd7f30e136a17a57d677ebb2129af186b1259caf92459ccececf7ae1eeb8290a033c084feffa331d7b752a4b1fee5722b455b8a93d0b993e29b65c9ce20775ebc13acb580b7a274111ff7e40bd7ca67acbc374bf3baeba0d29fd245ce7c91fa31a3011ce2f679b15df6c8b25ed60b9c29bc2535c0505e0522d5519a876d1b85480670b65f9177f732ada155bdca3d187a5bd5c82013b2c8a39bf2e2a71b78eea94e174da3b09ec00af442ad777257f9f6b186a19d90702da10b4586009e484c45b87ae849746b9f75edaf864565ca9ceb8eb5e1667d49cde5b6cb0b852f36e690bcf8aeb5e98303863627a5e5fe686d09d8797a57f8dfb1cac7a13936c29b27eeab2a95ff27a00cb4babad7c3010ad086bbda7e7134e170e77e06dcab0dbb35feeb772b051eec957cef8bbd878cb0f5032d5a550dc681bee889eb888342c0ba5b64aef626354a5b7113cfc6ae32aa91777ce9aeeae8627db361eaed51aaa1b34c5c5d441e574ae4be2fc397d61d2b2dadb5e983848bb3eb547610f306166bf2ce802368a517fb2397a18919016ff80baacb1daa7f09b690fff52eb42e7d10c729e089a7015c26d8a3d10cbd361caff9b3fa727d1108364e8ee91ffb8272009bc26caf81513ff35438903ebd5b00d5a685a2895106c9ae178199eeba4d3411b8628979249769acda126d1717ea7468ab454340b6ac72f6d72a021fe8dfe119375d81631c985aae4dd32f76f072f882d1ea860c5d5165085d6a9c021c0dd2a3c18fbbf845711a7c88de08b6c8f983b6b8711d0fbefedc5923e55123f6b843ccc4d71bc34d38cbc92dbddc38bc92ef7a7131ae850a09f084b5fd1cb2fe85e87e2dc648b7d6140b9e7f1851843f4578cd2a3a602ff6bbffc5276a97c23835a1c8e3b2b7b7ae145cd6cf480465a991d18a4081379db8b56dad822546d1c8e2e82b7cc30dc2e158eee827e49e2c358c7a0b8d230820a2ff28efc0cc912debb03888679715afe79d09995ed7f990ec989291ce9ceda79e1740eb9a41e9181edf51d4e06d1ae71bef0b134b92cd6293f80237eb1755aea9d1f8c8a7cc7fc3f2ee315052f051affebb925f9761f29dd2a8ab12da96e3c670ca92dec403b1c039ec9058b6a34a43a07103b2b9116729517ac3032b891329eef8e2a06f5b9031c210758d4ebf0321422afd666010705a768bdd77bc0aab7e089f4436ef9f42ede9957175f99f442ded46858490e5dd7c6f0e6fa123113ebb6ed050243c162fa932582d3a70976afcac73630accc9533409bd9a38a644b663ff27b81110bd466b804dd6c07edf1ba6ae0e3f8aed9a0f9ca8e979cbfe08e87c5b9e747aa5fa4f1681f8d1ace731ca8213d6bb8e77c3991017dbe723bc058aebe33790c6808c045dbf4f2b8d262d4bb792658630e10d771550501fcc777580e128d64d0c7d73375b734b89c529384d0fde62ae6fdd939ab307af783814594b5250025ed45d349130f094d9c94163fb06d184056f958543cf23bca2dc39a47963c0e4a93a096d122520ada7803d8c010e24c108ee9ca6b66952e1528919ffbf25ed6524d08a3e64309afa2677097870e546faa428af6a5ac4b647956a916d0593484c92ea65eb236bd78f06b60d4079055a5b00f5b65b7e3ef2dae103c1d362596a9d72d520af09961f4d18daabbec0efd05fbc07c65b46f1714057071a4fdc0c370ca21456fee104700c320843da3e8d1343a856c34183758637ecb3a567198737cc35976cdca7765d266f326535e32b15a2f481218607f046a7ea521159b8eb7cd3ad7e88ea35bd60a72023a9ddc68a71f071d0132691d73f12fbf8ec745dc7d64f06116fbd1d235bf6b1f566743fc2bdd0d0307b89fcbf9f8ba049586ee89d541823fe388e7725f208fc06f470183c8a5dd5f250398c20a248449e09e7f9b1c78390c009c252bb28c916156bd36c0acdfcab2ea7e89803ddb2d1df07912c0a0abca71d8adbcb82b1afa986fcef1f4189dd3ae2b93ea612509d7325a2a15fed8e4a400321d27b631c310c5db1c45944e4ae3be8444fd2d9cb3330dc70b1c41c1a6b77ca5f134877aeff6d60d8714b06beb18161e3b435fafdbaa9a865b66ea47d66cbf9e079dad10725c87227a422de2792695c371708db928f9471f7c92ace437dfaa77bcc941e626c540334ab1705a9a5f5b79051881158bbfb1ecd4f8f7e1f5fd99f6ab701017b2f7a20c561380779e3a5df0529cbed6dfeac8603c5395b1a2d9498c3093c008add0b022e9a8246121f6372fb6f93e6f73c1eb70da83446fd0030dbf63cc5c6dc6226ababfd662fa35f34b76823a49602d0a07e232c3152a8b71182c386bb5cd8a21a4b941165d377b77f0a9c60676d531346eccdde430f58c281ec963056a7c88d1af0b8311cfc65b1b6806c01082aa77b1da1e1077d552beb90528ffc7e34519354c2cd03e988773137514563c13a3b2f1ee9ac94182b2b07df3363d5ed6fdc8022f7750c521a7634961cd3fca42ae73d7d87e2f61d121266f63cfba4bb8eb81b4918f427f0fec466b5d3fdc13bcea8927d0b3854fc06acb3bb2bd1cba9fd5e50ec8a067416fbce9a81a054ffbe11ddaca9d950117b939f819a097d37fb0b3f3ecee2bbad42642d7e90283ed9e532c784e6a63734e36df543fe94cfd819070fc85c1f7efefd0063ceb209af4744dce102104d59e4af9a55c5f3ee3379b358823073c73b1d0a9aafee076970e32d4620ccdbaf077d300a37bec7d86427e563d022ad48dfe14fa29b8fa02ad1ed8d91bb78dc22e394b7417ec2dad715cc26558a08a60bd98f6d4b691869ee562fe5a970c6141f16bfe167cfd4fc1509aa2b7068d836da0727a108426cbfe17fce262a273f22362c40c86f8246e152e4e9d8ab845236dee2a6d14824b078c5d01be3388b061d028cc8f8bb058ef1b0b9c43d8f2c1713462458700226e75fa42ef9d4ce49321efb43d45bb7cf0c7197f44d789fecdcd03c1fcbc59befea5a8e6e598840c7f41e54f22403ed459fc99f1a4582dcf5afd2b8fc4c75a35b5805943b31e0ce09655245c5cf28ad9d9ce90fa74067e42cd50ad597d0a66a03867199524facdb4ac762193ae811f3f6f3f373dcdf65862d920c734d088323550ca7bf27c13c9d417e310465e10665afb049f89d624e729d097c4799e2ca2592b7809fec2db2025870dcb76f7c4dc1fc91a2b080443e0959f43c4021a5a560b9cdd2cba5e506a6e941cf932291cf8dbc43be0f545b35da1b4bfd63e5d0f8a0e54a1b9fc517ccb0ff8080aca97f01e06c86fa7db4c6032f75862e24f8ed192d5aef29e078f36d5c6b1ab129897c7f2ec7cb12c4e59aa160e8805671f69a68747a70e863e87bbfcf5be8350b947958931982d6dd6f6a85ebe9ad067b563d2493ebe166021deafeb8650c45866f818414a23d7f1ce212d3c16a9277295cd56beba0e9d30beac6f9aae56fc7bfb842defd76e1f5869f04a166460db4b9b9068a8322ac5ea32579b2ccefac53eb2d0618e8f188222c7640cb293e7d9fb1a432f50cc9eb24d292a23d2ee1fe9d84e2bbfb1f5830b76fd4ed38e41d15452b2977790f776718f31239ab48f15473e5645c66a6d18d33ce70cc1be7ca6204a178aad7188e0a8b0aa37d556b34cd81ae39f79f783851b4c3000b68bd2b00d1d82f734a909fd2fa55f403a622099016af215a1d5bd150eeecb65f536580daa2b4a731505f3d2a88c926fb951b0c0211b79d260d673b26cd9ce3db3d75e191c86a5b2c03b6351e257225aed33a234bcd08bdcadcee31c3660ac8ed8e47c72a9cc4a4d60e41df901472a44c95c6e296dd18daeede699482ea16f71bc300e9fe6dc97d8a44b0f209a598eb61f3100b95c79befd794ee9d67cf77ef885c245f7ae067a84100555cf24b6e81b9129a2d873b0b06e67fe1211f3641ddab3b0d6373f4b674e13dc0c9974895df206a1a29832c4588efcfc1e4687986b2af9c0c2db589f45ec6d7a583ce5b0ffc51198c1d2507f7c827d0d0a2c462007ee51833f380f502b386ba699895cb103301caa03e3fc746468dd7d8b560edc7744f5c7059c2569dd776148d88d7486c1a0adbe41bbbe32a42a95965a23a609192a097c458ef0b1ea9bf8a1dd785a67aa661c30ee9b5a89f89f3c0ab02ea929056fde09924206a892af285c983b29d1dc19eb52b5f63d2eb45b07bbca70804cf99f45128e3f9b56e134f254af0f174e4d6f8dc8fa14cae247e66cfa5264c6fb77f2f326b436de3e03a87f56f78c47e8745bef45288af6c3b72dcaff9130dcdff90f0271b2343312f8a2ea94dfaeee6212d67e2aa96f482f2e9190c7677eee1f7dfb2141d7e54f70da69c3a788110f7f488a1dfe64c036c2b6e341f612b1f6a60300676794acc7fab11d080f4a8840cbf6eb676466ff512db286b375edef0f563869adde7d699081654b33bd77faa1da1c15cf19c49ab86431cc427243fcf4dbddd1eb161042210c8bedd66a7e1ec542483d13077ff8a843d3e0f249b73c9d26216e77c9e40d1d1cd16c5689afa76d57a255be1705bfc7449c8e74b822d8ce7458fd63fd20c43466e271ee0f1b0aa04f10fe1f6cbe4699b67a501adbba838582ef71483d43977a3b9d4fa7b61d3b90d5b73585a043cbe6e03be392f18083a646bb7f1125ad3fc52f1b456e31c934ff90241e8839977f207631a81b216f4eafadb8e8475f3419e76c87213222e74337c2505431e9f01773c38be8f4f4ea25bfa430f6532bf5e5c5a1246b3a7d01e8e7c13efddfc529aac349d5eb04fc9bc5090fbff33f319c3ebbf28d8ce74c46b2b8a5161e36e36882c5df72a84bac1061819824c88e22c7bc1209310e7e2377ffb664203da225182dea76590efbbd2036f8de0915f5468520a0d2162e9f1249934e016d411a588f6f74fefe6c17f5a6101c919e5b952a85dfc3f27f0c3a2d8306c6fcfde238920a045a229506807b5f479010b0b81e1c763d328e6e240a54fe0527b00a019196e28f819a3b1b055d2de0ab6e32fd431a741d25a1609d8eadca9b43d00acbd49328479146e19287749ab6b10ae0554457b4bea0385aad3eacfc64c05ab6966b9a47af2eff64da800d72d1c3ab16bdc8cd891ff99c30469bc1e2104b485a8deb9180658bd7c99e3aa9f3cd04876aafeac0fba83464dfdddc58cc5c87fda0076ae8b73af6bb44d1ae6293e8d264c13aac32333cfb27df7b1052ef24ef2dfdecc84d6e5da1754b54bbd7e534952bc4b99e89969ef96eb8a530cbc4497cee59600cb3a0942984e6349f6f06b7f173c94020e93f89ade95ec1602e9154b130042e98090e6fe61ef99faf3a7bd25ca669396bdb2baaf7528fac8ea93f8ddc66caf98ac01c84ca5b0acc7c84fac1c54347d9184c78b68e7296984fa63ae87ef7800958312440a0603bc934268bff5b2354654ae907c1e1a9ae4482521445c3ccd65a17b0b587ce61da6b3034a9180b357800a3bec7eb6b351b8330ddfdbd8ee24b47b5825650712c66b7776f360ff53b295e584637e36294d933e0d8534ef99594871cca2683cd01db4568d145c3399bab42b1ab7d858b5789c5d90d4ec358084cb4aa6afd982d88a72cecfe7503038bac9d03033cf3a9e4f3c32ec20973580247f496e004c15f691fb427b2216d0d361a86abdfe0b9011b17d079f20924363c6f33c22548021e50956141a1c9c12712967b053092467b89b439e7fb0675f9f23e3b5a1c7c85a97db1bd48c039d765df077cdb961e1596dcd2f3cd8ad5fa3cdd350dbd3d02c902bf8dd6749311648188542a1257a445c98e014ea0f330a22cddce2a51c62fcbab42012b131205ff1a48d114853a98a0e51b14ec94ac068ec83725592c8fa7e3be7a113bb5d31fdefc635583c2bcb7de95287a5153949203f966ac48974657845053039532392eaa47a5f003c5c8246219e4b5607590f8e881f59e1f44e37bb61bee7640e8a3650fb212bcbc280a46b4fbb7d15765a864213d602949a286d8e468866548d0c812d2e5858c93493e6780ea958600533ceb5a3551cc081553960c9bd935a7bafbc6ee4881f701acf44b05fab9822e71fea2d55d7b06048570a13f076ec655130bdbee4909e6287bc79f2b806478dafd662e7792e540244f0203d4e340369269fd8eb200e4efd3098016fd069d4263ef148d1a14b808614724817b010eb73c8a84a92197bd9094e6a66ea586fb37b5d0f1c489132e3021c3dca947150719d549a3cfc20be84c0813ad87081f8f511fc47db7ea0abf685685d62f6700350881f60590562455095c1bb79abbd4a65ff557ae4af3f87becf2c7f0d0c7683968929286eb39f1edb396adbd61092cfeb5a7b933ee4f4fe6abf57a1582b54fc3277517c6a76bc21a6d9a767be483447c156ac36f242a7c10a839f6948b4d40b4531d0a3809b4f3894ac68afbc34419918357fe68277f952a608c3a10f13cd584dc449d06a467ef3e29cf0e76cb839b306fc9c8a6f36e97190dfe24f0c295af6bd047c72be498d9482cb9723d7236d24dfe7899740839f700088537a7025e6ba52c49b0fb5fd99d24ebf596f231967533d6cfe66c6d72ed2c2993e2902ad8962a498cd63ac4f5a68f8af38519d219c2b0673cc89d69ef8fe303e27ce8f58f877223af722451ea426fbca1020a10a43c2d30680bc48c0669a2fc024d2e14941c3583663a53ff474c65b30e8f41c051c6abaeaa7a7b408716606f9475469d9c766165cd4475e52941b3e3f40ccad2090fae8da1aac6c22f3b2d21592712b7d92b9756e951e07b86ab681c974911429918b82ce2864fc62bc59ce3c5d178948b6e440daa10d277a87e23cb2213d7e9cd361cea1557bde60fa5a845db214d2d0ede61440dd1723843a58fe05efb8fabf4ecfb966a2af92bb9455d2a2450835fe1d4aa191f84c4caa44008728caecf23c75546a9ec06df2bb525989333642b43d128d4932743a13342907786448d6590a498f442ad39206a35914cd8ef1e113a380eac99f70d1eb72f23eefd91288590e4680b7874d79ec08ac0dc615e8ed5cc80560aa64d1765ae9c4cb5fcd6004e5856650ffe9a1c39f8f8b08bf78288d002309eaf6f30c64f8e818078088eb24147e800a23e9fcc2b3271205700d59b42f9c6d72b162b15d36d112b2abfa6da2442f592096633560e79dd34ed1a2c3f615375a2ffcd0bf6d4b80ec787d9126ea21c41badc2d72328d5e7e8775fc6e0e849e66905d3d15da31e4a0e7d37bfef09fe777e48a9f267ca08079fdd806acbdfe2b8db5e436a7ccf670cd61d83aee017100ea38756ca5bb4af1cb4fce5f5f9b2eb89ed6a6003e15b0bb13e8d4eeb8ae8330fe5e7267deb56f880e14f0595b327fd5a92a89f2dba0b7af7121eac95d6d9737a6c08b95ca223ca01ef2e7c5637b5d4d73d24f64f724dd97fd34475e48779d802ba8f79ff69cf384a72f01ad62c7b6adbc936c5d74a8cb09575ac69234902af7d2cc86f2a74c6615ff27f4427058c2aa3c5dce2dce9eab0a3da19b82caf066b2167a8d4cc0005ce7eef65bf4050eb89dbed234b62dc058a630933aec1c62bd7da9c2c459e42469bac1952a2f6b31c35cb6546fb6940ca37311764cdc574c6a0840a0afcf821468bb4d484738fcfd8a804edc2f9bdea743d7eac58cd6a65eaf91ec5e288909ff90ac177e89816e716e8870605d2262168da6d658d89133d51818f402d85c46b45b4cb7097ddc6d5f6ab5f9cdc6fa96ead275840d43506911ddb1e27eae19cc113740a9e69db1b936663d1c244ab4ea660243e374ae6dbc7a604863715eb57852bb391698cb793fb84c0b6655ecafadbd9975eb8580d9155f1577b0fb7ed1313e9c695c82c49984df340a382d8e2a9af7b270b7dd02a966804f090923e454ea265d673ff15fe20747a39176708ee27af7f8beb84252c82e4a82213df788e9b8e53ef04642bfadfab900d6c32f27d5a73835f7aabc332511b071ec6f326e5d3db7689f625f0ec5f6e677e45faafd979f624589ed47034074173366de142f5317ff53fb56b1c9f2f910f55500769f3c59ddd62e9f8e4f94dfab61bed3d61bc39f6829651ca68dc17ca38b0ccc6bc5d451f508cf6fedbc5344a7f0f37a3994f8d13d3345ab68314818e04d51201cc74e7b3d6e7d2126db723e32bb327b36876092924e2597a2b4b7d453d501c6c3ea30eb3567762f7784c55a79de4ee1c5f8a52b9ca1fbecde3d42dd4b8b4aae64267605171d3a10ce45db20316ba735eeecf02631eb9b2cfb88010c4ee4a3a3a1c8678b10d31b3c0e9a0f2dabe0f4acf2ea38794c0c57ae5eeff8ae285f0fe309be8c93e00caee12d5221d8a0d986b862f736c82de63829ecd80cc0ee87d825924ed147f5c30e6cc907dd2a4e509a2e6f969c513e4e820bd1dd8392cf4e70c0ec2877064603ba804ed9712507265b3878c3cd0754dbd88381439fc142c814441ea8f770fe0dff936fd7704ac294e71c720fce7f35b17774c46159e66d5c7f0a578fe9ea35de1f89be62d7235478626852dde0a6fb972510bb6552a97316dda0f20604139e098966bf023a8f671c4c5aadda91e30002d2d925dddcbeb374220998bb853cdaab04fb01405176792ee2becc4f304b62343769b4e93a0e8d408c6b2df0d1500b81200822c5cd41a3add69814adc4fd358bd5066d9d259e4e4868d423577cad82a78a56cea6fc691205bf60f33e33e386e5f41f3fcb41d66bda47d62d88bd34f5be083d5ab3493de5734d7aa5055e5d40649788da9d5e26a983f255522f6dc8f0387f1c7dfdd1f06535f9bd18887cf23c861f91af7cd2ff8a59846e3116d2824234a7a9ebdc1bdd070dd9f4e2a3f6d86b4194e7d7b64a0d99afcf28bc37eebf0276e32d30b57552b7d0e6237cf3ae7c43b860db16c856d98e35658736e6bc00fcc35c9c409726afc93611979804f7a6c22b0eeeb6605a2d2341d7264c10b0ab8b022ebdf4f96ce5c44c330d5f74d322757445336ab25100c3713dfaf96b72b6465c476f2cd443363e17c61dde53b70f9efb2f63d0895579dcc34cde91b345c2dbf1779a7fda641d1741520bbf20ca6fa5c4d3cb38f5a63e12265b1b7205d47dd53ce3429f5f54471eb333478539629e6c7e659072a432bddda0d49d65accaeb5e0ed5697076bb92081908458a621769db5f31710b09c61071c0c4bdb09d6210e72f29a7d3ddb667253c34183a787a1c1a76fd3182c8b61b124935f17ec6a4fac9a685b6ebaf871f970067ab7c2f1ce1e6c794500e1043e7dd056b94d1e34f3a0d5d5595073f21aecb58fc83b82b7b2635d01c6344e2d59cf4823451070a621d61e9efa0ec170f1f4f3e8c2e6580935f7cd5a86c49f7d51838d9a6d599c7681bb8533585394d0059d0e8c37e65e41af92ece49102df7565f8b8d9abd86b1729a81c33d555dfdd3f0bea9793684534fae5d002a95b16bd3138b79e4f6f666615fc6d17e849547b952e35cfb486193a367d0d98798b7af2ed20c944bf6d45402349eaa4c7aba607c679c198fe937ad0768669966b2132d5cca6415fdfbd1d26a7ccb7edc594554f7edd7c8dd191308ef95185c234420c9ecec2a6a583647191c359926acf9ad28ac46ff0a76eaac84541693de006018843f22085c271a80c12c7f13ae283e6e18084ccc0a67dd9cfdcd0e045229d4e0135c9eaeab8d2ed186b90193f66e7eae120f98c264b27c3e4647cf396ef8ee5c0c21781a4b5faf80f77612d7e5de2f0374b57f465e280ed64ada50ea53757c9ed45dbfa50097045d3beb670cc849ff7897c9c0258601bb003169730c5ae244561468652f096b87a2b4fef77980c47e0a5a84a2692ec70d57f7004293267ad8826fb7f7fafffc79634d09188e76edd12ca92b34a9809e10d24be2ed61f0df22bfe627be7cc287e848ac1c10d16c292c736f341c018d5334</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">æœ¬ç¯‡ä»‹ç»äº†ESè¯»å†™æ–‡æ¡£æµç¨‹ä»¥åŠåº•å±‚åˆ†ç‰‡åŸç†</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>07.Elasticsearchå‚æ•°è°ƒä¼˜</title>
    <link href="https://lukme.top/posts/793b821e.html"/>
    <id>https://lukme.top/posts/793b821e.html</id>
    <published>2024-10-30T02:39:01.000Z</published>
    <updated>2024-10-30T04:02:11.629Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Elasticsearchå‚æ•°è°ƒä¼˜"><a href="#Elasticsearchå‚æ•°è°ƒä¼˜" class="headerlink" title="Elasticsearchå‚æ•°è°ƒä¼˜"></a>Elasticsearchå‚æ•°è°ƒä¼˜</h2><h3 id="1-ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜"><a href="#1-ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜" class="headerlink" title="1. ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜"></a>1. ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜</h3><p>ç³»ç»Ÿå±‚é¢çš„è°ƒä¼˜ä¸»è¦æ˜¯<code>å†…å­˜çš„è®¾å®š</code>ä¸<code>é¿å…äº¤æ¢å†…å­˜</code>ã€‚</p><p>ES å®‰è£…åé»˜è®¤è®¾ç½®çš„å †å†…å­˜æ˜¯ <code>1GB</code>ï¼Œè¿™å¾ˆæ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜å‡ºç°ï¼šæˆ‘ä»¬è¦è®¾ç½®å¤šå°‘å†…å­˜ç»™ ES å‘¢ï¼Ÿ</p><p>å…¶å®è¿™æ˜¯è¦çœ‹æˆ‘ä»¬é›†ç¾¤èŠ‚ç‚¹çš„å†…å­˜å¤§å°ï¼Œè¿˜å–å†³äºæˆ‘ä»¬æ˜¯å¦åœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šè¿˜æ˜¯å¦è¦éƒ¨ç½²å…¶ä»–æœåŠ¡ã€‚</p><ul><li>å¦‚æœå†…å­˜ç›¸å¯¹å¾ˆå¤§ï¼Œå¦‚ 64G åŠä»¥ä¸Šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸åœ¨ ES é›†ç¾¤ä¸Šéƒ¨ç½²å…¶ä»–æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘å»ºè®® ES å†…å­˜å¯ä»¥è®¾ç½®ä¸º 31G-32Gï¼Œå› ä¸ºè¿™é‡Œæœ‰ä¸€ä¸ª 32G æ€§èƒ½ç“¶é¢ˆé—®é¢˜ï¼Œç›´ç™½çš„è¯´å°±æ˜¯å³ä½¿ä½ ç»™äº† ES é›†ç¾¤å¤§äº 32G çš„å†…å­˜ï¼Œå…¶æ€§èƒ½ä¹Ÿä¸ä¸€å®šä¼šæ›´åŠ ä¼˜è‰¯ï¼Œç”šè‡³ä¼šä¸å¦‚è®¾ç½®ä¸º 31G-32G æ—¶å€™çš„æ€§èƒ½ã€‚<br>ä»¥æˆ‘è°ƒä¼˜çš„é›†ç¾¤ä¸ºä¾‹ï¼Œæˆ‘æ‰€è°ƒä¼˜çš„æœåŠ¡å™¨èŠ‚ç‚¹å†…å­˜ä¸º 64Gï¼ŒæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šä¹ŸåŸºæœ¬ä¸è·‘å…¶ä»–æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘æŠŠ ES é›†ç¾¤å†…å­˜å¤§å°è®¾ç½®ä¸ºäº† 31Gï¼Œä»¥å……åˆ†å‘æŒ¥é›†ç¾¤æ€§èƒ½ã€‚</li><li>è®¾ç½® ES é›†ç¾¤å†…å­˜çš„æ—¶å€™ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ç¡®ä¿å †å†…å­˜æœ€å°å€¼ï¼ˆXmsï¼‰ä¸æœ€å¤§å€¼ï¼ˆXmxï¼‰çš„å¤§å°æ˜¯ç›¸åŒçš„ï¼Œé˜²æ­¢ç¨‹åºåœ¨è¿è¡Œæ—¶æ”¹å˜å †å†…å­˜å¤§å°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆè€—ç³»ç»Ÿèµ„æºçš„è¿‡ç¨‹ã€‚</li><li>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯é¿å…äº¤æ¢å†…å­˜ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¹å†…å­˜è¿›è¡Œé”å®šï¼Œä»¥é¿å…äº¤æ¢å†…å­˜ï¼ˆä¹Ÿå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚é¢è¿›è¡Œå…³é—­å†…å­˜äº¤æ¢ï¼‰ã€‚å¯¹åº”çš„å‚æ•°ï¼š<code>bootstrap.mlockall: true</code></li></ul><h3 id="2-åˆ†ç‰‡ä¸å‰¯æœ¬"><a href="#2-åˆ†ç‰‡ä¸å‰¯æœ¬" class="headerlink" title="2. åˆ†ç‰‡ä¸å‰¯æœ¬"></a>2. åˆ†ç‰‡ä¸å‰¯æœ¬</h3><ul><li><code>åˆ†ç‰‡ (shard)</code>ï¼šES æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æœç´¢å¼•æ“, ç´¢å¼•é€šå¸¸éƒ½ä¼šåˆ†è§£æˆä¸åŒéƒ¨åˆ†, åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹çš„éƒ¨åˆ†æ•°æ®å°±æ˜¯åˆ†ç‰‡ã€‚ES è‡ªåŠ¨ç®¡ç†å’Œç»„ç»‡åˆ†ç‰‡, å¹¶åœ¨å¿…è¦çš„æ—¶å€™å¯¹åˆ†ç‰‡æ•°æ®è¿›è¡Œå†å¹³è¡¡åˆ†é…, æ‰€ä»¥ç”¨æˆ·åŸºæœ¬ä¸Šä¸ç”¨æ‹…å¿ƒåˆ†ç‰‡çš„å¤„ç†ç»†èŠ‚ã€‚åˆ›å»ºç´¢å¼•æ—¶é»˜è®¤çš„åˆ†ç‰‡æ•°ä¸º 5 ä¸ªï¼Œå¹¶ä¸”ä¸€æ—¦åˆ›å»ºä¸èƒ½æ›´æ”¹ã€‚</li><li><code>å‰¯æœ¬ (replica)</code>ï¼šES é»˜è®¤åˆ›å»ºä¸€ä»½å‰¯æœ¬ï¼Œå°±æ˜¯è¯´åœ¨ 5 ä¸ªä¸»åˆ†ç‰‡çš„åŸºç¡€ä¸Šï¼Œæ¯ä¸ªä¸»åˆ†ç‰‡éƒ½ç›¸åº”çš„æœ‰ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚é¢å¤–çš„å‰¯æœ¬æœ‰åˆ©æœ‰å¼Šï¼Œæœ‰å‰¯æœ¬å¯ä»¥æœ‰æ›´å¼ºçš„æ•…éšœæ¢å¤èƒ½åŠ›ï¼Œä½†ä¹Ÿå äº†ç›¸åº”å‰¯æœ¬å€æ•°çš„ç£ç›˜ç©ºé—´ã€‚</li></ul><p>é‚£æˆ‘ä»¬åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œåº”è¯¥åˆ›å»ºå¤šå°‘ä¸ªåˆ†ç‰‡ä¸å‰¯æœ¬æ•°å‘¢ï¼Ÿ</p><ul><li>å¯¹äºå‰¯æœ¬æ•°ï¼Œæ¯”è¾ƒå¥½ç¡®å®šï¼Œå¯ä»¥æ ¹æ®æˆ‘ä»¬é›†ç¾¤èŠ‚ç‚¹çš„å¤šå°‘ä¸æˆ‘ä»¬çš„å­˜å‚¨ç©ºé—´å†³å®šï¼Œæˆ‘ä»¬çš„é›†ç¾¤æœåŠ¡å™¨å¤šï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿå¤§å¤šå­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥å¤šè®¾ç½®å‰¯æœ¬æ•°ï¼Œä¸€èˆ¬æ˜¯ 1-3 ä¸ªå‰¯æœ¬æ•°ï¼Œå¦‚æœé›†ç¾¤æœåŠ¡å™¨ç›¸å¯¹è¾ƒå°‘å¹¶ä¸”å­˜å‚¨ç©ºé—´æ²¡æœ‰é‚£ä¹ˆå®½æ¾ï¼Œåˆ™å¯ä»¥åªè®¾å®šä¸€ä»½å‰¯æœ¬ä»¥ä¿è¯å®¹ç¾ï¼ˆå‰¯æœ¬æ•°å¯ä»¥åŠ¨æ€è°ƒæ•´ï¼‰ã€‚</li><li>å¯¹äºåˆ†ç‰‡æ•°ï¼Œæ˜¯æ¯”è¾ƒéš¾ç¡®å®šçš„ã€‚å› ä¸ºä¸€ä¸ªç´¢å¼•åˆ†ç‰‡æ•°ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸èƒ½æ›´æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºç´¢å¼•å‰ï¼Œè¦å……åˆ†çš„è€ƒè™‘åˆ°ï¼Œä»¥åæˆ‘ä»¬åˆ›å»ºçš„ç´¢å¼•æ‰€å­˜å‚¨çš„æ•°æ®é‡ï¼Œå¦åˆ™åˆ›å»ºäº†ä¸åˆé€‚çš„åˆ†ç‰‡æ•°ï¼Œä¼šå¯¹æˆ‘ä»¬çš„æ€§èƒ½é€ æˆå¾ˆå¤§çš„å½±å“ã€‚</li></ul><h3 id="3-å‚æ•°è°ƒä¼˜"><a href="#3-å‚æ•°è°ƒä¼˜" class="headerlink" title="3. å‚æ•°è°ƒä¼˜"></a>3. å‚æ•°è°ƒä¼˜</h3><p>ä¸‹é¢æˆ‘ä¼šä»‹ç»ä¸€äº› ES å…³é”®å‚æ•°çš„è°ƒä¼˜ã€‚</p><p>æœ‰å¾ˆå¤šåœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬çš„ ES é›†ç¾¤å ç”¨äº†å¤šå¤§çš„ cpu ä½¿ç”¨ç‡ï¼Œè¯¥å¦‚ä½•è°ƒèŠ‚å‘¢ã€‚cpu ä½¿ç”¨ç‡é«˜ï¼Œæœ‰å¯èƒ½æ˜¯å†™å…¥å¯¼è‡´çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æŸ¥è¯¢å¯¼è‡´çš„ï¼Œé‚£è¦æ€ä¹ˆæŸ¥çœ‹å‘¢ï¼Ÿ</p><p>å¯ä»¥å…ˆé€šè¿‡ <code>GET _nodes/&#123;node&#125;/hot_threads</code> æŸ¥çœ‹çº¿ç¨‹æ ˆï¼ŒæŸ¥çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹å ç”¨ <code>cpu</code> é«˜ï¼Œå¦‚æœæ˜¯ <code>elasticsearch[&#123;node&#125;][search][T#10]</code> åˆ™æ˜¯æŸ¥è¯¢å¯¼è‡´çš„ï¼Œå¦‚æœæ˜¯ <code>elasticsearch[&#123;node&#125;][bulk][T#1]</code> åˆ™æ˜¯æ•°æ®å†™å…¥å¯¼è‡´çš„ã€‚</p><p>åœ¨å®é™…è°ƒä¼˜ä¸­ï¼Œcpu ä½¿ç”¨ç‡å¾ˆé«˜ï¼Œå¦‚æœä¸æ˜¯ SSDï¼Œå»ºè®®æŠŠ <code>index.merge.scheduler.max_thread_count: 1</code> ç´¢å¼• merge æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®ä¸º 1 ä¸ªï¼Œè¯¥å‚æ•°å¯ä»¥æœ‰æ•ˆè°ƒèŠ‚å†™å…¥çš„æ€§èƒ½ã€‚å› ä¸ºåœ¨å­˜å‚¨ä»‹è´¨ä¸Šå¹¶å‘å†™ï¼Œç”±äºå¯»å€çš„åŸå› ï¼Œå†™å…¥æ€§èƒ½ä¸ä¼šæå‡ï¼Œåªä¼šé™ä½ã€‚</p><p>è¿˜æœ‰å‡ ä¸ªé‡è¦å‚æ•°å¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œå„ä½åŒå­¦å¯ä»¥è§†è‡ªå·±çš„é›†ç¾¤æƒ…å†µä¸æ•°æ®æƒ…å†µè€Œå®šã€‚</p><ul><li><code>index.refresh_interval</code>ï¼šè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯æ•°æ®å†™å…¥åå‡ ç§’å¯ä»¥è¢«æœç´¢åˆ°ï¼Œé»˜è®¤æ˜¯ 1sã€‚æ¯æ¬¡ç´¢å¼•çš„ refresh ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ lucene æ®µ, è¿™ä¼šå¯¼è‡´é¢‘ç¹çš„åˆå¹¶è¡Œä¸ºï¼Œå¦‚æœä¸šåŠ¡éœ€æ±‚å¯¹å®æ—¶æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼Œå¯ä»¥å°†æ­¤å‚æ•°è°ƒå¤§ï¼Œå®é™…è°ƒä¼˜å‘Šè¯‰æˆ‘ï¼Œè¯¥å‚æ•°ç¡®å®å¾ˆç»™åŠ›ï¼Œcpu ä½¿ç”¨ç‡ç›´çº¿ä¸‹é™ã€‚</li><li><code>indices.memory.index_buffer_size</code>ï¼šå¦‚æœæˆ‘ä»¬è¦è¿›è¡Œéå¸¸é‡çš„é«˜å¹¶å‘å†™å…¥æ“ä½œï¼Œé‚£ä¹ˆæœ€å¥½å°† <code>indices.memory.index_buffer_size</code> è°ƒå¤§ä¸€äº›ï¼Œindex buffer çš„å¤§å°æ˜¯æ‰€æœ‰çš„ shard å…¬ç”¨çš„ï¼Œä¸€èˆ¬å»ºè®®ï¼ˆçœ‹çš„å¤§ç‰›åšå®¢ï¼‰ï¼Œå¯¹äºæ¯ä¸ª shard æ¥è¯´ï¼Œæœ€å¤šç»™ <code>512mb</code>ï¼Œå› ä¸ºå†å¤§æ€§èƒ½å°±æ²¡ä»€ä¹ˆæå‡äº†ã€‚ES ä¼šå°†è¿™ä¸ªè®¾ç½®ä½œä¸ºæ¯ä¸ª shard å…±äº«çš„ index bufferï¼Œé‚£äº›ç‰¹åˆ«æ´»è·ƒçš„ shard ä¼šæ›´å¤šçš„ä½¿ç”¨è¿™ä¸ª bufferã€‚é»˜è®¤è¿™ä¸ªå‚æ•°çš„å€¼æ˜¯ 10%ï¼Œä¹Ÿå°±æ˜¯ jvm heap çš„ 10%ã€‚</li><li><code>translog</code>ï¼šES ä¸ºäº†ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæ¯æ¬¡ indexã€bulkã€deleteã€update å®Œæˆçš„æ—¶å€™ï¼Œä¸€å®šä¼šè§¦å‘åˆ·æ–° translog åˆ°ç£ç›˜ä¸Šã€‚åœ¨æé«˜æ•°æ®å®‰å…¨æ€§çš„åŒæ—¶å½“ç„¶ä¹Ÿé™ä½äº†ä¸€ç‚¹æ€§èƒ½ã€‚å¦‚æœä½ ä¸åœ¨æ„è¿™ç‚¹å¯èƒ½æ€§ï¼Œè¿˜æ˜¯å¸Œæœ›æ€§èƒ½ä¼˜å…ˆï¼Œå¯ä»¥è®¾ç½®å¦‚ä¸‹å‚æ•°ï¼š</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;index.translog&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;sync_interval&quot;</span>: <span class="string">&quot;120s&quot;</span>,     <span class="comment">--syncé—´éš”è°ƒé«˜</span></span><br><span class="line">        <span class="string">&quot;durability&quot;</span>: <span class="string">&quot;async&quot;</span>,       -â€“ å¼‚æ­¥æ›´æ–°</span><br><span class="line">        <span class="string">&quot;flush_threshold_size&quot;</span>:<span class="string">&quot;1g&quot;</span>  <span class="comment">--logæ–‡ä»¶å¤§å°</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·è®¾å®šçš„æ„æ€æ˜¯å¼€å¯å¼‚æ­¥å†™å…¥ç£ç›˜ï¼Œå¹¶è®¾å®šå†™å…¥çš„æ—¶é—´é—´éš”ä¸å¤§å°ï¼Œæœ‰åŠ©äºå†™å…¥æ€§èƒ½çš„æå‡ã€‚</li></ul><p><strong>è¿˜æœ‰ä¸€äº›è¶…æ—¶å‚æ•°çš„è®¾ç½®ï¼š</strong></p><ul><li><code>discovery.zen.ping_timeout</code> åˆ¤æ–­ master é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œå‘ç°å…¶ä»– node å­˜æ´»çš„è¶…æ—¶è®¾ç½®</li><li><code>discovery.zen.fd.ping_interval</code> èŠ‚ç‚¹è¢« ping çš„é¢‘ç‡ï¼Œæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜æ´»</li><li><code>discovery.zen.fd.ping_timeout</code> èŠ‚ç‚¹å­˜æ´»å“åº”çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º 30sï¼Œå¦‚æœç½‘ç»œå¯èƒ½å­˜åœ¨éšæ‚£ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§</li><li><code>discovery.zen.fd.ping_retries ping</code> å¤±è´¥/è¶…æ—¶å¤šå°‘å¯¼è‡´èŠ‚ç‚¹è¢«è§†ä¸ºå¤±è´¥ï¼Œé»˜è®¤ä¸º 3</li></ul><h3 id="4-å…¶ä»–å»ºè®®"><a href="#4-å…¶ä»–å»ºè®®" class="headerlink" title="4. å…¶ä»–å»ºè®®"></a>4. å…¶ä»–å»ºè®®</h3><p>è¿˜æœ‰ä¸€äº›é›¶ç¢çš„ä¼˜åŒ–å»ºè®®å–”ã€‚</p><ul><li><code>æ’å…¥ç´¢å¼•è‡ªåŠ¨ç”Ÿæˆ id</code>ï¼šå½“å†™å…¥ç«¯ä½¿ç”¨ç‰¹å®šçš„ id å°†æ•°æ®å†™å…¥ ES æ—¶ï¼ŒES ä¼šæ£€æŸ¥å¯¹åº”çš„ç´¢å¼•ä¸‹æ˜¯å¦å­˜åœ¨ç›¸åŒçš„ idï¼Œè¿™ä¸ªæ“ä½œä¼šéšç€æ–‡æ¡£æ•°é‡çš„å¢åŠ ä½¿æ¶ˆè€—è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥å¦‚æœä¸šåŠ¡ä¸Šæ²¡æœ‰ç¡¬æ€§éœ€æ±‚å»ºè®®ä½¿ç”¨ ES è‡ªåŠ¨ç”Ÿæˆçš„ idï¼ŒåŠ å¿«å†™å…¥é€Ÿç‡ã€‚</li><li><code>é¿å…ç¨€ç–ç´¢å¼•</code>ï¼šç´¢å¼•ç¨€ç–ä¹‹åï¼Œä¼šå¯¼è‡´ç´¢å¼•æ–‡ä»¶å¢å¤§ã€‚ES çš„ keywordï¼Œæ•°ç»„ç±»å‹é‡‡ç”¨ doc_values ç»“æ„ï¼Œå³ä½¿å­—æ®µæ˜¯ç©ºå€¼ï¼Œæ¯ä¸ªæ–‡æ¡£ä¹Ÿä¼šå ç”¨ä¸€å®šçš„ç©ºé—´ï¼Œæ‰€ä»¥ç¨€ç–ç´¢å¼•ä¼šé€ æˆç£ç›˜å¢å¤§ï¼Œå¯¼è‡´æŸ¥è¯¢å’Œå†™å…¥æ•ˆç‡é™ä½ã€‚</li></ul><h2 id="jvmè°ƒä¼˜"><a href="#jvmè°ƒä¼˜" class="headerlink" title="jvmè°ƒä¼˜"></a>jvmè°ƒä¼˜</h2><blockquote><p>ä»…æä¾›æ€è·¯ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç»™åˆ°ç‰©ç†æœºå†…å­˜ä¸€åŠï¼Œä¸Šé™32Gå³å¯</p></blockquote><p>1.JVMè°ƒä¼˜ç­–ç•¥</p><p>æ¨èè®¾ç½®æ˜¯ç‰©ç†æœºçš„ä¸€åŠå†…å­˜ï¼Œä½†æ˜¯å½“ç‰©ç†æœºçš„å†…å­˜å¤§äº32GBçš„æ—¶å€™ï¼Œè‹¥å†…å­˜æ˜¯64GBï¼Œåˆ™å°±æ˜¯32GBå†…å­˜ã€‚é»˜è®¤å°±æ˜¯ç‰©ç†æœºå†…å­˜çš„ä¸€åŠã€‚</p><p>ä½†æ˜¯å½“å¤§äº64GBæ—¶ï¼Œæ¯”å¦‚ç‰©ç†æœºæ˜¯256GBå†…å­˜ï¼Œæ­¤æ—¶ä¸åº”è¯¥è®¾ç½®å†…å­˜ä¸ºå®¿ä¸»æœºçš„ä¸€åŠï¼Œåº”è¯¥æœ€å¤§ä¸Šé™è®¾ç½®ä¸º32GBã€‚</p><p>2.ä¿®æ”¹å †å†…å­˜å¤§å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨çŠ¶æ€</span></span><br><span class="line">[root@elk01:0 ~]# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       2.2Gi       1.2Gi       0.0Ki       388Mi       1.4Gi</span><br><span class="line">Swap:          2.7Gi       736Mi       2.0Gi</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹javaç¨‹åºå·²å ç”¨å†…å­˜</span></span><br><span class="line">[root@elk92 ~]# ps -ef | grep java | grep -i xms</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘ç»™çš„æ˜¯4Gå†…å­˜ï¼Œå ç”¨ä¸€åŠå†…å­˜</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027215156903.png" alt="image-20241027215156903"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹å†…å­˜å¤§å°</span></span><br><span class="line">[root@elk01:0 ~]# vim /etc/elasticsearch/jvm.options</span><br><span class="line">Â·Â·Â·</span><br><span class="line">-Xms256m</span><br><span class="line">-Xmx256m</span><br></pre></td></tr></table></figure><p><strong>æ‹·è´æ–‡ä»¶åˆ°å…¶ä»–2ä¸ªèŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# scp /etc/elasticsearch/jvm.options 10.0.0.212:/etc/elasticsearch/</span><br><span class="line">[root@elk01:0 ~]# scp /etc/elasticsearch/jvm.options 10.0.0.213:/etc/elasticsearch/</span><br></pre></td></tr></table></figure><p><strong>é‡å¯ESé›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]#  systemctl restart elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒæœ€å¥½æ»šåŠ¨é‡å¯ï¼Œå½“å‰é‡å¯å®Œæ¯•åå†é‡å¯å…¶å®ƒèŠ‚ç‚¹ï¼ˆé˜²æ­¢æ‰€æœ‰é›†ç¾¤å®•æœºï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€æ˜¯å¦OK</span></span><br><span class="line">[root@elk01:2 ~]# curl 10.0.0.211:9200/_cat/nodes</span><br><span class="line">10.0.0.213 42 97 0 0.25 0.30 0.28 cdfhilmrstw * elk03</span><br><span class="line">10.0.0.211 75 48 3 1.38 0.81 0.64 cdfhilmrstw - elk01</span><br><span class="line">10.0.0.212 52 97 0 0.34 0.31 0.28 cdfhilmrstw - elk02</span><br></pre></td></tr></table></figure><p><strong>å†æ¬¡æŸ¥çœ‹å†…å­˜å ç”¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       1.1Gi       2.0Gi       0.0Ki       771Mi       2.5Gi</span><br><span class="line">Swap:          2.7Gi        60Mi       2.7Gi</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">é’ˆå¯¹Elasticsearchå‚æ•°è°ƒä¼˜ï¼Œä»ç³»ç»Ÿï¼Œåˆ†ç‰‡ä¸Šåˆ†æ</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>06.ESé›†ç¾¤åŠ å¯†</title>
    <link href="https://lukme.top/posts/de7fd46f.html"/>
    <id>https://lukme.top/posts/de7fd46f.html</id>
    <published>2024-10-30T02:38:01.000Z</published>
    <updated>2024-10-30T04:02:06.950Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ESé›†ç¾¤åŠ å¯†"><a href="#ESé›†ç¾¤åŠ å¯†" class="headerlink" title="ESé›†ç¾¤åŠ å¯†"></a>ESé›†ç¾¤åŠ å¯†</h2><p><strong>æœªåŠ å¯†å‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@elk91 ~]# curl 10.0.0.211:9200/_cat/nodes?v</span><br><span class="line">ip        heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line">10.0.0.92           78          66   0    0.01    0.02     0.03 cdfhilmrstw -      elk01</span><br><span class="line">10.0.0.93           44          47   1    0.02    0.02     0.01 cdfhilmrstw -      elk02</span><br><span class="line">10.0.0.91           54          68   1    0.22    0.17     0.12 cdfhilmrstw *      elk03</span><br></pre></td></tr></table></figure><p><strong>1. ç”Ÿæˆè¯ä¹¦æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# /usr/share/elasticsearch/bin/elasticsearch-certutil cert --days 3650 -out /etc/elasticsearch/elastic-certificates.p12 -pass <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹è¯ä¹¦æƒé™ï¼ˆå¦åˆ™esæ²¡æœ‰æƒé™è¯»å–è¯ä¹¦ï¼‰</span></span><br><span class="line">[root@elk91 ~]# <span class="built_in">chown</span> elasticsearch:elasticsearch /etc/elasticsearch/elastic-certificates.p12</span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š:`</span><br><span class="line">[root@elk01:1 ~]# /usr/share/elasticsearch/bin/elasticsearch-certutil cert -h æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">--days   æŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸå¤šä¹…</span><br><span class="line">--out    æŒ‡å®šè¯ä¹¦å­˜æ”¾è·¯å¾„</span><br><span class="line">--pass   æŒ‡å®šè¯ä¹¦å¯†ç ï¼ˆä¸ºç©ºå³å¯ï¼‰</span><br></pre></td></tr></table></figure><p><strong>2. åŒæ­¥è¯ä¹¦æ–‡ä»¶åˆ°å…¶ä»–èŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elastic-certificates.p12 10.0.0.212:/etc/elasticsearch/</span><br><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elastic-certificates.p12 10.0.0.213:/etc/elasticsearch/</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨ï¼šæ³¨æ„æ£€æŸ¥å…¶å®ƒèŠ‚ç‚¹çš„è¯ä¹¦æƒé™æ˜¯å¦æ˜¯elasticsearchï¼Œè‹¥ä¸æ˜¯åˆ™ä¿®æ”¹ï¼ˆè§ä¸Šä¸€æ­¥ï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>4. ä¿®æ”¹ESé…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#åŒæ­¥é…ç½®æ–‡ä»¶åˆ°å…¶å®ƒèŠ‚ç‚¹</span></span><br><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elasticsearch.yml 10.0.0.212:/etc/elasticsearch/</span><br><span class="line">[root@elk01:1 ~]# scp /etc/elasticsearch/elasticsearch.yml 10.0.0.213:/etc/elasticsearch/</span><br></pre></td></tr></table></figure><p><strong>5. æ‰€æœ‰èŠ‚ç‚¹é‡å¯elasticsearch</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]#  systemctl restart elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒæœ€å¥½æ»šåŠ¨é‡å¯ï¼Œå½“å‰é‡å¯å®Œæ¯•åå†é‡å¯å…¶å®ƒèŠ‚ç‚¹ï¼ˆé˜²æ­¢æ‰€æœ‰é›†ç¾¤å®•æœºï¼‰</span></span><br></pre></td></tr></table></figure><p><strong>6. æµ‹è¯•è®¿é—®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# curl 10.0.0.211:9200/_cat/nodes</span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:&#123;<span class="string">&quot;root_cause&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missing authentication credentials for REST request [/_cat/nodes]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;],<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missing authentication credentials for REST request [/_cat/nodes]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;,<span class="string">&quot;status&quot;</span>:401&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ²¡æœ‰æƒé™è®¿é—®å³ä¸ºæˆåŠŸ</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆå¯†ç "><a href="#ç”Ÿæˆå¯†ç " class="headerlink" title="ç”Ÿæˆå¯†ç "></a>ç”Ÿæˆå¯†ç </h2><p><strong>æ³¨æ„ä¿å­˜å¯†ç </strong></p><blockquote><p>auto  éäº¤äº’å¼ï¼Œè‡ªåŠ¨ç”Ÿæˆéšæœºå¯†ç </p><p>interactive äº¤äº’å¼ï¼Œè‡ªå·±è¾“å…¥å¯†ç ï¼ˆæœ‰7é¡¹ï¼‰</p><p><code>æ³¨æ„ä¿å­˜å¯†ç </code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto</span><br><span class="line">Initiating the setup of passwords <span class="keyword">for</span> reserved <span class="built_in">users</span> elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.</span><br><span class="line">The passwords will be randomly generated and printed to the console.</span><br><span class="line">Please confirm that you would like to <span class="built_in">continue</span> [y/N]y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user apm_system</span><br><span class="line">PASSWORD apm_system = ZY6QTWFDqGv64uVzB2PR</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user kibana_system</span><br><span class="line">PASSWORD kibana_system = BtaZLprbzzF1tYXSaCld</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user kibana</span><br><span class="line">PASSWORD kibana = BtaZLprbzzF1tYXSaCld</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user logstash_system</span><br><span class="line">PASSWORD logstash_system = ykztlETUjj9bu7zDF9Fw</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user beats_system</span><br><span class="line">PASSWORD beats_system = Fe075On7ZgmleYNkS9in</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user remote_monitoring_user</span><br><span class="line">PASSWORD remote_monitoring_user = J7bkmxKsrhUKhLJyksMD</span><br><span class="line"></span><br><span class="line">Changed password <span class="keyword">for</span> user elastic</span><br><span class="line">PASSWORD elastic = pNcoJpSv0j1Qp9ZZ4N5G</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•è¿æ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŠ ä¸Šç”¨æˆ·å’Œå¯†ç æµ‹è¯•</span></span><br><span class="line">[root@elk01:1 ~]# curl -u elastic:pNcoJpSv0j1Qp9ZZ4N5G 10.0.0.211:9200/_cat/nodes</span><br><span class="line">10.0.0.212 19 97 3 0.23 0.50 0.71 cdfhilmrstw * elk02</span><br><span class="line">10.0.0.211 12 91 3 0.31 0.46 0.53 cdfhilmrstw - elk01</span><br><span class="line">10.0.0.213 43 90 3 0.27 0.61 0.89 cdfhilmrstw - elk03</span><br></pre></td></tr></table></figure><h2 id="kibanaé›†æˆESåŠ å¯†é›†ç¾¤"><a href="#kibanaé›†æˆESåŠ å¯†é›†ç¾¤" class="headerlink" title="kibanaé›†æˆESåŠ å¯†é›†ç¾¤"></a>kibanaé›†æˆESåŠ å¯†é›†ç¾¤</h2><p><strong>1. ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# vim /etc/kibana/kibana.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">elasticsearch.username: <span class="string">&quot;kibana_system&quot;</span></span><br><span class="line">elasticsearch.password: <span class="string">&quot;BtaZLprbzzF1tYXSaCld&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯†ç è§ä¸Šé¢ç”Ÿæˆçš„</span></span><br></pre></td></tr></table></figure><p><strong>2. é‡å¯kibanaæœåŠ¡ </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]#  systemctl restart kibana</span><br></pre></td></tr></table></figure><p><strong>3. è®¿é—®kibanaçš„webUIç™»å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.211:5601</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨elasticç”¨æˆ·ç™»å½•</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027222304410.png" alt="image-20241027222304410"></p><p><img src="https://cos.lukme.top/Pic/image-20241027222417898.png" alt="image-20241027222417898"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•åå¦‚æœæ²¡æœ‰å‡ºç°å³ä¸Šè§’eæ ‡å¿—ï¼Œå°è¯•æ¸…é™¤ç¼“å­˜ï¼Œæˆ–è€…ä½¿ç”¨æ— ç—•æ¨¡å¼ç™»å½•</span></span><br><span class="line">è¿™é‡Œä¿®æ”¹å¯†ç ä¸º   123456</span><br></pre></td></tr></table></figure><h2 id="filebeatå†™å…¥ESåŠ å¯†é›†ç¾¤"><a href="#filebeatå†™å…¥ESåŠ å¯†é›†ç¾¤" class="headerlink" title="filebeatå†™å…¥ESåŠ å¯†é›†ç¾¤"></a>filebeatå†™å…¥ESåŠ å¯†é›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/filebeat/19-tcp_es_secret.yaml </span><br><span class="line"><span class="comment"># æ•°æ®ä»ç›‘å¬çš„æŒ‡å®štcpç«¯å£æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output:</span><br><span class="line">  elasticsearch:</span><br><span class="line">    hosts:</span><br><span class="line">    - <span class="string">&quot;http://10.0.0.211:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.212:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.213:9200&quot;</span></span><br><span class="line">    index: <span class="string">&quot;linux-tcp-secret-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    username: elastic</span><br><span class="line">    password: <span class="string">&quot;123456&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;linux-tcp-secret&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;linux-tcp-secret*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]# filebeat -e -c /etc/filebeat/19-tcp_es_secret.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•å®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]#  <span class="built_in">echo</span> 7890 |nc 10.0.0.211 9000</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027224350997.png" alt="image-20241027224350997"></p><p><strong>ä½¿ç”¨å¼€å‘å·¥å…·ç®€å•æŸ¥çœ‹æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027224929276.png" alt="image-20241027224929276"></p><h2 id="logstashå†™å…¥ESåŠ å¯†é›†ç¾¤"><a href="#logstashå†™å…¥ESåŠ å¯†é›†ç¾¤" class="headerlink" title="logstashå†™å…¥ESåŠ å¯†é›†ç¾¤"></a>logstashå†™å…¥ESåŠ å¯†é›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/16-tcp-es-secret.conf</span><br><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; 8888</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">   elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;logstach-tcp-secret-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      user =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">      password =&gt; <span class="string">&quot;123456&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# logstash -rf /etc/logstash/conf.d/16-tcp-es-secret.conf </span><br><span class="line"></span><br><span class="line"><span class="comment">#å†™å…¥æ•°æ®æµ‹è¯•</span></span><br><span class="line">[root@elk02:0 ~]# <span class="built_in">echo</span> 666666 |nc 10.0.0.211 8888</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027225729785.png" alt="image-20241027225729785"></p><h2 id="è§’è‰²è®¿é—®"><a href="#è§’è‰²è®¿é—®" class="headerlink" title="è§’è‰²è®¿é—®"></a>è§’è‰²è®¿é—®</h2><p><strong>åˆ›å»ºè§’è‰²ï¼Œç»™å¼€å‘æˆ–è€…è¿ç»´ä¸åŒæƒé™</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027231430903.png" alt="image-20241027231430903"></p><p><img src="https://cos.lukme.top/Pic/image-20241027232332394.png" alt="image-20241027232332394"></p><p><img src="https://cos.lukme.top/Pic/image-20241027232500498.png" alt="image-20241027232500498"></p><p><strong>åˆ›å»ºè¿ç»´è§’è‰²</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027232645991.png" alt="image-20241027232645991"></p><p><strong>è¿˜æœ‰kibanaçš„æƒé™é€‰æ‹©allå®Œäº‹</strong>  <strong><em>å›¾ç•¥</em></strong></p><p><strong>åˆ›å»ºç”¨æˆ·</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027232837646.png" alt="image-20241027232837646"></p><p><strong>ç™»å½•ææ˜Ÿæ˜Ÿç”¨æˆ·   æƒé™ç¡®å®å°‘</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027233121133.png" alt="image-20241027233121133"></p>]]></content>
    
    
    <summary type="html">é’ˆå¯¹ESé›†ç¾¤åŠ å¯†ï¼Œè®¾ç½®æƒé™è®¿é—®</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>05.logstashå¯¹æ¥filebeat</title>
    <link href="https://lukme.top/posts/4a11ec3f.html"/>
    <id>https://lukme.top/posts/4a11ec3f.html</id>
    <published>2024-10-30T02:37:01.000Z</published>
    <updated>2024-10-30T04:01:54.948Z</updated>
    
    <content type="html"><![CDATA[<h2 id="logstashå¯¹æ¥filebeat"><a href="#logstashå¯¹æ¥filebeat" class="headerlink" title="logstashå¯¹æ¥filebeat"></a>logstashå¯¹æ¥filebeat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ç¼–å†™logstashå®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/03_filebeat_input.conf</span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 9999</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨logstashå®ä¾‹</span></span><br><span class="line">[root@elk01:4 ~]# logstash -rf /etc/logstash/conf.d/03_filebeat_input.conf </span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦æœ‰9999ç«¯å£</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:4 ~]# <span class="built_in">cat</span> /etc/filebeat/14-logstash.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: filestream</span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/test.conf</span><br><span class="line">  parsers:</span><br><span class="line">  - ndjson:</span><br><span class="line">      target: <span class="string">&quot;&quot;</span></span><br><span class="line">      message_key: message</span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.211:9999&quot;</span>]</span><br><span class="line">  </span><br><span class="line"><span class="comment">#2.å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:4 ~]# filebeat -e -c /etc/filebeat/14-logstash.yaml </span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ£€æŸ¥logstashæ˜¯å¦æœ‰æ ‡å‡†è¾“å‡º  ï¼ˆmessageå­—æ®µé‡Œè¾“å‡ºnewæ˜¯/tmp/test.confé‡Œçš„å†…å®¹,è¯æ˜å¯¹æ¥filebeatæˆåŠŸï¼‰</span></span><br><span class="line">&#123;</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">         <span class="string">&quot;agent&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;ephemeral_id&quot;</span> =&gt; <span class="string">&quot;b923603a-d451-4c18-b9d4-f7aa0e034000&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">             <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;id&quot;</span> =&gt; <span class="string">&quot;4f19d0b0-5ed5-4c21-82ef-6f001fb850b3&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filebeat&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-05T05:29:42.250Z,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">           <span class="string">&quot;ecs&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">          <span class="string">&quot;tags&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;beats_input_codec_plain_applied&quot;</span></span><br><span class="line">    ],</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;new&quot;</span>,</span><br><span class="line">         <span class="string">&quot;input&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filestream&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="string">&quot;log&quot;</span> =&gt; &#123;</span><br><span class="line">          <span class="string">&quot;file&quot;</span> =&gt; &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;/tmp/test.conf&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;offset&quot;</span> =&gt; 14</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="filterå¤„ç†å­—æ®µ"><a href="#filterå¤„ç†å­—æ®µ" class="headerlink" title="filterå¤„ç†å­—æ®µ"></a>filterå¤„ç†å­—æ®µ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">#remove_fieldå¯ä»¥è¿‡æ»¤ä¸éœ€è¦çš„é¡¶çº§å­—æ®µ</span></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/04_filebeat_input.conf</span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 9999</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•ˆæœå¦‚ä¸‹  ï¼ˆå¦‚æœæƒ³è¦messageé‡Œæ¯ä¸ªå­—æ®µåŠ å…¥åˆ°é¡¶çº§å­—æ®µé‡Œï¼Œè¯¦æƒ…è§ä¸Šä¸€ç¯‡ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ï¼‰</span></span><br><span class="line">&#123;</span><br><span class="line">          <span class="string">&quot;timestamp&quot;</span> =&gt; <span class="string">&quot;2024-10-05T16:16:29+08:00&quot;</span>,</span><br><span class="line">                <span class="string">&quot;uri&quot;</span> =&gt; <span class="string">&quot;/index.nginx-debian.html&quot;</span>,</span><br><span class="line">             <span class="string">&quot;status&quot;</span> =&gt; <span class="string">&quot;304&quot;</span>,</span><br><span class="line">          <span class="string">&quot;SendBytes&quot;</span> =&gt; 0,</span><br><span class="line">            <span class="string">&quot;referer&quot;</span> =&gt; <span class="string">&quot;-&quot;</span>,</span><br><span class="line">            <span class="string">&quot;tcp_xff&quot;</span> =&gt; <span class="string">&quot;-&quot;</span>,</span><br><span class="line">         <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-05T08:16:30.048Z,</span><br><span class="line">              <span class="string">&quot;vhost&quot;</span> =&gt; <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">       <span class="string">&quot;responsetime&quot;</span> =&gt; 0,</span><br><span class="line">             <span class="string">&quot;domain&quot;</span> =&gt; <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">       <span class="string">&quot;upstreamtime&quot;</span> =&gt; <span class="string">&quot;-&quot;</span>,</span><br><span class="line">          <span class="string">&quot;http_host&quot;</span> =&gt; <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">           <span class="string">&quot;clientip&quot;</span> =&gt; <span class="string">&quot;10.0.0.1&quot;</span>,</span><br><span class="line">       <span class="string">&quot;upstreamhost&quot;</span> =&gt; <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http_user_agent&quot;</span> =&gt; <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/129.0.0.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;xff&quot;</span> =&gt; <span class="string">&quot;-&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useragent-filteræ’ä»¶"><a href="#useragent-filteræ’ä»¶" class="headerlink" title="useragent filteræ’ä»¶"></a>useragent filteræ’ä»¶</h3><blockquote><p>åˆ†æåˆ†æè®¾å¤‡çš„ç±»å‹åŠæ“ä½œç³»ç»Ÿ</p></blockquote><p><strong>ç¼–å†™logstashå®ä¾‹æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/05_filebeat_filter_es.yaml </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; <span class="string">&quot;9999&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># åˆ†æç”¨æˆ·çš„è®¾å¤‡ç±»å‹</span></span><br><span class="line">  useragent &#123;</span><br><span class="line">  <span class="comment"># å¯¹å“ªä¸ªå­—æ®µè¿›è¡Œåˆ†æ</span></span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;http_user_agent&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®šè§£æçš„è®¾å¤‡ä¿¡æ¯æ”¾åœ¨å“ªä¸ªå­—æ®µä¸­ï¼Œè‹¥ä¸æŒ‡å®šåˆ™é»˜è®¤æ”¾åœ¨é¡¶çº§å­—æ®µä¸­</span></span><br><span class="line">    target =&gt; <span class="string">&quot;agent-kind&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">   codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#å†™å…¥esé›†ç¾¤ï¼ˆå¯ä»¥å…ˆåªç”¨ä¸Šé¢çš„æ ‡å‡†è¾“å‡ºï¼Œæµ‹è¯•è¾“å‡ºæ— è¯¯åœ¨ä½¿ç”¨ä¸‹é¢çš„å†™å…¥é›†ç¾¤ï¼‰</span></span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">    hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">    index =&gt; <span class="string">&quot;logstash-nginx-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨logstashå®ä¾‹</span></span><br><span class="line">[root@elk01:4 ~]# logstash -rf /etc/logstash/conf.d/05_filebeat_filter_es.yaml</span><br></pre></td></tr></table></figure><p><strong>filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:4 ~]# <span class="built_in">cat</span> /etc/filebeat/15-nginx_logstash.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: filestream</span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log</span><br><span class="line">  parsers:</span><br><span class="line">  - ndjson:</span><br><span class="line">      target: <span class="string">&quot;&quot;</span></span><br><span class="line">      message_key: message</span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.211:9999&quot;</span>]</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:4 ~]# filebeat -e -c /etc/filebeat/15-nginx_logstash.yaml </span><br></pre></td></tr></table></figure><p><strong>æµè§ˆå™¨è®¿é—®ï¼š10.0.0.211:5601</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241005170328290.png" alt="image-20241005170328290"></p><blockquote><p>åœ¨åˆ›å»ºç´¢å¼•æ¨¡æ¿æ—¶å€™å‘ç°å¤šå‡ºä¸€ä¸ªæ—¶é—´æˆ³å­—æ®µ</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241005170803108.png" alt="image-20241005170803108"></p><h3 id="æ—¶é—´æ ¼å¼å¤„ç†"><a href="#æ—¶é—´æ ¼å¼å¤„ç†" class="headerlink" title="æ—¶é—´æ ¼å¼å¤„ç†"></a>æ—¶é—´æ ¼å¼å¤„ç†</h3><p><a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-date.html#plugins-filters-date-match">å®˜æ–¹</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># åˆ†æç”¨æˆ·çš„è®¾å¤‡ç±»å‹</span></span><br><span class="line">  useragent &#123;</span><br><span class="line">    <span class="comment"># å¯¹å“ªä¸ªå­—æ®µè¿›è¡Œåˆ†æ</span></span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;http_user_agent&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®šè§£æçš„è®¾å¤‡ä¿¡æ¯æ”¾åœ¨å“ªä¸ªå­—æ®µä¸­ï¼Œè‹¥ä¸æŒ‡å®šåˆ™é»˜è®¤æ”¾åœ¨é¡¶çº§å­—æ®µä¸­</span></span><br><span class="line">    target =&gt; <span class="string">&quot;linux_agent&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¤„ç†æ—¥æœŸçš„æ’ä»¶ #AccessTimeæ˜¯ç”¨æˆ·å®é™…è®¿é—®æ—¶é—´</span></span><br><span class="line">  <span class="built_in">date</span> &#123;</span><br><span class="line">    <span class="comment"># &quot;[29/Aug/2024:08:46:59 +0000]&quot;</span></span><br><span class="line">    match =&gt; [ <span class="string">&quot;AccessTime&quot;</span>, <span class="string">&quot;[dd/MMM/yyyy:HH:mm:ss Z]&quot;</span> ]</span><br><span class="line">    <span class="comment"># å°†è§£æçš„å­—ç¬¦ä¸²å­˜å‚¨åˆ°æŒ‡å®šå­—æ®µï¼Œè‹¥ä¸æŒ‡å®šåˆ™é»˜è®¤è¦†ç›–&quot;@timestamp&quot;</span></span><br><span class="line">    target =&gt; <span class="string">&quot;accesstime&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="geoip-filteræ’ä»¶"><a href="#geoip-filteræ’ä»¶" class="headerlink" title="geoip filteræ’ä»¶"></a>geoip filteræ’ä»¶</h3><blockquote><p>åˆ†æç”¨æˆ·çš„åœ°ç†ä½ç½®,å‰ææ˜¯æ—¥å¿—é‡Œçš„ipéœ€è¦æ˜¯å…¬ç½‘åœ°å€ï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ”¹æ¨¡æ‹Ÿ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.è·å–è‡ªå·±çš„å…¬ç½‘åœ°å€</span><br><span class="line">[root@elk01:1 ~]# curl ifconfig.io</span><br><span class="line">101.82.161.6</span><br><span class="line"></span><br><span class="line">2.ä¿®æ”¹nginxæ—¥å¿—æ–‡ä»¶æ¨¡æ‹Ÿå…¬ç½‘åœ°å€è®¿é—®  ï¼ˆæ›¿æ¢åé‡Œé¢ipæ•°å­—éšä¾¿æ”¹æ”¹ï¼‰  ï¼ˆ10.0.0.1æ˜¯æ—¥å¿—é‡Œå®¢æˆ·ç«¯è®¿é—®çš„ipï¼‰</span><br><span class="line">[root@elk01:1 ~]# sed -i s#10.0.0.1#101.82.161.6#g /var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">3.é‡å¯nginx</span><br><span class="line">[root@elk01:1 ~]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line">4.åˆ é™¤filebeaté‡‡é›†ç¼“å­˜</span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">rm</span> -fr /var/lib/filebeat/*</span><br><span class="line"></span><br><span class="line">5.é‡æ–°å¯åŠ¨logstashå®ä¾‹å’Œfilebeatå®ä¾‹</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241005181444001.png" alt="image-20241005181444001"></p><blockquote><p>æ·»åŠ mapæ•°æ®æç¤ºä¸åŒ…å«ä»»ä½•å­—æ®µï¼Ÿ    logstashåˆ›å»ºçš„ç´¢å¼•çš„åœ°ç†åæ ‡ç‚¹ç±»å‹é»˜è®¤æ˜¯floatï¼Œä¿®æ”¹ä¸ºgeoip.location</p><p>åšä¸€ä¸ªæ¨¡æ¿æ˜ å°„locationçš„typeç±»å‹</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241005181708936.png" alt="image-20241005181708936"></p><p><img src="https://cos.lukme.top/Pic/image-20241005181759172.png" alt="image-20241005181759172"></p><h2 id="grokæ’ä»¶"><a href="#grokæ’ä»¶" class="headerlink" title="grokæ’ä»¶"></a>grokæ’ä»¶</h2><blockquote><p><a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-grok.html">å®˜æ–¹grokæŒ‡å¯¼â€”ç‚¹å‡»ç›´è¾¾</a></p><p><a href="https://github.com/logstash-plugins/logstash-patterns-core/tree/main/patterns/ecs-v1">grokåŒ¹é…æ”¯æŒé¡¹â€”github</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥æ‰¾å†…ç½®çš„åŒ¹é…æ¨¡å¼ï¼ˆä»¥httpdä¸ºä¾‹ï¼‰</span></span><br><span class="line">[root@elk01:0 conf.d]# find / -name httpd</span><br><span class="line">/usr/share/logstash/vendor/bundle/jruby/2.5.0/gems/logstash-patterns-core-4.3.4/patterns/legacy/httpd</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨httpdè¿™ä¸ªåŒ¹é…è§„åˆ™é‡Œå°è¯•æœç´¢clientipå­—æ®µï¼Œå³å¯æ‰¾åˆ°  HTTPD_COMMONLOG  è¿™ä¸ªåŒ¹é…é¡¹</span></span><br><span class="line">[root@elk01:0 conf.d]# grep clientip /usr/share/logstash/vendor/bundle/jruby/2.5.0/gems/logstash-patterns-core-4.3.4/patterns/legacy/httpd</span><br><span class="line">HTTPD_COMMONLOG %&#123;IPORHOST:clientip&#125; %&#123;HTTPDUSER:ident&#125; %&#123;HTTPDUSER:auth&#125; \[%&#123;HTTPDATE:timestamp&#125;\] <span class="string">&quot;(?:%&#123;WORD:verb&#125; %&#123;NOTSPACE:request&#125;(?: HTTP/%&#123;NUMBER:httpversion&#125;)?|%&#123;DATA:rawrequest&#125;)&quot;</span> (?:-|%&#123;NUMBER:response&#125;) (?:-|%&#123;NUMBER:bytes&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹é¢å°±ä»¥clientipä¸ºä¾‹ï¼Œå±•ç¤ºgrokåŒ¹é…</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ç¼–è¾‘logstashå®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/07_filter_grok.conf </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; <span class="string">&quot;7777&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># åŸºäºæ­£åˆ™åŒ¹é…ä»»æ„æ–‡æœ¬ï¼Œgrokå†…ç½®äº†120ç§åŒ¹é…æ¨¡å¼</span></span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;HTTPD_COMBINEDLOG&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#åˆ†æè®¾å¤‡ç±»å‹</span></span><br><span class="line">  useragent &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;agent&quot;</span></span><br><span class="line">    target =&gt; <span class="string">&quot;agent-kind&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#åˆ†æç”¨æˆ·çš„ç»çº¬åº¦ï¼Œä½ç½®ä¿¡æ¯ï¼ˆipè¦ä¸ºå…¬ç½‘ipæ‰æœ‰æ•ˆï¼‰</span></span><br><span class="line">  geoip &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; [<span class="string">&quot;clientip&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">   codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">    hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">    index =&gt; <span class="string">&quot;logstash-nginx-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:0 conf.d]# logstash -rf /etc/logstash/conf.d/07_filter_grok.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç¼–è¾‘filebeatå®ä¾‹</span></span><br><span class="line"><span class="built_in">cat</span> /etc/filebeat/16-nginx_logstash_grok.yaml</span><br><span class="line">filebeat:</span><br><span class="line">  inputs:</span><br><span class="line">  - <span class="built_in">type</span>: filestream</span><br><span class="line">    paths:</span><br><span class="line">      - /var/log/nginx/access.log*</span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.93:7777&quot;</span>]</span><br><span class="line">  </span><br><span class="line"><span class="comment"># å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/16-nginx_logstash_grok.yaml </span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºå±•ç¤º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å±•ç¤ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·ipä»¥clientipå­—æ®µä½œä¸ºé¡¶çº§å­—æ®µï¼Œå±•ç¤ºå‡ºip</span></span><br><span class="line"><span class="string">&quot;timestamp&quot;</span> =&gt; <span class="string">&quot;20/Oct/2024:16:36:12 +0800&quot;</span>,</span><br><span class="line">      <span class="string">&quot;clientip&quot;</span> =&gt; <span class="string">&quot;87.120.127.103&quot;</span>,</span><br><span class="line">          <span class="string">&quot;verb&quot;</span> =&gt; <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">         <span class="string">&quot;geoip&quot;</span> =&gt; &#123;</span><br><span class="line">             <span class="string">&quot;timezone&quot;</span> =&gt; <span class="string">&quot;Europe/Sofia&quot;</span>,</span><br><span class="line">            <span class="string">&quot;longitude&quot;</span> =&gt; 23.332,</span><br><span class="line">       <span class="string">&quot;continent_code&quot;</span> =&gt; <span class="string">&quot;EU&quot;</span>,</span><br><span class="line">             <span class="string">&quot;latitude&quot;</span> =&gt; 42.696,</span><br><span class="line">                   <span class="string">&quot;ip&quot;</span> =&gt; <span class="string">&quot;87.120.127.103&quot;</span>,</span><br><span class="line">         <span class="string">&quot;country_name&quot;</span> =&gt; <span class="string">&quot;Bulgaria&quot;</span>,</span><br><span class="line">        <span class="string">&quot;country_code3&quot;</span> =&gt; <span class="string">&quot;BG&quot;</span>,</span><br><span class="line">             <span class="string">&quot;location&quot;</span> =&gt; &#123;</span><br><span class="line">           <span class="string">&quot;lon&quot;</span> =&gt; 23.332,</span><br><span class="line">           <span class="string">&quot;lat&quot;</span> =&gt; 42.696</span><br><span class="line">           </span><br><span class="line"> <span class="comment">#åˆ†æç”¨æˆ·çš„ç»çº¬åº¦ï¼Œä½ç½®ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå±•ç¤ºå‡ºç”¨æˆ·ipçš„ä¸€äº›ä¿¡æ¯åŒ…æ‹¬æ—¶åŒºï¼ŒåŸå¸‚åå­—ç­‰</span></span><br><span class="line"> geoip &#123;</span><br><span class="line">   <span class="built_in">source</span> =&gt; [<span class="string">&quot;clientip&quot;</span>]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ­£åˆ™æå–å­—æ®µ"><a href="#è‡ªå®šä¹‰æ­£åˆ™æå–å­—æ®µ" class="headerlink" title="è‡ªå®šä¹‰æ­£åˆ™æå–å­—æ®µ"></a>è‡ªå®šä¹‰æ­£åˆ™æå–å­—æ®µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è‡ªå®šä¹‰æ­£åˆ™</span></span><br><span class="line">[root@elk93 ~]# <span class="built_in">cat</span> /tmp/parttern/xixi.re</span><br><span class="line">YEAR \d&#123;4&#125;</span><br><span class="line">school [A-z]&#123;5&#125;</span><br><span class="line">Class [A-z]&#123;5&#125;\d&#123;2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼–å†™logstashå®ä¾‹</span></span><br><span class="line">[root@elk93 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/05-tcp-grok-stdout.conf</span><br><span class="line">[root@elk01:1 ~]# vim /etc/logstash/conf.d/08_pattern.conf </span><br><span class="line"></span><br><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; 6666</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123;</span><br><span class="line">    <span class="comment"># åŠ è½½è‡ªå®šä¹‰æ­£åˆ™ï¼ˆå­˜æ”¾è‡ªå®šä¹‰æ­£åˆ™ç›®å½•ï¼‰</span></span><br><span class="line">    patterns_dir =&gt; [<span class="string">&quot;/tmp/pattern/&quot;</span>]</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;xixi %&#123;YEAR:year&#125;-%&#123;school:school&#125;-%&#123;Class:class&#125; haha&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line"> stdout &#123;</span><br><span class="line">  codec =&gt; rubydebug</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Class [A-z]&#123;5&#125;\d&#123;2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœåŒ¹é…è§„åˆ™æœªè¾¾åˆ°åˆ™å¦‚ä¸‹ï¼ˆè§„åˆ™æ˜¯Class [A-z]&#123;5&#125;\d&#123;2&#125;   å­—æ¯ååº”è¯¥æ˜¯2æ•°å­—ï¼‰</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-20T12:33:19.642Z,</span><br><span class="line">          <span class="string">&quot;port&quot;</span> =&gt; 49454,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="string">&quot;tags&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;_grokparsefailure&quot;</span></span><br><span class="line">    ],</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;xixi 2024-BJedu-Linux666 haha&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾¾åˆ°åŒ¹é…è§„åˆ™    xixi %&#123;YEAR:year&#125;-%&#123;school:school&#125;-%&#123;Class:class&#125; haha  æ‰èƒ½å¦‚æ­¤</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-20T12:31:16.265Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;xixi 2024-BJedu-Linux01 haha&quot;</span>,</span><br><span class="line">        <span class="string">&quot;school&quot;</span> =&gt; <span class="string">&quot;BJedu&quot;</span>,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">          <span class="string">&quot;year&quot;</span> =&gt; <span class="string">&quot;2024&quot;</span>,</span><br><span class="line">          <span class="string">&quot;port&quot;</span> =&gt; 34950,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">         <span class="string">&quot;class&quot;</span> =&gt; <span class="string">&quot;Linux01&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºå¹´ä»½æ˜¯2024-2030</span></span><br><span class="line">[root@elk01:2 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 2024 2030`; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;xixi <span class="variable">$i</span>-BJedu-Linux01 haha&quot;</span> | nc 10.0.0.211 6666 &amp; <span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="mutateæ’ä»¶"><a href="#mutateæ’ä»¶" class="headerlink" title="mutateæ’ä»¶"></a>mutateæ’ä»¶</h2><h3 id="è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼æå–"><a href="#è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼æå–" class="headerlink" title="è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼æå–"></a>è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼æå–</h3><p><strong>1. ä½¿ç”¨pythonè„šæœ¬åˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> generate_log.py </span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="comment"># @author : Jason Yin</span></span><br><span class="line"></span><br><span class="line">import datetime</span><br><span class="line">import random</span><br><span class="line">import logging</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">LOG_FORMAT = <span class="string">&quot;%(levelname)s %(asctime)s [com.linux.%(module)s] - %(message)s &quot;</span></span><br><span class="line">DATE_FORMAT = <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®rootçš„logging.Loggerå®ä¾‹çš„åŸºæœ¬é…ç½®</span></span><br><span class="line">logging.basicConfig(level=logging.INFO, format=LOG_FORMAT, datefmt=DATE_FORMAT, filename=sys.argv[1]</span><br><span class="line">, filemode=<span class="string">&#x27;a&#x27;</span>,)</span><br><span class="line">actions = [<span class="string">&quot;æµè§ˆé¡µé¢&quot;</span>, <span class="string">&quot;è¯„è®ºå•†å“&quot;</span>, <span class="string">&quot;åŠ å…¥æ”¶è—&quot;</span>, <span class="string">&quot;åŠ å…¥è´­ç‰©è½¦&quot;</span>, <span class="string">&quot;æäº¤è®¢å•&quot;</span>, <span class="string">&quot;ä½¿ç”¨ä¼˜æƒ åˆ¸&quot;</span>, <span class="string">&quot;é¢†å–ä¼˜æƒ åˆ¸&quot;</span>,</span><br><span class="line"> <span class="string">&quot;æœç´¢&quot;</span>, <span class="string">&quot;æŸ¥çœ‹è®¢å•&quot;</span>, <span class="string">&quot;ä»˜æ¬¾&quot;</span>, <span class="string">&quot;æ¸…ç©ºè´­ç‰©è½¦&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    time.sleep(random.randint(1, 5))</span><br><span class="line">    user_id = random.randint(1, 10000)</span><br><span class="line">    <span class="comment"># å¯¹ç”Ÿæˆçš„æµ®ç‚¹æ•°ä¿ç•™2ä½æœ‰æ•ˆæ•°å­—.</span></span><br><span class="line">    price = round(random.uniform(15000, 30000),2)</span><br><span class="line">    action = random.choice(actions)</span><br><span class="line">    svip = random.choice([0,1,2])</span><br><span class="line">    logging.info(<span class="string">&quot;DAU|&#123;0&#125;|&#123;1&#125;|&#123;2&#125;|&#123;3&#125;&quot;</span>.format(user_id, action,svip,price))</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p><strong>2. å¯åŠ¨è„šæœ¬-ç”Ÿæˆæ—¥å¿—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# python3 generate_log.py /tmp/apps.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆç±»ä¼¼æ ¼å¼çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">tail</span> -f /tmp/apps.log </span><br><span class="line">INFO 2024-10-27 09:23:50 [com.linux.generate_log] - DAU|5164|é¢†å–ä¼˜æƒ åˆ¸|2|18464.33 </span><br><span class="line">INFO 2024-10-27 09:23:51 [com.linux.generate_log] - DAU|2615|æœç´¢|1|21874.88 </span><br><span class="line">INFO 2024-10-27 09:23:56 [com.linux.generate_log] - DAU|8097|æŸ¥çœ‹è®¢å•|1|23759.47 </span><br><span class="line">INFO 2024-10-27 09:23:57 [com.linux.generate_log] - DAU|795|åŠ å…¥è´­ç‰©è½¦|2|21097.98 </span><br><span class="line">INFO 2024-10-27 09:24:00 [com.linux.generate_log] - DAU|1577|æ¸…ç©ºè´­ç‰©è½¦|0|16636.14</span><br></pre></td></tr></table></figure><p><strong>3. ç¼–å†™logstashå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/10.beats-mutate.conf </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5555</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="comment">#åˆ†å‰²å­—æ®µ</span></span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123; <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;|&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">    codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨logstashå®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]# logstash -rf /etc/logstash/conf.d/10.beats-mutate.conf </span><br></pre></td></tr></table></figure><p><strong>4. ç¼–å†™filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/filebeat/18-apps-to-logstash.yaml</span><br><span class="line">filebeat:</span><br><span class="line">  inputs:</span><br><span class="line">  - <span class="built_in">type</span>: filestream</span><br><span class="line">    paths:</span><br><span class="line">      - /tmp/apps.log </span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.211:7777&quot;</span>]</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/18-apps-to-logstash.yaml</span><br></pre></td></tr></table></figure><p><strong>5. è¾“å‡ºå±•ç¤º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;INFO 2024-10-27 09:46:03 [com.linux.generate_log] - DAU&quot;</span>,</span><br><span class="line">        [1] <span class="string">&quot;3013&quot;</span>,</span><br><span class="line">        [2] <span class="string">&quot;è¯„è®ºå•†å“&quot;</span>,</span><br><span class="line">        [3] <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        [4] <span class="string">&quot;25853.85 &quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T01:58:28.229Z</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å­—æ®µ"><a href="#æ·»åŠ å­—æ®µ" class="headerlink" title="æ·»åŠ å­—æ®µ"></a>æ·»åŠ å­—æ®µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸º[0-4]æ·»åŠ é¡¶çº§å­—æ®µ</span></span><br><span class="line">&#123;</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;INFO 2024-10-27 09:46:03 [com.linux.generate_log] - DAU&quot;</span>,</span><br><span class="line">        [1] <span class="string">&quot;3013&quot;</span>,</span><br><span class="line">        [2] <span class="string">&quot;è¯„è®ºå•†å“&quot;</span>,</span><br><span class="line">        [3] <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        [4] <span class="string">&quot;25853.85 &quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T01:58:28.229Z</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹logstashå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/10.beats-mutate.conf </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5555</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  mutate &#123;</span><br><span class="line">      <span class="comment">#åˆ†å‰²messageå­—æ®µï¼Œä»¥ | ä¸ºåˆ†éš”ç¬¦</span></span><br><span class="line">      <span class="built_in">split</span> =&gt; &#123; <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;|&quot;</span> &#125;</span><br><span class="line">      <span class="comment">#æ·»åŠ å­—æ®µ</span></span><br><span class="line">      add_field =&gt; &#123;</span><br><span class="line">       <span class="string">&quot;other&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][0]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][1]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][2]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][3]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][4]&#125;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">    codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºå±•ç¤º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;2&quot;</span>,</span><br><span class="line">     <span class="string">&quot;other&quot;</span> =&gt; <span class="string">&quot;INFO 2024-10-27 09:46:03 [com.linux.generate_log] - DAU&quot;</span>,</span><br><span class="line"><span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T02:17:55.199Z,</span><br><span class="line">    <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;3013&quot;</span>,</span><br><span class="line">    <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;è¯„è®ºå•†å“&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å¤šæ¬¡åˆ‡å‰²"><a href="#å¤šæ¬¡åˆ‡å‰²" class="headerlink" title="å¤šæ¬¡åˆ‡å‰²"></a>å¤šæ¬¡åˆ‡å‰²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬å‘ç°æŸä¸ªå­—æ®µå†…å®¹å¤šï¼ˆä¾‹å¦‚æœ¬æ¡ˆä¾‹çš„otherå­—æ®µï¼‰ï¼Œå¯å®ç°å¤šæ¬¡åˆ‡å‰²è¾“å‡ºæˆ‘ä»¬éœ€è¦çš„å­—æ®µ</span><br><span class="line">          <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;2&quot;</span>,</span><br><span class="line">         <span class="string">&quot;other&quot;</span> =&gt; <span class="string">&quot;INFO 2024-10-27 09:46:03 [com.linux.generate_log] - DAU&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T02:17:55.199Z,</span><br><span class="line">        <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;3013&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;è¯„è®ºå•†å“&quot;</span></span><br><span class="line"></span><br><span class="line">å¯¹otherå­—æ®µåˆ‡å‰²ï¼Œä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦ï¼Œè¾“å‡ºå¦‚ä¸‹</span><br><span class="line">         <span class="string">&quot;other&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;INFO&quot;</span>,</span><br><span class="line">        [1] <span class="string">&quot;2024-10-27&quot;</span>,</span><br><span class="line">        [2] <span class="string">&quot;10:46:33&quot;</span>,</span><br><span class="line">        [3] <span class="string">&quot;[com.linux.generate_log]&quot;</span>,</span><br><span class="line">        [4] <span class="string">&quot;-&quot;</span>,</span><br><span class="line">        [5] <span class="string">&quot;DAU&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹logstashå®ä¾‹ï¼Œåœ¨filteré‡Œå†æ¬¡åˆ†å‰²ï¼Œå°†æ—¶é—´å’Œç½‘ç«™ä¿¡æ¯éƒ½æ”¾åœ¨é¡¶çº§å­—æ®µé‡Œ</span></span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="comment">#åˆ†å‰²otherå­—æ®µï¼Œç©ºæ ¼ä¸ºåˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123; <span class="string">&quot;other&quot;</span> =&gt; <span class="string">&quot; &quot;</span> &#125;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="comment">#å°†æ—¥æœŸå’Œæ—¶é—´æ·»åŠ åˆ°datetimeå­—æ®µä¸­</span></span><br><span class="line">      <span class="string">&quot;datetime&quot;</span> =&gt; <span class="string">&quot;%&#123;[other][1]&#125; %&#123;[other][2]&#125;&quot;</span></span><br><span class="line">      <span class="comment">#å°†è®¿é—®çš„ç½‘ç«™æ·»åŠ åˆ°wwwå­—æ®µä¸­</span></span><br><span class="line">      <span class="string">&quot;www&quot;</span> =&gt; <span class="string">&quot;%&#123;[other][3]&#125;&quot;</span>              </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºå±•ç¤º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">        <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;9928&quot;</span>,</span><br><span class="line">           <span class="string">&quot;www&quot;</span> =&gt; <span class="string">&quot;[com.linux.generate_log]&quot;</span>,</span><br><span class="line">      <span class="string">&quot;datetime&quot;</span> =&gt; <span class="string">&quot;2024-10-27 10:58:19&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;é¢†å–ä¼˜æƒ åˆ¸&quot;</span>,</span><br><span class="line">          <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;2&quot;</span>,</span><br><span class="line">         <span class="string">&quot;other&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;INFO&quot;</span>,</span><br><span class="line">        [1] <span class="string">&quot;2024-10-27&quot;</span>,</span><br><span class="line">        [2] <span class="string">&quot;10:58:19&quot;</span>,</span><br><span class="line">        [3] <span class="string">&quot;[com.linux.generate_log]&quot;</span>,</span><br><span class="line">        [4] <span class="string">&quot;-&quot;</span>,</span><br><span class="line">        [5] <span class="string">&quot;DAU&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å†æ¬¡å¤šæ¬¡åˆ‡å‰²å®ç°ç½‘é¡µå­—æ®µæ²¡æœ‰ [ ]</span></span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123;<span class="string">&quot;www&quot;</span> =&gt; <span class="string">&quot;[&quot;</span>&#125;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;www2&quot;</span> =&gt; <span class="string">&quot;%&#123;[www][1]&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123;<span class="string">&quot;www2&quot;</span> =&gt;<span class="string">&quot;]&quot;</span>&#125;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      website =&gt; <span class="string">&quot;%&#123;[www2][0]&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºå±•ç¤º</span></span><br><span class="line">        <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;3837&quot;</span>,</span><br><span class="line">          <span class="string">&quot;www2&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;com.linux.generate_log&quot;</span></span><br><span class="line">    ],</span><br><span class="line">        <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;æµè§ˆé¡µé¢&quot;</span>,</span><br><span class="line">          <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;0&quot;</span>,</span><br><span class="line">       <span class="string">&quot;website&quot;</span> =&gt; <span class="string">&quot;com.linux.generate_log&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T03:03:39.620Z</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">           <span class="string">&quot;www&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;&quot;</span>,</span><br><span class="line">        [1] <span class="string">&quot;com.linux.generate_log]&quot;</span></span><br><span class="line">    ],</span><br><span class="line">      <span class="string">&quot;datetime&quot;</span> =&gt; <span class="string">&quot;2024-10-27 11:03:40&quot;</span>,</span><br><span class="line">         <span class="string">&quot;other&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;INFO&quot;</span>,</span><br><span class="line">        [1] <span class="string">&quot;2024-10-27&quot;</span>,</span><br><span class="line">        [2] <span class="string">&quot;11:03:40&quot;</span>,</span><br><span class="line">        [3] <span class="string">&quot;[com.linux.generate_log]&quot;</span>,</span><br><span class="line">        [4] <span class="string">&quot;-&quot;</span>,</span><br><span class="line">        [5] <span class="string">&quot;DAU&quot;</span></span><br><span class="line">    ],</span><br><span class="line">         <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;16570.26 &quot;</span>,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;INFO 2024-10-27 11:03:40 [com.linux.generate_log] - DAU&quot;</span>,</span><br><span class="line">        [1] <span class="string">&quot;8129&quot;</span>,</span><br><span class="line">        [2] <span class="string">&quot;ä½¿ç”¨ä¼˜æƒ åˆ¸&quot;</span>,</span><br><span class="line">        [3] <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        [4] <span class="string">&quot;16570.26 &quot;</span></span><br><span class="line">    ],</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å¤šä½™å­—æ®µ"><a href="#åˆ é™¤å¤šä½™å­—æ®µ" class="headerlink" title="åˆ é™¤å¤šä½™å­—æ®µ"></a>åˆ é™¤å¤šä½™å­—æ®µ</h3><blockquote><p>ç§»é™¤å¦‚messageï¼Œotherï¼Œwwwç­‰å­—æ®µï¼ˆå·²ç»éƒ½åšäº†æå–åˆ‡å‰²ï¼Œæ‰€æœ‰ä¸éœ€è¦å†å±•ç¤ºäº†ï¼‰</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹logstashå®ä¾‹</span></span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;message&quot;</span>,<span class="string">&quot;other&quot;</span>,<span class="string">&quot;www&quot;</span>,<span class="string">&quot;www2&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ€ç»ˆæ•ˆæœ</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="string">&quot;datetime&quot;</span> =&gt; <span class="string">&quot;2024-10-27 11:09:12&quot;</span>,</span><br><span class="line">         <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;18005.57 &quot;</span>,</span><br><span class="line">        <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;5897&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;æäº¤è®¢å•&quot;</span>,</span><br><span class="line">          <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">       <span class="string">&quot;website&quot;</span> =&gt; <span class="string">&quot;com.linux.generate_log&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T03:09:13.875Z</span><br></pre></td></tr></table></figure><h3 id="æœ€ç»ˆlogstashå®ä¾‹-å¹¶è¾“å‡ºåˆ°ESé›†ç¾¤"><a href="#æœ€ç»ˆlogstashå®ä¾‹-å¹¶è¾“å‡ºåˆ°ESé›†ç¾¤" class="headerlink" title="æœ€ç»ˆlogstashå®ä¾‹,å¹¶è¾“å‡ºåˆ°ESé›†ç¾¤"></a>æœ€ç»ˆlogstashå®ä¾‹,å¹¶è¾“å‡ºåˆ°ESé›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/10.beats-mutate.conf </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5555</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  mutate &#123;</span><br><span class="line">      <span class="comment">#åˆ†å‰²messageå­—æ®µï¼ˆä»¥|ä¸ºåˆ†éš”ç¬¦ï¼‰</span></span><br><span class="line">      <span class="built_in">split</span> =&gt; &#123; <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;|&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">#æ·»åŠ å­—æ®µ</span></span><br><span class="line">      add_field =&gt; &#123; </span><br><span class="line">       <span class="string">&quot;other&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][0]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][1]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][2]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][3]&#125;&quot;</span></span><br><span class="line">       <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][4]&#125;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="comment">#åˆ†å‰²otherå­—æ®µï¼Œç©ºæ ¼ä¸ºåˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123; <span class="string">&quot;other&quot;</span> =&gt; <span class="string">&quot; &quot;</span> &#125;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;datetime&quot;</span> =&gt; <span class="string">&quot;%&#123;[other][1]&#125; %&#123;[other][2]&#125;&quot;</span></span><br><span class="line">      <span class="string">&quot;www&quot;</span> =&gt; <span class="string">&quot;%&#123;[other][3]&#125;&quot;</span> </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123;<span class="string">&quot;www&quot;</span> =&gt; <span class="string">&quot;[&quot;</span>&#125;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;www2&quot;</span> =&gt; <span class="string">&quot;%&#123;[www][1]&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123;<span class="string">&quot;www2&quot;</span> =&gt;<span class="string">&quot;]&quot;</span>&#125;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      website =&gt; <span class="string">&quot;%&#123;[www2][0]&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="comment">#è½¬æ¢ç±»å‹</span></span><br><span class="line">    convert =&gt; &#123;</span><br><span class="line">       <span class="comment">#å°†å­—æ®µpriceç±»å‹è½¬ä¸ºæµ®ç‚¹å‹ï¼ˆé»˜è®¤æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨ESé›†ç¾¤é‡Œkibanaå‡ºå›¾æ— æ³•åšåˆ°æ±‚å’Œç­‰æ“ä½œï¼‰</span></span><br><span class="line">      <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;float&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#ç§»é™¤å¤šä½™å­—æ®µ</span></span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;message&quot;</span>,<span class="string">&quot;other&quot;</span>,<span class="string">&quot;www&quot;</span>,<span class="string">&quot;www2&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">    codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line"> elasticsearch&#123;</span><br><span class="line">   hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">   index =&gt; <span class="string">&quot;auto_logs-apps-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="logstashå¤šåˆ†æ”¯è¯­å¥"><a href="#logstashå¤šåˆ†æ”¯è¯­å¥" class="headerlink" title="logstashå¤šåˆ†æ”¯è¯­å¥"></a>logstashå¤šåˆ†æ”¯è¯­å¥</h2><p><strong>1. å¤šåˆ†æè¯­å¥     â€”åŸºç¡€ç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/11-multiple_input.conf </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5555</span><br><span class="line">    <span class="built_in">type</span> =&gt; beats</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; 6666</span><br><span class="line">    <span class="built_in">type</span> =&gt; tcp</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/tmp/luay.log&quot;</span>]</span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; file</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">   codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•</span></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> 999 |nc 10.0.0.211 6666</span><br><span class="line">[root@elk01:2 ~]# <span class="built_in">echo</span> 7989 &gt;/tmp/luay.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡º</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;tcp&quot;</span>,</span><br><span class="line">          <span class="string">&quot;port&quot;</span> =&gt; 56998,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T08:53:35.394Z,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;999&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;file&quot;</span>,</span><br><span class="line">          <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;/tmp/luay.log&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T08:54:44.088Z,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;7989&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. å¤šåˆ†æè¯­å¥   â€”å¤æ‚ç±»å½¢</strong></p><blockquote><p><a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-outputs-elasticsearch.html">å®˜æ–¹æ¡ˆä¾‹</a></p><p>æ·»åŠ   if  åˆ¤æ–­</p></blockquote><h3 id="inputå¤šåˆ†æ”¯"><a href="#inputå¤šåˆ†æ”¯" class="headerlink" title="inputå¤šåˆ†æ”¯"></a>inputå¤šåˆ†æ”¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;è¦æ±‚&#x27;</span>ï¼š</span><br><span class="line">1.åˆ é™¤tcpç±»å‹çš„versionå’Œportå­—æ®µ</span><br><span class="line">2.åˆ é™¤fileç±»å‹çš„versionå’Œhostå­—æ®µï¼Œå°†pathå­—æ®µæ”¹ä¸ºfilepathå­—æ®µ</span><br><span class="line">3.beatç±»å‹åŒæ¡ˆä¾‹10.beats-mutate.confï¼ˆå¾€ä¸Šç¿»ï¼‰</span><br><span class="line"></span><br><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/11-multiple_input.conf </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5555</span><br><span class="line">    <span class="built_in">type</span> =&gt; beats</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; 6666</span><br><span class="line">    <span class="built_in">type</span> =&gt; tcp</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/tmp/luay.log&quot;</span>]</span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; file</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;tcp&quot;</span> &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">      remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;port&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;file&quot;</span> &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">      rename =&gt; &#123; <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;filepath&quot;</span> &#125;</span><br><span class="line">      remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;host&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">     mutate &#123;</span><br><span class="line">       <span class="built_in">split</span> =&gt; &#123;<span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;|&quot;</span>&#125;</span><br><span class="line">       add_field =&gt; &#123;</span><br><span class="line">         <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][1]&#125;&quot;</span></span><br><span class="line">         <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][2]&#125;&quot;</span></span><br><span class="line">         <span class="string">&quot;svip&quot;</span>  =&gt; <span class="string">&quot;%&#123;[message][3]&#125;&quot;</span></span><br><span class="line">         <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][4]&#125;&quot;</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125; </span><br><span class="line">   &#125;</span><br><span class="line">   mutate &#123;</span><br><span class="line">     remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>,<span class="string">&quot;message&quot;</span>]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">   codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•</span></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> 999999999 &gt;&gt;/tmp/luay.log </span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> 11111111 |nc 10.0.0.211 6666</span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/18-apps-to-logstash.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºå±•ç¤º</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="string">&quot;filepath&quot;</span> =&gt; <span class="string">&quot;/tmp/luay.log&quot;</span>,</span><br><span class="line">          <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;file&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T09:22:11.843Z</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;tcp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T09:22:28.519Z</span><br><span class="line">    &#123;</span><br><span class="line">          <span class="string">&quot;svip&quot;</span> =&gt; <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;åŠ å…¥æ”¶è—&quot;</span>,</span><br><span class="line">          <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;beats&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-27T09:23:57.599Z,</span><br><span class="line">         <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;27975.99 &quot;</span>,</span><br><span class="line">        <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;6505&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="output-å¤šåˆ†æ”¯"><a href="#output-å¤šåˆ†æ”¯" class="headerlink" title="output å¤šåˆ†æ”¯"></a>output å¤šåˆ†æ”¯</h3><blockquote><p>è¾“å‡ºesé›†ç¾¤ï¼Œå¤šåˆ†æ”¯ç´¢å¼•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/11-multiple_input.conf </span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5555</span><br><span class="line">    <span class="built_in">type</span> =&gt; beats</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; 6666</span><br><span class="line">    <span class="built_in">type</span> =&gt; tcp</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/tmp/luay.log&quot;</span>]</span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; file</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;tcp&quot;</span> &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">      remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;port&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;file&quot;</span> &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">      rename =&gt; &#123; <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;filepath&quot;</span> &#125;</span><br><span class="line">      remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;host&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">     mutate &#123;</span><br><span class="line">       <span class="built_in">split</span> =&gt; &#123;<span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;|&quot;</span>&#125;</span><br><span class="line">       add_field =&gt; &#123;</span><br><span class="line">         <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][1]&#125;&quot;</span></span><br><span class="line">         <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][2]&#125;&quot;</span></span><br><span class="line">         <span class="string">&quot;svip&quot;</span>  =&gt; <span class="string">&quot;%&#123;[message][3]&#125;&quot;</span></span><br><span class="line">         <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][4]&#125;&quot;</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125; </span><br><span class="line">   &#125;</span><br><span class="line">   mutate &#123;</span><br><span class="line">     remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>,<span class="string">&quot;message&quot;</span>]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  <span class="comment">#stdout &#123;</span></span><br><span class="line">  <span class="comment"># codec =&gt; rubydebug</span></span><br><span class="line">  <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;tcp&quot;</span> &#123;</span><br><span class="line">    elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;logstash-if-tcp-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;file&quot;</span> &#123;</span><br><span class="line">    elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;logstash-if-file-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;logstash-if-apps-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027174748739.png" alt="image-20241027174748739"></p><h3 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a>å®æ“</h3><blockquote><p>å°†/var/log/syslogï¼Œ/var/log/auth.logï¼Œ/var/log/vmware-vmsvc*.logè¿™ä¸‰æ–‡ä»¶å†™å…¥ESä¸åŒçš„ç´¢å¼•ï¼Œè¦æ±‚ä½¿ç”¨ifå¤šåˆ†æ”¯è¯­å¥å®Œæˆã€‚</p><ol><li>è¦æ±‚å†™å…¥ESç´¢å¼•åˆ†åˆ«å¸¦æœ‰syslog,auth,vmwareç­‰å…³é”®è¯</li><li>å«syslogå…³é”®è¯ç´¢å¼•è¦æ±‚åˆ†ç‰‡æ•°é‡ä¸º3ï¼Œå‰¯æœ¬æ•°é‡ä¸º0</li><li>å«authå…³é”®è¯ç´¢å¼•è¦æ±‚åˆ†ç‰‡æ•°é‡ä¸º5ï¼Œå‰¯æœ¬æ•°é‡ä¸º0</li><li>å«vmwareå…³é”®è¯ç´¢å¼•è¦æ±‚åˆ†ç‰‡æ•°é‡ä¸º8ï¼Œå‰¯æœ¬æ•°é‡ä¸º0</li></ol></blockquote><p><strong>1. ç¼–å†™logstashå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/12-if_test.conf</span><br><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/var/log/syslog&quot;</span>]</span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; syslog</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/var/log/auth.log&quot;</span>]</span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; auth</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/var/log/vmware-vmsvc*.log&quot;</span>]</span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; vmware</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">   codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;syslog&quot;</span> &#123;</span><br><span class="line">    elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;linux-syslog-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;auth&quot;</span> &#123;</span><br><span class="line">    elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;linux-auth-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    elasticsearch&#123;</span><br><span class="line">      hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">      index =&gt; <span class="string">&quot;linux-vmware-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. è®¾ç½®å•ç‹¬å‰¯æœ¬</strong></p><blockquote><p>ç´¢å¼•ç®¡ç†â€”&gt;ç´¢å¼•æ¨¡æ¿â€”&gt;åˆ›å»ºç´¢å¼•æ¨¡æ¿</p></blockquote><p><strong>3åˆ†ç‰‡0å‰¯æœ¬</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241027180916483.png" alt="image-20241027180916483"></p><p><img src="https://cos.lukme.top/Pic/image-20241027181113679.png" alt="image-20241027181113679"></p><p>â€œnumber_of_replicasâ€:0,<br>â€œnumber_of_shardsâ€:3</p><p><strong>å…¶å®ƒä¸¤ä¸ªåŒç†å¦‚ä¸Šæ“ä½œ</strong></p><p><strong>3. å¯åŠ¨logstashå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# logstash -rf /etc/logstash/conf.d/12-if_test.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šlogstashé‡‡é›†æ–‡ä»¶ä¹Ÿæ˜¯æœ‰ç¼“å­˜çš„ï¼Œé‡æ–°é‡‡é›†è®°å¾—åˆ é™¤ç¼“å­˜</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027181807970.png" alt="image-20241027181807970"></p><h2 id="logstashçš„pipelineè¯­å¥"><a href="#logstashçš„pipelineè¯­å¥" class="headerlink" title="logstashçš„pipelineè¯­å¥"></a>logstashçš„pipelineè¯­å¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;Logstashçš„pipelineï¼Œå¤šå®ä¾‹å’Œå¤šåˆ†æ”¯è¯­å¥å¯¹æ¯”&#x27;</span></span><br><span class="line">1.å¤šåˆ†æ”¯è¯­å¥çš„ä¼˜ç¼ºç‚¹</span><br><span class="line">ä¼˜ç‚¹:</span><br><span class="line">å¯ä»¥å°†å¤šä¸ªinputå†™å…¥åˆ°åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿è¡Œä¸€ä¸ªLogstashå®ä¾‹ï¼Œæ›´åŠ è½»é‡çº§ã€‚</span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">ä¿®æ”¹ä¸€ä¸ªé…ç½®å°±ç®—æ˜¯çƒ­åŠ è½½é…ç½®ï¼Œå¦‚æœä¿®æ”¹é…ç½®å‡ºé”™ï¼Œåˆ™å¯¼è‡´æ•´ä¸ªLogstashæ— æ³•ç»§ç»­è¿è¡Œï¼Œä¼šå½±å“åˆ°å…¶ä»–inputã€‚</span><br><span class="line">2.logstashçš„å¤šå®ä¾‹</span><br><span class="line">ä¼˜ç‚¹:</span><br><span class="line">æ¯ä¸ªå®ä¾‹äº’ä¸å½±å“ï¼Œæ²¡æœ‰å¤ªå¼ºçš„é€»è¾‘æ€§ï¼Œç†è§£ç®€å•ã€‚</span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">éœ€è¦ç®¡ç†å¤šä¸ªæ•°æ®ç›®å½•ï¼Œç›¸å¯¹è€Œè¨€æ›´åŠ é‡é‡çº§ã€‚</span><br><span class="line">3.pipeline</span><br><span class="line">ä¼˜ç‚¹:</span><br><span class="line">è½»é‡çº§ï¼Œä¸€ä¸ªLogstashå®ä¾‹ï¼Œè½»é‡çº§ï¼Œç›¸å¯¹è€Œè¨€é…ç½®æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œè€Œæ˜¯å°†é…ç½®æ–‡ä»¶æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶çš„æ€è·¯ã€‚</span><br><span class="line">æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ç‹¬ç«‹çš„inputï¼Œfilterå’Œoutputï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸ºå¤šä¸ªä¸åŒçš„pipelineã€‚</span><br><span class="line">æ— éœ€ä½¿ç”¨-fé€‰é¡¹æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥å¯åŠ¨Logstashï¼ŒLogstashä¼šè‡ªåŠ¨åŠ è½½pipelineæ–‡ä»¶ã€‚</span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">å‡ ä¹å®Œç¾ï¼Œå½“LogstashæŒ‚æ‰ï¼Œä¼šå½±å“åˆ°æ‰€æœ‰çš„é…ç½®ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/logstash-pipeline.png" alt="logstash-pipeline.drawio"></p><h3 id="å‡†å¤‡æ–‡ä»¶"><a href="#å‡†å¤‡æ–‡ä»¶" class="headerlink" title="å‡†å¤‡æ–‡ä»¶"></a>å‡†å¤‡æ–‡ä»¶</h3><p><strong>1. tcp</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/13-pipeline_tcp.conf</span><br><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; 6666</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;address&quot;</span> =&gt; <span class="string">&quot;%&#123;host&#125;:%&#123;port&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>, <span class="string">&quot;host&quot;</span>,<span class="string">&quot;port&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">    hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">    index =&gt; <span class="string">&quot;logstash-pipeline-tcp-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. file</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/14-pipeline_file.conf</span><br><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/tmp/luay.log&quot;</span>]</span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    rename =&gt; &#123; <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;filepath&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">    hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">    index =&gt; <span class="string">&quot;logstash-pipeline-file-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. beats</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/15-pipeline_beat.conf</span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5555</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    <span class="built_in">split</span> =&gt; &#123;<span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;|&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;userId&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][1]&#125;&quot;</span></span><br><span class="line">      <span class="string">&quot;action&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][2]&#125;&quot;</span></span><br><span class="line">      <span class="string">&quot;svip&quot;</span>  =&gt; <span class="string">&quot;%&#123;[message][3]&#125;&quot;</span></span><br><span class="line">      <span class="string">&quot;price&quot;</span> =&gt; <span class="string">&quot;%&#123;[message][4]&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;tags&quot;</span>, <span class="string">&quot;log&quot;</span> , <span class="string">&quot;host&quot;</span>,<span class="string">&quot;ecs&quot;</span>,<span class="string">&quot;message&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">    hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">    index =&gt; <span class="string">&quot;logstash-pipeline-apps-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#filebeatå®ä¾‹ï¼ˆlogæ–‡ä»¶è‡ªå¤‡ï¼‰</span></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/18-apps-to-logstash.yaml </span><br><span class="line">filebeat:</span><br><span class="line">  inputs:</span><br><span class="line">  - <span class="built_in">type</span>: filestream</span><br><span class="line">    paths:</span><br><span class="line">      - /tmp/apps.log </span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.211:5555&quot;</span>]</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹pipelineæ–‡ä»¶"><a href="#ä¿®æ”¹pipelineæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹pipelineæ–‡ä»¶"></a>ä¿®æ”¹pipelineæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/logstash/pipelines.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">- pipeline.id: tcp-pipeline</span><br><span class="line">  path.config: <span class="string">&quot;/etc/logstash/conf.d/13-pipeline_tcp.conf&quot;</span></span><br><span class="line">- pipeline.id: file-pipeline</span><br><span class="line">  path.config: <span class="string">&quot;/etc/logstash/conf.d/14-pipeline_file.conf&quot;</span></span><br><span class="line">- pipeline.id: beat-pipeline</span><br><span class="line">  path.config: <span class="string">&quot;/etc/logstash/conf.d/15-pipeline_beat.conf&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#  pipeline.id  åå­—å¯è‡ªå®šä¹‰</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºè½¯é“¾æ¥æ–‡ä»¶"><a href="#åˆ›å»ºè½¯é“¾æ¥æ–‡ä»¶" class="headerlink" title="åˆ›å»ºè½¯é“¾æ¥æ–‡ä»¶"></a>åˆ›å»ºè½¯é“¾æ¥æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">mkdir</span> /usr/share/logstash/config</span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">ln</span> -svf /etc/logstash/pipelines.yml /usr/share/logstash/config/pipelines.yml</span><br><span class="line"><span class="string">&#x27;/usr/share/logstash/config/pipelines.yml&#x27;</span> -&gt; <span class="string">&#x27;/etc/logstash/pipelines.yml&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨logstash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# logstash -r</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼špipelineè¯­æ³• å¯åŠ¨æ—¶å€™ä¸éœ€è¦æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å†™å…¥æ•°æ®</span></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> 898989 |nc 10.0.0.211 6666</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> 9900 &gt;/tmp/luay.log</span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/18-apps-to-logstash.yaml</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241027185825270.png" alt="image-20241027185825270"></p><p><img src="https://cos.lukme.top/Pic/logstash-pipeline.png" alt="logstash-pipeline.drawio"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨logstashæ‹¿å–filebeaté‡‡é›†çš„æ•°æ®ï¼Œå¹¶ä½œç­›é€‰è¿‡æ»¤</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>04.logstashéƒ¨ç½²åŠå®æ“</title>
    <link href="https://lukme.top/posts/9a6613a9.html"/>
    <id>https://lukme.top/posts/9a6613a9.html</id>
    <published>2024-10-30T02:36:01.000Z</published>
    <updated>2024-10-30T03:23:51.673Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨ç½²logstash"><a href="#éƒ¨ç½²logstash" class="headerlink" title="éƒ¨ç½²logstash"></a>éƒ¨ç½²logstash</h2><p>Logstashæ˜¯å…è´¹ä¸”å¼€æ”¾çš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°æ‚¨æœ€å–œæ¬¢çš„â€œå­˜å‚¨åº“â€ä¸­ï¼ŒLogstashçš„ä½œç”¨å°±æ˜¯åœ¨äºæ—¥å¿—å¤„ç†ï¼Œè½¬æ¢æ“ä½œã€‚</p><p><strong>1.ä¸‹è½½logstash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]#   wget https://artifacts.elastic.co/downloads/logstash/logstash-7.17.23-amd64.deb</span><br></pre></td></tr></table></figure><p><strong>2.å®‰è£…logstash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# dpkg -i logstash-7.17.23-amd64.deb</span><br></pre></td></tr></table></figure><p><strong>3.æ·»åŠ è½¯é“¾æ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">ln</span> -svf /usr/share/logstash/bin/logstash /usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">[root@elk01:1 ~]# logstash -h</span><br></pre></td></tr></table></figure><p><strong>4.å¯åŠ¨æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]#  logstash -e <span class="string">&quot;input &#123; stdin &#123; type =&gt; stdin &#125; &#125; output &#123; stdout &#123; codec =&gt; rubydebug &#125; &#125;&quot;</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">The stdin plugin is now waiting <span class="keyword">for</span> input:</span><br><span class="line">111111</span><br><span class="line">&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;stdin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-05T01:48:28.131Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;111111&quot;</span>,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ¸©é¦¨æç¤ºï¼šå¦‚æœä½ å‡ºç°äº†å’Œæˆ‘ä¸€æ ·æŠ¥é”™å¦‚ä¸‹</p><p>[ERROR] 2024-10-05 01:25:25.226 [pool-3-thread-1] jvm - Unknown garbage collector name {:name=&gt;â€G1 Concurrent GCâ€}</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è¡¨ç¤º Logstash ä¸è¯†åˆ« <span class="string">&quot;G1 Concurrent GC&quot;</span> ä½œä¸ºåƒåœ¾å›æ”¶å™¨çš„åç§°ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºåœ¨ `jvm.options` é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†é”™è¯¯çš„åƒåœ¾å›æ”¶å™¨åç§°ã€‚</span><br><span class="line"></span><br><span class="line">è§£å†³ï¼šç¼–è¾‘ jvm.options æ–‡ä»¶ï¼š</span><br><span class="line">[root@elk01:1 ~]# vim /etc/logstash/jvm.options </span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹æˆ–æ·»åŠ  JVM å‚æ•°ï¼š</span></span><br><span class="line">åœ¨ jvm.options æ–‡ä»¶ä¸­ï¼Œåº”è¯¥è®¾ç½® -XX:+UseG1GC æ¥å¯ç”¨ G1 åƒåœ¾å›æ”¶å™¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <span class="string">&quot;G1 Concurrent GC&quot;</span> è¿™æ ·çš„åç§°ã€‚æ‰¾åˆ°ä»»ä½•æåŠåƒåœ¾å›æ”¶å™¨çš„è¡Œï¼Œæ²¡æœ‰å°±æ·»åŠ ï¼Œä¹‹åé‡å¯logstash</span><br><span class="line"></span><br><span class="line">-XX:+UseG1GC</span><br></pre></td></tr></table></figure></blockquote><h2 id="logstashç»„ä»¶"><a href="#logstashç»„ä»¶" class="headerlink" title="logstashç»„ä»¶"></a>logstashç»„ä»¶</h2><p>logstashæœ‰ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œåˆ†åˆ«ä¸ºinputï¼Œfilterå’Œoutputã€‚å…¶ä¸­ï¼Œfilterç»„ä»¶æ˜¯å¯é€‰ç»„ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">logstashå¤šå®ä¾‹åŠpipelineæ¦‚å¿µ</span><br><span class="line">inputï¼š</span><br><span class="line">æ•°æ®ä»å“ªé‡Œæ¥ï¼Œå¯ä»¥æ˜¯stdin,tcp,file,kafka,redis,...</span><br><span class="line">æ¨èé˜…è¯»:</span><br><span class="line">https://www.elastic.co/guide/en/logstash/7.17/input-plugins.html</span><br><span class="line"></span><br><span class="line">filter:</span><br><span class="line">å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤æ“ä½œï¼Œå¸¸ç”¨çš„æ’ä»¶æœ‰: grok,<span class="built_in">date</span>,mutate,user_agent,geoip,json,...</span><br><span class="line">æ¨èé˜…è¯»:</span><br><span class="line">https://www.elastic.co/guide/en/logstash/7.17/filter-plugins.html</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">æ•°æ®åˆ°å“ªå»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯å†™å…¥elasticsearchæˆ–è€…stdout(æµ‹è¯•)</span><br><span class="line">æ¨èé˜…è¯»ï¼š</span><br><span class="line">https://www.elastic.co/guide/en/logstash/7.17/output-plugins.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥éƒ¨ç½²å¤šä¸ªLogstashå®ä¾‹ï¼Œæ¯ä¸ªLogstashå®ä¾‹å¯ä»¥æœ‰å¤šä¸ªpipelineï¼Œæ¯ä¸ªpipelineå¯ä»¥æœ‰inputï¼Œfilterå’Œoutputæ’ä»¶ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/logstash.png" alt="logstash"></p><h2 id="logstashç±»å‹æ¡ˆä¾‹"><a href="#logstashç±»å‹æ¡ˆä¾‹" class="headerlink" title="logstashç±»å‹æ¡ˆä¾‹"></a>logstashç±»å‹æ¡ˆä¾‹</h2><blockquote><p>yesçš„ä¸ºå¿…é€‰å‚æ•°</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241005110046458.png" alt="image-20241005110046458"></p><h3 id="input-tcpç±»å‹"><a href="#input-tcpç±»å‹" class="headerlink" title="input-tcpç±»å‹"></a>input-tcpç±»å‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ç¼–å†™logstashå®ä¾‹ï¼Œæ ‡å‡†è¾“å‡ºstdout</span></span><br><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/01_tcp_stdout.conf</span><br><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; <span class="string">&quot;8888&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.å¯åŠ¨logstashå®ä¾‹   ï¼ˆ  -r   çƒ­åŠ è½½ï¼Œ-f  åè¦è·Ÿå®ä¾‹ï¼‰</span></span><br><span class="line">[root@elk01:2 ~]# logstash -rf /etc/logstash/conf.d/01_tcp_stdout.conf </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.åˆ«çš„èŠ‚ç‚¹å‘é€æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk02:1 ~]# <span class="built_in">echo</span> 999|nc 10.0.0.211 8888</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»ˆç«¯è¾“å‡º</span></span><br><span class="line">&#123;</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;999&quot;</span>,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;10.0.0.212&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-05T03:22:38.582Z,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="string">&quot;port&quot;</span> =&gt; 46720</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ‡å‡†è¾“å‡ºçš„#ï¼Œè‹¥ä¸æŒ‡å®šcodecå±æ€§ï¼Œåˆ™é»˜è®¤çš„è§£ç å™¨ä¸ºrubydebugã€‚</span></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">   <span class="comment"># codec =&gt; rubydebug</span></span><br><span class="line">   <span class="comment"># æ­¤å¤„æŒ‡å®šçš„codecçš„è§£ç å™¨ä¸ºjsonæ ¼å¼</span></span><br><span class="line">   codec =&gt; json </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»ˆç«¯è¾“å‡ºåˆ™ä¸º</span></span><br><span class="line">&#123;<span class="string">&quot;@timestamp&quot;</span>:<span class="string">&quot;2024-08-29T07:10:55.639Z&quot;</span>,<span class="string">&quot;@version&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;host&quot;</span>:<span class="string">&quot;10.0.0.91&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;9999&quot;</span>,<span class="string">&quot;port&quot;</span>:58096&#125;</span><br></pre></td></tr></table></figure><h3 id="input-fileç±»å‹"><a href="#input-fileç±»å‹" class="headerlink" title="input-fileç±»å‹"></a>input-fileç±»å‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ç¼–å†™logstashå®ä¾‹ï¼Œæ ‡å‡†è¾“å‡ºstdoutï¼ˆæ³¨æ„pathç±»å‹æ˜¯æ•°ç»„ï¼Œè¯¦ç»†çœ‹å®˜ç½‘ï¼‰ </span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/02_file_stdout.yaml </span><br><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; [<span class="string">&quot;/tmp/test.conf&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.å¯åŠ¨logstashå®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]# logstash -rf /etc/logstash/conf.d/02_file_stdout.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å‘é€æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">echo</span> <span class="string">&#x27;666&#x27;</span> &gt;&gt;/tmp/test.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#logstashçš„æ ‡å‡†è¾“å‡º</span></span><br><span class="line">&#123;</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-05T03:34:23.489Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;666&quot;</span>,</span><br><span class="line">          <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;/tmp/test.conf&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="logstashçš„é‡‡é›†ç¼“å­˜"><a href="#logstashçš„é‡‡é›†ç¼“å­˜" class="headerlink" title="logstashçš„é‡‡é›†ç¼“å­˜"></a>logstashçš„é‡‡é›†ç¼“å­˜</h3><blockquote><p>â€‹     å½“æˆ‘ä»¬åœæ‰å®ä¾‹2æ—¶å€™ï¼Œå†æ¬¡å¾€test.confé‡Œå†™å…¥æ–°æ•°æ®  7890 ï¼Œé‡æ–°æ‰§è¡Œå®ä¾‹2æ—¶å€™ï¼Œå‘ç°æ•°æ®å¹¶ä¸ä¼šé‡æ–°é‡‡é›†ï¼Œè€Œæ˜¯åªé‡‡é›†æ–°æ•°æ®ï¼Œè¿™ç§ç°è±¡åŒfilebeatä¸€æ ·ï¼Œå°†é‡‡é›†è¿‡çš„è®°å½•æ”¾åœ¨ç¼“å­˜æ–‡ä»¶é‡Œï¼Œä¸‹æ¬¡é‡‡é›†å‰å…ˆè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œçœ‹çœ‹é‡‡é›†çš„åç§»é‡ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶åœ¨å“ªå‘¢ï¼Ÿ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨å®ä¾‹æ—¶å€™å‘ç°è¯»å–æ–‡ä»¶--&gt;/usr/share/logstash/data/plugins/inputs/file/.sincedb_387337cd9c394c04fb5a33c176cf8715<span class="string">&quot;, :path=&gt;[&quot;</span>/tmp/test.conf<span class="string">&quot;]&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†è¿™ä¸ªæ–‡ä»¶å·²ç»è¢«é‡‡é›†çš„ä¿¡æ¯</span></span><br><span class="line"><span class="string">[root@elk01:3 ~]# cat /usr/share/logstash/data/plugins/inputs/file/.sincedb_387337cd9c394c04fb5a33c176cf8715 </span></span><br><span class="line"><span class="string">788369 0 64768 14 1728099475.853982 /tmp/test.conf</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚ä½•å®ç°æ–‡ä»¶é‡æ–°é‡‡é›†ï¼Ÿ</p><p>1.æ¸…ç©ºè¿™ä¸ªæ–‡ä»¶å–½ï¼Œç›´æ¥æ¸…ç©ºè¿™ä¸€çº§ç›®å½•æ‰€æœ‰æ–‡ä»¶å³å¯</p><p><code>rm -f /usr/share/logstash/data/plugins/inputs/file/.sincedb*</code></p><p>2.è®¾ç½®æ–‡ä»¶é‡‡é›†ä¸ºä»å¤´é‡‡é›†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:3 ~]# vim /etc/logstash/conf.d/02_file_stdout.yaml </span><br><span class="line">input &#123;</span><br><span class="line">file &#123;</span><br><span class="line"> path =&gt; [<span class="string">&quot;/tmp/test.conf&quot;</span>,<span class="string">&quot;/tmp/test2.log&quot;</span>]  <span class="comment">#pathæ•°ç»„ï¼Œæ”¯æŒé‡‡é›†å¤šä¸ªæ–‡ä»¶</span></span><br><span class="line"> start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line"> stdout &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>start_position  é»˜è®¤å€¼end  ä»æ–‡ä»¶æœ€åä½ç½®é‡‡é›†ï¼Œæœ‰æ•ˆå€¼ä¸º beginning  end</p></blockquote><h3 id="logstashçš„å¤šå®ä¾‹"><a href="#logstashçš„å¤šå®ä¾‹" class="headerlink" title="logstashçš„å¤šå®ä¾‹"></a>logstashçš„å¤šå®ä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŒfilebeatä¸€æ ·ï¼Œå¯åŠ¨æ—¶å€™æŒ‡å®šä¸åŒæ•°æ®ç›®å½•    --path.data</span><br><span class="line">logstash -rf /etc/logstash/conf.d/02-file-to-stdout.conf --path.data /tmp/logstash-data</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¸¦ä½ éƒ¨ç½²logstashå¹¶ä¸”ç®€å•ä½¿ç”¨logstashæ’ä»¶</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»ºä¸ªäººäº‘ç›˜</title>
    <link href="https://lukme.top/posts/aca79867.html"/>
    <id>https://lukme.top/posts/aca79867.html</id>
    <published>2024-10-15T11:30:07.000Z</published>
    <updated>2024-10-15T11:37:58.849Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç³»ç»Ÿä»‹ç»"><a href="#ç³»ç»Ÿä»‹ç»" class="headerlink" title="ç³»ç»Ÿä»‹ç»"></a>ç³»ç»Ÿä»‹ç»</h2><p>ownCloudæ˜¯ä¸€ä¸ªåŸºäºäº‘è®¡ç®—çš„å¼€æºæ–‡ä»¶å…±äº«å’Œåä½œå¹³å°ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨å¤šä¸ªè®¾å¤‡ä¸ŠåŒæ­¥ã€å…±äº«å’Œåä½œæ–‡ä»¶ã€‚</p><p><strong>ä¸»è¦ç‰¹ç‚¹</strong></p><ul><li>ç”¨æˆ·å¯ä»¥å°†ownCloudç§æœ‰äº‘ç›˜ä¸å…¶ä»–è®¾å¤‡åŒæ­¥ï¼Œéšæ—¶éšåœ°è®¿é—®å’Œç®¡ç†æ–‡ä»¶ã€‚</li><li>æ”¯æŒè·¨å¹³å°è®¿é—®ï¼ŒåŒ…æ‹¬Windowsã€Macã€Androidã€iOSã€Linuxç­‰ã€‚</li><li>æä¾›å…¬å…±é“¾æ¥åˆ†äº«åŠŸèƒ½ï¼Œå¯ä»¥è®¾ç½®å¯†ç å’Œè¿‡æœŸæ—¥æœŸï¼Œç¡®ä¿æ–‡ä»¶åˆ†äº«çš„å®‰å…¨æ€§ã€‚</li><li>å›¢é˜Ÿæˆå‘˜å¯ä»¥åœ¨åŒä¸€ä¸ªownCloudç§æœ‰äº‘ç›˜ä¸­å…±äº«å’Œåä½œæ–‡ä»¶ï¼Œæé«˜å›¢é˜Ÿæ•ˆç‡ã€‚</li><li>æ”¯æŒå®æ—¶åä½œï¼Œå¦‚åŒæ—¶ç¼–è¾‘æ–‡æ¡£ã€åˆ›å»ºæ¼”ç¤ºæ–‡ç¨¿ç­‰ã€‚</li><li>ownCloudå¯ä»¥ä½œä¸ºä¸€ä¸ªå¤‡ä»½è§£å†³æ–¹æ¡ˆï¼Œå°†ç”¨æˆ·çš„é‡è¦æ•°æ®å¤‡ä»½åˆ°ç§æœ‰äº‘ç›˜ä¸­ã€‚</li><li>æä¾›ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥æ¢å¤ä¹‹å‰çš„æ–‡ä»¶ç‰ˆæœ¬ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</li><li>ownCloudå¯ä»¥ä¸å¤šç§åº”ç”¨ç¨‹åºé›†æˆï¼Œå¦‚OnlyOfficeã€Microsoft 365ã€Collabora Onlineç­‰ï¼Œæ»¡è¶³ç”¨æˆ·çš„ä¸ªæ€§åŒ–éœ€æ±‚ã€‚</li><li>æ”¯æŒHTTPSå’ŒSSLåŠ å¯†ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚</li><li>æä¾›å¤šå› ç´ è®¤è¯ã€æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰å®‰å…¨åŠŸèƒ½ã€‚</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><ul><li>ç”¨äºä¸ªäººæ–‡ä»¶åŒæ­¥ã€å¤‡ä»½å’Œåˆ†äº«ã€‚è·¨å¹³å°è®¿é—®ï¼Œæ–¹ä¾¿åœ¨ä¸åŒè®¾å¤‡ä¹‹é—´åˆ‡æ¢ã€‚</li><li>ç”¨äºå›¢é˜Ÿåä½œã€æ–‡ä»¶å…±äº«å’Œç‰ˆæœ¬æ§åˆ¶ã€‚æé«˜å›¢é˜Ÿæ•ˆç‡ï¼Œé™ä½ITæˆæœ¬ã€‚</li><li>ç”¨äºå­¦ç”Ÿä½œä¸šæäº¤ã€æ•™å¸ˆèµ„æºå…±äº«ç­‰ã€‚æä¾›å®‰å…¨ã€å¯é çš„æ–‡ä»¶å­˜å‚¨å’Œåˆ†äº«ç¯å¢ƒ</li></ul><p><strong>æŠ€æœ¯æ¶æ„</strong></p><p>ownCloudé‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼Œå°†å­˜å‚¨ã€åç«¯å’Œå‰ç«¯ç»„ä»¶åˆ†ç¦»ï¼Œé€šè¿‡å®‰å…¨ã€æ˜ç¡®çš„APIè¿›è¡Œé€šä¿¡ã€‚è¿™ç§æ¶æ„ä½¿å¾—ownCloudå…·æœ‰é«˜å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚</p><p>å¦‚éœ€äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥è®¿é—®å…¶å®˜æ–¹ç½‘ç«™æˆ–æŸ¥é˜…ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£ã€‚</p><blockquote><p>å®˜æ–¹ç½‘ç«™</p><p><a href="https://owncloud.com/">https://owncloud.com/</a></p><p>Dockeré•œåƒ</p><p><a href="https://hub.docker.com/_/owncloud">https://hub.docker.com/_/owncloud</a></p><p>GitHubåœ°å€</p><p><a href="https://github.com/owncloud/core">https://github.com/owncloud/core</a></p></blockquote><h2 id="å®‰è£…æ•™ç¨‹"><a href="#å®‰è£…æ•™ç¨‹" class="headerlink" title="å®‰è£…æ•™ç¨‹"></a>å®‰è£…æ•™ç¨‹</h2><p>Dockeréƒ¨ç½²æ“ä½œæ­¥éª¤ï¼šå®‰è£…Dockerã€æ‹‰å–é•œåƒã€å¯åŠ¨å®¹å™¨ã€‚æœ¬ç¯‡åŸºäºCentos7ç³»ç»Ÿæ“ä½œå®‰è£…</p><h3 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.æ·»åŠ å®˜æ–¹dockeræº</span></span><br><span class="line">[root@docker01 ~]# vim /etc/yum.repos.d/docker-ce.repo </span><br><span class="line">[docker-ce-stable]</span><br><span class="line">name=Docker CE Stable - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://download.docker.com/linux/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/stable</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://download.docker.com/linux/centos/gpg</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æ›¿æ¢åä¸ºæºï¼ˆdockerå®˜æ–¹ä¼—æ‰€å‘¨åŸå› ä¸èƒ½è®¿é—®ä»¥åŠä¸‹è½½æ…¢ï¼Œè¿™é‡Œä½¿ç”¨åä¸ºé•œåƒæºï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">&#x27;s+download.docker.com+mirrors.huaweicloud.com/docker-ce+&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å®‰è£…docker</span></span><br><span class="line">[root@docker01 ~]# yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æ›´æ”¹é•œåƒåŠ é€Ÿï¼ˆå¦‚æœå¤±æ•ˆï¼Œä¹Ÿå¯å¾€ä¸Šæ‰¾å…¶ä»–åŠ é€Ÿåœ°å€ï¼‰</span></span><br><span class="line">[root@docker01 ~]# <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;dns&quot;</span>: [<span class="string">&quot;8.8.8.8&quot;</span>, <span class="string">&quot;8.8.4.4&quot;</span>],</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://dockerproxy.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.nju.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://registry.docker-cn.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# systemctl daemon-reload</span><br><span class="line">[root@docker01 ~]# systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹‰å–æ•°æ®åº“é•œåƒ</span></span><br><span class="line">[root@docker01 ~]# docker pull mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–owncloudé•œåƒ</span></span><br><span class="line">[root@docker01 ~]# docker pull owncloud</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºmysqlæœåŠ¡ï¼ˆè¿™é‡Œçš„æ•°æ®åº“å¯†ç ä¹Ÿæ˜¯ä½ è®¿é—®äº‘ç›˜çš„å¯†ç ï¼‰</span></span><br><span class="line">[root@docker01 ~]# docker run --name db --<span class="built_in">env</span> MYSQL_ROOT_PASSWORD=luay123 -d --restart=always mysql</span><br><span class="line"></span><br><span class="line">-name  db         ç»™å®¹å™¨èµ·ä¸ªåå­—ï¼Œå¯è‡ªå®šä¹‰</span><br><span class="line">--restart=always  dockeræ¯æ¬¡é‡å¯éƒ½ä¼šå¯åŠ¨è¿™ä¸ªå®¹å™¨</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ›å»ºä¸€ä¸ªè½¯ä»¶ç›®å½•ï¼Œæ–¹ä¾¿ç®¡ç†owncloudçš„æ•°æ®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä½ ä¸Šä¼ çš„å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰</span></span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> /app/owncloud/ -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ›å»ºowncloudæœåŠ¡</span></span><br><span class="line"><span class="comment"># --link mydb:mydbè¡¨ç¤ºè¿æ¥çš„å¦å¤–ä¸€ä¸ªå®¹å™¨mydb</span></span><br><span class="line">[root@docker01 ~]# docker run --name mycloud -p 8081:80 --<span class="built_in">link</span> mydb:mydb -d -v /app/owncloud/:/var/www/html --restart=always owncloud</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹è¿è¡ŒçŠ¶æ€  ï¼ˆæ˜¯å¦éƒ½æ˜¯upçŠ¶æ€ï¼Œä¸è¦æœ‰ç«¯å£å†²çªï¼‰</span></span><br><span class="line">[root@web01 ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE         CREATED          STATUS          PORTS                                   NAMES</span><br><span class="line">273ee893d887   owncloud    6 seconds ago    Up 4 seconds    0.0.0.0:8081-&gt;80/tcp, :::8081-&gt;80/tcp   mycloud</span><br><span class="line">a614a95ec067   mysql       33 minutes ago   Up 33 minutes   3306/tcp, 33060/tcp                     mydb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æµè§ˆå™¨è®¿é—®   ä½ çš„ip:8081   ä¾‹å¦‚æˆ‘çš„ipæ˜¯10.0.0.7     é‚£å°±è®¿é—®10.0.0.7:8081    </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºç®¡ç†å‘˜è´¦å·</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241015190649471.png" alt="image-20241015190649471"></p><p><strong>ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241015191024034.png" alt="image-20241015191024034"></p><p><img src="https://cos.lukme.top/Pic/image-20241015191332027.png" alt="image-20241015191332027"></p><h3 id="ç®¡ç†æ–‡ä»¶"><a href="#ç®¡ç†æ–‡ä»¶" class="headerlink" title="ç®¡ç†æ–‡ä»¶"></a>ç®¡ç†æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¿˜è®°å¾—æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®æ–‡ä»¶ç›®å½•å—ï¼Ÿ  çœ‹çœ‹æˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡æ˜¯ä¸æ˜¯å°±åœ¨è¿™ğŸ˜</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# ll /app/owncloud/data/admin/files/</span><br><span class="line">-rw-r--r-- 1 33 tape  529735 May  6 14:09 8CE7E8A4D305671B267848D4E720CAE3.jpg</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¦‚ä½•æ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„äº‘ç›˜å‘¢ï¼Œè¿™é‡Œå¸¦ä½ ä½¿ç”¨dockeræ¥æ­å»ºå±äºè‡ªå·±çš„äº‘ç›˜å§ã€‚</summary>
    
    
    
    <category term="çˆ±è°ƒç ”" scheme="https://lukme.top/categories/%E7%88%B1%E8%B0%83%E7%A0%94/"/>
    
    
    <category term="ä¸ªäººäº‘ç›˜" scheme="https://lukme.top/tags/%E4%B8%AA%E4%BA%BA%E4%BA%91%E7%9B%98/"/>
    
  </entry>
  
  <entry>
    <title>å°†hexoéƒ¨ç½²åˆ°åšå®¢ä¸Š</title>
    <link href="https://lukme.top/posts/7a77547d.html"/>
    <id>https://lukme.top/posts/7a77547d.html</id>
    <published>2024-10-10T03:17:04.000Z</published>
    <updated>2024-10-15T13:47:21.293Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç¯‡æ˜¯ä»¥windowsæœ¬åœ°å·²ç»éƒ¨ç½²å¥½hexoä¹‹åæ“ä½œï¼Œwindowsæœ¬åœ°å·²ç»å®‰è£…å¥½git</p></blockquote><p><a href="https://blog.csdn.net/weixin_42242910/article/details/136297201">windowså®‰è£…git</a></p><h4 id="åˆ›å»ºgitç”¨æˆ·"><a href="#åˆ›å»ºgitç”¨æˆ·" class="headerlink" title="åˆ›å»ºgitç”¨æˆ·"></a>åˆ›å»ºgitç”¨æˆ·</h4><p>æ‰“å¼€Git Bashï¼Œä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &quot;xxx@xxx.com&quot;     # xxx@xxx.comæ”¹ä¸ºé‚®ç®±</span><br><span class="line">git config --global user.name &quot;xxx&quot;              # xxxä¸ºç”¨æˆ·å</span><br></pre></td></tr></table></figure><p>æ­¤å¤„çš„é‚®ç®±å’Œç”¨æˆ·åç”¨äºæ ‡è¯†æ˜¯å“ªä½ç”¨æˆ·æäº¤çš„ä»£ç ï¼Œèµ·ä¸ªè‡ªå·±å–œæ¬¢çš„åç§°å³å¯ï¼Œé‚®ç®±æœ€å¥½æ˜¯çœŸå®çš„é‚®ç®±</p><h4 id="è¿æ¥æœåŠ¡å™¨"><a href="#è¿æ¥æœåŠ¡å™¨" class="headerlink" title="è¿æ¥æœåŠ¡å™¨"></a>è¿æ¥æœåŠ¡å™¨</h4><blockquote><p>ä½¿ç”¨Xshellæˆ–è€…å…¶ä»–è½¯ä»¶è¿æ¥æœåŠ¡å™¨ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯WindTermï¼Œå¼€æºå…è´¹ï¼Œåœ¨æ­¤æ”¾ä¸ªé“¾æ¥<a href="https://winterm.org/">WindTermå®˜ç½‘ (winterm.org)</a>ã€‚</p></blockquote><h5 id="æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†Git"><a href="#æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†Git" class="headerlink" title="æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†Git"></a>æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†Git</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure><p>è‹¥æ˜¾ç¤ºå¦‚ä¸‹åˆ™æ— éœ€å†æ¬¡å®‰è£…GIt</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git version 1.8.3.1</span><br></pre></td></tr></table></figure><h5 id="è‹¥æœªå®‰è£…åˆ™è¿›è¡Œå®‰è£…"><a href="#è‹¥æœªå®‰è£…åˆ™è¿›è¡Œå®‰è£…" class="headerlink" title="è‹¥æœªå®‰è£…åˆ™è¿›è¡Œå®‰è£…"></a>è‹¥æœªå®‰è£…åˆ™è¿›è¡Œå®‰è£…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git   # CentOSä½¿ç”¨yumå®‰è£…ï¼ŒDebianä½¿ç”¨apt-getå®‰è£… è¯·è‡ªè¡ŒæŸ¥æ‰¾å‘½ä»¤</span><br><span class="line">git --vesion         #æ˜¾ç¤ºgitç‰ˆæœ¬å·ï¼Œè¯´æ˜å®‰è£…æˆåŠŸ</span><br></pre></td></tr></table></figure><h5 id="æ·»åŠ gitç”¨æˆ·"><a href="#æ·»åŠ gitç”¨æˆ·" class="headerlink" title="æ·»åŠ gitç”¨æˆ·"></a>æ·»åŠ gitç”¨æˆ·</h5><ol><li><p>rootç”¨æˆ·é»˜è®¤çš„æƒé™è¿‡å¤§ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬ä¸ºæœåŠ¡å™¨æ·»åŠ ä¸€ä¸ªåä¸ºgitçš„ç”¨æˆ·ï¼Œç”¨äºå°†åšå®¢è‡ªåŠ¨éƒ¨ç½²è‡³æœåŠ¡å™¨ä¸Šï¼ˆä¸éœ€è¦ä¸»åŠ¨åˆ‡æ¢åˆ°gitç”¨æˆ·ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æ“ä½œéƒ½ç”¨rootç”¨æˆ·å³å¯ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd git     #æ·»åŠ åä¸ºgitçš„ç”¨æˆ·</span><br><span class="line">passwd git      #ä¿®æ”¹gitç”¨æˆ·çš„å¯†ç   </span><br></pre></td></tr></table></figure></li><li><p>ä¸ºgitç”¨æˆ·æˆäºˆsudoæƒé™ï¼Œç”¨WindTermæ‰“å¼€ /etc ç›®å½•ä¸‹çš„ sudoers æ–‡ä»¶ï¼Œåœ¨ root ALL=(ALL) ALL è¯­å¥ä¸‹æ·»åŠ  git ALL=(ALL) ALL ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cos.lukme.top/Pic/image-20241013170104029.png" alt="image-20241013170104029"></p></li></ol><p>   æˆ–è€…åœ¨/etc/sudoers.dç›®å½•ä¸‹ï¼Œæ–°å»ºusergitæ–‡ä»¶ï¼Œæ·»åŠ <code>git ALL=(ALL) NOPASSWD:ALL</code>å¹¶ä¿å­˜,æ•ˆæœä¸€æ ·</p>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sudoers.d/usergit</span><br><span class="line">git ALL=(ALL) NOPASSWD:ALL</span><br></pre></td></tr></table></figure><h5 id="ä¸ºgitç”¨æˆ·æ·»åŠ SSHå¯†é’¥"><a href="#ä¸ºgitç”¨æˆ·æ·»åŠ SSHå¯†é’¥" class="headerlink" title="ä¸ºgitç”¨æˆ·æ·»åŠ SSHå¯†é’¥"></a>ä¸ºgitç”¨æˆ·æ·»åŠ SSHå¯†é’¥</h5><blockquote><p>è‹¥ä¸æ·»åŠ SSHå¯†é’¥ï¼Œé‚£ä¹ˆæœ¬åœ°è®¡ç®—æœºå¯¹æœåŠ¡å™¨çš„gitä»“åº“è¿›è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½éœ€è¦è¾“å…¥å¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºgitç”¨æˆ·æ·»åŠ SSHå¯†é’¥çš„æ–¹å¼æ¥å®ç°å…å¯†ç™»å½•ã€‚</p></blockquote><ol><li><p>æœ¬åœ°è®¡ç®—æœºåœ¨ä»»æ„ä½ç½®æ‰“å¼€<code>Git Bash</code>ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå¯†é’¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>æŒ‰ä¸‰æ¬¡Enterå³å¯ç”Ÿæˆå¯†é’¥</p></li><li><p>è¿›å…¥<code>C:\Users\ç”¨æˆ·å</code>é‡Œé¢æœ‰.sshç›®å½•ï¼Œé‡Œé¢çš„id_rsa.pubå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘çš„å¦‚ä¸‹</p></li></ol><p><img src="https://cos.lukme.top/Pic/image-20241013170251887.png" alt="image-20241013170251887"></p><ol><li><p>æœåŠ¡å™¨ä¸­è¿›å…¥<code>/home/git</code>ç›®å½•ï¼Œåˆ›å»º.sshç›®å½•ï¼Œå¹¶æ–°å»ºåä¸ºauthorized_keysçš„æ–‡ä»¶ï¼Œå°†id_rsa.pubçš„å†…å®¹å¤åˆ¶è¿›å»å¹¶ä¿å­˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /home/git</span><br><span class="line">mkdir .ssh</span><br><span class="line">vim authorized_keys</span><br></pre></td></tr></table></figure></li><li><p>ä¸ºå…¬é’¥æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è®¾ç½®è¯»å†™æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 /home/git/.ssh/authorized_keys</span><br><span class="line">chmod 700 /home/git/.ssh</span><br></pre></td></tr></table></figure></li><li><p>å°†.sshæ–‡ä»¶å¤¹åŠå…¶å†…çš„æ–‡ä»¶æ‰€æœ‰æƒç§»äº¤ç»™gitç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R git:git /home/git/.ssh</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æœ¬åœ°è®¡ç®—æœºæµ‹è¯•æ˜¯å¦å¯ä»¥ç”¨sshå…å¯†ç™»å½•æœåŠ¡å™¨ã€‚æ‰“å¼€Git Bash</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -v git@xxx.xxx.xxx.xxx     #git@åå¡«å†™æœåŠ¡å™¨çš„å…¬ç½‘ip</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡å…å¯†ç™»å½•ä¼šæç¤ºè®©ä½ è¾“å…¥yes/noï¼Œè¾“å…¥yeså³å¯ï¼Œä¹‹åå°±ä¸éœ€è¦è¾“å…¥yesäº†ï¼Œæ˜¾ç¤ºä»¥ä¸‹å†…å®¹å³å…å¯†ç™»å½•æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Last login: Tue Jun 18 15:21:51 2024 from 111.194.209.107</span><br></pre></td></tr></table></figure></li></ol><h4 id="æœåŠ¡å™¨åˆ›å»ºGitä»“åº“å¹¶é…ç½®è‡ªåŠ¨éƒ¨ç½²"><a href="#æœåŠ¡å™¨åˆ›å»ºGitä»“åº“å¹¶é…ç½®è‡ªåŠ¨éƒ¨ç½²" class="headerlink" title="æœåŠ¡å™¨åˆ›å»ºGitä»“åº“å¹¶é…ç½®è‡ªåŠ¨éƒ¨ç½²"></a>æœåŠ¡å™¨åˆ›å»ºGitä»“åº“å¹¶é…ç½®è‡ªåŠ¨éƒ¨ç½²</h4><blockquote><p>è¿™é‡Œçš„Gitä»“åº“ï¼ˆrepositoryï¼‰å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå­˜æ”¾ç€ä¸åŒç‰ˆæœ¬ä»£ç çš„ä»£ç åº“ï¼ŒåŒ…å«äº†é¡¹ç›®æ‰€æœ‰çš„æºæ–‡ä»¶å’Œç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯ã€‚ä½†æˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦ç”¨åˆ°çš„æ˜¯è£¸åº“ï¼Œå³ä»…åŒ…å«ç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯çš„ä»“åº“ã€‚åè€…ä¸ä¿å­˜æ–‡ä»¶ï¼Œå¸¸ç”¨ä½œæœåŠ¡å™¨ä»“åº“ï¼Œå®ç°æ•°æ®å…±äº«å’ŒåŒæ­¥ã€‚</p><p>è‡ªåŠ¨éƒ¨ç½²çš„æ ¸å¿ƒåœ¨äºgit-hooksï¼ˆé’©å­ï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç§è„šæœ¬ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘æ—¶ä¼šè°ƒç”¨é’©å­å¹¶æ‰§è¡Œé’©å­æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p></blockquote><ol><li><p>åˆ›å»ºè¿›å…¥è‡ªå·±æƒ³åˆå§‹åŒ–gitä»“åº“çš„ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/repo</span><br><span class="line">cd /home/repo</span><br><span class="line">git init --bare hexo-blog.git    #åˆ›å»ºä¸€ä¸ªåä¸ºblogçš„ä»“åº“ï¼Œ--bareå‚æ•°ä¸ºåˆ›å»ºè£¸åº“</span><br></pre></td></tr></table></figure></li><li><p>è¿›å…¥<code>/home/repo/hexo-blog.git/hooks</code>ç›®å½•ï¼Œæ‰¾åˆ°<code>post-receive</code>æ–‡ä»¶ï¼ˆè‹¥æ— åˆ™åˆ›å»ºï¼‰ï¼Œåœ¨é‡Œé¢è¾“å…¥<code>git --work-tree=/home/blog/hexo --git-dir=/home/repo/hexo-blog.git checkout -f</code>ï¼ˆwork-treeä¸ºhexoçš„éƒ¨ç½²ç›®å½•ï¼Œgit-dirä¸ºGitä»“åº“çš„ç›®å½•ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /home/repo/hexo-blog.git/hooks</span><br><span class="line">vim post-receive</span><br><span class="line">mkdir -p /home/blog/hexo</span><br></pre></td></tr></table></figure></li><li><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>post-receive</code>é’©å­ï¼Œå½“Gitæ”¶åˆ°pushè¯·æ±‚çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªé’©å­ã€‚è¿™ä¸ªé’©å­ä¸­æ·»åŠ çš„è¯­å¥æ‰§è¡Œçš„æ“ä½œä¸ºï¼šåˆ é™¤hexoéƒ¨ç½²ç›®å½•ä¸­åŸæœ‰çš„æ–‡ä»¶ï¼Œç„¶åå°†Gitä»“åº“ä¸­çš„å†…å®¹cloneè‡³hexoéƒ¨ç½²ç›®å½•ä¸‹ã€‚è¿™æ ·æˆ‘ä»¬åœ¨æœ¬åœ°æ›´æ–°åšå®¢å¹¶ä¸”æ‰§è¡Œéƒ¨ç½²å‘½ä»¤åï¼Œç½‘é¡µæ–‡ä»¶ä¼šè¢«pushè‡³æœåŠ¡å™¨çš„Gitä»“åº“å†…ï¼Œé’©å­æ–‡ä»¶åˆ™ä¼šå°†Gitä»“åº“å†…çš„ç½‘é¡µæ–‡ä»¶å¤åˆ¶åˆ°hexoéƒ¨ç½²ç›®å½•ä¸‹ï¼Œä»è€Œå®ç°è‡ªåŠ¨éƒ¨ç½²åŠŸèƒ½ã€‚</p></li><li><p>ä¸ºé’©å­æ–‡ä»¶åŠGitä»“åº“ç›®å½•é…ç½®æƒé™ã€‚è¿™é‡Œéœ€è¦å°†æˆ‘ä»¬åˆ›å»ºçš„ä»“åº“åŠéƒ¨ç½²ç›®å½•çš„æ‰€æœ‰æƒç§»äº¤ç»™gitç”¨æˆ·ï¼Œå› ä¸ºlinuxä¸‹åˆ›å»ºæ–‡ä»¶æ—¶é»˜è®¤åªæœ‰æ‹¥æœ‰è€…ï¼ˆå³åˆ›å»ºè€…ï¼‰æ‰å…·æœ‰è¯»å†™æƒé™ï¼Œè€ŒGitè¿›è¡Œpushæ“ä½œæ—¶ç™»å½•çš„ç”¨æˆ·ä¸ºgitç”¨æˆ·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /home/repo/hexo-blog.git/hooks/post-receive     #ä¸ºé’©å­æ–‡ä»¶æˆäºˆå¯æ‰§è¡Œæƒé™ï¼ˆ+xï¼‰</span><br><span class="line">chown -R git:git /home/repo     #å°†ä»“åº“ç›®å½•çš„æ‰€æœ‰æƒç§»äº¤ç»™gitç”¨æˆ·</span><br><span class="line">chown -R git:git /home/blog/hexo     #å°†hexoéƒ¨ç½²ç›®å½•çš„æ‰€æœ‰æƒç§»äº¤ç»™gitç”¨æˆ·</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æœ¬åœ°Hexoçš„é…ç½®æ–‡ä»¶_config.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">git@ä½ çš„å…¬ç½‘ip:/home/repo/hexo-blog.git</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1.Centos7ä½¿ç”¨yumå®‰è£…</span><br><span class="line">[root@luay ~]# yum -y install nginx</span><br><span class="line"></span><br><span class="line">2.ç¼–å†™hexoçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@luay ~]# vim /etc/nginx/conf.d/hexo.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    <span class="comment"># æœåŠ¡å™¨å…¬ç½‘IP</span></span><br><span class="line">    server_name 123.123.123.123;</span><br><span class="line">    <span class="comment"># é¡¹ç›®çš„éƒ¨ç½²åœ°å€</span></span><br><span class="line">    root /home/blog/hexo;</span><br><span class="line">    location /&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä»¥ä¸‹é…ç½®æ˜¯ç»‘å®šSSLè¯ä¹¦æ—¶ä½¿ç”¨çš„ï¼Œè‹¥åŸŸåæ²¡å¤‡æ¡ˆå°±å…ˆä¸å¡«ï¼Œä½¿ç”¨ä¸Šé¢çš„å°±è¡Œäº†</span></span><br><span class="line"><span class="comment"># listen 443 ssl;</span></span><br><span class="line">    <span class="comment"># è¯·å¡«å†™ç»‘å®šè¯ä¹¦çš„åŸŸå</span></span><br><span class="line">    <span class="comment"># server_name huochairener-blog.cn;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># éƒ¨ç½²sslä½¿ç”¨çš„å‚æ•°</span></span><br><span class="line">    <span class="comment"># if ($server_port !~ 443)&#123;</span></span><br><span class="line">    <span class="comment"># rewrite ^(/.*)$ https://$host$1 permanent;</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯·å¡«å†™è¯ä¹¦æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„</span></span><br><span class="line">    <span class="comment"># ssl_certificate /xx/xx/xxxx.crt;</span></span><br><span class="line">    <span class="comment"># è¯·å¡«å†™ç§é’¥æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„</span></span><br><span class="line">    <span class="comment"># ssl_certificate_key /xx/xx/xxx.key;</span></span><br><span class="line">    <span class="comment"># ssl_session_timeout 10m;</span></span><br><span class="line">    <span class="comment"># è¯·æŒ‰ç…§ä»¥ä¸‹åè®®é…ç½®</span></span><br><span class="line">    <span class="comment"># ssl_protocols TLSv1.2 TLSv1.3;</span></span><br><span class="line">    <span class="comment"># è¯·æŒ‰ç…§ä»¥ä¸‹å¥—ä»¶é…ç½®ï¼Œé…ç½®åŠ å¯†å¥—ä»¶ï¼Œå†™æ³•éµå¾ª openssl æ ‡å‡†ã€‚</span></span><br><span class="line">    <span class="comment"># ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span></span><br><span class="line">    <span class="comment"># ssl_prefer_server_ciphers on;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.æ£€æŸ¥nginxè¯­æ³•</span><br><span class="line">nginx -t  <span class="comment"># ä¸€èˆ¬æŠ¥é”™ä¿¡æ¯å¾ˆæ˜ç¡®ï¼Œç¿»è¯‘ä¸€ä¸‹å°±è¡Œã€‚è‹¥ä¸çŸ¥é“å°±æŸ¥æŸ¥ï¼Œæˆ–è€…çœ‹çœ‹æ–‡ä»¶é‡Œæœ‰æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼</span></span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨nginx</span><br><span class="line">[root@luay ~]# systemctl start nginx</span><br><span class="line"></span><br><span class="line">5.è®¿é—®ç½‘ç«™</span><br><span class="line">ä½¿ç”¨http://ä½ çš„å…¬ç½‘ip        </span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹è¾“å…¥ä½ çš„å…¬ç½‘ipåœ°å€</span><br></pre></td></tr></table></figure><p>nginxå¸¸ç”¨å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop    # åœæ­¢nginx</span><br><span class="line">nginx -s reload  # é‡è½½nginxï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åä½¿ç”¨</span><br><span class="line">nginx -t  # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æœ‰é”™è¯¯ï¼Œå¸¸ç”¨äºä¿®æ”¹é…ç½®æ–‡ä»¶åçš„æ£€æŸ¥</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¿™é‡Œä»¥è…¾è®¯äº‘æœåŠ¡å™¨ä¸ºä¾‹</summary>
    
    
    
    <category term="hexo" scheme="https://lukme.top/categories/hexo/"/>
    
    
    <category term="hexo" scheme="https://lukme.top/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>zabbixå¾®ä¿¡å‘Šè­¦</title>
    <link href="https://lukme.top/posts/96fcc157.html"/>
    <id>https://lukme.top/posts/96fcc157.html</id>
    <published>2024-10-06T13:55:29.000Z</published>
    <updated>2024-10-06T14:17:32.936Z</updated>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.work.weixin.qq.com/document/path/99110">https://developer.work.weixin.qq.com/document/path/99110</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç»ˆç«¯æŸä¸ªç¾¤ç»„æ·»åŠ æœºå™¨äººä¹‹åï¼Œåˆ›å»ºè€…å¯ä»¥åœ¨æœºå™¨äººè¯¦æƒ…é¡µçœ‹åˆ°è¯¥æœºå™¨äººç‰¹æœ‰çš„webhookurlã€‚å¼€å‘è€…å¯ä»¥æŒ‰ä»¥ä¸‹è¯´æ˜å‘è¿™ä¸ªåœ°å€å‘èµ·HTTP POST è¯·æ±‚ï¼Œå³å¯å®ç°ç»™è¯¥ç¾¤ç»„å‘é€æ¶ˆæ¯</span><br><span class="line"><span class="comment">#å‡è®¾webhookæ˜¯   https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=693a91f6-7xxx-4bc4-97a0-0ec2sifa5aaa</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨curlå‘½ä»¤å‘æ¶ˆæ¯</span></span><br><span class="line">curl <span class="string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=693axxx6-7aoc-4bc4-97a0-0ec2sifa5aaa&#x27;</span> \</span><br><span class="line">   -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">   -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">   &#123;</span></span><br><span class="line"><span class="string">    &quot;msgtype&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">    &quot;text&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;content&quot;: &quot;hello world&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">   &#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ–‡æœ¬ç±»å‹</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;msgtype&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¹¿å·ä»Šæ—¥å¤©æ°”ï¼š29åº¦ï¼Œå¤§éƒ¨åˆ†å¤šäº‘ï¼Œé™é›¨æ¦‚ç‡ï¼š60%&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mentioned_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;wangqing&quot;</span><span class="punctuation">,</span><span class="string">&quot;@all&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mentioned_mobile_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;13800001111&quot;</span><span class="punctuation">,</span><span class="string">&quot;@all&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>msgtype</td><td>æ˜¯</td><td>æ¶ˆæ¯ç±»å‹ï¼Œæ­¤æ—¶å›ºå®šä¸ºtext</td></tr><tr><td>content</td><td>æ˜¯</td><td>æ–‡æœ¬å†…å®¹ï¼Œæœ€é•¿ä¸è¶…è¿‡2048ä¸ªå­—èŠ‚ï¼Œå¿…é¡»æ˜¯utf8ç¼–ç </td></tr><tr><td>mentioned_list</td><td>å¦</td><td>useridçš„åˆ—è¡¨ï¼Œæé†’ç¾¤ä¸­çš„æŒ‡å®šæˆå‘˜(@æŸä¸ªæˆå‘˜)ï¼Œ@allè¡¨ç¤ºæé†’æ‰€æœ‰äººï¼Œå¦‚æœå¼€å‘è€…è·å–ä¸åˆ°useridï¼Œå¯ä»¥ä½¿ç”¨mentioned_mobile_list</td></tr><tr><td>mentioned_mobile_list</td><td>å¦</td><td>æ‰‹æœºå·åˆ—è¡¨ï¼Œæé†’æ‰‹æœºå·å¯¹åº”çš„ç¾¤æˆå‘˜(@æŸä¸ªæˆå‘˜)ï¼Œ@allè¡¨ç¤ºæé†’æ‰€æœ‰äºº</td></tr></tbody></table></div><h3 id="ä½¿ç”¨pythonè°ƒç”¨æ¥å£"><a href="#ä½¿ç”¨pythonè°ƒç”¨æ¥å£" class="headerlink" title="ä½¿ç”¨pythonè°ƒç”¨æ¥å£"></a>ä½¿ç”¨pythonè°ƒç”¨æ¥å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£…pythonç¯å¢ƒ</span></span><br><span class="line">[root@zabbix5-server alertscripts]# yum install -y python36-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£…Pythonçš„requestsæ¨¡å—</span></span><br><span class="line">[root@zabbix5-server alertscripts]# pip3 install requests -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ç¼–å†™pythonè„šæœ¬</span></span><br><span class="line">[root@web01 ~]# vim wechat.py</span><br><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>&#125;</span><br><span class="line">api_url = <span class="string">&quot;webhookåœ°å€&quot;</span></span><br><span class="line">def msg(text):</span><br><span class="line">json_text= &#123;</span><br><span class="line"><span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line"><span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;content&quot;</span>: text</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(requests.post(api_url,json.dumps(json_text),headers=headers).content)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">text = sys.argv[1]</span><br><span class="line">msg(text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å°†è„šæœ¬æ”¾åœ¨/usr/lib/zabbix/alertscripts</span></span><br><span class="line">[root@zabbix5-server ~]# vim /usr/lib/zabbix/alertscripts/wechat.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æˆæƒæ‰§è¡Œæƒé™</span></span><br><span class="line">[root@zabbix5-server ~]# <span class="built_in">chmod</span> +x /usr/lib/zabbix/alertscripts/wechat.py</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ æŠ¥è­¦åª’ä»‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#webç«¯é…ç½®</span></span><br><span class="line">ç®¡ç†&gt;æŠ¥è­¦åª’ä»‹ç±»å‹&gt;åˆ›å»ºåª’ä½“ç±»å‹</span><br><span class="line"></span><br><span class="line">è„šæœ¬å‚æ•°ï¼š&#123;ALERT.MESSAGE&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722843581583.png" alt="QQ_1722843581583"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722843667085.png" alt="QQ_1722843667085"></p><p><strong>æ·»åŠ åŠ¨ä½œ</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722843783104.png" alt="QQ_1722843783104"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722843908351.png" alt="QQ_1722843908351"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722844043228.png" alt="QQ_1722844043228"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722844217316.png" alt="QQ_1722844217316"></p><p><strong>æ·»åŠ æ”¶ä»¶äºº</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722844455876.png" alt="QQ_1722844455876"></p><h3 id="ä½¿ç”¨shellè„šæœ¬è°ƒç”¨æ¥å£"><a href="#ä½¿ç”¨shellè„šæœ¬è°ƒç”¨æ¥å£" class="headerlink" title="ä½¿ç”¨shellè„šæœ¬è°ƒç”¨æ¥å£"></a>ä½¿ç”¨shellè„šæœ¬è°ƒç”¨æ¥å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ç¼–å†™shellè„šæœ¬åœ¨æŒ‡å®šç›®å½•ä¸‹</span></span><br><span class="line">[root@zabbix5-server alertscripts]# vim /usr/lib/zabbix/alertscripts/wechat.sh</span><br><span class="line">[root@zabbix5-server alertscripts]# <span class="built_in">cat</span> wechat.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">web_hook=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=96462ac7-122d-4f51-946e-694a4c11d2ed&quot;</span></span><br><span class="line">headers=<span class="string">&quot;Content-Type: application/json&quot;</span></span><br><span class="line">json_file=<span class="string">&quot;/usr/lib/zabbix/alertscripts/msg.json&quot;</span></span><br><span class="line">/bin/cat &gt; <span class="variable">$&#123;json_file&#125;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">&quot;msgtype&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">&quot;text&quot;: &#123;</span></span><br><span class="line"><span class="string">&quot;content&quot;: &quot;$1&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">/usr/bin/curl <span class="string">&quot;<span class="variable">$&#123;web_hook&#125;</span>&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;<span class="variable">$&#123;headers&#125;</span>&quot;</span> \</span><br><span class="line">-d <span class="string">&quot;<span class="subst">$(cat $&#123;json_file&#125;)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.åˆ›å»ºä¸€ä¸ªjsonæ–‡ä»¶</span></span><br><span class="line">[root@zabbix5 ~]#vim /usr/lib/zabbix/alertscripts/msg.json</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line"><span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;content&quot;</span>: <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æˆæƒæ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/lib/zabbix/alertscripts/wechat.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æ›´æ”¹å±ä¸»å±ç»„ï¼ˆzabbixå¯åŠ¨ç”¨æˆ·æ˜¯zabbixï¼Œä¸æ”¹åˆ™æ²¡æœ‰æƒé™è°ƒç”¨ï¼‰</span></span><br><span class="line"><span class="built_in">chown</span> zabbix.zabbix /usr/lib/zabbix/alertscripts/wechat.sh</span><br><span class="line"><span class="built_in">chown</span> zabbix.zabbix /usr/lib/zabbix/alertscripts/msg.json</span><br></pre></td></tr></table></figure><p><strong>webç•Œé¢æ·»åŠ æŠ¥è­¦ç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç®¡ç†&gt;æŠ¥è­¦åª’ä»‹ç±»å‹&gt;åˆ›å»ºåª’ä»‹ç±»å‹</span><br><span class="line"></span><br><span class="line">è„šæœ¬å‚æ•°ï¼š&#123;ALERT.MESSAGE&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722845658579.png" alt="QQ_1722845658579"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722845826346.png" alt="QQ_1722845826346"></p><p><strong>æ·»åŠ åŠ¨ä½œ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®&gt;åŠ¨ä½œ&gt;åˆ›å»ºåŠ¨ä½œ</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722845872056.png" alt="QQ_1722845872056"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722846012723.png" alt="QQ_1722846012723"></p><p><strong>æ·»åŠ ä¿å­˜</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722846086534.png" alt="QQ_1722846086534"></p><p><strong>æ·»åŠ æ¥æ”¶äºº</strong></p><p><code>æ·»åŠ å®Œè®°å¾—ç‚¹æ›´æ–°</code></p><p><img src="https://cos.lukme.top/Pic/QQ_1722846168458.png" alt="QQ_1722846168458"></p>]]></content>
    
    
    <summary type="html">æ•™ä½ å®ç°zabbixç›‘æ§æœºå™¨ï¼Œå¾®ä¿¡æœºå™¨äººå‘Šè­¦é€šçŸ¥</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>filebeatæ¨¡å—åŒ–åˆ†ææ—¥å¿—</title>
    <link href="https://lukme.top/posts/907ae385.html"/>
    <id>https://lukme.top/posts/907ae385.html</id>
    <published>2024-10-04T17:19:53.000Z</published>
    <updated>2024-10-20T01:43:33.215Z</updated>
    
    <content type="html"><![CDATA[<h2 id="filebeaté‡‡é›†dockeræ—¥å¿—"><a href="#filebeaté‡‡é›†dockeræ—¥å¿—" class="headerlink" title="filebeaté‡‡é›†dockeræ—¥å¿—"></a>filebeaté‡‡é›†dockeræ—¥å¿—</h2><p><strong>1.è¿è¡Œä¸€ä¸ªnginxçš„dockerå®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# docker run --name nginx -d -p 88:80 nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨ï¼šdockerçš„å®‰è£…ä¸å†èµ˜è¿°</span></span><br></pre></td></tr></table></figure><p><strong>2.è®¿é—®æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# curl 10.0.0.211:88</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦è¿”å›nginxç•Œé¢ï¼Œæ³¨æ„ç«¯å£æ˜¯å¦æœ‰å†²çª</span></span><br></pre></td></tr></table></figure><p><strong>3.ç¼–å†™filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/08-docker-log.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: docker</span><br><span class="line">  tags: <span class="string">&#x27;docker&#x27;</span></span><br><span class="line">  <span class="comment">#ä¸‹é¢å†™å®¹å™¨çš„idå·ï¼Œå†™*ä»£è¡¨æ”¶é›†æ‰€æœ‰å®¹å™¨æ—¥å¿—</span></span><br><span class="line">  containers.ids:   </span><br><span class="line">  - <span class="string">&quot;*&quot;</span></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>]</span><br><span class="line">  indices:</span><br><span class="line">    - index: <span class="string">&quot;filebeat-docker-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;docker&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;filebeat&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;filebeat*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]# filebeat -e -c /etc/filebeat/08-docker-log.yaml</span><br></pre></td></tr></table></figure><p><strong>3.è®¿é—®nginxä½¿ä¹‹äº§ç”Ÿæ—¥å¿—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# curl 10.0.0.211:88</span><br><span class="line"><span class="comment">#dockerå·²ç»æ˜ å°„æœ¬åœ°88ç«¯å£</span></span><br></pre></td></tr></table></figure><h2 id="filebeatæ¨¡å—"><a href="#filebeatæ¨¡å—" class="headerlink" title="filebeatæ¨¡å—"></a>filebeatæ¨¡å—</h2><p>æ¨¡å—æ˜¯filebeatå†…ç½®çš„ä¸€äº›ä¸­é—´ä»¶æ—¥å¿—ç›‘æ§æ–¹æ¡ˆï¼Œæ¯”å¦‚å¸¸è§çš„nginxï¼Œtomcatï¼Œmysqlï¼Œzookeeperç­‰æ—¥å¿—ç›‘æ§ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filebeatå†…ç½®æ¨¡å—åœ¨ /etc/filebeat/modules.d/ä¸‹ã€‚</span><br><span class="line">è¢«ç¦ç”¨çš„æ¨¡å—åç¼€å¸¦.disabled</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ¨¡å—åˆ—è¡¨</span></span><br><span class="line">[root@elk01:2 ~]#  filebeat modules list</span><br></pre></td></tr></table></figure><p><strong>å¯ç¦ç”¨æ¨¡å—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# filebeat modules <span class="built_in">enable</span> nginx tomcat</span><br><span class="line"></span><br><span class="line">[root@elk01:2 ~]# filebeat modules <span class="built_in">disable</span> tomcat</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å—åˆ†ænginxè®¿é—®æ—¥å¿—"><a href="#æ¨¡å—åˆ†ænginxè®¿é—®æ—¥å¿—" class="headerlink" title="æ¨¡å—åˆ†ænginxè®¿é—®æ—¥å¿—"></a>æ¨¡å—åˆ†ænginxè®¿é—®æ—¥å¿—</h2><h3 id="å‰æå‡†å¤‡"><a href="#å‰æå‡†å¤‡" class="headerlink" title="å‰æå‡†å¤‡"></a>å‰æå‡†å¤‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.é˜²æ­¢ç´¢å¼•å†²çªï¼Œåˆ é™¤æ‰€æœ‰ç´¢å¼•å’Œç´¢å¼•æ¨¡å¼</span><br><span class="line">2.è¿˜åŸnginxæ—¥å¿—æ ¼å¼ï¼ˆå¦‚æœä¹‹å‰ä½ åšè¿‡nginxè¾“å‡ºæ ¼å¼ä¸ºjsonæ ¼å¼çš„è¯å°±å°†nginxé…ç½®æ–‡ä»¶è¿˜åŸä¸ºåŸæ ¼å¼ï¼‰</span><br><span class="line">3.æ£€æŸ¥nginxæ˜¯å¦å¯ç”¨ï¼Œé…ç½®æ–‡ä»¶æ˜¯å¦OKï¼ˆnginx -tï¼‰ï¼Œå¯ç”¨nginxæ¨¡å—ï¼ˆfilebeat modules <span class="built_in">enable</span> nginxï¼‰</span><br><span class="line">4.å¦‚æœä½ çš„nginxæ—¥å¿—æ–‡ä»¶ä¸åœ¨é»˜è®¤çš„ç›®å½•åˆ™ä¿®æ”¹å®ä¾‹nginxæ–‡ä»¶ï¼Œå¦‚æœé»˜è®¤ç›®å½•åˆ™è·³è¿‡</span><br><span class="line">[root@elk01:2 ~]#  vim /etc/filebeat/modules.d/nginx.yml </span><br><span class="line">Â·Â·Â·#ä¿®æ”¹ä½ çš„æ—¥å¿—æ–‡ä»¶ç›®å½•</span><br><span class="line">var.paths: [<span class="string">&quot;/yourpath/nginx/access.log*&quot;</span>]</span><br><span class="line">Â·Â·Â·</span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶"><a href="#ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶" class="headerlink" title="ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶"></a>ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/10-nginx-modules.yaml </span><br><span class="line"><span class="comment"># é…ç½®filebeatçš„å¯ç”¨æ¨¡å—</span></span><br><span class="line">filebeat.config.modules:</span><br><span class="line">  <span class="comment"># é»˜è®¤ä¼šå»æ‰¾filebeatå®‰è£…ç›®å½•ä¸‹çš„&quot;modules.d&quot;æ‰€æœ‰ä»¥&quot;.yml&quot;ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">  path: <span class="variable">$&#123;path.config&#125;</span>/modules.d/*.yml</span><br><span class="line">  <span class="comment"># æ˜¯å¦æ”¯æŒçƒ­åŠ è½½</span></span><br><span class="line">  reload.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>] </span><br><span class="line">  index: <span class="string">&quot;filebeat-nginx-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;filebeat-nginx&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;filebeat-nginx*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/10-nginx-modules.yaml</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241004102923489.png" alt="image-20241004102923489"></p><blockquote><p>æ—¥åä¾¿å¯ä»¥åœ¨  èœå•æ â€”&gt;Discoveré‡ŒæŸ¥è¯¢åˆ†ænginxæ—¥å¿—  å¦‚ä¸‹å›¾</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241004103225591.png" alt="image-20241004103225591"></p><h3 id="ç»Ÿè®¡ç½‘ç«™æ—¥PVé‡"><a href="#ç»Ÿè®¡ç½‘ç«™æ—¥PVé‡" class="headerlink" title="ç»Ÿè®¡ç½‘ç«™æ—¥PVé‡"></a>ç»Ÿè®¡ç½‘ç«™æ—¥PVé‡</h3><blockquote><p>å¯ä»¥ç†è§£ä¸º  ä¸€ä¸ªé¡µé¢å°±æ˜¯ä¸€æ¡PVï¼Œfilebeatæ˜¯æŒ‰è¡Œç»Ÿè®¡ï¼Œnginxçš„æ¯ä¸ªè®¿é—®è®°å½•éƒ½ä¸ºä¸€è¡Œï¼Œä»¥è®¡æ•°æ–¹å¼ç»Ÿè®¡ä¸ºæ—¥PV</p><p>ç‚¹å‡»ä¿å­˜å³å¯ä¿å­˜å¯è§†åŒ–åº“</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241004103908465.png" alt="image-20241004103908465"></p><h3 id="ç»Ÿè®¡ç½‘ç«™æ—¥UV"><a href="#ç»Ÿè®¡ç½‘ç«™æ—¥UV" class="headerlink" title="ç»Ÿè®¡ç½‘ç«™æ—¥UV"></a>ç»Ÿè®¡ç½‘ç«™æ—¥UV</h3><blockquote><p>è¿™ä¸ªç»Ÿè®¡ä¸å¤ªå‡†ç¡®ï¼Œè·å–çš„ipæ˜¯æ—¥å¿—é‡Œæ¯è¡Œç¬¬ä¸€ä¸ªçš„ipï¼Œè¿™ä¸ªipå…¶å®æ˜¯è´Ÿè½½å‡è¡¡çš„ipï¼Œå¦‚æœæƒ³è¦è·å–æ¯ä¸ªç”¨æˆ·çœŸå®ipï¼Œnginxé…ç½®æ–‡ä»¶éœ€è¦è®¾ç½®è·å–ç”¨æˆ·çœŸå®ipæ‰ç®—æ˜¯æ—¥UVé‡ï¼Œä¿å­˜uvåº“</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241004111335927.png" alt="image-20241004111335927"></p><h3 id="ç»Ÿè®¡å¸¦å®½"><a href="#ç»Ÿè®¡å¸¦å®½" class="headerlink" title="ç»Ÿè®¡å¸¦å®½"></a>ç»Ÿè®¡å¸¦å®½</h3><p><img src="https://cos.lukme.top/Pic/image-20241004112012078.png" alt="image-20241004112012078"></p><p><img src="https://cos.lukme.top/Pic/image-20241004112552478.png" alt="image-20241004112552478"></p><h3 id="ç»Ÿè®¡è®¾å¤‡ç±»å‹"><a href="#ç»Ÿè®¡è®¾å¤‡ç±»å‹" class="headerlink" title="ç»Ÿè®¡è®¾å¤‡ç±»å‹"></a>ç»Ÿè®¡è®¾å¤‡ç±»å‹</h3><p><img src="https://cos.lukme.top/Pic/image-20241004112842696.png" alt="image-20241004112842696"></p><h3 id="ç»Ÿè®¡è®¾å¤‡æ“ä½œç³»ç»Ÿ"><a href="#ç»Ÿè®¡è®¾å¤‡æ“ä½œç³»ç»Ÿ" class="headerlink" title="ç»Ÿè®¡è®¾å¤‡æ“ä½œç³»ç»Ÿ"></a>ç»Ÿè®¡è®¾å¤‡æ“ä½œç³»ç»Ÿ</h3><p><img src="https://cos.lukme.top/Pic/image-20241004120352348.png" alt="image-20241004120352348"></p><h3 id="å…¨çƒæµé‡ç»Ÿè®¡"><a href="#å…¨çƒæµé‡ç»Ÿè®¡" class="headerlink" title="å…¨çƒæµé‡ç»Ÿè®¡"></a>å…¨çƒæµé‡ç»Ÿè®¡</h3><p><img src="https://cos.lukme.top/Pic/image-20241004115735265.png" alt="image-20241004115735265"></p><p><img src="https://cos.lukme.top/Pic/global-traffic.gif" alt="recording"></p><h3 id="åˆ›å»ºä»ªè¡¨æ¿"><a href="#åˆ›å»ºä»ªè¡¨æ¿" class="headerlink" title="åˆ›å»ºä»ªè¡¨æ¿"></a>åˆ›å»ºä»ªè¡¨æ¿</h3><blockquote><p>èœå•æ â€”&gt;Dashboard   æ–°å»ºä»ªè¡¨æ¿ï¼Œæ•°æ®ä»å‰é¢ä¿å­˜çš„åº“ä¸­æ·»åŠ </p><p>åˆ·æ–°å¯æ˜¾ç¤ºåœ¨çº¿å®æ—¶æ•°æ®</p></blockquote><p><img src="https://cos.lukme.top/Pic/image-20241004121524063.png" alt="image-20241004121524063"></p><h2 id="filebeatçš„å¤šè¡Œå¤„ç†"><a href="#filebeatçš„å¤šè¡Œå¤„ç†" class="headerlink" title="filebeatçš„å¤šè¡Œå¤„ç†"></a>filebeatçš„å¤šè¡Œå¤„ç†</h2><blockquote><p>filestreamæ–‡ä»¶æµä¹Ÿæ˜¯é‡‡é›†æ–‡ä»¶çš„ï¼Œlogçš„æ›¿ä»£</p></blockquote><p><a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/multiline-examples.html">å®˜ç½‘</a></p><p><strong>multilineçš„countç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/11-filestream_multiline.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: filestream</span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/student.info</span><br><span class="line">  parsers:</span><br><span class="line">  - multiline:</span><br><span class="line">      <span class="built_in">type</span>: count</span><br><span class="line">      count_lines: 4</span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Š</span></span><br><span class="line">      <span class="comment"># typeæŒ‡å®šç±»å‹ï¼Œæœ‰æ•ˆå€¼ä¸º: patternå’Œcount</span></span><br><span class="line">      <span class="comment">#  pattern:      åŸºäºæ­£åˆ™åŒ¹é…äº‹ä»¶ã€‚</span></span><br><span class="line">      <span class="comment">#  count:         å°†å‡ è¡Œæ•°æ®ä½œä¸ºä¸€ä¸ªäº‹ä»¶</span></span><br><span class="line">      <span class="comment">#count_lines:  å°†æŒ‡å®šçš„è¡Œæ•°åˆå¹¶ä¸ºä¸€ä¸ªäº‹ä»¶</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">#æç¤º ï¼šcountç±»å‹è¿™ç§ï¼Œéœ€è¦è¢«æ”¶é›†çš„ä¿¡æ¯æ ¼å¼æ˜¯æœ‰è§„å¾‹çš„</span></span><br><span class="line">ä¾‹å¦‚ï¼š   count: 2  ï¼ˆæ•°æ®éƒ½æ˜¯4è¡Œ4è¡Œçš„æˆ–Nè¡ŒNè¡Œçš„ï¼‰</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /tmp/student.info </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hobby&quot;</span>: [<span class="string">&quot;å­¦ä¹ &quot;</span>,<span class="string">&quot;è·‘æ­¥&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;æå››&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hobby&quot;</span>: [<span class="string">&quot;å­¦ä¹ &quot;</span>,<span class="string">&quot;çœ‹ä¹¦&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> [root@elk01:0 ~]# filebeat -e -c /etc/filebeat/11-filestream_multiline-.yaml</span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 384,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/student.info&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;flags&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;multiline&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;&#123;\n  \&quot;name\&quot;: \&quot;å¼ ä¸‰\&quot;,\n  \&quot;hobby\&quot;: [\&quot;å­¦ä¹ \&quot;,\&quot;è·‘æ­¥\&quot;]\n&#125;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filestream&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#å°†å¤šè¡Œæ•°æ®é‡‡é›†ä¸ºä¸€è¡Œï¼Œä½†å¿…é¡»æ˜¯æœ‰è§„å¾‹çš„ï¼Œé‡‡é›†çš„æ˜¯ä¸Šé¢æ–‡ä»¶æ¯4è¡Œä¸ºä¸€ç»„æ•°æ®</span></span><br></pre></td></tr></table></figure><p><strong>multilineçš„patternç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/12-filestream_multiline_pattern.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: filestream</span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/student.info</span><br><span class="line">  parsers:</span><br><span class="line">  - multiline:</span><br><span class="line">      <span class="built_in">type</span>: pattern</span><br><span class="line">      pattern: <span class="string">&#x27;^\&#123;&#x27;</span></span><br><span class="line">      negate: <span class="literal">true</span></span><br><span class="line">      match: after</span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Š</span></span><br><span class="line">patternï¼š <span class="string">&#x27;^\&#123;&#x27;</span> åŒ¹é…ä»¥&#123;å¼€å¤´çš„</span><br><span class="line">negate: åŒ¹é…è§„åˆ™</span><br><span class="line">match: åŒ¹é…è§„åˆ™   è§ä¸‹å›¾</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241004212526358.png" alt="image-20241004212526358"></p><h2 id="filebeaté‡‡é›†tomcatæ—¥å¿—"><a href="#filebeaté‡‡é›†tomcatæ—¥å¿—" class="headerlink" title="filebeaté‡‡é›†tomcatæ—¥å¿—"></a>filebeaté‡‡é›†tomcatæ—¥å¿—</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.éƒ¨ç½²tomcat</span><br><span class="line">[root@elk01:0 app]# wget https://dlcdn.apache.org/tomcat/tomcat-10/v10.1.30/bin/apache-tomcat-10.1.30.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹å®‰è£…tomcat(æå‰åˆ›å»ºå®‰è£…ç›®å½•)</span><br><span class="line">[root@elk01:0 app]# tar xf apache-tomcat-10.1.30.tar.gz -C /app</span><br><span class="line">[root@elk01:0 app]# <span class="built_in">ln</span> -s /app/apache-tomcat-10.1.30/ /app/tomcat</span><br><span class="line"></span><br><span class="line">3.é…ç½®tomatoçš„jdkç¯å¢ƒï¼Œä½¿ç”¨elasticsearchçš„jdkå³å¯ï¼ŒæŸ¥çœ‹javaç‰ˆæœ¬</span><br><span class="line">[root@elk01:0 app]#  /usr/share/elasticsearch/jdk/bin/java --version</span><br><span class="line">openjdk 22.0.1 2024-04-16</span><br><span class="line">OpenJDK Runtime Environment (build 22.0.1+8-16)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 22.0.1+8-16, mixed mode, sharing)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:0 app]# <span class="built_in">cat</span> /etc/profile.d/jdk.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/share/elasticsearch/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:0 app]# <span class="built_in">source</span> /etc/profile.d/jdk.sh </span><br><span class="line">[root@elk01:0 app]# java --version</span><br><span class="line">openjdk 22.0.1 2024-04-16</span><br><span class="line">OpenJDK Runtime Environment (build 22.0.1+8-16)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 22.0.1+8-16, mixed mode, sharing)</span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨tomcat</span><br><span class="line">[root@elk01:0 app]# /app/tomcat/bin/startup.sh </span><br></pre></td></tr></table></figure><p><strong>ç¼–å†™filebeatå®ä¾‹</strong>   ä½¿ç”¨tomcaté‡‡é›†æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1.å¯ç”¨tomcatæ¨¡å—</span><br><span class="line">[root@elk01:0 app]# filebeat modules <span class="built_in">enable</span> tomcat</span><br><span class="line"></span><br><span class="line">2.ä¿®æ”¹tomcatæ¨¡å—é‡Œæ—¥å¿—è·¯å¾„</span><br><span class="line">[root@elk01:0 app]# vim /etc/filebeat/modules.d/tomcat.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    <span class="comment">## é»˜è®¤æ˜¯udpç±»å‹ï¼Œæœ‰æ•ˆå€¼: udp,tcp,file</span></span><br><span class="line">    <span class="comment"># å½“ç±»å‹ä¸ºfileæ—¶ï¼Œä¸‹é¢å®šä¹‰çš„è·¯å¾„æ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class="line">    var.input: file</span><br><span class="line">    var.paths:</span><br><span class="line">      - /app/tomcat/logs/localhost_access_log.* </span><br><span class="line">Â·Â·Â·</span><br><span class="line"></span><br><span class="line">3.ç¼–å†™filebeatå®ä¾‹</span><br><span class="line">[root@elk01:0 app]# <span class="built_in">cat</span> /etc/filebeat/13.modules_tomcat.yaml </span><br><span class="line">filebeat.config.modules:</span><br><span class="line">  path: <span class="variable">$&#123;path.config&#125;</span>/modules.d/*.yml</span><br><span class="line">  reload.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">  elasticsearch:</span><br><span class="line">    hosts: </span><br><span class="line">    - <span class="string">&quot;http://10.0.0.211:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.212:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.213:9200&quot;</span></span><br><span class="line">    index: <span class="string">&quot;modules-tomcat-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;modules-tomcat&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;modules-tomcat*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 3</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/13.modules_tomcat.yaml </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡è®²è¿°äº†ä½¿ç”¨filebeatçš„å†…ç½®nginxæ¨¡å—æ¥åˆ†ænginxæ—¥å¿—ï¼Œå¹¶ç»Ÿè®¡å‡ºå›¾</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>filebeatå¤šå®ä¾‹</title>
    <link href="https://lukme.top/posts/29cf1fa5.html"/>
    <id>https://lukme.top/posts/29cf1fa5.html</id>
    <published>2024-10-04T17:16:01.000Z</published>
    <updated>2024-10-04T17:22:33.057Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æŒ‡å®šESçš„åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡"><a href="#æŒ‡å®šESçš„åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡" class="headerlink" title="æŒ‡å®šESçš„åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡"></a>æŒ‡å®šESçš„åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡</h2><p><strong>ESç´¢å¼•åç§°çš„åˆ›å»ºè§„èŒƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.åç§°æœ€å¥½è§åçŸ¥æ„ï¼Œæœ€å¥½å’Œä½ å®é™…å†™å…¥çš„ä¸šåŠ¡æœ‰å…³;</span><br><span class="line">2.åç§°ä¸è¦ä»¥<span class="string">&quot;.&quot;</span>å¼€å¤´ï¼Œä»¥<span class="string">&quot;.&quot;</span>å¼€å¤´å¤šç´¢å¼•æˆ‘ä»¬ç§°ä¹‹ä¸º<span class="string">&quot;éšè—ç´¢å¼•&quot;</span>;</span><br><span class="line">3.ä¸€èˆ¬éšè—ç´¢å¼•éƒ½æ˜¯ç»„ä»¶å»åˆ›å»ºï¼Œå»ºè®®ä¸è¦äººä¸ºåˆ›å»ºï¼Œé»˜è®¤kibanaå°±éšè—äº†ä»¥<span class="string">&quot;.&quot;</span>å¼€å¤´çš„ç´¢å¼•</span><br><span class="line">4.å­—ç¬¦æ”¯æŒå°å†™å­—æ¯ï¼Œæ•°å­—åŠè¿å­—ç¬¦(-)ï¼Œå’Œå†…ç½®ä¸€äº›å˜é‡æ¯”å¦‚<span class="string">&quot;%&#123;...&#125;&quot;</span>;</span><br><span class="line">5.ä¸è¦å‡ºç°ç‰¹æ®Šå­—ç¬¦;</span><br></pre></td></tr></table></figure><p><strong>1.é€šè¿‡ESçš„APIæ“ä½œå‰¯æœ¬å’Œåˆ†ç‰‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/school&#x27;</span> \</span><br><span class="line">-H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">-d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;settings&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;number_of_shards&quot;: 5,</span></span><br><span class="line"><span class="string">      &quot;number_of_replicas&quot;: 0</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºç´¢å¼•schoolï¼Œä¸»åˆ†ç‰‡5ï¼Œå‰¯æœ¬0</span></span><br></pre></td></tr></table></figure><p><strong>2.é€šè¿‡ç´¢å¼•æ¨¡æ¿æ“ä½œå‰¯æœ¬å’Œåˆ†ç‰‡</strong></p><blockquote><p>ç´¢å¼•æ¨¡æ¿ï¼šåˆ›å»ºç´¢å¼•æ—¶ï¼Œä¼šè‡ªåŠ¨åŒ¹é…æ˜¯å¦æœ‰å¯¹åº”çš„ç´¢å¼•æ¨¡æ¿ï¼Œè‹¥åŒ¹é…åˆ™æ ¹æ®ç´¢å¼•æ¨¡æ¿åˆ›å»ºã€‚</p></blockquote><p>â€‹    <strong>2.1åˆ›å»ºç´¢å¼•æ¨¡æ¿</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/_index_template/linux-school&#x27;</span> \</span><br><span class="line">-H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">-d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;template&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;settings&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;number_of_replicas&quot;: 0,</span></span><br><span class="line"><span class="string">      &quot;number_of_shards&quot;: 5</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;index_patterns&quot;: [</span></span><br><span class="line"><span class="string">    &quot;linux-school*&quot;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Šï¼šindex_patternsï¼Œè¿™é‡Œæ˜¯ç”¨äºåŒ¹é…ç´¢å¼•çš„ï¼Œå‡¡æ˜¯ç´¢å¼•æ˜¯linux-schoolçš„éƒ½ä¼šå…³è”æ­¤æ¨¡æ¿</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002233116968.png" alt="image-20241002233116968"></p><p><strong>éªŒè¯æ¨¡æ¿</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/linux-school-01&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;linux-school-01&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°åŠ è½½ç´¢å¼•ç®¡ç†ï¼Œå‘ç°åˆ›å»ºçš„ç´¢å¼•å…³è”äº†æ¨¡æ¿ï¼Œåˆ›å»ºäº†5ä¸ªåˆ†ç‰‡</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002233631403.png" alt="image-20241002233631403"></p><p>  2.2å›¾å½¢åŒ–åˆ›å»ºç´¢å¼•æ¨¡æ¿</p><p><img src="https://cos.lukme.top/Pic/index.gif" alt="recording"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">éªŒè¯ç´¢å¼•æ¨¡æ¿ï¼š</span><br><span class="line">[root@elk01:2 ~]# curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/student01&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;student01&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">ç´¢å¼•ç®¡ç†é‡ŒæŸ¥çœ‹æ–°åˆ›å»ºçš„student-01ç´¢å¼•æ˜¯å¦æ˜¯  3åˆ†ç‰‡ï¼Œ0å‰¯æœ¬ è‡ªç„¶æ˜¯OKçš„</span><br></pre></td></tr></table></figure><p><strong>3.é€šè¿‡filebeatç»„ä»¶æ“ä½œå‰¯æœ¬å’Œåˆ†ç‰‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/filebeat/06-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>] </span><br><span class="line">  <span class="comment"># è‡ªå®šä¹‰ç´¢å¼•åç§°  ,å‰ææ˜¯å…³é—­ç´¢å¼•çš„ç”Ÿå‘½å‘¨æœŸ  </span></span><br><span class="line">  index: <span class="string">&quot;test-filebeat-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#å…³é—­ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line"><span class="comment">#å®šä¹‰ç´¢å¼•æ¨¡æ¿çš„åç§°</span></span><br><span class="line">setup.template.name: <span class="string">&quot;test-filebeat&quot;</span></span><br><span class="line"><span class="comment">#å®šä¹‰æ¨¡æ¿çš„åŒ¹é…æ¨¡å¼</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;test-filebeat*&quot;</span></span><br><span class="line"><span class="comment">#è‹¥ç´¢å¼•æ¨¡å¼æ¨¡æ¿å­˜åœ¨ï¼Œæ˜¯å¦è¦†ç›–  </span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line"><span class="comment">#å®šä¹‰ç´¢å¼•æ¨¡æ¿è®¾ç½®</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¦‚ä¸‹ç´¢å¼•ç®¡ç†é‡Œä¾¿åˆ›å»ºäº†ä¸€ä¸ªåä¸ºtest-filebeatçš„ç´¢å¼•å’Œtest-filebeatçš„æ¨¡æ¿</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241003002143618.png" alt="image-20241003002143618"></p><blockquote><p>æç¤ºï¼šåŸºäºfilebeaté…ç½®çš„ESé›†ç¾¤çš„ç´¢å¼•åŠåˆ†ç‰‡ï¼Œå‰¯æœ¬ä¿¡æ¯ï¼Œæœ¬è´¨ä¸Šåˆ›å»ºæ—¶ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºESçš„httpè¯·æ±‚è¿›è¡Œåˆ›å»ºç´¢å¼•ã€‚</p></blockquote><h2 id="å¤šä¸ªintputå†™åˆ°ä¸åŒç´¢å¼•"><a href="#å¤šä¸ªintputå†™åˆ°ä¸åŒç´¢å¼•" class="headerlink" title="å¤šä¸ªintputå†™åˆ°ä¸åŒç´¢å¼•"></a>å¤šä¸ªintputå†™åˆ°ä¸åŒç´¢å¼•</h2><blockquote><p>éœ€æ±‚ï¼šå¤šä¸ªinputså†™å…¥åˆ°ESé›†ç¾¤é‡Œçš„ä¸åŒç´¢å¼•é‡Œ</p></blockquote><p><strong>1.ç¼–å†™é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/filebeat/07-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  <span class="comment">#ç»™äº‹ä»¶æ‰“æ ‡ç­¾ä¸ºfile</span></span><br><span class="line">  tags: <span class="string">&quot;file&quot;</span></span><br><span class="line">  paths:</span><br><span class="line">  - /tmp/test.log </span><br><span class="line">  </span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  tags: <span class="string">&quot;tcp&quot;</span></span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line">  </span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  tags: <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>]</span><br><span class="line">  <span class="comment">#index: &quot;student-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  <span class="comment">#å¤šä¸ªç´¢å¼•æ¨¡å¼</span></span><br><span class="line">  indices:</span><br><span class="line">    - index: <span class="string">&quot;study-file-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;file&quot;</span></span><br><span class="line">    - index: <span class="string">&quot;study-tcp-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;tcp&quot;</span></span><br><span class="line">    - index: <span class="string">&quot;study-nginx-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;nginx&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;study&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;study*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 8</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™æ¯ä¸ªäº‹ä»¶æ‰“ä¸Šä¸“å±æ ‡ç­¾ï¼Œç´¢å¼•é‡Œæ ¹æ®æ ‡ç­¾åˆ¤æ–­å†™å…¥å“ªé‡Œ</span></span><br></pre></td></tr></table></figure><p><strong>2.å¯åŠ¨filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/07-nginx-es.yaml </span><br></pre></td></tr></table></figure><p><strong>3.æµ‹è¯•tcpæ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;999&quot;</span> | nc 10.0.0.211 9000</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;666&quot;</span> | nc 10.0.0.211 9000</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;000&quot;</span> | nc 10.0.0.211 9000</span><br></pre></td></tr></table></figure><p><strong>4.æµ‹è¯•nginx</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> curl 10.0.0.211;<span class="built_in">sleep</span> 0.5;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>5.æµ‹è¯•æœ¬åœ°æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> â€˜hello world<span class="string">&#x27; &gt;/tmp/test.log</span></span><br></pre></td></tr></table></figure><p><strong>6.kibanaåŸºäºDiscoveråˆ†ææ•°æ®</strong></p><p>â€‹    6.1æŸ¥çœ‹ç´¢å¼•æ˜¯å¦éƒ½åˆ›å»ºå®Œæˆ</p><p><img src="https://cos.lukme.top/Pic/image-20241003114353521.png" alt="image-20241003114353521"></p><p>  6.2åˆ›å»ºç´¢å¼•æ¨¡å¼ä¸º     study*</p><p>  6.3 è¿›å…¥Discoverï¼Œé€‰æ‹©ç›¸åº”å­—æ®µï¼ŒæŸ¥çœ‹åˆ†ææ•°æ®</p><p><img src="https://cos.lukme.top/Pic/image-20241003114810243.png" alt="image-20241003114810243"></p><h2 id="æ§åˆ¶å¤šä¸ªinputæºçš„æ˜¯å¦å¯ç”¨"><a href="#æ§åˆ¶å¤šä¸ªinputæºçš„æ˜¯å¦å¯ç”¨" class="headerlink" title="æ§åˆ¶å¤šä¸ªinputæºçš„æ˜¯å¦å¯ç”¨"></a>æ§åˆ¶å¤šä¸ªinputæºçš„æ˜¯å¦å¯ç”¨</h2><blockquote><p>ä½¿ç”¨enabledï¼Œæ§åˆ¶inputså¤šä¸ªæºæ˜¯å¦å¯ç”¨ï¼Œtrue / false</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  <span class="comment"># é…ç½®è¯¥ä»£ç å—æ˜¯å¦æ‰§è¡Œï¼Œé»˜è®¤å€¼ä¸ºtrueï¼Œè‹¥ä¸æƒ³è¦åŠ è½½ï¼Œåˆ™è®¾ç½®ä¸ºfalseå³å¯</span></span><br><span class="line">  enabled: <span class="literal">false</span></span><br><span class="line">  tags: <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log*</span><br></pre></td></tr></table></figure><h2 id="filebeat-å¤šå®ä¾‹"><a href="#filebeat-å¤šå®ä¾‹" class="headerlink" title="filebeat å¤šå®ä¾‹"></a>filebeat å¤šå®ä¾‹</h2><p><strong>1.å¯åŠ¨ç¬¬ä¸€ä¸ªå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/02-tcp-console.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/02-tcp-console.yaml </span><br></pre></td></tr></table></figure><p><strong>2.å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/filebeat/04-nginx-console.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/04-nginx-console.yaml</span><br><span class="line">2024-10-03T12:15:44.735+0800    INFO    instance/beat.go:698    Home path: [/usr/share/filebeat] Config path: [/etc/filebeat] Data path: [/var/lib/filebeat] Logs path: [/var/log/filebeat] Hostfs Path: [/]</span><br><span class="line">2024-10-03T12:15:44.737+0800    ERROR   instance/beat.go:1027   Exiting: <span class="string">&#x27;data path already locked by another beat&#x27;</span>. Please make sure that multiple beats are not sharing the same data path (path.data).</span><br><span class="line">Exiting: data path already locked by another beat. Please make sure that multiple beats are not sharing the same data path (path.data).</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨ç¬¬äºŒä¸ªçš„å®ä¾‹æ—¶å€™æç¤ºï¼Œæ•°æ®ç›®å½•å·²ç»è¢«å…¶ä»–çš„å®ä¾‹é”å®šäº†ï¼ŒæŸ¥çœ‹/var/lib/filebeat/ç›®å½•é‡Œå­˜åœ¨ä¸€ä¸ªé”æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#ä¸èƒ½å…±ç”¨æ•°æ®ç›®å½•ï¼Œå½“é€€å‡ºè¿™ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªé”æ–‡ä»¶ä¹Ÿä¼šæ¶ˆå¤±</span></span><br><span class="line">[root@elk01:1 ~]# ll /var/lib/filebeat/</span><br><span class="line">-rw------- 1 root root    0 Oct  3 12:15 filebeat.lock</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹ï¼Œéœ€è¦æŒ‡å®šæ•°æ®ç›®å½•</span></span><br><span class="line">[root@elk01:2 ~]# filebeat -e -c /etc/filebeat/04-nginx-console.yaml --path.data /tmp/nginx-filebeat</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ€»ç»“:</span><br><span class="line">- 1.åŒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å¯åŠ¨å¤šä¸ªfilebeatå®ä¾‹ï¼Œä½†éœ€è¦æŒ‡å®šä¸åŒçš„æ•°æ®ç›®å½•;</span><br><span class="line">- 2.å¦‚æœfilebeaté‡‡é›†å¤šä¸ªæ•°æ®æºæœ‰ä¸¤ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Œè¦ä¹ˆé…ç½®å¤šä¸ªinputï¼Œè¦ä¹ˆä½¿ç”¨å¤šå®ä¾‹;</span><br><span class="line"></span><br><span class="line">å¦‚æœæ‰€æœ‰é…ç½®éƒ½æ”¾åœ¨åŒä¸€ä¸ªfilebeatä¼˜ç¼ºç‚¹:</span><br><span class="line">ä¼˜ç‚¹:</span><br><span class="line">éƒ¨ç½²æ–¹ä¾¿ï¼Œå¯åŠ¨ä¸€ä¸ªå®ä¾‹å³å¯ã€‚</span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">-1.å½“å¤šä¸ªinputä¸­æœ‰ä»»æ„ä¸€ä¸ªéœ€è¦ä¿®æ”¹æ—¶ï¼Œåœ¨é‡å¯æœŸé—´ï¼Œå…¶ä»–çš„inputéƒ½ä¼šå—åˆ°å½±å“ã€‚</span><br><span class="line">-2.å½“é…ç½®å¤šäº‹ï¼Œå¤šä¸ªinputé…ç½®æ¯”è¾ƒç¹ç;</span><br><span class="line"></span><br><span class="line">å¦‚æœæ‰€æœ‰é…ç½®éƒ½ä½¿ç”¨ä¸åŒfilebeatï¼Œå¤šå®ä¾‹ä¼˜ç¼ºç‚¹:</span><br><span class="line">ä¼˜ç‚¹:</span><br><span class="line">- 1.å®ç°äº†é…ç½®æ–‡ä»¶å’Œç¨‹åºçš„è§£è€¦ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯ä¸€ä¸ªå®ä¾‹æŒ‚æ‰ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–å®ä¾‹;</span><br><span class="line">- 2.é…ç½®ç®€å•</span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">- 1.éƒ¨ç½²ä¸æ–¹ä¾¿ï¼Œè¦åŒæ—¶éƒ¨ç½²å¤šä¸ªfilebeatï¼Œä¸”æ•°æ®ç›®å½•éœ€è¦å•ç‹¬æŒ‡å®šç»´æŠ¤;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡é€šè¿‡filebeatå†™å…¥ä¸åŒç´¢å¼•å’Œä½¿ç”¨ä¸åŒæ•°æ®ç›®å½•å®ç°å¤šå®ä¾‹</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>EFKæ¶æ„éƒ¨ç½²</title>
    <link href="https://lukme.top/posts/fab536ab.html"/>
    <id>https://lukme.top/posts/fab536ab.html</id>
    <published>2024-10-04T17:14:30.000Z</published>
    <updated>2024-10-04T17:22:33.063Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¯´æ˜ï¼šå…¨ç¯‡elasticæ˜¯åŸºäºUbuntuç³»ç»Ÿå®‰è£…çš„ï¼Œä¸Centoså·®åˆ«ä¸æ˜¯å¤ªå¤§ï¼Œä¸‹è½½è½¯ä»¶è¿æ¥å¯å»å®˜ç½‘ä¸‹è½½</p></blockquote><h2 id="ElasitcStackæ¦‚è¿°"><a href="#ElasitcStackæ¦‚è¿°" class="headerlink" title="ElasitcStackæ¦‚è¿°"></a>ElasitcStackæ¦‚è¿°</h2><h3 id="1-ä»€ä¹ˆæ˜¯ElasticStackï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯ElasticStackï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ElasticStackï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯ElasticStackï¼Ÿ</h3><p>æ‰€è°“çš„ElasticStackåˆ«åä¸ºelk stackã€‚</p><p>ELKæŒ‡çš„æ˜¯ä¸‰ä¸ªæŠ€æœ¯æ ˆ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- ElasticSearchï¼Œç®€ç§°ï¼š es</span><br><span class="line">æ•°æ®åº“ï¼Œåº”ç”¨åœºæ™¯ä¸ºæ•°æ®çš„å¿«é€Ÿæ£€ç´¢ã€‚ä½†å‡¡å’Œæœç´¢æ¡†ç›¸å…³çš„ï¼Œéƒ½ä¼šç”¨ESè¿›è¡Œæ•°æ®çš„æŸ¥è¯¢ã€‚</span><br><span class="line"></span><br><span class="line">- Logstash:</span><br><span class="line">é‡‡é›†æ•°æ®ï¼Œæ—¥å¿—èšåˆï¼Œå¤„ç†æ•°æ®ï¼Œå°†æ•°æ®å†™å…¥åˆ°ESå­˜å‚¨åº“ã€‚</span><br><span class="line"></span><br><span class="line">- Kibana:</span><br><span class="line">ç”¨äºå‡ºå›¾å±•ç¤ºæ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç”±äºLogstashæ¯”è¾ƒé‡é‡çº§ï¼Œé‡‡é›†æ—¥å¿—æ—¶å¯åŠ¨è¾ƒæ…¢ï¼Œä½¿ç”¨JRubyè¯­è¨€ç ”å‘ï¼Œå¯åŠ¨æ—¶éœ€è¦å…ˆå¯åŠ¨è™šæ‹Ÿæœºã€‚å› æ­¤å®˜æ–¹å¼€å‘äº†beatsç»„ä»¶ï¼Œbeatsç»„ä»¶æ˜¯ä¸€ç³»åˆ—beatçš„é›†åˆï¼Œæ¯”å¦‚filebeatå°±æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„beatç»„ä»¶ï¼Œå¤šç”¨äºæ–‡æœ¬æ—¥å¿—é‡‡é›†ã€‚</span><br></pre></td></tr></table></figure><h3 id="2-å¸¸ç”¨çš„æ¶æ„"><a href="#2-å¸¸ç”¨çš„æ¶æ„" class="headerlink" title="2.å¸¸ç”¨çš„æ¶æ„"></a>2.å¸¸ç”¨çš„æ¶æ„</h3><p>EFK:</p><pre><code>- ElasticSearch- Filebeat:     é‡‡é›†æ•°æ®å†™å…¥ESé›†ç¾¤ã€‚- Kibana</code></pre><p>ELFK:</p><pre><code>- ElasticSearch- Filebeat: - Logstash- Kibana</code></pre><p>ELKF+KAFKA:</p><pre><code>- zookeeper - kafka</code></pre><h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><h3 id="1-ä»€ä¹ˆæ˜¯ElasticSearch"><a href="#1-ä»€ä¹ˆæ˜¯ElasticSearch" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ElasticSearch"></a>1.ä»€ä¹ˆæ˜¯ElasticSearch</h3><p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ï¼Œèƒ½å¤Ÿè§£å†³ä¸æ–­æ¶Œç°å‡ºçš„å„ç§ç”¨ä¾‹ã€‚ä½œä¸º Elastic Stack çš„æ ¸å¿ƒï¼ŒElasticsearch ä¼šé›†ä¸­å­˜å‚¨æ‚¨çš„æ•°æ®ï¼Œè®©æ‚¨é£å¿«å®Œæˆæœç´¢ï¼Œå¾®è°ƒç›¸å…³æ€§ï¼Œè¿›è¡Œå¼ºå¤§çš„åˆ†æï¼Œå¹¶è½»æ¾ç¼©æ”¾è§„æ¨¡ã€‚ESçš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å­˜å‚¨æ•°æ®å’Œå¿«é€Ÿè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ã€‚</p><h3 id="2-å®‰è£…éƒ¨ç½²ES"><a href="#2-å®‰è£…éƒ¨ç½²ES" class="headerlink" title="2.å®‰è£…éƒ¨ç½²ES"></a>2.å®‰è£…éƒ¨ç½²ES</h3><p><strong>å•ç‚¹éƒ¨ç½²ES</strong>   ä¸€èˆ¬ç”¨äºæµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">`æœ¬æœºipï¼š10.0.0.211`</span><br><span class="line">1.ä¸‹è½½ES</span><br><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">2.å®‰è£…ES</span><br><span class="line">[root@elk01 ~]# dpkg -i elasticsearch-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">3.ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk01 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line">cluster.name: elk</span><br><span class="line">path.data: /var/lib/elasticsearch</span><br><span class="line">path.logs: /var/log/elasticsearch</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.port: 9300</span><br><span class="line">discovery.type: single-node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`ç›¸å…³å‚æ•°è¯´æ˜:`</span><br><span class="line">cluster.name: <span class="comment">#æŒ‡å®šESé›†ç¾¤çš„åç§°</span></span><br><span class="line">path.data: <span class="comment">#æŒ‡å®šæ•°æ®ç›®å½•</span></span><br><span class="line">path.logs: <span class="comment">#æŒ‡å®šæ—¥å¿—ç›®å½•</span></span><br><span class="line">network.host: <span class="comment">#æŒ‡å®šå®¿ä¸»æœºçš„ç›‘å¬IPã€‚</span></span><br><span class="line">http.port: 9200<span class="comment">#å¯¹å¤–æä¾›http|httpsæ¥å£çš„ç«¯å£ã€‚</span></span><br><span class="line">transport.port: 9300<span class="comment">#é›†ç¾¤å†…éƒ¨æ•°æ®ä¼ è¾“çš„ç«¯å£ï¼Œä¼šä¼˜å…ˆå¯åŠ¨è¯¥ç«¯å£é€‰ä¸¾masterååœ¨å¯åŠ¨9200ç«¯å£ã€‚</span></span><br><span class="line">discovery.type: <span class="comment">#æŒ‡å®šESé›†ç¾¤çš„ç±»å‹ï¼Œsingle-nodeè¡¨ç¤ºçš„æ˜¯å•ç‚¹ã€‚</span></span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨ESå¹¶è®¾ç½®å¼€æœºè‡ªå¯</span><br><span class="line">[root@elk01 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch</span><br><span class="line"></span><br><span class="line">5.æ£€æŸ¥ç›‘å¬çš„ç«¯å£å·</span><br><span class="line">[root@elk01 ~]# ss -lntup |egrep <span class="string">&#x27;9[23]00&#x27;</span></span><br><span class="line">tcp6       0      0 :::9200        :::*       LISTEN      6431/java</span><br><span class="line">tcp6       0      0 :::9300        :::*       LISTEN      6431/java</span><br><span class="line"></span><br><span class="line">6.æµ‹è¯•è®¿é—®</span><br><span class="line">[root@elk01:0 ~]# curl 10.0.0.211:9200</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;vV46E9vqRK-MxDs6I-3ceg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;deb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;61d76462eecaf09ada684d1b5d319b5ff6865a83&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2024-07-25T14:37:42.448799567Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.11.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</span></span><br><span class="line">[root@elk01:0 ~]# curl 10.0.0.211:9200/_cat/nodes</span><br><span class="line">10.0.0.211 19 91 11 0.10 0.23 0.11 cdfhilmrstw * elk01</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºè¡¨å¤´ä¿¡æ¯    *ä»£è¡¨masterèŠ‚ç‚¹</span></span><br><span class="line">[root@elk01:0 ~]# curl 10.0.0.211:9200/_cat/nodes?v</span><br><span class="line">ip         heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line">10.0.0.211           20          91   0    0.06    0.21     0.11 cdfhilmrstw *      elk01</span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•å¸è½½ESï¼Ÿ</strong></p><pre><code>1.åœæ­¢ESæœåŠ¡[root@elk91 ~]# systemctl disable --now elasticsearch.service 2.åˆ é™¤æ•°æ®[root@elk91 ~]# \rm -rf  /var/&#123;lib,log&#125;/elasticsearch/ /tmp/*  /etc/elasticsearch3.åˆ é™¤è½¯ä»¶[root@elk91 ~]# sudo yum remove elasticsearch[root@elk91 ~]# sudo rpm -e elasticsearch</code></pre><h3 id="3-éƒ¨ç½²ESé›†ç¾¤"><a href="#3-éƒ¨ç½²ESé›†ç¾¤" class="headerlink" title="3.éƒ¨ç½²ESé›†ç¾¤"></a>3.éƒ¨ç½²ESé›†ç¾¤</h3><div class="table-container"><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>LanIP</th></tr></thead><tbody><tr><td>elk01</td><td>10.0.0.211</td><td>172.16.1.211</td></tr><tr><td>elk02</td><td>10.0.0.222</td><td>172.16.1.222</td></tr><tr><td>elk03</td><td>10.0.0.233</td><td>172.16.1.233</td></tr></tbody></table></div><p><strong>1.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ElasticSearch</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½ES</span><br><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.23-amd64.deb</span><br><span class="line">[root@elk01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 212 213;<span class="keyword">do</span> scp elasticsearch-7.17.23-x86_64.rpm root@172.16.1.<span class="variable">$i</span>:/root ;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">2.å®‰è£…ES</span><br><span class="line">[root@elk01 ~]#dpkg -i elasticsearch-7.17.23-amd64.deb</span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line">cluster.name: elk</span><br><span class="line">path.data: /var/lib/elasticsearch</span><br><span class="line">path.logs: /var/log/elasticsearch</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.port: 9300</span><br><span class="line">discovery.seed_hosts: [<span class="string">&quot;10.0.0.211&quot;</span>, <span class="string">&quot;10.0.0.212&quot;</span>,<span class="string">&quot;10.0.0.213&quot;</span>]</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">&quot;10.0.0.211&quot;</span>, <span class="string">&quot;10.0.0.212&quot;</span>,<span class="string">&quot;10.0.0.213&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`ç›¸å…³å‚æ•°è¯´æ˜:`</span><br><span class="line">discovery.seed_hosts:<span class="comment">#å½“å‰ESé›†ç¾¤çš„ä¸»æœºåˆ—è¡¨ã€‚</span></span><br><span class="line">cluster.initial_master_nodes:<span class="comment">#é›†ç¾¤å¯åŠ¨æ—¶é¦–æ¬¡å‚ä¸masteré€‰ä¸¾çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>3.å°†é…ç½®æ–‡ä»¶æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹</strong></p><pre><code>[root@elk01 ~]# scp /etc/elasticsearch/elasticsearch.yml root@172.16.1.212:/etc/elasticsearch/[root@elk01 ~]# scp /etc/elasticsearch/elasticsearch.yml root@172.16.1.213:/etc/elasticsearch/</code></pre><p><strong>4.å¯åŠ¨ESé›†ç¾¤ </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch.service </span><br><span class="line">[root@elk02 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch.service </span><br><span class="line">[root@elk03 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch.service </span><br></pre></td></tr></table></figure><p><strong>5.æŸ¥çœ‹ç«¯å£æ˜¯å¦ç›‘å¬é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# ss -lntup |egrep <span class="string">&#x27;9[23]00&#x27;</span></span><br><span class="line">tcp6       0      0 :::9200        :::*       LISTEN      6431/java</span><br><span class="line">tcp6       0      0 :::9300        :::*       LISTEN      6431/java</span><br></pre></td></tr></table></figure><p><strong>6.æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# curl 10.0.0.213:9200/_cat/nodes</span><br><span class="line">10.0.0.212  9 94  8 0.46 0.49 0.31 cdfhilmrstw - elk02</span><br><span class="line">10.0.0.211 25 95 21 0.56 0.47 0.25 cdfhilmrstw * elk01</span><br><span class="line">10.0.0.213 28 90 25 1.21 0.78 0.43 cdfhilmrstw - elk03</span><br><span class="line"></span><br><span class="line"><span class="comment">#elk02æ˜¯ä¸»èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nameå’Œuuid</span></span><br><span class="line">[root@elk01 ~]# curl -s 10.0.0.211:9200|egrep <span class="string">&#x27;_name|_uuid&#x27;</span></span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ï¼Ÿ</span></span><br><span class="line">[root@elk01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 211 213`;<span class="keyword">do</span> curl -s 10.0.0.<span class="variable">$i</span>:9200|egrep <span class="string">&#x27;_name|_uuid&#x27;</span>;<span class="keyword">done</span></span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span>,</span><br></pre></td></tr></table></figure><p><strong>7.ESé›†ç¾¤å†™å…¥å’Œè¯»å–æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†™å…¥æ•°æ®  ï¼ˆtestæ˜¯ç´¢å¼•ï¼Œè‡ªå®šä¹‰ï¼‰</span></span><br><span class="line">curl -X POST -H <span class="string">&quot;Content-Type:application/json&quot;</span> 10.0.0.211:9200/test/_doc -d <span class="string">&#x27;&#123;&quot;name&quot;:&quot;zhang3&quot;,&quot;age&quot;:&quot;18&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¯»å–æ•°æ®ï¼ˆjqéœ€è¦å®‰è£…ï¼Œæ ¼å¼åŒ–è¾“å‡ºï¼Œ212/213ä¹Ÿèƒ½è¯»å–åˆ°æ•°æ®ï¼Œå› ä¸ºæ˜¯esé›†ç¾¤ï¼‰</span></span><br><span class="line">[root@elk01 ~]# curl -s 10.0.0.211:9200/test/_search | jq .hits</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;value&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;max_score&quot;</span>: 1,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;ppKQ0ZEB6pCPlAoKbzPE&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_score&quot;</span>: 1,</span><br><span class="line">      <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;zhang3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="string">&quot;18&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="kibanaè¯»å–æ•°æ®"><a href="#kibanaè¯»å–æ•°æ®" class="headerlink" title="kibanaè¯»å–æ•°æ®"></a>kibanaè¯»å–æ•°æ®</h2><h3 id="1-kibanaæ¦‚è¿°"><a href="#1-kibanaæ¦‚è¿°" class="headerlink" title="1.kibanaæ¦‚è¿°"></a>1.kibanaæ¦‚è¿°</h3><p>ä½¿ç”¨ Kibana é’ˆå¯¹å¤§è§„æ¨¡æ•°æ®å¿«é€Ÿè¿è¡Œæ•°æ®åˆ†æï¼Œä»¥å®ç°å¯è§‚æµ‹æ€§ã€å®‰å…¨å’Œæœç´¢ã€‚å¯¹æ¥è‡ªä»»ä½•æ¥æºçš„ä»»ä½•æ•°æ®è¿›è¡Œå…¨é¢é€å½»çš„åˆ†æï¼Œä»å¨èƒæƒ…æŠ¥åˆ°æœç´¢åˆ†æï¼Œä»æ—¥å¿—åˆ°åº”ç”¨ç¨‹åºç›‘æµ‹ï¼Œä¸ä¸€è€Œè¶³ã€‚è¯´ç™½äº†ï¼Œkibanaå°±æ˜¯ä»ESæŸ¥è¯¢æ•°æ®å¹¶å±•ç¤ºæ•°æ®ã€‚</p><h3 id="2-éƒ¨ç½²kibana"><a href="#2-éƒ¨ç½²kibana" class="headerlink" title="2.éƒ¨ç½²kibana"></a>2.éƒ¨ç½²kibana</h3><p><strong>1.ä¸‹è½½ &amp; å®‰è£…kibana</strong>  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/kibana/kibana-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">[root@elk01 ~]# dpkg -i kibana-7.17.23-amd64.deb </span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# vim /etc/kibana/kibana.yml </span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">server.name: <span class="string">&quot;kibana&quot;</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>]</span><br><span class="line">i18n.locale: <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨kibana"><a href="#3-å¯åŠ¨kibana" class="headerlink" title="3.å¯åŠ¨kibana"></a>3.å¯åŠ¨kibana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# systemctl <span class="built_in">enable</span> --now kibana</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç«¯å£æ˜¯å¦å¯åŠ¨</span></span><br><span class="line">[root@elk01 ~]# ss  -lntup|grep 5601</span><br><span class="line">tcp        0      0 0.0.0.0:5601      0.0.0.0:*     LISTEN      9696/node  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">10.0.0.211:5601</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1725800433992.png" alt="QQ_1725800433992"></p><p><strong>ç´¢å¼•ç®¡ç†å°±æœ‰æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002121943290.png" alt="image-20241002121943290"></p><p><strong>å¦‚ä½•æŸ¥è¯¢é‚£ä¸ªæ•°æ®å‘¢ï¼Ÿ</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1725800690692.png" alt="QQ_1725800690692"></p><p><img src="https://cos.lukme.top/Pic/QQ_1725800736873.png" alt="QQ_1725800736873"></p><p><img src="https://cos.lukme.top/Pic/QQ_1725800780918.png" alt="QQ_1725800780918"></p><h3 id="4-kibanaæŸ¥è¯¢ESæ•°æ®"><a href="#4-kibanaæŸ¥è¯¢ESæ•°æ®" class="headerlink" title="4.kibanaæŸ¥è¯¢ESæ•°æ®"></a>4.kibanaæŸ¥è¯¢ESæ•°æ®</h3><p><strong>1.å‡†å¤‡æµ‹è¯•æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H <span class="string">&quot;Content-Type:application/json&quot;</span> 10.0.0.211:9200/_bulk -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot; : &#123; &quot;_index&quot; : &quot;student1&quot;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;:&quot;æå››&quot;,&quot;hobby&quot;:[&quot;å­¦ä¹ &quot;,&quot;ç©æ‰‹æœº&quot;,&quot;çœ‹ç¾å¥³&quot;]&#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot; : &#123; &quot;_index&quot; : &quot;student2&quot;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;hobby&quot;:[&quot;å¤§é•¿è…¿&quot;,&quot;å­¦ä¹ &quot;]&#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»ˆç«¯è¾“å‡ºå¦‚ä¸‹å³OK</span></span><br><span class="line">&#123;<span class="string">&quot;took&quot;</span>:780,<span class="string">&quot;errors&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;items&quot;</span>:[&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;student&quot;</span>,<span class="string">&quot;_type&quot;</span>:<span class="string">&quot;_doc&quot;</span>,<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;YWacOJIBCijr5nh3GosC&quot;</span>,<span class="string">&quot;_version&quot;</span>:1,<span class="string">&quot;result&quot;</span>:<span class="string">&quot;created&quot;</span>,<span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:2,<span class="string">&quot;successful&quot;</span>:2,<span class="string">&quot;failed&quot;</span>:0&#125;,<span class="string">&quot;_seq_no&quot;</span>:0,<span class="string">&quot;_primary_term&quot;</span>:1,<span class="string">&quot;status&quot;</span>:201&#125;&#125;,&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;student&quot;</span>,<span class="string">&quot;_type&quot;</span>:<span class="string">&quot;_doc&quot;</span>,<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;YmacOJIBCijr5nh3GosC&quot;</span>,<span class="string">&quot;_version&quot;</span>:1,<span class="string">&quot;result&quot;</span>:<span class="string">&quot;created&quot;</span>,<span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:2,<span class="string">&quot;successful&quot;</span>:2,<span class="string">&quot;failed&quot;</span>:0&#125;,<span class="string">&quot;_seq_no&quot;</span>:1,<span class="string">&quot;_primary_term&quot;</span>:1,<span class="string">&quot;status&quot;</span>:201&#125;&#125;]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#apiè°ƒå–æ–¹æ³•--å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/7.17/docs-bulk.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨å†æ¬¡è®¿é—®  kibana  ï¼Œå‘ç°ç´¢å¼•ç®¡ç†ä¼šå¤šå‡ºæ¥ä¸€ä¸ªæˆ‘ä»¬åˆ›å»ºçš„studentç´¢å¼•</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002122102175.png" alt="image-20241002122102175"></p><p><strong>2.åˆ›å»ºç´¢å¼•æ¨¡å¼</strong></p><p>kibanaçš„ç´¢å¼•æ¨¡å¼ç”¨äºåŒ¹é…ESé›†ç¾¤çš„ä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•ã€‚     student*</p><p><img src="https://cos.lukme.top/Pic/image-20241002122146329.png" alt="image-20241002122146329"></p><p><strong>3.kibanaæŸ¥è¯¢æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002122628647.png" alt="image-20241002122628647"></p><p><strong>ä»¥å­—æ®µæŸ¥è¯¢</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002122712583.png" alt="image-20241002122712583"></p><p><img src="https://cos.lukme.top/Pic/image-20241002122754986.png" alt="image-20241002122754986"></p><p><strong>ä½¿ç”¨jsonæ ¼å¼æŸ¥è¯¢</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002122306868.png" alt="image-20241002122306868"></p><p><strong>å…¶å®ƒæ–¹å¼æŸ¥è¯¢é›†ç¾¤é¢œè‰²</strong></p><p>1.é€šè¿‡es-headç»„ä»¶æŸ¥è¯¢ï¼ˆä¸€ä¸ªæ’ä»¶ï¼‰</p><p>2.åŸºäºå®˜æ–¹çš„APIæŸ¥è¯¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# curl -s 10.0.0.211:9200/_cat/indices?v</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002122830955.png" alt="image-20241002122830955"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# curl -s 10.0.0.211:9200/_cat/indices|awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line">green</span><br><span class="line">green</span><br><span class="line">green</span><br><span class="line">green</span><br><span class="line">green</span><br></pre></td></tr></table></figure><h2 id="Filebeaté‡‡é›†æ•°æ®"><a href="#Filebeaté‡‡é›†æ•°æ®" class="headerlink" title="Filebeaté‡‡é›†æ•°æ®"></a>Filebeaté‡‡é›†æ•°æ®</h2><p><strong>filebeat</strong><br>æ— è®ºæ‚¨æ˜¯ä»å®‰å…¨è®¾å¤‡ã€äº‘ã€å®¹å™¨ã€ä¸»æœºè¿˜æ˜¯ OT è¿›è¡Œæ•°æ®æ”¶é›†ï¼ŒFilebeat éƒ½å°†ä¸ºæ‚¨æä¾›ä¸€ç§è½»é‡å‹æ–¹æ³•ï¼Œç”¨äºè½¬å‘å’Œæ±‡æ€»æ—¥å¿—ä¸æ–‡ä»¶ï¼Œè®©ç®€å•çš„äº‹æƒ…ä¸å†ç¹æ‚ã€‚è¯´ç™½äº†ï¼Œfilebeatçš„æ ¸å¿ƒå°±æ˜¯é‡‡é›†æ—¥å¿—å¹¶å°†æ—¥å¿—å‘é€åˆ°æˆ‘ä»¬æœŸæœ›çš„ç›®çš„ç«¯ã€‚æœ¬è´¨æ ¸å¿ƒå°±æ˜¯input(æ•°æ®ä»å“ªæ¥)å’Œoutput(æ•°æ®åˆ°å“ªå»)ã€‚</p><p><strong>==filebeaté»˜è®¤æ˜¯æŒ‰è¡Œè¯»å–æ•°æ®==</strong></p><p><img src="https://cos.lukme.top/Pic/elkmassage.png" alt="elkmassage"></p><h3 id="éƒ¨ç½²filebeat"><a href="#éƒ¨ç½²filebeat" class="headerlink" title="éƒ¨ç½²filebeat"></a>éƒ¨ç½²filebeat</h3><p><a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/configuring-howto-filebeat.html">Filebeat Reference å®˜æ–¹æ–‡æ¡£</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½filebeatåŒ…</span><br><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">2.å®‰è£…filebeat </span><br><span class="line">[root@elk01 ~]# dpkg -i filebeat-7.17.23-amd64.deb </span><br></pre></td></tr></table></figure><h3 id="é‡‡é›†æ•°æ®ç»ˆç«¯åˆ°ç»ˆç«¯"><a href="#é‡‡é›†æ•°æ®ç»ˆç«¯åˆ°ç»ˆç«¯" class="headerlink" title="é‡‡é›†æ•°æ®ç»ˆç«¯åˆ°ç»ˆç«¯"></a>é‡‡é›†æ•°æ®ç»ˆç«¯åˆ°ç»ˆç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†™æ³•è§å®˜æ–¹ï¼Œç›´æ¥å¤åˆ¶ä½¿ç”¨  (åœ¨ inputs å’Œ Output é‡Œé€‰æ‹©ç›¸åº”çš„æ–¹å¼)</span></span><br><span class="line"><span class="string">&#x27;https://www.elastic.co/guide/en/beats/filebeat/7.17/configuring-howto-filebeat.html&#x27;</span></span><br><span class="line">1.ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶      ï¼ˆinputs&gt;Stdin  æ ‡å‡†è¾“å…¥    output&gt;Console  ç»ˆç«¯è¾“å‡ºï¼‰</span><br><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /etc/filebeat/01-stdin-stdout.yaml </span><br><span class="line"><span class="comment"># æ•°æ®ä»æ ‡å‡†è¾“å…¥æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: stdin</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#2.å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">ç›¸å…³å‚æ•°è¯´ ï¼š</span><br><span class="line">-c &lt;config&gt;:</span><br><span class="line">æŒ‡å®šçš„æ˜¯é…ç½®æ–‡ä»¶ </span><br><span class="line">-e :</span><br><span class="line">å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°ç»ˆç«¯ã€‚</span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/01-stdin-stdout.yaml </span><br><span class="line"><span class="comment">#ç»ˆç«¯æˆ‘è¾“å…¥çš„</span></span><br><span class="line">66666666666666666666666666666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºå†…å®¹ï¼šå¾ˆæ˜æ˜¾ï¼Œæ•°æ®è¢«å°è£…åˆ°äº†ä¸€ä¸ª&quot;message&quot;å­—æ®µä¸­ã€‚</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:23:12.146Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;stdin&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;13686d12-e255-4c48-a609-dcc4b8331c44&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;66666666666666666666666666666666&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">2024-09-28T21:23:13.147+0800    ERROR   file/states.go:125      State <span class="keyword">for</span>  should have been dropped, but couldn<span class="string">&#x27;t as state is not finished.</span></span><br></pre></td></tr></table></figure><h3 id="filebeatç›‘å¬tcpç«¯å£"><a href="#filebeatç›‘å¬tcpç«¯å£" class="headerlink" title="filebeatç›‘å¬tcpç«¯å£"></a>filebeatç›‘å¬tcpç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1ã€‚ç¼–å†™filebeaté…ç½®æ–‡ä»¶       ï¼ˆinputs&gt;tcp   æŒ‡å®štcpç«¯å£ï¼‰</span></span><br><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /etc/filebeat/02-tcp-console.yaml </span><br><span class="line"><span class="comment"># æ•°æ®ä»ç›‘å¬çš„æŒ‡å®štcpç«¯å£æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#2.å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/02-tcp-console.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å‘é€æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk03:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> | nc 10.0.0.211 9000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.è§‚å¯Ÿfilebeatæ˜¯å¦é‡‡é›†åˆ°æ•°æ®</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:33:01.962Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;tcp&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;a43721b4-8160-4985-9f6f-67c0178affa7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;address&quot;</span>: <span class="string">&quot;10.0.0.213:47174&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡‡é›†æœ¬åœ°æ–‡ä»¶è¾“å‡ºæ•°æ®åˆ°ç»ˆç«¯"><a href="#é‡‡é›†æœ¬åœ°æ–‡ä»¶è¾“å‡ºæ•°æ®åˆ°ç»ˆç«¯" class="headerlink" title="é‡‡é›†æœ¬åœ°æ–‡ä»¶è¾“å‡ºæ•°æ®åˆ°ç»ˆç«¯"></a>é‡‡é›†æœ¬åœ°æ–‡ä»¶è¾“å‡ºæ•°æ®åˆ°ç»ˆç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">1.ç¼–å†™filebeaté…ç½®æ–‡ä»¶    ï¼ˆinputs&gt;<span class="built_in">log</span>ï¼‰</span><br><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /etc/filebeat/03-log-console.yaml</span><br><span class="line"><span class="comment"># æ•°æ®ä»ç›‘å¬çš„æŒ‡å®šæ–‡ä»¶æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/test.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">2.å¯åŠ¨filebeatå®ä¾‹</span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/03-log-console.yaml</span><br><span class="line"></span><br><span class="line">3.å†™å…¥æµ‹è¯•æ•°æ®(å¦å¼€ä¸€ä¸ªç»ˆç«¯å†™å…¥)</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&#x27;999&#x27;</span> &gt; /tmp/test.log</span><br><span class="line"></span><br><span class="line">4.è§‚å¯Ÿç»ˆç«¯è¾“å‡º</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:48:53.645Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 0,           <span class="comment">#æ³¨æ„è¿™ä¸ªå­—æ®µ</span></span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.log&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;10485e22-a3e8-40f0-bbb9-c194f9541bf4&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.éªŒè¯filebeaté‡‡é›†æ•°æ®æ˜¯æŒ‰è¡Œè¯»å–    (æ³¨æ„offset å­—æ®µå˜åŒ–)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†æ¬¡å†™å…¥æ•°æ®è§‚å¯Ÿé‡‡é›†æƒ…å†µ</span></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&#x27;hello world&#x27;</span> &gt;&gt; /tmp/test.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§‚å¯Ÿoffsetï¼ˆåç§»é‡ï¼‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:54:03.721Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 4,    <span class="comment">#ä¸ºå•¥æ˜¯å››ä¸ªåç§»é‡ï¼Ÿ</span></span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.log&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;999hello world&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;10485e22-a3e8-40f0-bbb9-c194f9541bf4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å› ä¸ºä¸Šæ¬¡999ä¸‰ä¸ªä¹‹åæœ‰ä¸ªç‰¹æ®Šå­—ç¬¦--æ¢è¡Œç¬¦ï¼Œæ‰€ä»¥offsetä¹‹å‰é‡‡é›†çš„åç§»é‡æ˜¯4ä¸ª</span></span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•éªŒè¯filebeatæ˜¯æŒ‰è¡Œé‡‡é›†æ•°æ®çš„ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> -n <span class="string">&#x27;ABCD&#x27;</span> &gt;&gt; /tmp/test.log      -n ä¸æ¢è¡Œ</span><br><span class="line"></span><br><span class="line">è§‚å¯Ÿç»ˆç«¯æ˜¯å¦æœ‰é‡‡é›†æ•°æ®,å¾ˆæ˜æ˜¾æ²¡æœ‰é‡‡é›†</span><br></pre></td></tr></table></figure><p><strong>6.é‡å¯filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœæ­¢filebeat   Ctrl+c</span><br><span class="line">å†æ¬¡æ‰§è¡Œå®ä¾‹    filebeat -e -c /etc/filebeat/03-log-console.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ­¤æ—¶æˆ‘ä»¬å‘ç°filebeatå¹¶ä¸ä¼šé‡‡é›†æ•°æ®ï¼Œå› ä¸ºfilebeatå·²ç»é‡‡é›†è¿‡äº†ï¼Œ</span></span><br><span class="line"><span class="comment">#filebeatæ˜¯å¦‚ä½•çŸ¥é“æœ‰æ²¡æœ‰é‡‡é›†è¿‡æ•°æ®ï¼Ÿå¾€ä¸Šç¿»çœ‹åŠ è½½ä¿¡æ¯å¦‚ä¸‹å›¾</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002105509955.png" alt="image-20241002105509955"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Finished loading transaction <span class="built_in">log</span> file <span class="keyword">for</span> <span class="string">&#x27;/var/lib/filebeat/registry/filebeat&#x27;</span>. Active transaction <span class="built_in">id</span>=63</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªè¡¨ç¤ºçš„æ˜¯ï¼Œåœ¨é‡‡é›†æ•°æ®ä¹‹å‰å…ˆåŠ è½½<span class="string">&#x27;/var/lib/filebeat/registry/filebeat&#x27;</span>ä¸‹çš„äº‹åŠ¡æ—¥å¿—log.jsonï¼Œé‡Œé¢è®°å½•äº†å·²ç»é‡‡é›†è¿‡çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‰å»æŸ¥çœ‹ä¸‹ï¼Œ</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹æœ€åä¸€æ¡æ•°æ®</span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">tail</span> -1 /var/lib/filebeat/registry/filebeat/log.json </span><br><span class="line">&#123;<span class="string">&quot;k&quot;</span>:<span class="string">&quot;filebeat::logs::native::788078-64768&quot;</span>,<span class="string">&quot;v&quot;</span>:&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;native::788078-64768&quot;</span>,<span class="string">&quot;offset&quot;</span>:24,<span class="string">&quot;timestamp&quot;</span>:[2061673550511,1727837342],<span class="string">&quot;ttl&quot;</span>:-1,<span class="string">&quot;prev_id&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;source&quot;</span>:<span class="string">&quot;/tmp/test.log&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;log&quot;</span>,<span class="string">&quot;FileStateOS&quot;</span>:&#123;<span class="string">&quot;inode&quot;</span>:788078,<span class="string">&quot;device&quot;</span>:64768&#125;,<span class="string">&quot;identifier_name&quot;</span>:<span class="string">&quot;native&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°æ®æœ‰ä¸ªoffsetå­—æ®µï¼Œè¿™é‡Œè®°å½•çš„æ˜¯ä¸Šä¸€æ¬¡é‡‡é›†è¿‡çš„åç§»é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥æŸ¥çœ‹ä¸‹è¿™ä¸ªæ—¥å¿—çš„åç§»é‡æ˜¯ä¸æ˜¯24</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /tmp/test.log </span><br><span class="line">999</span><br><span class="line">hello world</span><br><span class="line">ABCD666</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶ä¸­æ¯ä¸ªæ¢è¡Œä¹‹åéƒ½æœ‰ä¸€ä¸ªæ¢è¡Œç¬¦å ä¸€ä¸ªåç§»é‡ï¼Œæ‰€ä»¥æ€»è¿‡æ˜¯24ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡æ—¥å¿—è®°å½•çš„æ˜¯æ²¡æœ‰é”™çš„ã€‚å½“æˆ‘ä»¬åˆ é™¤è¿™ä¸ªäº‹åŠ¡æ—¥å¿—log.jsonæ—¶å€™ï¼Œé‡æ–°æ‰§è¡Œfilebeatå®ä¾‹ï¼Œä¾¿ä¼šé‡æ–°é‡‡é›†æ•°æ®</span></span><br></pre></td></tr></table></figure><p><strong>7.è‡ªå®šä¹‰é‡‡é›†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ¹æ®æ­¥éª¤6ä¸­é‡æ–°filebeatå®ä¾‹æ‰€è¿°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰é‡‡é›†ä¾¿å¯ä»¥æ ¹æ®è®¾ç½®åç§»é‡æ¥è¾¾åˆ°è‡ªå®šä¹‰é‡‡é›†æ•°æ®</span></span><br><span class="line"><span class="comment">#ä¿®æ”¹äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å¦‚ä¸‹ï¼Œåªä¿®æ”¹åç§»é‡ï¼Œéœ€æ±‚æ˜¯åªé‡‡é›†ABCD666åŠä»¥åçš„æ•°æ®</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /tmp/test.log </span><br><span class="line">999</span><br><span class="line">hello world</span><br><span class="line">ABCD666  <span class="comment">#å°†offsetè®¾ç½®ä¸º16ï¼Œè®°å¾—æ•°æ¢è¡Œç¬¦</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# vim /var/lib/filebeat/registry/filebeat/log.json </span><br><span class="line">&#123;<span class="string">&quot;op&quot;</span>:<span class="string">&quot;set&quot;</span>,<span class="string">&quot;id&quot;</span>:65&#125;</span><br><span class="line">&#123;<span class="string">&quot;k&quot;</span>:<span class="string">&quot;filebeat::logs::native::788078-64768&quot;</span>,<span class="string">&quot;v&quot;</span>:&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;native::788078-64768&quot;</span>,<span class="string">&quot;offset&quot;</span>:16,<span class="string">&quot;timestamp&quot;</span>:[2061673550511,1727837342],<span class="string">&quot;ttl&quot;</span>:-1,<span class="string">&quot;prev_id&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;source&quot;</span>:<span class="string">&quot;/tmp/test.log&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;log&quot;</span>,<span class="string">&quot;FileStateOS&quot;</span>:&#123;<span class="string">&quot;inode&quot;</span>:788078,<span class="string">&quot;device&quot;</span>:64768&#125;,<span class="string">&quot;identifier_name&quot;</span>:<span class="string">&quot;native&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°æ‰§è¡Œå®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/03-log-console.yaml </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-10-02T03:12:45.360Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;c8d05474-6175-4dd1-93e8-933cb7760b92&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 16,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.log&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ABCD666&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><h3 id="é‡‡é›†nginxæ—¥å¿—æ¡ˆä¾‹"><a href="#é‡‡é›†nginxæ—¥å¿—æ¡ˆä¾‹" class="headerlink" title="é‡‡é›†nginxæ—¥å¿—æ¡ˆä¾‹"></a>é‡‡é›†nginxæ—¥å¿—æ¡ˆä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">1.å®‰è£…nginx   ï¼ˆå¯ä»¥å…ˆå°è¯•è·³è¿‡2æ­¥éª¤ï¼Œçœ‹çœ‹ä¸ä¿®æ”¹é…ç½®æ–‡ä»¶çš„è¾“å‡ºï¼Œå’Œä¿®æ”¹ä¹‹åçš„åŒºåˆ«ï¼‰</span><br><span class="line">[root@elk01:1 ~]# apt -y install nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.å°†nginxé‡‡é›†çš„æ•°æ®ä»¥jsonæ ¼å¼å±•ç¤ºï¼Œä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶ï¼ˆæ ¼å¼åŒ–å±•ç¤ºï¼Œæ–¹ä¾¿åˆ†ææ•°æ®ï¼Œè®¿é—®ipï¼ŒçŠ¶æ€ç ç­‰ï¼‰</span><br><span class="line">[root@elk01:1 ~]# vim /etc/nginx/nginx.conf </span><br><span class="line"><span class="comment">#httpæ¨¡å—é‡Œæ·»åŠ å¦‚ä¸‹ï¼Œæ³¨é‡Šå®˜æ–¹çš„   access_log /var/log/nginx/access.log</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">  log_format nginx_json <span class="string">&#x27;&#123;&quot;timestamp&quot;:&quot;$time_iso8601&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;vhost&quot;:&quot;$server_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;clientip&quot;:&quot;$remote_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;SendBytes&quot;:$body_bytes_sent,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;responsetime&quot;:$request_time,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;http_host&quot;:&quot;$host&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;uri&quot;:&quot;$uri&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;domain&quot;:&quot;$host&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;referer&quot;:&quot;$http_referer&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;tcp_xff&quot;:&quot;$proxy_protocol_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;status&quot;:&quot;$status&quot;&#125;&#x27;</span>;</span><br><span class="line"> access_log /var/log/nginx/access.log nginx_json;</span><br><span class="line"><span class="comment">#2.1 æ£€æŸ¥nginxè¯­æ³•æ˜¯å¦æœ‰é—®é¢˜</span></span><br><span class="line">[root@elk01:1 ~]# nginx -t </span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"><span class="comment">#2.2 é‡æ–°nginx</span></span><br><span class="line">[root@elk01:1 ~]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.ç¼–å†™filebeaté…ç½®æ–‡ä»¶    ï¼ˆinputs&gt;<span class="built_in">log</span>ï¼‰</span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/filebeat/04-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    <span class="comment">#å½“json.keys_under_rootçš„å€¼ä¸ºtrueæ—¶ï¼Œä¼šè‡ªåŠ¨è§£æjsonæ ¼å¼ï¼Œå¹¶å°†å­—æ®µæ”¾åœ¨é¡¶çº§å­—æ®µä¸­</span></span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    <span class="comment">#å½“jsonæ ¼å¼è§£æé”™è¯¯æ—¶ï¼Œå¯ä»¥å°†é”™è¯¯ä¿¡æ¯å†™å…¥åˆ°eventäº‹ä»¶(æŒ‡çš„æ˜¯filebeaté‡‡é›†çš„æ¯ä¸€æ¡æ•°æ®)ä¸­ã€‚</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    <span class="comment">#å¦‚æœé‡‡é›†çš„å­—æ®µå’Œfilebeatè‡ªå·±çš„å­—æ®µå†²çªï¼Œåˆ™è¦†ç›–æ•°æ®</span></span><br><span class="line">    overwirte_kes: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">2.å¯åŠ¨filebeatå®ä¾‹</span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/03-log-console.yaml</span><br><span class="line">3.å¦å¼€ä¸€ä¸ªç»ˆç«¯æµ‹è¯•</span><br><span class="line">[root@elk01:1 ~]# curl 10.0.0.211</span><br><span class="line"><span class="comment">#æŸ¥çœ‹filebeatæ”¶é›†æ—¥å¿—</span></span><br><span class="line">1.è¿™æ˜¯æœªé…ç½®  json.keys_under_root: <span class="literal">true</span>  çš„å±•ç¤º</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;&#123;\&quot;timestamp\&quot;:\&quot;2024-10-02T11:40:24+08:00\&quot;,\&quot;vhost\&quot;:\&quot;10.0.0.211\&quot;,\&quot;clientip\&quot;:\&quot;10.0.0.211\&quot;,\&quot;SendBytes\&quot;:612,\&quot;responsetime\&quot;:0.000,\&quot;upstreamtime\&quot;:\&quot;-\&quot;,\&quot;upstreamhost\&quot;:\&quot;-\&quot;,\&quot;http_host\&quot;:\&quot;10.0.0.211\&quot;,\&quot;uri\&quot;:\&quot;/index.nginx-debian.html\&quot;,\&quot;domain\&quot;:\&quot;10.0.0.211\&quot;,\&quot;xff\&quot;:\&quot;-\&quot;,\&quot;referer\&quot;:\&quot;-\&quot;,\&quot;tcp_xff\&quot;:\&quot;-\&quot;,\&quot;http_user_agent\&quot;:\&quot;curl/7.81.0\&quot;,\&quot;status\&quot;:\&quot;200\&quot;&#125;&quot;</span>,</span><br><span class="line">  </span><br><span class="line">2.è¿™æ˜¯é…ç½®json.keys_under_root: <span class="literal">true</span>çš„å±•ç¤º  ï¼ˆipï¼ŒçŠ¶æ€ç ï¼Œæ—¶é—´æˆ³éƒ½ä»¥é¡¶çº§å­—æ®µå±•ç¤ºäº†ï¼Œæ›´åŠ æ–¹ä¾¿è¯»å–åˆ†ææ•°æ®ï¼‰</span><br><span class="line">  <span class="string">&quot;json&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;clientip&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;domain&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2024-10-02T11:55:24+08:00&quot;</span>,</span><br><span class="line">    <span class="string">&quot;referer&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vhost&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http_host&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tcp_xff&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;xff&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uri&quot;</span>: <span class="string">&quot;/index.nginx-debian.html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http_user_agent&quot;</span>: <span class="string">&quot;curl/7.81.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;responsetime&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;upstreamhost&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;SendBytes&quot;</span>: 612,</span><br><span class="line">    <span class="string">&quot;upstreamtime&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: <span class="string">&quot;200&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ESæ¶æ„é‡‡é›†nginxæ—¥å¿—å¹¶åˆ†æ"><a href="#ESæ¶æ„é‡‡é›†nginxæ—¥å¿—å¹¶åˆ†æ" class="headerlink" title="ESæ¶æ„é‡‡é›†nginxæ—¥å¿—å¹¶åˆ†æ"></a>ESæ¶æ„é‡‡é›†nginxæ—¥å¿—å¹¶åˆ†æ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ç¼–å†™filebeatå¸å…¥ESé›†ç¾¤é…ç½®æ–‡ä»¶   ï¼ˆé€‰æ‹©output&gt;Elasticsearchå¤åˆ¶å®˜æ–¹æ¡ˆä¾‹ä¿®æ”¹ï¼‰</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/filebeat/05-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_kes: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>] </span><br><span class="line">  </span><br><span class="line"><span class="comment">#2.å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/05-nginx-es.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.è®¿é—®nginxæœåŠ¡</span></span><br><span class="line">[root@elk01:1 ~]# <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> curl 10.0.0.211; <span class="built_in">sleep</span> 1 ;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®ï¼š10.0.0.211:5601</p><p><img src="https://cos.lukme.top/Pic/image-20241002155103512.png" alt="image-20241002155103512"></p><p><strong>åˆ›å»ºç´¢å¼•</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002160236505.png" alt="image-20241002160236505"></p><p><strong>è¿›å…¥èœå•æ é€‰æ‹©Discover</strong></p><p><strong>æŸ¥çœ‹æ•°æ®ï¼ˆæ”¯æŒå¤šæ¡ä»¶æŸ¥è¯¢ï¼‰</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002160129138.png" alt="image-20241002160129138"></p><p><img src="https://cos.lukme.top/Pic/image-20241002161758175.png" alt="image-20241002161758175"></p><h2 id="ESçš„å¸¸è§æœ¯è¯­-åˆ†ç‰‡"><a href="#ESçš„å¸¸è§æœ¯è¯­-åˆ†ç‰‡" class="headerlink" title="ESçš„å¸¸è§æœ¯è¯­-åˆ†ç‰‡"></a>ESçš„å¸¸è§æœ¯è¯­-åˆ†ç‰‡</h2><p><img src="https://cos.lukme.top/Pic/image-20241002160849403.png" alt="image-20241002160849403"></p><p><strong>index</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- index: ç´¢å¼•</span><br><span class="line">ç´¢å¼•æ˜¯ä¸€ä¸ªé€»è¾‘çš„å­˜å‚¨å•å…ƒï¼Œä¸€èˆ¬ç”¨äºæ ‡è¯†ä¸åŒçš„ä¸šåŠ¡ç±»å‹ï¼Œå› æ­¤ç´¢å¼•çš„åç§°å¤§å®¶å¯ä»¥è‡ªå®šä¹‰ã€‚</span><br><span class="line">ç”¨æˆ·åŸºäºç´¢å¼•è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚</span><br></pre></td></tr></table></figure><p><strong>shard</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- shard: åˆ†ç‰‡</span><br><span class="line">ä¸€ä¸ªç´¢å¼•æœ€å°‘æœ‰ä¸€ä¸ªåˆ†ç‰‡ï¼Œæ•°æ®å­˜å‚¨åœ¨åˆ†ç‰‡ä¸­ã€‚</span><br><span class="line">å½“ç´¢å¼•çš„åˆ†ç‰‡æ•°é‡å¤§äº1æ—¶ï¼ŒESé›†ç¾¤è‡ªåŠ¨å°†åˆ†ç‰‡åˆ†æ•£åœ°å­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®èŠ‚ç‚¹ï¼Œè€Œæ˜¯å®ç°äº†æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ã€‚</span><br></pre></td></tr></table></figure><blockquote><p>â€‹    ä¸€ä¸ª åˆ†ç‰‡ æ˜¯ä¸€ä¸ªåº•å±‚çš„ å·¥ä½œå•å…ƒ ï¼Œå®ƒä»…ä¿å­˜äº†å…¨éƒ¨æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ åœ¨åˆ†ç‰‡å†…éƒ¨æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»åˆ†ç‰‡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€Œç°åœ¨æˆ‘ä»¬åªéœ€çŸ¥é“ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ª Lucene çš„å®ä¾‹ï¼Œä»¥åŠå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœç´¢å¼•æ“ã€‚ æˆ‘ä»¬çš„æ–‡æ¡£è¢«å­˜å‚¨å’Œç´¢å¼•åˆ°åˆ†ç‰‡å†…ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºæ˜¯ç›´æ¥ä¸ç´¢å¼•è€Œä¸æ˜¯ä¸åˆ†ç‰‡è¿›è¡Œäº¤äº’ã€‚<br>â€‹     Elasticsearch æ˜¯åˆ©ç”¨åˆ†ç‰‡å°†æ•°æ®åˆ†å‘åˆ°é›†ç¾¤å†…å„å¤„çš„ã€‚åˆ†ç‰‡æ˜¯æ•°æ®çš„å®¹å™¨ï¼Œæ–‡æ¡£ä¿å­˜åœ¨åˆ†ç‰‡å†…ï¼Œåˆ†ç‰‡åˆè¢«åˆ†é…åˆ°é›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹é‡Œã€‚ å½“ä½ çš„é›†ç¾¤è§„æ¨¡æ‰©å¤§æˆ–è€…ç¼©å°æ—¶ï¼Œ Elasticsearch ä¼šè‡ªåŠ¨çš„åœ¨å„èŠ‚ç‚¹ä¸­è¿ç§»åˆ†ç‰‡ï¼Œä½¿å¾—æ•°æ®ä»ç„¶å‡åŒ€åˆ†å¸ƒåœ¨é›†ç¾¤é‡Œã€‚</p><p>â€‹    ä¸€ä¸ªåˆ†ç‰‡å¯ä»¥æ˜¯ ä¸» åˆ†ç‰‡æˆ–è€… å‰¯æœ¬ åˆ†ç‰‡ã€‚ ç´¢å¼•å†…ä»»æ„ä¸€ä¸ªæ–‡æ¡£éƒ½å½’å±äºä¸€ä¸ªä¸»åˆ†ç‰‡ï¼Œæ‰€ä»¥ä¸»åˆ†ç‰‡çš„æ•°ç›®å†³å®šç€ç´¢å¼•èƒ½å¤Ÿä¿å­˜çš„æœ€å¤§æ•°æ®é‡ã€‚</p></blockquote><p><strong>replica</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- replica: å‰¯æœ¬</span><br><span class="line">æ¯ä¸ªåˆ†ç‰‡æœ‰0ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ï¼Œè‹¥å‰¯æœ¬æ•°é‡å¤§äº0æ—¶ï¼Œåˆ™å¯ä»¥å®ç°å¯¹ä¸»åˆ†ç‰‡çš„å¤‡ä»½ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£å°†å…¶åˆ†ç‰‡ä¸»åˆ†ç‰‡(primary shard)å’Œå‰¯æœ¬åˆ†ç‰‡(replica shard)ã€‚</span><br><span class="line">ä¸»åˆ†ç‰‡(primary shard)å’Œå‰¯æœ¬åˆ†ç‰‡(replica shard)ä¸èƒ½åœ¨åŒä¸€å°èŠ‚ç‚¹ã€‚</span><br><span class="line">ä¸»åˆ†ç‰‡è´Ÿè´£æ•°æ®çš„è¯»å†™ï¼Œè€Œå‰¯æœ¬åˆ†ç‰‡åªè´Ÿè´£æ•°æ®çš„è¯»å–å’ŒåŒæ­¥ã€‚</span><br><span class="line">å½“ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡è¾ƒå¤šæ—¶ï¼Œé»˜è®¤çš„å†™å…¥ç­–ç•¥ä¸ºï¼š <span class="string">&quot;(ä¸»åˆ†ç‰‡æ•°é‡ + å‰¯æœ¬åˆ†ç‰‡æ•°é‡) / 2 + 1&quot;</span>ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯åŠæ•°ä»¥ä¸Šå†™å…¥æœºåˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚1ä¸ªä¸»åˆ†ç‰‡ï¼Œå’Œ1ä¸ªå‰¯æœ¬åˆ†ç‰‡æ€»å…±2ä¸ªåˆ†ç‰‡çš„æ•°æ®ç›¸åŒï¼Œå…¶å†™å…¥ç­–ç•¥ä¸ºï¼š (1 + 1) / 2 + 1ï¼Œç»“æœä¸ºï¼š2ï¼Œè¡¨ç¤ºä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å¿…é¡»å†™å…¥æˆåŠŸåˆ™åˆ¤å®šæˆåŠŸã€‚</span><br></pre></td></tr></table></figure><blockquote><p>â€‹    ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡åªæ˜¯ä¸€ä¸ªä¸»åˆ†ç‰‡çš„æ‹·è´ã€‚å‰¯æœ¬åˆ†ç‰‡ä½œä¸ºç¡¬ä»¶æ•…éšœæ—¶ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±çš„å†—ä½™å¤‡ä»½ï¼Œå¹¶ä¸ºæœç´¢å’Œè¿”å›æ–‡æ¡£ç­‰è¯»æ“ä½œæä¾›æœåŠ¡ã€‚<br>å‰¯æœ¬åˆ†ç‰‡çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†æ•…éšœè½¬ç§»ï¼Œå¦‚æœæŒæœ‰ä¸»åˆ†ç‰‡çš„èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡å°±ä¼šæ™‹å‡ä¸ºä¸»åˆ†ç‰‡çš„è§’è‰²ã€‚åœ¨ç´¢å¼•å†™å…¥æ—¶ï¼Œå‰¯æœ¬åˆ†ç‰‡åšç€ä¸ä¸»åˆ†ç‰‡ç›¸åŒçš„å·¥ä½œã€‚æ–°æ–‡æ¡£é¦–å…ˆè¢«ç´¢å¼•è¿›ä¸»åˆ†ç‰‡ç„¶åå†åŒæ­¥åˆ°å…¶å®ƒæ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡ã€‚</p><p>â€‹    å¢åŠ å‰¯æœ¬æ•°å¹¶ä¸ä¼šå¢åŠ ç´¢å¼•å®¹é‡ï¼Œåœ¨ç´¢å¼•å»ºç«‹çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ä¸»åˆ†ç‰‡æ•°ï¼Œä½†æ˜¯å‰¯æœ¬åˆ†ç‰‡æ•°å¯ä»¥éšæ—¶ä¿®æ”¹</p></blockquote><p>é€šä¿—ç†è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åˆ†ç‰‡æ•°ï¼ˆnumber_of_shardsï¼‰å°±æ˜¯ä¸»åˆ†ç‰‡ä¸ªæ•°</span><br><span class="line">å‰¯æœ¬æ•°ï¼ˆnumber_of_replicasï¼‰ å¯ä»¥ç†è§£æˆä¸»åˆ†ç‰‡çš„æ‹·è´ä¸ªæ•°</span><br><span class="line">å¦‚æœä¸»åˆ†ç‰‡æ•°æ˜¯5ï¼Œåˆ™æ¯ä¸ªå‰¯æœ¬éƒ½æœ‰5ä¸ªåˆ†ç‰‡</span><br><span class="line">å› æ­¤ESé›†ç¾¤æ€»çš„åˆ†ç‰‡æ•° = åˆ†ç‰‡æ•° * (å‰¯æœ¬æ•° + 1)</span><br></pre></td></tr></table></figure><p><strong>å‰¯æœ¬æ•°åˆ†é…ç®—æ³•ï¼š</strong></p><blockquote><p>å‰¯æœ¬æ•° &lt;= ESé›†ç¾¤çš„æœåŠ¡å™¨ä¸ªæ•° - 1</p></blockquote><p>å‰¯æœ¬é™¤äº†æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä¸»è¦ç›®çš„ä¸ºäº†å®¹ç¾ï¼Œæ•°æ®å†—ä½™å­˜å‚¨ï¼Œä¿è¯æ•°æ®å®‰å…¨ï¼Œå› æ­¤ï¼Œå‰¯æœ¬æ•°åº”è·Ÿæ®ESé›†ç¾¤ä¸­çš„æ•°æ®åº“æ•°é‡ï¼ˆN-1ï¼‰è¿›è¡Œé…ç½®ï¼Œå¦‚æœESé›†ç¾¤ä¸­æœ‰3å°æœåŠ¡å™¨ï¼Œåˆ™å‰¯æœ¬æ•°è®¾ç½®ä¸º2ï¼Œå‡ 1 å› ä¸ºä¸»åˆ†ç‰‡æœ¬èº«ä¹Ÿç®—ä¸€ä»½ã€‚å‰¯æœ¬æ•°è®¾ç½®ä¸º2ï¼Œæ•°æ®å®é™…ä¸Šæœ‰3ä»½ï¼Œåˆ†æ•£åˆ°3å°æœåŠ¡å™¨ä¸­ã€‚</p><blockquote><p>é¢„ä¼°è¦å­˜å…¥ESæ€»æ•°æ®é‡ * (å‰¯æœ¬æ•°+1) &lt;= ESé›†ç¾¤çš„æ€»å†…å­˜ / 2</p></blockquote><p>å­˜å…¥ESæœç´¢å¼•æ“ çš„æ•°æ®å¯ä»¥é¢„ä¼°ï¼Œæ¯”å¦‚é¢„ä¼°å­˜å…¥çš„æ•°æ®æœ‰ 100Gï¼Œåˆ™å®é™…ä¸Šä¼šå ç”¨çš„å†…å­˜ä¸º 100G * (å‰¯æœ¬æ•°+1) åŠ  1 å› ä¸ºè®¡å…¥äº†ä¸»åˆ†ç‰‡ï¼Œæ•°é‡é‡Œè¶…é™äº†ä¹Ÿå¯ä»¥å­˜å…¥ï¼Œåªè¦ç£ç›˜å¤Ÿå¤§ï¼Œä½†æ˜¯è®¡ç®—æ—¶å°±å¯èƒ½ç”¨åˆ°äº†ç£ç›˜ï¼Œç£ç›˜çš„IOæ€§èƒ½ä¼šè®©æ•´ä¸ªESé›†ç¾¤æ€§èƒ½å¤§å‰¯ä¸‹é™ã€‚</p><p>ESé›†ç¾¤çš„æ€»å†…å­˜åªå–äº†ä¸€åŠï¼Œå› ä¸ºè€ƒè™š ES çš„ java. ç¨‹åºæœ¬èº«å ç”¨çš„å†…å­˜ï¼Œæ•°æ®èšåˆè¿ç®—æ¶ˆè€—çš„å†…å­˜ï¼Œå¦‚æœå®é™…é¡¹ç›®ä¸­å¤§é‡å¤æ‚è¿ç®—ï¼Œå ç”¨çš„å†…å­˜éœ€è¦æ›´å¤šã€‚</p><p><strong>åˆ†ç‰‡æ•°åˆ†é…ç®—æ³•ï¼š</strong></p><blockquote><p>åˆ†ç‰‡æ•° * (å‰¯æœ¬æ•° + 1) &lt;= ESé›†ç¾¤çš„æ€»CPUæ ¸å¿ƒä¸ªæ•°</p></blockquote><p>åˆ†ç‰‡å†…çš„æ£€ç´¢è¿ç®—èšåˆéœ€è¦ CPUï¼Œ ä¸ºäº†å……åˆ†å‘æŒ¥å¤šæ ¸CPUçš„æ€§èƒ½ï¼Œä¸”åˆé¿å…CPUé¢‘ç¹è°ƒåº¦ï¼Œå› æ­¤ï¼ŒESé›†ç¾¤å†…æ€»çš„åˆ†ç‰‡æ•°åº”å°äºç­‰äºæ€»çš„CPUæ ¸å¿ƒä¸ªæ•°ã€‚</p><p><strong>document</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- document: æ–‡æ¡£</span><br><span class="line">ESæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£å‹æ•°æ®åº“ï¼Œå’ŒmangoDBç±»ä¼¼ã€‚</span><br><span class="line">æ¯ä¸ªæ–‡ä»¶çš„æ•°æ®åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š å…ƒæ•°æ®å’Œæºæ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">1.å…ƒæ•°æ®(metadata):</span><br><span class="line">ç”¨äºæè¿°æºæ•°æ®çš„æ•°æ®ã€‚</span><br><span class="line">å¸¸è§çš„å­—æ®µå¦‚ä¸‹:</span><br><span class="line">_index:</span><br><span class="line">è¡¨ç¤ºæ–‡æ¡£éš¶å±äºå“ªä¸ªç´¢å¼•ã€‚</span><br><span class="line">_id:</span><br><span class="line">è¡¨ç¤ºæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ã€‚</span><br><span class="line">_source:</span><br><span class="line">ä»£è¡¨ç”¨æˆ·å®é™…å­˜å‚¨çš„æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">2.æºæ•°æ®(<span class="built_in">source</span> data):</span><br><span class="line">ç”¨æˆ·å®é™…å†™å…¥çš„æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">- allocation(åˆ†é…):</span><br><span class="line">  æŒ‡çš„æ˜¯å°†ç´¢å¼•çš„ä¸åŒåˆ†ç‰‡å’Œå‰¯æœ¬åˆ†é…åˆ°æ•´ä¸ªESé›†ç¾¤çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªåˆ†é…è¿‡ç¨‹ç”±ESé›†ç¾¤è‡ªå·±å®ç°ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡è®²è¿°äº†åŸºäºEFKæ¶æ„çš„æ—¥å¿—æ”¶é›†éƒ¨ç½²åŠç®€å•æ—¥å¿—åˆ†æ</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>03-k8sPODèµ„æº</title>
    <link href="https://lukme.top/posts/df6c32c8.html"/>
    <id>https://lukme.top/posts/df6c32c8.html</id>
    <published>2024-10-04T14:14:29.000Z</published>
    <updated>2024-10-06T14:17:32.938Z</updated>
    
    <content type="html"><![CDATA[<h2 id="k8sèµ„æºæ¸…å•æè¿°"><a href="#k8sèµ„æºæ¸…å•æè¿°" class="headerlink" title="k8sèµ„æºæ¸…å•æè¿°"></a>k8sèµ„æºæ¸…å•æè¿°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ApiVersion:</span><br><span class="line">èµ„æºçš„ç‰ˆæœ¬ï¼Œå®˜æ–¹å¯¹æ¯ä¸ªèµ„æºè§„å®šäº†ä¸åŒçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®èµ„æºçš„ç‰ˆæœ¬è¿›è¡Œä¹¦å†™ã€‚</span><br><span class="line">ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œèµ„æºçš„ç‰ˆæœ¬å¾ˆå°‘å˜åŠ¨ï¼Œé™¤éåœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œéšç€åŠŸèƒ½çš„å¢å¼ºï¼Œç‰ˆæœ¬å¯èƒ½ä¹Ÿä¼šå¾®è°ƒã€‚</span><br><span class="line"></span><br><span class="line">kind:</span><br><span class="line">èµ„æºçš„ç±»å‹ï¼ŒK8Sé›†ç¾¤ä¸­ä¸€åˆ‡çš†èµ„æºã€‚</span><br><span class="line"></span><br><span class="line">metadata:</span><br><span class="line">èµ„æºçš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š </span><br><span class="line">- èµ„æºçš„åç§°;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºæ‰€å±çš„åç§°ç©ºé—´;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„æ ‡ç­¾;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„æ³¨è§£;(æ—©æœŸç‰ˆæœ¬å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„åˆ›å»ºæ—¶é—´;</span><br><span class="line">- ...</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line">å®šä¹‰äº†ç”¨æˆ·å¯¹Podçš„æœŸæœ›çŠ¶æ€ã€‚ç”¨æˆ·å¯ä»¥åšå¦‚ä¸‹æ“ä½œ:</span><br><span class="line">- æŒ‡å®šèŠ‚ç‚¹è°ƒåº¦;</span><br><span class="line">- æŒ‡å®šè°ƒåº¦çš„äº²å’Œæ€§æˆ–åäº²å’Œæ€§;</span><br><span class="line">- èµ„æºçš„æ•°æ®æ˜¯å¦è¿›è¡ŒæŒä¹…åŒ–;</span><br><span class="line">- èµ„æºçš„é…ç½®æ–‡ä»¶æ˜¯å¦éœ€è¦ä¿®æ”¹;</span><br><span class="line">- èµ„æºçš„å®¹å™¨ä½¿ç”¨å…·ä½“çš„é•œåƒ;</span><br><span class="line">- èµ„æºçš„é™åˆ¶</span><br><span class="line">- èµ„æºçš„è®¤è¯ä¿¡æ¯</span><br><span class="line">- èµ„æºçš„å®‰å…¨ä¿¡æ¯</span><br><span class="line">- ...</span><br><span class="line"></span><br><span class="line">status:</span><br><span class="line">èµ„æºå®é™…çš„çŠ¶æ€ï¼Œæ¯”å¦‚è°ƒåº¦åˆ°å“ªä¸ªworkerèŠ‚ç‚¹ï¼Œå®é™…åˆ†é…çš„IPåœ°å€ï¼Œè¿è¡Œå‘¨æœŸï¼Œé‡å¯æ¬¡æ•°ç­‰ã€‚</span><br><span class="line">è¯¥èµ„æºä¸€èˆ¬ä¸éœ€è¦äººä¸ºå®šä¹‰ï¼Œè€Œæ˜¯æœ‰K8Sé›†ç¾¤è‡ªèº«ç»´æŠ¤ã€‚</span><br></pre></td></tr></table></figure><h2 id="podèµ„æºåŠèµ„æºæ¸…å•"><a href="#podèµ„æºåŠèµ„æºæ¸…å•" class="headerlink" title="podèµ„æºåŠèµ„æºæ¸…å•"></a>podèµ„æºåŠèµ„æºæ¸…å•</h2><p><strong>1.PODèµ„æº</strong></p><p><strong>kubernetesèµ„æºå¯¹è±¡æ“ä½œ</strong></p><div class="table-container"><table><thead><tr><th>èµ„æºå¯¹è±¡</th><th>å¢</th><th>åˆ </th><th>æ”¹</th><th>æŸ¥</th></tr></thead><tbody><tr><td>node</td><td></td><td>kubectl delete node</td><td></td><td>kubectl get nodes</td></tr><tr><td>namespace</td><td>kubectl create ns [èµ„æºå]</td><td>kubectl delete ns [èµ„æºå]</td><td>kubectl edit ns [èµ„æºå]</td><td>kubectl get ns</td></tr><tr><td>pod</td><td></td><td>kubectl delete pod [èµ„æºå]</td><td>kubectl edit pod[èµ„æºå]</td><td>kubectl get pod</td></tr></tbody></table></div><p><strong>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE     VERSION</span><br><span class="line">master   Ready    master   4d13h   v1.19.3</span><br><span class="line">node01   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br><span class="line">node02   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br><span class="line">node03   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹åç§°ç©ºé—´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   4d13h</span><br><span class="line">kube-flannel      Active   4d12h</span><br><span class="line">kube-node-lease   Active   4d13h</span><br><span class="line">kube-public       Active   4d13h</span><br><span class="line">kube-system       Active   4d13h</span><br><span class="line">luay              Active   4h17m</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹pod  (é»˜è®¤defaultåç§°ç©ºé—´)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   0          6h8m</span><br><span class="line">nginx-pod                1/1     Running   0          5h43m</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹pod  (æŒ‡å®šåç§°ç©ºé—´)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -n luay</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">busybox-pod   2/2     Running   0          3m30s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master ~]# kubectl get pod -n luay -o wide</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE     IP         NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">busybox-pod   2/2     Running   0          4m14s   10.2.2.6   node03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">-n æŒ‡å®šå‘½åç©ºé—´</span><br><span class="line">-o æŒ‡å®šè¾“å‡ºæ–¹å¼</span><br><span class="line">jsonï¼šè¾“å‡ºjsonæ ¼å¼</span><br><span class="line">yamlï¼šè¾“å‡ºyamlæ ¼å¼</span><br><span class="line">wideï¼šè¾“å‡ºè¯¦ç»†ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><strong>2.podçš„èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# vim nginx.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pod</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: nginx-containers</span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line">apiVersion: v1       <span class="comment"># K8Sèµ„æºæ¥å£</span></span><br><span class="line">kind: Pod            <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line">metadata:            <span class="comment">#èµ„æºçš„å…ƒæ•°æ®</span></span><br><span class="line">  name: nginx-pod    <span class="comment"># PODåå­—</span></span><br><span class="line">  namespace: default <span class="comment"># æŒ‡å®šèµ„æºå¯åŠ¨åœ¨å“ªä¸ªåç§°ç©ºé—´ï¼Œé»˜è®¤default</span></span><br><span class="line">spec:                <span class="comment">#å®¹å™¨ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">  containers:        <span class="comment">#å®¹å™¨ä¿¡æ¯</span></span><br><span class="line">  - image: nginx:alpine           <span class="comment">#æŒ‡å®šå®¹å™¨é•œåƒ</span></span><br><span class="line">    imagePullPolicy: IfNotPresent <span class="comment">#æŒ‡å®šé•œåƒæ‹‰å–è§„åˆ™</span></span><br><span class="line">    name: nginx-containers        <span class="comment">#å®¹å™¨åå­—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Alwaysï¼šæ€»æ˜¯æ‹‰å–é•œåƒï¼Œä¸ç®¡å½“å‰æœºå™¨ä¸Šæ˜¯å¦æœ‰è¯¥é•œåƒéƒ½æ‹‰å– nginx:latest</span><br><span class="line">Neverï¼šä»ä¸æ‹‰å–é•œåƒï¼Œéœ€è¦æå‰docker pull</span><br><span class="line">IfNotPresentï¼šå¦‚æœé•œåƒä¸å­˜åœ¨ï¼Œåˆ™æ‹‰å–</span><br></pre></td></tr></table></figure><h2 id="podæŠ¥é”™åŠå¯èƒ½åŸå› "><a href="#podæŠ¥é”™åŠå¯èƒ½åŸå› " class="headerlink" title="podæŠ¥é”™åŠå¯èƒ½åŸå› "></a>podæŠ¥é”™åŠå¯èƒ½åŸå› </h2><pre><code>1.ImagePullBackOff  é—®é¢˜åŸå› :      é•œåƒæ‹‰å–å¤±è´¥ã€‚  å¯èƒ½åŸå› ï¼š      1.å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜å¯¼è‡´ï¼Œæ£€æŸ¥Podæ‰€åœ¨èŠ‚ç‚¹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è®¿é—®ç½‘ç»œ;      2.é•œåƒåç§°å†™é”™ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé”™è¯¯;      3.é•œåƒæ˜¯ç§æœ‰ä»“åº“ï¼Œé•œåƒæ— æƒé™æ‹‰å–;2.ContainerCreating    é—®é¢˜åˆ†æ:        å®¹å™¨æ­£åœ¨åˆ›å»ºé˜¶æ®µï¼Œç­‰å¾…å®¹å™¨åˆ›å»ºï¼Œè¯¥è¿‡ç¨‹åŒ…å«æ‹‰å–é•œåƒçš„æ—¶é—´ã€‚3.Pending    é—®é¢˜åˆ†æ:        ä»»åŠ¡å·²ç»è¢«K8Sé›†ç¾¤æ¥å—ï¼Œä½†æ˜¯æœªè°ƒåº¦åˆ°æŒ‡å®šèŠ‚ç‚¹ã€‚    å¯èƒ½åŸå› :        1.å½“å‰é›†ç¾¤ä¸æ­£å¸¸å·¥ä½œï¼Œè¯·æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼Œæ¯”å¦‚CNIç»„ä»¶æœªå®‰è£…;        2.æŒ‡å®šçš„è°ƒåº¦çš„èŠ‚ç‚¹ä¸å­˜åœ¨æ—¶ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜;        3.ç«¯å£å†²çªï¼Œæ— æ³•å®Œæˆè°ƒåº¦;        4.æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«æ‰“ä¸Šæ±¡ç‚¹ï¼Œä¸”podæ²¡æœ‰é…ç½®æ±¡ç‚¹å®¹å¿ä¹Ÿä¼šå¯¼è‡´è¯¥çŠ¶æ€;4.CrashLoopBackOff    é—®é¢˜åˆ†æ:        å¤„äºè¯¥çŠ¶æ€ï¼Œè¯´æ˜Podå†…è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨é‡å¯ã€‚    å¯èƒ½åŸå› :        1.å¯èƒ½æ˜¯å®¹å™¨çš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œå‘½ä»¤ç»“æŸå¯¼è‡´çš„;5.Completed    é—®é¢˜åˆ†æ:        å®¹å™¨æ­£å¸¸é€€å‡ºï¼Œå®¹å™¨æ²¡æœ‰è¢«å¼ºåˆ¶ä¸­æ–­ã€‚6.Running    é—®é¢˜åˆ†æ:        è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ã€‚7.Init:1/2     é—®é¢˜åˆ†æ:        å½“å‰çš„Podå¤„äºåˆå§‹åŒ–å®¹å™¨é˜¶æ®µï¼Œç›®å‰å·²ç»å®Œæˆä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ï¼Œæ­£åœ¨è¿›è¡Œç¬¬äºŒä¸ªå®¹å™¨åˆå§‹åŒ–ã€‚8.PodInitializing    é—®é¢˜åˆ†æ:        Podæ­£å¤„äºåˆå§‹åŒ–é˜¶æ®µã€‚9.ErrImageNeverPull     é—®é¢˜åˆ†æ:        å°†é•œåƒä¸‹è½½ç­–ç•¥è®¾ç½®ä¸ºNeverï¼Œä¸”æœ¬åœ°ä¹Ÿæ²¡æœ‰ç¼“å­˜é•œåƒï¼Œå› æ­¤å¯åŠ¨å®¹å™¨å¤±è´¥ã€‚10.OutOfcpu    é—®é¢˜åˆ†æ:        ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç”±äºCPUèµ„æºä¸è¶³å¯¼è‡´çš„ã€‚11.OutOfmemory    é—®é¢˜åˆ†æ:        ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç”±äºå†…å­˜ä¸è¶³æ— æ³•åˆ†é…å¯¼è‡´çš„ã€‚12.NodePorts    é—®é¢˜åˆ†æ:        å½“å‰çš„workerèŠ‚ç‚¹çš„ç«¯å£å¯èƒ½å­˜åœ¨å†²çªã€‚13.RunContainerError    é—®é¢˜åˆ†æ:        è¿è¡Œå®¹å™¨æ—¶å‡ºé”™ï¼Œå¯ä»¥é€šè¿‡kubectl describe pods &lt;POD_NAME&gt;æŸ¥çœ‹è¯¦ç»†çš„ä¿¡æ¯ã€‚14.ErrImagePull    é—®é¢˜åˆ†æ:        æ‹‰å–é•œåƒæ˜¯å¤±è´¥ã€‚    å¯èƒ½åŸå› :        1.é•œåƒåç§°å†™é”™äº†;        2.æ²¡æœ‰è®¿é—®æƒé™;15.Terminating    é—®é¢˜åˆ†æ:        Podçš„å®¹å™¨æ­£åœ¨åˆ é™¤ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šè¶…è¿‡30sã€‚16.CreateContainerConfigError    é—®é¢˜åˆ†æ:        è¿è¡Œå®¹å™¨å‡ºé”™ï¼Œä¸€èˆ¬æƒ…ä¸‹ï¼Œæ˜¯é…ç½®å‡ºé”™ã€‚17.ContainerStatusUnknown    é—®é¢˜åˆ†æ:        å®¹å™¨é‡å¯ç­–ç•¥ä¸ºNerverï¼Œä¸”æˆ‘ä»¬æµ‹è¯•æ—¶å°†å·¥ä½œèŠ‚ç‚¹çš„å®¹å™¨ç›´æ¥åˆ é™¤å•¦ã€‚æ— æ³•è·å–</code></pre><h2 id="èµ„æºæ¸…å•ç¼–å†™æ¡ˆä¾‹"><a href="#èµ„æºæ¸…å•ç¼–å†™æ¡ˆä¾‹" class="headerlink" title="èµ„æºæ¸…å•ç¼–å†™æ¡ˆä¾‹"></a>èµ„æºæ¸…å•ç¼–å†™æ¡ˆä¾‹</h2><p><strong>åŸºäºä¸€ä¸ªpodéƒ¨ç½²wordpress</strong></p><p><strong>1.ç¼–å†™èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# <span class="built_in">cat</span> wordpress.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-pod</span><br><span class="line">spec:</span><br><span class="line"> <span class="comment"># ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œåç§°ç©ºé—´</span></span><br><span class="line">  hostNetwork: <span class="literal">true</span></span><br><span class="line">  containers:</span><br><span class="line">  - name: db</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: wp</span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  - name: wp</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: WORDPRESS_DB_HOST</span><br><span class="line">      value: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_NAME</span><br><span class="line">      value: wp</span><br><span class="line">    - name: WORDPRESS_DB_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>2.æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºpod</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl apply -f wordpress.yaml</span><br><span class="line"></span><br><span class="line">`å› ä¸ºä½¿ç”¨çš„å®¿ä¸»æœºç½‘ç»œåç§°ç©ºé—´ï¼Œéœ€ä¿è¯80ç«¯å£ä¸è¢«å ç”¨`</span><br></pre></td></tr></table></figure><p><strong>3.æŸ¥çœ‹podèŠ‚ç‚¹ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl get pod -o wide</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   IP           NODE    </span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   0          8h    10.2.2.2     node03  </span><br><span class="line">nginx-pod                1/1     Running   0          8h    10.2.2.3     node03  </span><br><span class="line">wordpress-pod            2/2     Running   0          36m   10.0.0.203   node03  </span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºèŠ‚ç‚¹node03   ip 10.0.0.203</span></span><br><span class="line">æµè§ˆå™¨è®¿é—®10.0.0.203</span><br></pre></td></tr></table></figure><p><strong>åŸºäºä¸€ä¸ªpodèµ·wordpressï¼ŒåšæŒä¹…åŒ–</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# <span class="built_in">cat</span> wordpress.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">    run: mysql</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#å¦‚æœä½¿ç”¨ä¸‹é¢portsï¼Œè¿™ä¸ªå¯ä»¥ä¸ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span></span><br><span class="line">  hostNetwork: <span class="literal">true</span></span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql</span><br><span class="line">  containers:</span><br><span class="line">  - name: db</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: wp</span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: mysql-data</span><br><span class="line">      mountPath: /var/lib/mysql</span><br><span class="line">      </span><br><span class="line">  - name: wp</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="comment">#ç›¸å½“äºæš´éœ²ç«¯å£ï¼Œç›´æ¥ä½¿ç”¨èŠ‚ç‚¹çš„å®¿ä¸»æœºipè®¿é—®å³å¯Â·</span></span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 80</span><br><span class="line">      hostPort: 80</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: WORDPRESS_DB_HOST</span><br><span class="line">      value: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_NAME</span><br><span class="line">      value: wp</span><br><span class="line">    - name: WORDPRESS_DB_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="è¿æ¥pod"><a href="#è¿æ¥pod" class="headerlink" title="è¿æ¥pod"></a>è¿æ¥pod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## è¿æ¥åˆ°POD</span></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it nginx-pod -- /bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment">## å½“ä¸€ä¸ªPODä¸­æœ‰å¤šä¸ªå®¹å™¨æ—¶ï¼Œä½¿ç”¨-cæŒ‡å®šå®¹å™¨åï¼Œè¿æ¥åˆ°æŒ‡å®šçš„å®¹å™¨</span></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it nginx-busybox -c busybox-container -- /bin/sh</span><br></pre></td></tr></table></figure><h2 id="podçš„ç½‘ç»œå…±äº«"><a href="#podçš„ç½‘ç»œå…±äº«" class="headerlink" title="podçš„ç½‘ç»œå…±äº«"></a>podçš„ç½‘ç»œå…±äº«</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.PODå†…çš„å®¹å™¨ä½¿ç”¨Containeræ¨¡å¼å…±äº«æ ¹å®¹å™¨çš„ç½‘ç»œ</span><br><span class="line">2.å®¹å™¨çœ‹åˆ°çš„ç½‘ç»œè®¾å¤‡ä¿¡æ¯å’Œæ ¹å®¹å™¨å®Œå…¨ç›¸åŒ</span><br><span class="line">3.PODå†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥ä½¿ç”¨localhostè¿›è¡Œç½‘ç»œé€šè®¯</span><br><span class="line">4.PODå†…çš„å¤šä¸ªå®¹å™¨ä¸èƒ½ç»‘å®šç›¸åŒçš„ç«¯å£</span><br><span class="line">5.PODçš„ç”Ÿå‘½å‘¨æœŸå’Œæ ¹å®¹å™¨ä¸€æ ·ï¼Œå¦‚æœæ ¹å®¹å™¨é€€å‡ºäº†ï¼ŒPODå°±é€€å‡ºäº†</span><br></pre></td></tr></table></figure><h2 id="podçš„æ–‡ä»¶å…±äº«"><a href="#podçš„æ–‡ä»¶å…±äº«" class="headerlink" title="podçš„æ–‡ä»¶å…±äº«"></a>podçš„æ–‡ä»¶å…±äº«</h2><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241002101149735.png" alt="image-20241002101149735"></p><h3 id="æŒ‚è½½æ–¹å¼hostPath"><a href="#æŒ‚è½½æ–¹å¼hostPath" class="headerlink" title="æŒ‚è½½æ–¹å¼hostPath"></a>æŒ‚è½½æ–¹å¼hostPath</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> mysql.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql57-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">    run: mysql</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data</span><br><span class="line">  <span class="comment">#å®¿ä¸»æœºæŒ‚è½½çš„ç›®å½•</span></span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql</span><br><span class="line">  containers:</span><br><span class="line">  - name: mysql57-container</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  <span class="built_in">env</span>:</span><br><span class="line">  - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  - name: MYSQL_DATABASE</span><br><span class="line">    value: <span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">  - name: MYSQL_USER</span><br><span class="line">    value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">  - name: MYSQL_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  <span class="comment">#ä¼ é€’å‘½ä»¤æŒ‡å®šå­—ç¬¦é›†</span></span><br><span class="line">  args:</span><br><span class="line">  - --character-set-server=utf8mb4</span><br><span class="line">  - --collation-server=utf8mb4_unicode_ci</span><br><span class="line">  volumeMounts:</span><br><span class="line">  <span class="comment">#nameè¦å’Œä¸Šé¢æŒ‚è½½ç›®å½•çš„nameä¸€è‡´ï¼ŒmountPathæ˜¯å®¹å™¨å†…çš„è¦æŒ‚è½½çš„ç›®å½•</span></span><br><span class="line">  - name: mysql-data</span><br><span class="line">    mountPath: /var/lib/mysql</span><br></pre></td></tr></table></figure><h3 id="hostPathçš„typeç±»å‹"><a href="#hostPathçš„typeç±»å‹" class="headerlink" title="hostPathçš„typeç±»å‹"></a>hostPathçš„typeç±»å‹</h3><blockquote><p>hostPath:<br>path: string<br>type : string</p><p>type ä¸ºç©ºæ—¶ä¸ºé»˜è®¤ç±»å‹</p><p><code>å®˜æ–¹ï¼šhttps://kubernetes.io/docs/concepts/storage/volumes/#hostpath</code></p></blockquote><div class="table-container"><table><thead><tr><th>typeç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>â€œâ€</td><td>ä¸ºç©ºæ—¶   é»˜è®¤</td></tr><tr><td>DirectoryOrCreate</td><td>ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œæƒé™å¿…é¡»æ˜¯755</td></tr><tr><td>Directory</td><td>ç›®å½•å¿…é¡»å­˜åœ¨</td></tr><tr><td>FileOrCreate</td><td>æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œæƒé™å¿…é¡»æ˜¯644</td></tr><tr><td>File</td><td>æ–‡ä»¶å¿…é¡»å­˜åœ¨</td></tr><tr><td>Socket</td><td>æŒ‚è½½socketæ–‡ä»¶</td></tr><tr><td>CharDevice</td><td>æŒ‚è½½å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼ˆé”®ç›˜ï¼Œç»ˆç«¯â€¦ï¼‰</td></tr><tr><td>BlockDevice</td><td>æŒ‚è½½å¿«è®¾å¤‡æ–‡ä»¶ï¼ˆç£ç›˜ï¼ŒUç›˜ï¼Œç§»åŠ¨ç¡¬ç›˜â€¦ï¼‰</td></tr></tbody></table></div><h3 id="æŒ‚è½½æ–¹å¼emptyDir"><a href="#æŒ‚è½½æ–¹å¼emptyDir" class="headerlink" title="æŒ‚è½½æ–¹å¼emptyDir"></a>æŒ‚è½½æ–¹å¼emptyDir</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å°†podå†…å®¹å™¨ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œå¦‚æœPODç»“æŸï¼Œç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> mysql.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql57-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">    run: mysql</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql</span><br><span class="line">  - name: empty-data</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">  containers:</span><br><span class="line">  - name: mysql57-container</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  <span class="built_in">env</span>:</span><br><span class="line">  - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  - name: MYSQL_DATABASE</span><br><span class="line">    value: <span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">  - name: MYSQL_USER</span><br><span class="line">    value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">  - name: MYSQL_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  args:</span><br><span class="line">  - --character-set-server=utf8mb4</span><br><span class="line">  - --collation-server=utf8mb4_unicode_ci</span><br><span class="line">  volumeMounts:</span><br><span class="line">  - name: empty-data</span><br><span class="line">    mountPath: /var/lib/mysql</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">## å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•</span></span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> busybox.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-busybox</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: empty-data</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: empty-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: empty-data</span><br><span class="line">      mountPath: /opt/ html</span><br></pre></td></tr></table></figure><h2 id="æ ‡ç­¾çš„ä½¿ç”¨åŠè®¾ç½®"><a href="#æ ‡ç­¾çš„ä½¿ç”¨åŠè®¾ç½®" class="headerlink" title="æ ‡ç­¾çš„ä½¿ç”¨åŠè®¾ç½®"></a>æ ‡ç­¾çš„ä½¿ç”¨åŠè®¾ç½®</h2><h3 id="nodeèŠ‚ç‚¹æ‰“æ ‡ç­¾"><a href="#nodeèŠ‚ç‚¹æ‰“æ ‡ç­¾" class="headerlink" title="nodeèŠ‚ç‚¹æ‰“æ ‡ç­¾"></a>nodeèŠ‚ç‚¹æ‰“æ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">kubectl get [èµ„æº] -n åç§°ç©ºé—´ --show-labels</span><br><span class="line"><span class="comment">## æŸ¥çœ‹nodeæ ‡ç­¾</span></span><br><span class="line">[root@master01 ~]# kubectl get nodes --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™nodeæ‰“æ ‡ç­¾</span></span><br><span class="line">[root@master01 ~]# kubectl label node node01 MEM=16g</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nodeè§’è‰²æ ‡ç­¾role</span></span><br><span class="line">[root@master kubernetes]# kubectl get nodes </span><br><span class="line">NAME     STATUS   ROLES    AGE     VERSION</span><br><span class="line">master   Ready    master   5d15h   v1.19.3</span><br><span class="line">node01   Ready    None     5d15h   v1.19.3</span><br><span class="line">node02   Ready    None     5d15h   v1.19.3</span><br><span class="line">node03   Ready    None     5d15h   v1.19.3</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™nodeè§’è‰²æ ‡ç­¾role</span></span><br><span class="line">[root@master kubernetes]# kubectl label node node01 node-role.kubernetes.io/node=</span><br><span class="line">[root@master kubernetes]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES        AGE     VERSION</span><br><span class="line">master   Ready    master       5d15h   v1.19.3</span><br><span class="line">node01   Ready    node         5d15h   v1.19.3</span><br><span class="line">node02   Ready    None         5d15h   v1.19.3</span><br><span class="line">node03   Ready    None         5d15h   v1.19.3</span><br><span class="line"></span><br><span class="line">kubectl label node node01 node-role.kubernetes.io/node=</span><br><span class="line">                   èŠ‚ç‚¹å    è°ƒç”¨æ¥å£             /rolesæ ‡ç­¾å=</span><br><span class="line">                   </span><br><span class="line"><span class="comment">#åˆ é™¤nodeè§’è‰²æ ‡ç­¾role</span></span><br><span class="line">[root@master kubernetes]# kubectl label node node01 node-role.kubernetes.io/node-</span><br></pre></td></tr></table></figure><h3 id="ç»™podæ‰“æ ‡ç­¾"><a href="#ç»™podæ‰“æ ‡ç­¾" class="headerlink" title="ç»™podæ‰“æ ‡ç­¾"></a>ç»™podæ‰“æ ‡ç­¾</h3><p><strong>ç»™podæ‰“æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹podæ ‡ç­¾</span></span><br><span class="line">[root@master kubernetes]# kubectl get pods --show-labels </span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          33h     app=nginx</span><br><span class="line">nginx-pod                1/1     Running   2          33h     &lt;none&gt;</span><br><span class="line">wordpress-pod            2/2     Running   0          2m11s   &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰“æ ‡ç­¾</span></span><br><span class="line">kubectl label èµ„æºç±»å‹ èµ„æºå æ ‡ç­¾</span><br><span class="line">[root@master kubernetes]# kubectl label pod nginx-pod name=nginx</span><br><span class="line"><span class="string">&#x27;pod/nginx-pod labeled</span></span><br><span class="line"><span class="string">[root@master kubernetes]# kubectl get pods --show-labels </span></span><br><span class="line"><span class="string">NAME                     READY   STATUS    RESTARTS   AGE     LABELS</span></span><br><span class="line"><span class="string">nginx-565785f75c-tpjmj   1/1     Running   2          33h     app=nginx</span></span><br><span class="line"><span class="string">nginx-pod                1/1     Running   2          33h     name=nginx</span></span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨èµ„æºæ¸…å•æ‰“æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">Kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    run: nginx</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure><p><strong>åˆ©ç”¨æ ‡ç­¾ï¼Œå¯åŠ¨podåœ¨æŒ‡å®šæ ‡ç­¾çš„nodeä¸Š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> nginx-2.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pod-v2</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    run: nginx</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#è¿™é‡Œæ˜¯é€‰æ‹©èµ·åœ¨æ ‡ç­¾æ˜¯MEM: 16gçš„nodeèŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨kubectl get nodes --show-labels æŸ¥çœ‹nodeæ ‡ç­¾</span></span><br><span class="line">  nodeSelector:</span><br><span class="line">  MEM: 16g</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container-v2</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤podæ ‡ç­¾"><a href="#åˆ é™¤podæ ‡ç­¾" class="headerlink" title="åˆ é™¤podæ ‡ç­¾"></a>åˆ é™¤podæ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kubectl label [èµ„æº] [èµ„æºå] [æ ‡ç­¾åã€æ ‡ç­¾key]-</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰podæœ‰çš„æ ‡ç­¾</span></span><br><span class="line">[root@master kubernetes]# kubectl get pods --show-labels</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          35h   app=nginx,pod-template-hash=565785f75c</span><br><span class="line">nginx-pod                1/1     Running   2          34h   name=nginx</span><br><span class="line">wordpress-pod            2/2     Running   0          39m   &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤podæ ‡ç­¾</span></span><br><span class="line">[root@master kubernetes]# kubectl label pod nginx-pod name-</span><br><span class="line">pod/nginx-pod labeled</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹</span></span><br><span class="line">[root@master kubernetes]# kubectl get pods --show-labels</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          35h   app=nginx,pod-template-hash=565785f75c</span><br><span class="line">nginx-pod                1/1     Running   2          34h   &lt;none&gt;</span><br><span class="line">wordpress-pod            2/2     Running   0          39m   &lt;none&gt;</span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾pod"><a href="#æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾pod" class="headerlink" title="æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾pod"></a>æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾pod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl get pod --show-labels -l app</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          35h   app=nginx,pod-template-hash=565785f75c</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨  `-l`  æŸ¥æ‰¾æŒ‡å®šçš„pod</span></span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®æ ‡ç­¾åˆ é™¤pod"><a href="#æ ¹æ®æ ‡ç­¾åˆ é™¤pod" class="headerlink" title="æ ¹æ®æ ‡ç­¾åˆ é™¤pod"></a>æ ¹æ®æ ‡ç­¾åˆ é™¤pod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl delete pod -l app=nginx</span><br></pre></td></tr></table></figure><h2 id="kubectlç”¨äºæ’é”™å‘½ä»¤"><a href="#kubectlç”¨äºæ’é”™å‘½ä»¤" class="headerlink" title="kubectlç”¨äºæ’é”™å‘½ä»¤"></a>kubectlç”¨äºæ’é”™å‘½ä»¤</h2><h3 id="describe"><a href="#describe" class="headerlink" title="describe"></a>describe</h3><blockquote><p><code>kubectl describe pod</code></p><p>æŸ¥çœ‹ç›¸å…³ Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬äº†è§£ Pod çš„çŠ¶æ€ã€é…ç½®å’Œè¿è¡ŒçŠ¶å†µã€‚å°¤å…¶æ˜¯Eventså¯ä»¥å¸®åŠ©æˆ‘ä»¬åšä¸€äº›æ•…éšœæ’æŸ¥ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl describe pod busybox-pod -n luay</span><br><span class="line"><span class="comment">#å¦‚æœæŸ¥çœ‹çš„podçš„åç§°ç©ºé—´ä¸æ˜¯é»˜è®¤defaultï¼Œåˆ™éœ€è¦æŒ‡å®š -n</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  18m   default-scheduler  Successfully assigned luay/busybox-pod to node03</span><br><span class="line">  Normal  Pulled     18m   kubelet            Container image <span class="string">&quot;busybox&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    18m   kubelet            Created container busybox-container</span><br><span class="line">  Normal  Started    18m   kubelet            Started container busybox-container</span><br><span class="line">  Normal  Pulled     18m   kubelet            Container image <span class="string">&quot;nginx:alpine&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    18m   kubelet            Created container nginx-container</span><br><span class="line">  Normal  Started    18m   kubelet            Started container nginx-container</span><br><span class="line">  </span><br><span class="line"><span class="comment">#æŸ¥çœ‹nodeèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">[root@master ~]# kubectl describe node master01</span><br></pre></td></tr></table></figure><h3 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h3><blockquote><p><code>kubectl logs èµ„æºå</code>   å¯ä»¥ä½¿ç”¨kubectl get pod  æŸ¥çœ‹èµ„æºå</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;kubectl logs èµ„æºåç§°&#x27;</span></span><br><span class="line">[root@master ~]# kubectl logs mysql80 </span><br><span class="line"></span><br><span class="line"><span class="comment">#å®æ—¶æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">[root@master ~]# kubectl logs -f mysql80 </span><br><span class="line"></span><br><span class="line"><span class="comment">#åŸºäºä¸€ä¸ªPodå†…å¤šä¸ªå®¹å™¨æŸ¥çœ‹æŒ‡çš„å®¹å™¨çš„æ—¥å¿—   -c  æŒ‡å®šå®¹å™¨å</span></span><br><span class="line">[root@master ~]# kubectl logs -f multiple-wordpress -c db</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;multiple-wordpress&#x27;</span> podå</span><br><span class="line">-c æŒ‡å®špodé‡Œçš„æŸä¸€ä¸ªå®¹å™¨å</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹podä¸Šä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—ï¼ˆå‰ææ˜¯è¯¥å®¹å™¨å­˜åœ¨ï¼Œè‹¥ç§»é™¤äº†åˆ™çœ‹ä¸åˆ°ï¼‰</span></span><br><span class="line"><span class="string">&#x27;è¿™ç§æƒ…å†µå­˜åœ¨äºï¼Œæ€æ‰äº†podé‡ŒæŸä¸ªå®¹å™¨ï¼Œåˆè¢«kubeleté‡æ–°æ‹‰å–äº†å¦ä¸€ä¸ªæ–°çš„å®¹å™¨,-pæŸ¥çœ‹ä¸Šä¸ªå®¹å™¨æ—¥å¿—&#x27;</span></span><br><span class="line">[root@master ~]#  kubectl logs -f mysql80 -p</span><br><span class="line"><span class="string">&#x27;mysql80&#x27;</span> å®¹å™¨å   ----å¾…éªŒè¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹5åˆ†é’Ÿå†…çš„æ—¥å¿—ä¿¡æ¯ï¼Œ é»˜è®¤æ˜¯æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼Œå¯ä»¥è‡ªå®šä¹‰æŒ‡å®šæ—¶é—´ï¼Œä¾‹å¦‚: 5s, 2m, or 3h.</span></span><br><span class="line">[root@master ~]# kubectl logs -f mysql80 --since  5m</span><br></pre></td></tr></table></figure><h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><p><strong>å°†æœ¬åœ°çš„æ–‡ä»¶æ‹·è´åˆ°Podçš„å®¹å™¨ä¸­</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl <span class="built_in">cp</span> wordpress.yaml mysql80:/tmp</span><br><span class="line"></span><br><span class="line">å¦‚ä½•æŸ¥çœ‹ï¼Ÿ</span><br><span class="line">[root@master ~]# kubectl <span class="built_in">exec</span> -it mysql80 --<span class="built_in">ls</span> /tmp</span><br><span class="line">ç±»ä¼¼äºdocker <span class="built_in">exec</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨-cæŒ‡å®š </span></span><br><span class="line">kubectl <span class="built_in">cp</span>  wordpress.yaml  -c wp multiple-wordpress:/</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;multiple-wordpress&#x27;</span>   <span class="comment">#podå   ---å¾…éªŒè¯</span></span><br><span class="line"><span class="string">&#x27;wp&#x27;</span> <span class="comment">#å®¹å™¨å</span></span><br><span class="line"></span><br><span class="line">å¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨-cæŒ‡å®šå®¹å™¨çš„åç§°ï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤Podè¿æ¥ç¬¬ä¸€ä¸ªå®¹å™¨</span><br></pre></td></tr></table></figure><h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><p><strong>æŸ¥çœ‹æŒ‡å®šå­—æ®µçš„å¸®åŠ©ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl explain pods.</span><br><span class="line">[root@master ~]# kubectl explain pods.metadata</span><br><span class="line">[root@master ~]# kubectl explain pods.metadata.name</span><br><span class="line">[root@master ~]# kubectl explain pods.spec.containers</span><br></pre></td></tr></table></figure><p><strong>å¸¸è§çš„èµ„æºç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;ï¼š</span><br><span class="line">è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">&lt;Object&gt;:</span><br><span class="line">è¡¨ç¤ºæœ‰ä¸‹çº§å­—æ®µã€‚</span><br><span class="line"></span><br><span class="line"> &lt;[]Object&gt;:</span><br><span class="line">è¡¨ç¤ºæ•°ç»„å¯¹è±¡è¯´å¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸ªå¯¹è±¡çš„åŒºåˆ†ä½¿ç”¨<span class="string">&quot;-&quot;</span>ï¼ŒåŒä¸€ä¸ªå¯¹è±¡æ•°ç»„å†…çš„ç›¸å…³å­—æ®µå¯ä»¥ç›¸äº’äº¤æ¢ã€‚</span><br><span class="line"></span><br><span class="line">&lt;boolean&gt;:</span><br><span class="line">åªæœ‰<span class="literal">true</span>å’Œ<span class="literal">false</span>ä¸¤ä¸ªæœ‰æ•ˆå€¼ã€‚</span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">integer</span>&gt;:</span><br><span class="line">æ•´å‹ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚</span><br><span class="line"></span><br><span class="line">-required-</span><br><span class="line">è¡¨ç¤ºè¯¥å­—æ®µå¿…é¡»å®šä¹‰ï¼Œä¸å®šä¹‰åˆ™ä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä¸Šå¹²è´§äº†ï¼Œk8sçš„PODèµ„æºä»¥åŠç½‘ç»œå…±äº«ï¼Œæ–‡ä»¶æŒ‚è½½ç­‰åœ¨è¿™é‡Œéƒ½èƒ½çœ‹åˆ°</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>02-k8séƒ¨ç½²</title>
    <link href="https://lukme.top/posts/24ecfc3b.html"/>
    <id>https://lukme.top/posts/24ecfc3b.html</id>
    <published>2024-10-02T16:49:49.000Z</published>
    <updated>2024-10-06T14:13:40.873Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><div class="table-container"><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>LanIP</th><th>è§’è‰²</th><th>åº”ç”¨</th><th>é…ç½®</th></tr></thead><tbody><tr><td>master01</td><td>10.0.0.200</td><td>172.16.1.200</td><td>master</td><td>kubectlã€apiserverã€ schedulerã€controllerã€ etcdã€kubeletã€dockerã€ kube-proxy</td><td>1h2g</td></tr><tr><td>node01</td><td>10.0.0.201</td><td>172.16.1.201</td><td>node</td><td>kubeletã€dockerã€kubeproxyã€proxy</td><td>1h2g</td></tr><tr><td>node02</td><td>10.0.0.202</td><td>172.16.1.202</td><td>node</td><td>kubeletã€dockerã€kubeproxyã€proxy</td><td>1h2g</td></tr><tr><td>node03</td><td>10.0.0.203</td><td>172.16.1.203</td><td>node</td><td>kubeletã€dockerã€kubeproxyã€proxy</td><td>2h4g</td></tr></tbody></table></div><p><strong>IPè§„åˆ’</strong></p><div class="table-container"><table><thead><tr><th>ä¸‰ç§Service</th><th>IP</th></tr></thead><tbody><tr><td>PodIP</td><td>10.2.0.0</td></tr><tr><td>ClusterIP</td><td>10.1.0.0</td></tr><tr><td>NodeIP</td><td>10.0.0.0</td></tr></tbody></table></div><h2 id="åŸºç¡€ç¯å¢ƒä¼˜åŒ–"><a href="#åŸºç¡€ç¯å¢ƒä¼˜åŒ–" class="headerlink" title="åŸºç¡€ç¯å¢ƒä¼˜åŒ–"></a>åŸºç¡€ç¯å¢ƒä¼˜åŒ–</h2><blockquote><p>æ³¨æ„ï¼šå››ä¸ªèŠ‚ç‚¹éƒ½æ“ä½œ</p></blockquote><p><strong>1.é…ç½®kubeleté…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„Cgroupé©±åŠ¨å’Œç¦ç”¨swap</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> &gt;/etc/sysconfig/kubelet &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">KUBELET_CGROUP_ARGS=&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"><span class="string">KUBELET_EXTRA_ARGS=&quot;--fail-swap-on=false&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line"><span class="comment">## è®©kubeletä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„Cgroupé©±åŠ¨</span></span><br><span class="line">KUBELET_CGROUP_ARGS=<span class="string">&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"><span class="comment">## è®©kubeletç¦æ­¢ä½¿ç”¨swapï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰</span></span><br><span class="line">KUBELET_EXTRA_ARGS=<span class="string">&quot;--fail-swap-on=false&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2.å†…æ ¸å‚æ•°è°ƒä¼˜</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]#  <span class="built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables=1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables=1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1</span></span><br><span class="line"><span class="string">vm.swappiness=0</span></span><br><span class="line"><span class="string">fs,file-max=52706963</span></span><br><span class="line"><span class="string">fs.nr_open=52706963</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line"><span class="comment">## å¼€å¯iptablesåŠŸèƒ½ ipv6</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="line"><span class="comment">## å¼€å¯iptablesåŠŸèƒ½ ipv4</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line"><span class="comment">## å¼€å¯å†…æ ¸è½¬å‘</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"><span class="comment">## å†…æ ¸å‚æ•°ç¦ç”¨swap</span></span><br><span class="line">vm.swappiness=0</span><br><span class="line"><span class="comment">## æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶æœ€å¤§å€¼</span></span><br><span class="line">fs,file-max=52706963</span><br><span class="line"><span class="comment">## æ–‡ä»¶æè¿°ç¬¦å¼€å¯æ•°é‡</span></span><br><span class="line">fs.nr_open=52706963</span><br></pre></td></tr></table></figure><p><strong>3.æ›´æ”¹dockeræº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ·»åŠ docekræº</span></span><br><span class="line">[root@master ~]#  <span class="built_in">cat</span> &gt; /etc/yum.repos.d/docker-ce.repo &lt;&lt;<span class="string">&quot;EOF&quot;</span></span><br><span class="line">[docker-ce-stable]</span><br><span class="line">name=Docker CE Stable - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://download.docker.com/linux/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/stable</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://download.docker.com/linux/centos/gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›¿æ¢ä¸ºåä¸ºæº</span></span><br><span class="line">[root@master ~]# sed -i <span class="string">&#x27;s+download.docker.com+mirrors.huaweicloud.com/docker-ce+&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br></pre></td></tr></table></figure><p><strong>4.å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y chrony</span><br><span class="line">[root@master ~]# systemctl start chronyd</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> chronyd</span><br></pre></td></tr></table></figure><p> <strong>5.å…³é—­swap</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸´æ—¶å…³é—­swap</span></span><br><span class="line">[root@master ~]#  swapoff -a &amp;&amp; sysctl -w vm.swappiness=0</span><br><span class="line"><span class="comment">#æ°¸ä¹…å…³é—­</span></span><br><span class="line">[root@master ~]#  sed -i <span class="string">&#x27;/swap/d&#x27;</span> /etc/fstab</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦å…³é—­</span></span><br><span class="line">[root@master ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.9G         95M        1.6G        9.5M        283M        1.7G</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><p><strong>6.åŠ è½½ipvsæ¨¡å—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span>  &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#! /bin/bash</span></span><br><span class="line"><span class="string">modprobe -- ip_vs</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_rr</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_wrr</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_sh</span></span><br><span class="line"><span class="string">modprobe -- nf_conntrack_ipv4</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆæƒ</span></span><br><span class="line">[root@master ~]# <span class="built_in">chmod</span> +x /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"><span class="comment">#sourceä½¿ç”Ÿæ•ˆ</span></span><br><span class="line">[root@master ~]# <span class="built_in">source</span> /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</span></span><br><span class="line">[root@master ~]# lsmod|grep -e <span class="string">&#x27;ip_vs&#x27;</span> -e <span class="string">&#x27;nf_conntrack_ipv&#x27;</span></span><br><span class="line">nf_conntrack_ipv4      15053  0 </span><br><span class="line">nf_defrag_ipv4         12729  1 nf_conntrack_ipv4</span><br><span class="line">ip_vs_sh               12688  0 </span><br><span class="line">ip_vs_wrr              12697  0 </span><br><span class="line">ip_vs_rr               12600  0 </span><br><span class="line">ip_vs                 145497  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr</span><br><span class="line">nf_conntrack          133095  2 ip_vs,nf_conntrack_ipv4</span><br><span class="line">libcrc32c              12644  3 xfs,ip_vs,nf_conntrack</span><br><span class="line"></span><br><span class="line"><span class="comment">#äº†è§£ä¸‹IPVS  LVS:ipvsadm</span></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h2><blockquote><p>æ³¨æ„ï¼šæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</p></blockquote><p><strong>1.å®‰è£…æŒ‡å®šç‰ˆæœ¬docekrå’Œå®¹å™¨è¿è¡Œæ—¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y docker-ce-19.03.15 docker-ce-cli-19.03.15 containerd.io</span><br><span class="line"></span><br><span class="line">`å®¹å™¨è¿è¡Œæ—¶ï¼ŒDockerã€containerdã€CRI-O`</span><br></pre></td></tr></table></figure><p><strong>2.å¯åŠ¨å’Œå¼€æœºè‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl start docker</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p><strong>3.æ·»åŠ dockeré•œåƒåŠ é€Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span><br><span class="line"><span class="string">    &quot;registry-mirrors&quot;: [</span></span><br><span class="line"><span class="string">    &quot;https://docker.1panel.live&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dockercf.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker-cf.registry.cyou&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.chenby.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.m.daocloud.io&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.m.daocloud.io&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.nju.edu.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dockerproxy.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.rainbond.cc&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.registry.cyou&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dockertest.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://hub-mirror.c.163.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://hub.rat.dev/&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://mirror.aliyuncs.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://mirror.baidubce.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://mirror.iscas.ac.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://registry.docker-cn.com&quot;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">`<span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>], `#é•œåƒåŠ é€Ÿä½¿ç”¨ç³»ç»ŸCgroupé©±åŠ¨</span><br></pre></td></tr></table></figure><p><strong>4.é‡å¯docerk</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl daemon-reload</span><br><span class="line">[root@master ~]# systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…kubeadm"><a href="#å®‰è£…kubeadm" class="headerlink" title="å®‰è£…kubeadm"></a>å®‰è£…kubeadm</h2><blockquote><p>æ³¨æ„ï¼šæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</p></blockquote><p><strong>1.æ›´æ¢kubernetesçš„yumæº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">&quot;EOF&quot;</span> &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.huaweicloud.com/kubernetes/yum/repos/kubernetes-el7-<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.huaweicloud.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.huaweicloud.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p><strong>2.ä¸‹è½½æŒ‡å®šç‰ˆæœ¬kubernetes</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install kubelet-1.19.3 kubeadm-1.19.3  kubectl-1.19.3  ipvsadm -y</span><br><span class="line"></span><br><span class="line">`kubelet`: nodeèŠ‚ç‚¹å®¹å™¨è¿è¡Œæ—¶çš„æ§åˆ¶å™¨ </span><br><span class="line">`kubeadm`: åšk8sé›†ç¾¤ kubectl k8sçš„å‘½ä»¤å®¢æˆ·ç«¯</span><br><span class="line">`ipvsadm`: åŠ è½½ipvsæ¨¡å—</span><br></pre></td></tr></table></figure><p><strong>3.å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl start kubelet</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> kubelet</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–é›†ç¾¤"><a href="#åˆå§‹åŒ–é›†ç¾¤" class="headerlink" title="åˆå§‹åŒ–é›†ç¾¤"></a>åˆå§‹åŒ–é›†ç¾¤</h2><blockquote><p>:dango:æ³¨æ„ï¼šä»…masterèŠ‚ç‚¹æ‰§è¡Œ</p><p>æ­¥éª¤1-3éƒ½æ˜¯masterèŠ‚ç‚¹æ‰§è¡Œ</p></blockquote><p><strong>1.åˆå§‹åŒ–é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubeadm init \</span><br><span class="line">--apiserver-advertise-address=10.0.0.200 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers  \</span><br><span class="line">--kubernetes-version=v1.19.3 \</span><br><span class="line">--service-cidr=10.1.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.2.0.0/16 \</span><br><span class="line">--service-dns-domain=cluster.local \</span><br><span class="line">--ignore-preflight-errors=Swap \</span><br><span class="line">--ignore-preflight-errors=NumCPU</span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line">`--apiserver-advertise-address=10.0.0.200`  <span class="comment">#å½“å‰masterä¸»æœºip</span></span><br><span class="line">`--service-cidr=10.1.0.0/16` <span class="comment">#è§„åˆ’ClusterIPç½‘æ®µ</span></span><br><span class="line">`--pod-network-cidr=10.2.0.0/16` <span class="comment">#è§„åˆ’çš„podIP</span></span><br><span class="line">`--service-dns-domain=cluster.local` <span class="comment">#ä½¿ç”¨æœ¬åœ°DNSé›†ç¾¤ï¼Œk8ä¼šè‡ªå·±è£…Coredns</span></span><br><span class="line">`--ignore-preflight-errors=Swap`<span class="comment">#å¿½ç•¥SwapæŠ¥é”™</span></span><br><span class="line">`--ignore-preflight-errors=NumCPU`<span class="comment">#å¿½ç•¥CPUæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">`ClusterIP`: ç”¨äºæ„å»ºå®¹å™¨åŒ–åº”ç”¨çš„å†…éƒ¨é€šä¿¡ç½‘ç»œï¼Œä½œä¸ºPODçš„è´Ÿè½½å‡è¡¡</span><br><span class="line"></span><br><span class="line"><span class="comment">###åˆå§‹åŒ–æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ²¡æœ‰æŠ¥é”™ç­‰å¾…å³å¯</span></span><br></pre></td></tr></table></figure><p><strong>ä¿å­˜token</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">`åˆå§‹åŒ–æˆåŠŸåä¼šè¾“å…¥å¦‚ä¸‹ï¼Œä½ çš„å’Œæˆ‘çš„ä¸ä¸€æ ·ï¼Œæ³¨æ„ä¿å­˜,24håä¼šæ¶ˆå¤±`</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">`#è¿™ä¸ªå‘½ä»¤ä¹Ÿä¿å­˜ï¼Œç­‰ä¸€ä¸‹ç›´æ¥å¤åˆ¶æ‰§è¡Œ`</span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line">kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br></pre></td></tr></table></figure><blockquote><p>!!!  åˆ°è¿™ä¸€æ­¥å‰é¢æ²¡æŠ¥é”™å°±å¯ä»¥æ‰“å¿«ç…§ï¼Œä¸‡ä¸€åé¢å‡ºé”™æ–¹ä¾¿å›æ»šï¼Œå»ºè®®æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥æ‰“ä¸€æ¬¡ï¼Œå¦‚æœæŠ¥é”™å¯ä»¥å›æ»šåˆ°åŒä¸€èµ·å§‹ç‚¹</p><p>!! å¦‚æœæ—¶é—´å¤ªä¹…å¿˜è®°åŠ å…¥ä»¤ç‰Œçš„å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤</p><p><code>kubeadm token create --print-join-command</code></p><p>è·å–æ–°çš„joinä»¤ç‰Œ</p></blockquote><p><strong>2.åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]#   <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">[root@master ~]#   <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">[root@master ~]#   <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">`ç›´æ¥å¤åˆ¶ä¸Šé¢çš„ä¸‰æ¡è¾“å‡º`</span><br></pre></td></tr></table></figure><p><strong>3.æŸ¥çœ‹k8sé›†ç¾¤èŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS     ROLES    AGE   VERSION</span><br><span class="line">master   NotReady   master   11m   v1.19.3</span><br></pre></td></tr></table></figure><p><strong>4.å…¶ä»–nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</strong></p><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œæ˜¯3ä¸ªnodeèŠ‚ç‚¹æ‰§è¡Œ  <code>å¤åˆ¶è‡ªå·±çš„ï¼Œå«æœ‰tokençš„å‘½ä»¤ï¼Œä¸è¦å¤åˆ¶æˆ‘çš„</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br><span class="line">    </span><br><span class="line">[root@node02 ~]# kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br><span class="line"></span><br><span class="line">[root@node03 ~]# kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br><span class="line">Â·Â·Â·</span><br><span class="line">Run <span class="string">&#x27;kubectl get nodes&#x27;</span> on the control-plane to see this node <span class="built_in">join</span> the cluster.</span><br></pre></td></tr></table></figure><p><strong>5.æŸ¥çœ‹k8sé›†ç¾¤</strong></p><blockquote><p>å»masterèŠ‚ç‚¹çœ‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS     ROLES    AGE     VERSION</span><br><span class="line">master   NotReady   master   17m     v1.19.3</span><br><span class="line">node01   NotReady   &lt;none&gt;   3m12s   v1.19.3</span><br><span class="line">node02   NotReady   &lt;none&gt;   3m32s   v1.19.3</span><br><span class="line">node03   NotReady   &lt;none&gt;   3m27s   v1.19.3</span><br><span class="line">`çœ‹åˆ°å››ä¸ªèŠ‚ç‚¹NotReadyå³OKï¼Œå› ä¸ºè¿˜æœªé…ç½®ç½‘ç»œï¼Œä¸èƒ½è·¨ä¸»æœºé€šä¿¡`</span><br></pre></td></tr></table></figure><p><strong>6.è®¾ç½®Kube-proxyä½¿ç”¨ipvsæ¨¡å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">`k8sé»˜è®¤ä½¿ç”¨çš„æ˜¯iptablesé˜²ç«å¢™ï¼Œå¯ä»¥ä¿®æ”¹æˆæ€§èƒ½æ›´é«˜çš„ipvsæ¨¡å¼ï¼Œè¯¥æ¨¡å¼LVSä¹Ÿåœ¨ä½¿ç”¨`</span><br><span class="line">[root@master01 ~]# kubectl edit cm kube-proxy -n kube-system</span><br><span class="line">mode: <span class="string">&quot;&quot;</span> --&gt;  mode: <span class="string">&quot;ipvs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœmodeï¼Œæ·»ä¸Šipvså³å¯</span></span><br></pre></td></tr></table></figure><p><strong>7.æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´ä¸­podç›¸ä¿¡ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod -n kube-system</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6d56c8448f-spslt         0/1     Pending   0          26m</span><br><span class="line">coredns-6d56c8448f-x5lqj         0/1     Pending   0          26m</span><br><span class="line">etcd-master                      1/1     Running   0          26m</span><br><span class="line">kube-apiserver-master            1/1     Running   0          26m</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          26m</span><br><span class="line">kube-proxy-qmbtd                 1/1     Running   0          26m</span><br><span class="line">kube-proxy-sqnbb                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-t7hcw                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-xzv7f                 1/1     Running   0          12m</span><br><span class="line">kube-scheduler-master            1/1     Running   0          26m</span><br><span class="line"></span><br><span class="line">`çŠ¶æ€æ²¡å¼‚å¸¸å³å¯ï¼Œé™¤Pendingå’ŒRunningä¹‹å¤–çš„çŠ¶æ€éƒ½æ˜¯ä¸æ­£å¸¸çš„ï¼Œæ£€æŸ¥æ˜¯å¦æ­¥éª¤å‡ºé”™`</span><br><span class="line"></span><br><span class="line">`coredns-6d56c8448f-spslt`<span class="comment">#dnsæœåŠ¡å™¨</span></span><br><span class="line">`coredns-6d56c8448f-x5lqj`<span class="comment">#dnsæœåŠ¡å™¨</span></span><br><span class="line">`etcd-master` <span class="comment">#æ•°æ®åº“æ‰€æœ‰èŠ‚ç‚¹çš„å­˜å‚¨</span></span><br><span class="line">`kube-apiserver-master`<span class="comment">#é›†ç¾¤çš„æ§åˆ¶ä¸­å¿ƒ--&#x27;å¸ä»¤éƒ¨&#x27;</span></span><br><span class="line">`kube-controller-manager-master` <span class="comment">#ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€--&#x27;æ§åˆ¶å™¨&#x27;</span></span><br><span class="line">`kube-proxy-qmbtd`<span class="comment">#è´Ÿè´£å°†ç½‘ç»œæµé‡è½¬å‘åˆ°æ­£ç¡®çš„Podã€ç«¯å£æ˜ å°„</span></span><br><span class="line">`kube-proxy-sqnbb`</span><br><span class="line">`kube-proxy-t7hcw`</span><br><span class="line">`kube-proxy-xzv7f`</span><br><span class="line">`kube-scheduler-master`<span class="comment">#è°ƒåº¦å™¨</span></span><br></pre></td></tr></table></figure><p><strong>8.æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´ä¸­podè¯¦ç»†ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod -n kube-system -o wide</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE   IP        </span><br><span class="line">coredns-6d56c8448f-spslt         0/1     Pending   0          42m   &lt;none&gt;    </span><br><span class="line">coredns-6d56c8448f-x5lqj         0/1     Pending   0          42m   &lt;none&gt;    </span><br><span class="line">etcd-master                      1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-apiserver-master            1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-proxy-qmbtd                 1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-proxy-sqnbb                 1/1     Running   0          28m   10.0.0.203</span><br><span class="line">kube-proxy-t7hcw                 1/1     Running   0          28m   10.0.0.201</span><br><span class="line">kube-proxy-xzv7f                 1/1     Running   0          28m   10.0.0.202</span><br><span class="line">kube-scheduler-master            1/1     Running   0          42m   10.0.0.200</span><br><span class="line"></span><br><span class="line">`æ£€æŸ¥çŠ¶æ€æ˜¯å¦éƒ½æ˜¯Runningï¼Œæ¯”å¯¹ä¸‹æ˜¯å¦æ­¥éª¤æœ‰å‡ºå…¥`</span><br></pre></td></tr></table></figure><p><strong>9.æŸ¥çœ‹åç§°ç©ºé—´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get namespace</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   45m</span><br><span class="line">kube-node-lease   Active   45m</span><br><span class="line">kube-public       Active   45m</span><br><span class="line">kube-system       Active   45m</span><br><span class="line"></span><br><span class="line">`namespace å¯ä»¥ç®€å†™ä¸º ns`</span><br><span class="line">[root@master ~]# kubectl get ns</span><br></pre></td></tr></table></figure><p><strong>10.é‡å¯kube-proxy</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">`åˆ é™¤æ‰€æœ‰proxy`</span><br><span class="line">kubectl get pod -n kube-system|grep <span class="string">&#x27;kube-proxy&#x27;</span>|awk <span class="string">&#x27;&#123;print &quot;kubectl delete pod -n kube-system &quot;$1&#125;&#x27;</span>|bash</span><br><span class="line"></span><br><span class="line">`#åˆ é™¤å•ä¸ªproxy`</span><br><span class="line">kubectl delete pod -n kube-system kube-proxyåå­— `ä¾‹å¦‚kube-proxy-qmbtd`</span><br><span class="line"></span><br><span class="line">`#å› ä¸ºk8ä¼šè‡ªåŠ¨æ‹‰èµ·åœæ‰çš„podï¼Œæ‰€ä»¥åˆ é™¤å³å¯é‡å¯`</span><br></pre></td></tr></table></figure><p><strong>11.å†æ¬¡æ£€æŸ¥çŠ¶æ€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod -n kube-system -o wide</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE   IP        </span><br><span class="line">coredns-6d56c8448f-spslt         0/1     Pending   0          52m   &lt;none&gt;    </span><br><span class="line">coredns-6d56c8448f-x5lqj         0/1     Pending   0          52m   &lt;none&gt;    </span><br><span class="line">etcd-master                      1/1     Running   0          52m   10.0.0.200</span><br><span class="line">kube-apiserver-master            1/1     Running   0          52m   10.0.0.200</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          52m   10.0.0.200</span><br><span class="line">kube-proxy-62xz4                 1/1     Running   0          47s   10.0.0.203</span><br><span class="line">kube-proxy-gxz9p                 1/1     Running   0          35s   10.0.0.202</span><br><span class="line">kube-proxy-sfzzf                 1/1     Running   0          37s   10.0.0.201</span><br><span class="line">kube-proxy-vjgc5                 1/1     Running   0          49s   10.0.0.200</span><br><span class="line">kube-scheduler-master            1/1     Running   0          52m   10.0.0.200</span><br><span class="line"></span><br><span class="line">`æ£€æŸ¥çŠ¶æ€æ˜¯å¦å¼‚å¸¸ï¼Œå¦‚æœ‰å¼‚å¸¸ï¼Œæ¯”å¯¹ä¹‹å‰æ­¥éª¤ï¼Œä¹Ÿå¯æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—æŠ¥é”™`</span><br></pre></td></tr></table></figure><h2 id="é…ç½®flannel"><a href="#é…ç½®flannel" class="headerlink" title="é…ç½®flannel"></a>é…ç½®flannel</h2><p><strong>1.ä¿®æ”¹flannelèµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">`kube-flannel.yml`</span><br><span class="line"><span class="comment">#ä¸‹è½½é“¾æ¥ https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml</span></span><br><span class="line"></span><br><span class="line">[root@master ~]# vim kube-flannel.yml</span><br><span class="line"><span class="comment">#1.å°†Networkç½‘æ®µæ”¹ä¸º10.2.0.0/16</span></span><br><span class="line">  net-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;10.2.0.0/16&quot;</span>,</span><br><span class="line">      <span class="string">&quot;EnableNFTables&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;Backend&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;vxlan&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.å°†å®¹å™¨ç»‘å®šç½‘å¡eth0   åœ¨`- --kube-subnet-mgr`  åé¢åŠ ä¸Š`- --iface=eth0` å¦‚ä¸‹</span></span><br><span class="line">containers:</span><br><span class="line">- args:</span><br><span class="line">- --ip-masq</span><br><span class="line">- --kube-subnet-mgr</span><br><span class="line">- --iface=eth0</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.åˆ é™¤å¦‚ä¸‹ä¸‰è¡Œï¼ˆæ„æ€æ˜¯ï¼Œåªæœ‰æ ‡ç­¾æ˜¯appçš„èŠ‚ç‚¹æ‰èƒ½ä¸‹è½½flannelï¼‰</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: flannel</span><br></pre></td></tr></table></figure><p><strong>2.åº”ç”¨flannelèµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨flannelèµ„æºæ¸…å•</span></span><br><span class="line">[root@master ~]# kubectl apply -f kube-flannel.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥flannelçš„podæ˜¯å¦æˆåŠŸå¯åŠ¨</span></span><br><span class="line">[root@master ~]# kubectl get pod -n kube-flannel</span><br><span class="line">NAME                    READY   STATUS                  RESTARTS   AGE</span><br><span class="line">kube-flannel-ds-g9drp   0/1     Running                 0          6m9s</span><br><span class="line">kube-flannel-ds-rcwkv   1/1     Running                 0          6m9s</span><br><span class="line">kube-flannel-ds-txcn2   1/1     Running                 0          6m9s</span><br><span class="line">kube-flannel-ds-whd7p   1/1     Running                 0          6m9s</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥k8sé›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">master   Ready    master   17m   v1.19.3</span><br><span class="line">node01   Ready    &lt;none&gt;   14m   v1.19.3</span><br><span class="line">node02   Ready    &lt;none&gt;   14m   v1.19.3</span><br><span class="line">node03   Ready    &lt;none&gt;   14m   v1.19.3</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ£€æŸ¥corednsæ˜¯å¦æ­£å¸¸è¿è¡Œ</span></span><br><span class="line">[root@master ~]# kubectl get pod -n kube-system</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6d56c8448f-hxpjc         1/1     Running   0          17m</span><br><span class="line">coredns-6d56c8448f-lb5m4         1/1     Running   0          17m</span><br><span class="line">etcd-master                      1/1     Running   0          17m</span><br><span class="line">kube-apiserver-master            1/1     Running   0          17m</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          17m</span><br><span class="line">kube-proxy-46jqn                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-4bnmp                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-5lc7l                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-r8cll                 1/1     Running   0          12m</span><br><span class="line">kube-scheduler-master            1/1     Running   0          17m</span><br></pre></td></tr></table></figure><p><strong>k8så‘½ä»¤è¡¥å…¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bash-completion</span><br><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)</span><br><span class="line">kubectl completion bash &gt; /etc/bash_completion.d/kubectl</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨kubeadminéƒ¨ç½²k8sé›†ç¾¤</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>01-k8sä»‹ç»</title>
    <link href="https://lukme.top/posts/5b9896c9.html"/>
    <id>https://lukme.top/posts/5b9896c9.html</id>
    <published>2024-10-02T16:34:28.000Z</published>
    <updated>2024-10-06T14:13:36.405Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å®¹å™¨"><a href="#ä»€ä¹ˆæ˜¯å®¹å™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯å®¹å™¨"></a>ä»€ä¹ˆæ˜¯å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®¹å™¨çš„æœ¬è´¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ã€‚</span><br></pre></td></tr></table></figure><p><strong>å®¹å™¨çš„ä¸‰è¦ç´ </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Namespace<span class="comment">#åšéš”ç¦»ï¼Œè®©è¿›ç¨‹åªèƒ½çœ‹åˆ°Namespaceä¸­çš„ä¸–ç•Œï¼›</span></span><br><span class="line">Cgroups<span class="comment">#åšé™åˆ¶ï¼Œè®©è¿™ä¸ªâ€œä¸–ç•Œâ€å›´ç€ä¸€ä¸ªçœ‹ä¸è§çš„å¢™ã€‚</span></span><br><span class="line">rootfs<span class="comment">#åšæ–‡ä»¶ç³»ç»Ÿï¼Œrootfs åªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ‰€åŒ…å«çš„æ–‡ä»¶ã€é…ç½®å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</span></span><br><span class="line"></span><br><span class="line">Namespaceå°†é›†ç¾¤å†…éƒ¨çš„èµ„æºè¿›è¡Œéš”ç¦»åˆ’åˆ†ã€‚åœ¨Namespaceä¸­ï¼Œå½¢æˆé€»è¾‘ä¸Šçš„ä¸åŒé¡¹ç›®ç»„æˆ–ç”¨æˆ·ç»„ã€‚</span><br></pre></td></tr></table></figure><p><strong>rootfs</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æŒ‚è½½åœ¨å®¹å™¨æ ¹ç›®å½•ä¸Šã€ç”¨æ¥ä¸ºå®¹å™¨è¿›ç¨‹æä¾›éš”ç¦»åæ‰§è¡Œç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå°±æ˜¯æ‰€è°“çš„â€œå®¹å™¨é•œåƒâ€ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„åå­—ï¼Œ</span><br><span class="line">å«ä½œï¼šrootfsï¼ˆæ ¹æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">å®¹å™¨çš„rootfsç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œ1ï¼šåªè¯»å±‚ã€2ï¼šå¯è¯»å†™å±‚ã€3ï¼šinitå±‚</span><br><span class="line">1.åªè¯»å±‚:éƒ½ä»¥å¢é‡çš„æ–¹å¼åˆ†åˆ«åŒ…å«äº†  æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</span><br><span class="line"></span><br><span class="line">2.å¯è¯»å†™ï¼šå°±æ˜¯ä¸“é—¨ç”¨æ¥å­˜æ”¾ä½ ä¿®æ”¹ rootfs åäº§ç”Ÿçš„å¢é‡ï¼Œæ— è®ºæ˜¯å¢ã€åˆ ã€æ”¹ï¼Œéƒ½å‘ç”Ÿåœ¨è¿™é‡Œã€‚è€Œå½“æˆ‘ä»¬ä½¿ç”¨å®Œäº†è¿™ä¸ªè¢«ä¿®æ”¹è¿‡çš„å®¹å™¨ä¹‹åï¼Œ</span><br><span class="line">è¿˜å¯ä»¥ä½¿ç”¨ docker commit å’Œ push æŒ‡ä»¤ï¼Œä¿å­˜è¿™ä¸ªè¢«ä¿®æ”¹è¿‡çš„å¯è¯»å†™å±‚ï¼Œå¹¶ä¸Šä¼ åˆ° Docker Hub ä¸Šï¼Œä¾›å…¶ä»–äººä½¿ç”¨ï¼›è€Œä¸æ­¤åŒæ—¶ï¼ŒåŸå…ˆçš„</span><br><span class="line">åªè¯»å±‚é‡Œçš„å†…å®¹åˆ™ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ã€‚è¿™å°±æ˜¯å¢é‡ rootfs çš„å¥½å¤„ã€‚</span><br><span class="line"></span><br><span class="line">3.Init å±‚ï¼šæ˜¯ Docker é¡¹ç›®å•ç‹¬ç”Ÿæˆçš„ä¸€ä¸ªå†…éƒ¨å±‚ï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾ /etc/hostsã€/etc/resolv.conf ç­‰ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="è®¤è¯†kubernetes"><a href="#è®¤è¯†kubernetes" class="headerlink" title="è®¤è¯†kubernetes"></a>è®¤è¯†kubernetes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Kubernetes æ˜¯ä¸€ä¸ªå¯ç§»æ¤ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œç”¨äºç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œæ–¹ä¾¿è¿›è¡Œå£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–ã€‚å¯ä»¥è‡ªåŠ¨éƒ¨ç½²</span><br><span class="line">(automating deployments)ï¼Œä¼¸ç¼©(scaling)å’Œè¿ç»´å®¹å™¨åŒ–åº”ç”¨(operations of application containers)çš„å¼€æºå¹³å°ã€‚ä»¥ä¸‹</span><br><span class="line">ç®€ç§°k8s</span><br><span class="line">  </span><br><span class="line">k8så‚è€ƒç½‘ç«™</span><br><span class="line">`k8så®˜æ–¹`: https://kubernetes.io/zh-cn/docs/home/</span><br><span class="line">`é˜¿é‡Œäº‘k8s-ACK`ï¼šhttps://www.aliyun.com/product/kubernetes</span><br><span class="line">`äºšé©¬é€Šk8s-EKS`ï¼šhttps://aws.amazon.com/cn/eks/?nc2=h_ql_prod_ct_eks</span><br><span class="line">`ä½¿ç”¨ansibleä¸€é”®éƒ¨ç½²k8s`ï¼šhttps://github.com/easzlab/kubeasz</span><br></pre></td></tr></table></figure><h2 id="k8sç»„ä»¶"><a href="#k8sç»„ä»¶" class="headerlink" title="k8sç»„ä»¶"></a>k8sç»„ä»¶</h2><p><img src="https://cos.lukme.top/Pic/components-of-kubernetes-1726291732343-3.svg" alt="components-of-kubernetes"></p><p><strong>æ ¸å¿ƒç»„ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰  masterèŠ‚ç‚¹</span><br><span class="line">2.æ§åˆ¶å®¹å™¨è¿è¡Œæ—¶ï¼ˆdockerï¼‰å¯åŠ¨æŒ‡å®šçš„å®¹å™¨      nodeèŠ‚ç‚¹</span><br></pre></td></tr></table></figure><p><strong>k8så„ä¸ªç»„ä»¶åŠŸèƒ½è¯´æ˜</strong></p><h3 id="1-UI-CLI"><a href="#1-UI-CLI" class="headerlink" title="(1)UI,CLI"></a>(1)UI,CLI</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç»Ÿç§°APIç”¨äºå‘é€è¯·æ±‚ç»™Kubernetesï¼ˆK8Sï¼‰é›†ç¾¤ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">## K8Sä¸‰å¤§æ¥å£APIäºŒæ¬¡å¼€å‘ï¼Œè°ƒç”¨æ¥å£</span></span><br><span class="line">CRIï¼šruntimeï¼Œå®¹å™¨æ“ä½œæ¥å£</span><br><span class="line">CNIï¼šnetworkï¼Œç½‘ç»œæ“ä½œæ¥å£</span><br><span class="line">CSIï¼šstorageï¼Œå­˜å‚¨æ“ä½œæ¥å£</span><br></pre></td></tr></table></figure><h3 id="2-Kubernetes-Master"><a href="#2-Kubernetes-Master" class="headerlink" title="(2)Kubernetes Master"></a>(2)Kubernetes Master</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„å‘æ¥çš„è¯·æ±‚ï¼Œæ ¹æ®éœ€æ±‚è°ƒåº¦åç«¯èŠ‚ç‚¹è¿è¡Œä»»åŠ¡,å°±æ˜¯<span class="string">&#x27;è€æ¿&#x27;</span>å­˜åœ¨ã€‚å…¶å†…éƒ¨æ ¸å¿ƒç»„ä»¶åˆ†ä¸ºï¼š</span><br><span class="line">1.`API Server`(K8Så†…ç½®ç»„ä»¶) <span class="string">&#x27;ç§˜ä¹¦&#x27;</span></span><br><span class="line">      æä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶;</span><br><span class="line">      æä¾›APIæœåŠ¡çš„ç»„ä»¶ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œæ˜¯Kubernetesé›†ç¾¤çš„å”¯ä¸€å…¥å£ï¼ˆæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯å†…éƒ¨ç»„ä»¶éƒ½å¿…é¡»é€šè¿‡å®ƒæ¥è®¿</span><br><span class="line">      é—®);å®ƒæä¾›åŸºäºhttps(RESTfulé£æ ¼)å’Œrpcåè®®(grpcæ˜¯æ®è¯´æ˜¯å°†æ¥è¦å–ä»£Httpsçš„RESTfulé£æ ¼)æ¥æä¾›æœåŠ¡çš„ã€‚å®ƒç”¨æ¥å¤„ç†</span><br><span class="line">      å®¢æˆ·ç«¯ä¼ æ¥çš„JSONæ ¼å¼çš„è¯·æ±‚æ•°æ®è€ŒéHTMLæ ¼å¼å“Ÿã€‚å®ƒä¹Ÿæ˜¯K8Sé›†ç¾¤å”¯ä¸€èƒ½æ“ä½œetcdçš„ç»„ä»¶</span><br><span class="line">     </span><br><span class="line">  2.`Scheduler`ï¼ˆK8Så†…ç½®ç»„ä»¶ï¼‰  <span class="string">&#x27;äººäº‹&#x27;</span></span><br><span class="line">      è´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Š;</span><br><span class="line">      æ¯”å¦‚å®¢æˆ·ç«¯é€šè¿‡API Serveræäº¤äº†ä¸€ä¸ªæ–°å¢å®¹å™¨çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¿å­˜åœ¨etcdä¸­ï¼Œetcdé€šè¿‡API Serveré€šçŸ¥Schedulerï¼Œ</span><br><span class="line">      Scheduleræ¥æ”¶åˆ°é€šçŸ¥åä¼šåœ¨ç®¡ç†çš„èµ„æºä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä½³è¿è¡Œçš„èŠ‚ç‚¹å»åˆ›å»ºå®¹å™¨;è¯¥æŒ‡ä»¤ä¾æ—§å­˜æ”¾åœ¨etcdä¸­ï¼ˆSchedulerä¸èƒ½ç›´</span><br><span class="line">      æ¥è®¿é—®etcdï¼Œè€Œæ˜¯é€šè¿‡API Serveré—´æ¥è®¿é—®etcdï¼‰ã€‚</span><br><span class="line">      </span><br><span class="line">   3.`Controller manager`(K8Så†…ç½®ç»„ä»¶)</span><br><span class="line">       è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼›</span><br><span class="line">       è¯¥ç»„ä»¶ä¼šwatch Api Serverç»„ä»¶ç”¨äºç®¡ç†K8Sé›†ç¾¤çš„ç»„ä»¶ï¼Œç¡®ä¿æˆ‘ä»¬æ‰€åˆ›å»ºçš„å®¹å™¨èƒ½å¤ŸæŒ‰ç…§æœŸæœ›çš„çŠ¶æ€è¿è¡Œçš„æ ¸å¿ƒç»„ä»¶</span><br><span class="line">       (æ¯”å¦‚ï¼šç›‘æ§é›†ç¾¤çš„æ‰€æœ‰å®¹å™¨è¿è¡Œï¼Œå½“æŸä¸ªå®¹å™¨æŒ‚æ‰åå®ƒå¯ä»¥è¿…é€Ÿåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹å¯åŠ¨)ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥è¯´</span><br><span class="line">       Controller manageræ˜¯K8sçš„å¤§è„‘ã€‚</span><br><span class="line">       </span><br><span class="line">    4.`etcd`(å¹¶ä¸æ˜¯K8Så†…ç½®ç»„ä»¶,ç”±CoreOSç ”å‘,è¢«RedHatæ”¶è´­ï¼Œæœ€ç»ˆåˆè¢«IBMå…¬å¸æ”¶è´­)</span><br><span class="line">      etcdåªèƒ½è¢«API Serverç›´æ¥è®¿é—®ã€‚æ˜¯æ•´ä¸ªé›†ç¾¤çš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨K8Sè¯·æ±‚æ•°æ®æ‰€æœ‰çš„æ•°æ®ã€‚ä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼›</span><br><span class="line">    etcdåŸºäºraftåè®®ä½¿ç”¨Golangè¯­è¨€å¼€å‘çš„åˆ†å¸ƒå¼å¼ºä¸€è‡´çš„é”®å€¼å¯¹ï¼ˆkey/valueï¼‰æ•°æ®åº“å­˜å‚¨ç³»ç»Ÿã€‚å­˜å‚¨æ–¹å¼å’Œrediså¾ˆåƒï¼Œ</span><br><span class="line">    ä½†æ˜¯åŠŸèƒ½å´æ¯”redisè¦å¼ºå¤§ï¼Œå› ä¸ºå®ƒæ”¯æŒæ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œä¹Ÿæ”¯æŒleaderé€‰ä¸¾ç­‰å„ç§åˆ†å¸ƒå¼ååŒåŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kube-apiserver(apiserver)ï¼š#æ‰€æœ‰Masterä¸Šçš„ç»„ä»¶å·¥ä½œéƒ½è¦ç»è¿‡apiserver</span><br><span class="line">etcdï¼š                     <span class="comment">#å­˜å‚¨æ‰€æœ‰å‘½ä»¤ã€èµ„æºæ¸…å•ã€webUIæ“ä½œåŠå…¶ä»–ç»„ä»¶æ•°æ®</span></span><br><span class="line">kube-scheduler(scheduler)ï¼š#èµ„æºè®¡ç®—ã€èµ„æºè°ƒåº¦</span><br><span class="line">kube-controller-manager(controller)ï¼š#ç»´æŠ¤é›†ç¾¤çŠ¶æ€</span><br><span class="line"></span><br><span class="line">`å½“æŸä¸ªNodeæ„å¤–å®•æœºæ—¶ï¼ŒController Managerä¼šåŠæ—¶å‘ç°å¹¶æ‰§è¡Œè‡ªåŠ¨åŒ–ä¿®å¤æµç¨‹ï¼Œç¡®ä¿é›†ç¾¤å§‹ç»ˆå¤„äºé¢„æœŸçš„å·¥ä½œçŠ¶æ€`</span><br></pre></td></tr></table></figure><h3 id="3-Kubernetes-Node"><a href="#3-Kubernetes-Node" class="headerlink" title="(3)Kubernetes Node"></a>(3)Kubernetes Node</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">åŠŸèƒ½ä¸Šæœ‰ç‚¹ç±»ä¼¼äºHadoopä¸­çš„DataNodeèŠ‚ç‚¹,è¢«Kubernetesè°ƒåº¦çš„ï¼Œå³è´Ÿè´£çœŸæ­£å¹²æ´»çš„èŠ‚ç‚¹ï¼ˆè¿è¡Œå®¹å™¨ï¼‰ã€‚å…¶å†…éƒ¨æ ¸å¿ƒç»„ä»¶åˆ†ä¸ºï¼š</span><br><span class="line">1.`kubelet`</span><br><span class="line">    è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†;</span><br><span class="line">    è¯¥ç»„ä»¶ä¹Ÿä¼šwatch Api Serverç»„ä»¶ï¼Œå³å®æ—¶æŸ¥çœ‹å…³äºå½“å‰èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œä»è€Œå»æ‰§è¡Œåˆ›å»ºæˆ–åˆ é™¤å®¹å™¨çš„ä»»åŠ¡</span><br><span class="line">    (ä»¥Dockerä¸ºä¾‹ï¼Œåˆ›å»ºå®¹å™¨æ—¶å°±ä¼šè°ƒç”¨dockerçš„APIå»Image Registryå»ä¸‹è½½ç›¸åº”çš„å®¹å™¨å¹¶å¯åŠ¨)ã€‚</span><br><span class="line">2.`Container runtime `</span><br><span class="line">    è´Ÿè´£é•œåƒç®¡ç†ä»¥åŠPodå’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰ï¼›</span><br><span class="line">3.`kube-proxy`   <span class="string">&#x27;ç›‘å·¥&#x27;</span></span><br><span class="line">    è´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼›</span><br><span class="line">    kube-proxyè¯´ç™½äº†ä¹Ÿæ˜¯API Serverçš„å®¢æˆ·ç«¯,å®ƒå®æ—¶ç›‘è§†(watch)ç€API Serverä¸Šçš„èµ„æºå˜åŠ¨(å°¤å…¶æ˜¯serviceèµ„æºå˜åŠ¨),</span><br><span class="line">    å®ƒä¼šæŠŠæ¯ä¸ªserviceèµ„æºå˜åŠ¨åœ¨ç›¸åº”èŠ‚ç‚¹ä¸Šå®šä¹‰ä¸ºå¯¹å¤–æš´éœ²ç›¸å…³è§„åˆ™(iptableæˆ–è€…ipvs)ï¼Œæ¯”å¦‚å¯¹å¤–æš´éœ²å¤–ç½‘æ˜ å°„ä¹‹ç±»çš„ã€‚</span><br><span class="line"></span><br><span class="line">4.Pod   <span class="string">&#x27;Podæ˜¯K8Sçš„æœ€å°å•ä½&#x27;</span></span><br><span class="line">è™½ç„¶æˆ‘ä»¬è¯´Kubernetesæ˜¯å®¹å™¨ç¼–æ’ç³»ç»Ÿ,ä½†æ˜¯ä¸å¾—ä¸è¯´åœ¨K8Sä¹‹ä¸Šå¹¶ä¸ä¼šç›´æ¥è¿è¡Œå®¹å™¨,æ¯ä¸ªå®¹å™¨åœ¨K8Sä¸­éƒ½è¢«é‡æ–°å°è£…æˆpod,è¯´</span><br><span class="line">ç™½äº†podå°±æ˜¯å®¹å™¨çš„å¤–å£³,ä½†éœ€è¦æ³¨æ„çš„æ˜¯ä¸€ä¸ªpodæ˜¯å¯ä»¥å­˜åœ¨å¤šä¸ªå®¹å™¨çš„ã€‚æ¯ä¸ªpodè¢«K8Så½“ä½œä¸€ä¸ªåŸå­å•å…ƒè¿›è¡Œç®¡ç†;ä¸€ä¸ªpodä¸­</span><br><span class="line">æœ‰å¤šä¸ªå®¹å™¨ï¼Œè¿™ä¸ªpodé‡Œé¢çš„æ‰€æœ‰å®¹å™¨åªèƒ½è¢«è°ƒåº¦åˆ°ä¸€å°èŠ‚ç‚¹å»æ‰§è¡Œï¼Œä¸èƒ½å°†åŒä¸€ä¸ªpodé‡Œé¢çš„å¤šä¸ªå®¹å™¨æ‹†åˆ†åˆ°ä¸åŒçš„Nodeè¿è¡Œ;</span><br><span class="line"></span><br><span class="line">1ã€Podæ˜¯K8Sçš„æœ€å°å•ä½</span><br><span class="line">2ã€Podçš„IPåœ°å€æ˜¯éšæœºçš„ï¼Œåˆ é™¤Podä¼šæ”¹å˜IP</span><br><span class="line">3ã€Podéƒ½æœ‰ä¸€ä¸ªæ ¹å®¹å™¨ï¼ˆä¸€ä¸ªpodè‡³å°‘æœ‰ä¸€ä¸ªæ ¹å®¹å™¨ï¼‰</span><br><span class="line">4ã€ä¸€ä¸ªPodå†…å¯ä»¥ç”±ä¸€ä¸ªå®¹å™¨æˆ–å¤šä¸ªå®¹å™¨ç»„æˆ</span><br><span class="line">5ã€ä¸€ä¸ªPodå†…çš„å®¹å™¨å…±äº«æ ¹å®¹å™¨çš„ç½‘ç»œã€åç§°ç©ºé—´ã€å’Œæ–‡ä»¶ç³»ç»Ÿå·</span><br><span class="line">6ã€ä¸€ä¸ªPodå†…çš„ç½‘ç»œåœ°å€ç”±æ ¹å®¹å™¨æä¾›</span><br><span class="line"></span><br><span class="line">5.`Fluentd`</span><br><span class="line">    å¦‚Fluentd-elasticsearchæä¾›é›†ç¾¤æ—¥å¿—é‡‡é›†ã€å­˜å‚¨ä¸æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">6.`Image Registry`</span><br><span class="line">    å­˜æ”¾é•œåƒæ–‡ä»¶çš„ä»“åº“ï¼Œå¹¶ä¸ç›´æ¥è¢«Kubernetesé›†ç¾¤ç®¡ç†ï¼Œå³å¹¶ä¸ç®—k8såŸç”Ÿç»„æˆéƒ¨åˆ†ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šè‡ªå»ºç§æœ‰çš„é•œåƒä»“åº“ï¼Œ</span><br><span class="line">    æ¯”å¦‚ä½¿ç”¨Harboréƒ¨ç½²httpsé«˜å¯ç”¨çš„é•œåƒä»“åº“</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubeletï¼šæ§åˆ¶å®¹å™¨è¿è¡Œæ—¶ï¼ˆdockerï¼‰å¯åŠ¨æŒ‡å®šçš„å®¹å™¨</span><br><span class="line">å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer runtimeï¼‰ï¼šdocker</span><br><span class="line">  - containerd</span><br><span class="line">  - CRI-O</span><br><span class="line">  - Docker Engine</span><br><span class="line">  - Mirantis Container Runtime</span><br><span class="line">kube-proxyï¼šPODç«¯å£æ˜ å°„ï¼Œç½‘ç»œç›¸å…³</span><br></pre></td></tr></table></figure><h3 id="PODè¿è¡ŒçŠ¶æ€"><a href="#PODè¿è¡ŒçŠ¶æ€" class="headerlink" title="PODè¿è¡ŒçŠ¶æ€"></a>PODè¿è¡ŒçŠ¶æ€</h3><div class="table-container"><table><thead><tr><th>çŠ¶æ€</th><th>æè¿°</th></tr></thead><tbody><tr><td>Pendingï¼ˆç­‰å¾…ï¼‰</td><td>Podå·²ç»è¢«K8Sç³»ç»Ÿæ¥å—ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œå°šæœªåˆ›å»ºï¼Œäº¦æœªè¿è¡Œã€‚æ­¤é˜¶æ®µåŒ…æ‹¬ç­‰å¾…Podè¢«è°ƒåº¦çš„æ—¶é—´å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒçš„æ—¶é—´</td></tr><tr><td>Runningï¼ˆè¿è¡Œï¼‰</td><td>Podå·²ç»ç»‘å®šåˆ°æŸä¸ªèŠ‚ç‚¹(node)ï¼ŒPodä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²è¢«åˆ›å»ºï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»åœ¨è¿è¡Œï¼Œæˆ–è€…å¤„äºå¯åŠ¨æˆ–é‡å¯çŠ¶æ€</td></tr><tr><td>Succeededï¼ˆæˆåŠŸï¼‰</td><td>Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†é‡å¯</td></tr><tr><td>Failedï¼ˆå¤±è´¥ï¼‰</td><td>Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯å› ä¸ºå¤±è´¥è€Œç»ˆæ­¢</td></tr><tr><td>Unknownï¼ˆæœªçŸ¥ï¼‰</td><td>å› ä¸ºæŸäº›åŸå› æ— æ³•è·å–PodçŠ¶æ€ï¼Œè¿™ç§æƒ…å†µï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸Podæ‰€åœ¨ä¸»æœºé€šä¿¡å¤±è´¥</td></tr></tbody></table></div><h2 id="k8sç½‘ç»œ"><a href="#k8sç½‘ç»œ" class="headerlink" title="k8sç½‘ç»œ"></a>k8sç½‘ç»œ</h2><blockquote><p>Serviceä¹Ÿæ˜¯K8Sæ ¸å¿ƒèµ„æºä¹‹ä¸€ï¼ŒServiceå®šä¹‰äº†æœåŠ¡çš„å…¥å£åœ°å€ï¼Œç”¨æ¥å°†åç«¯çš„PodæœåŠ¡æš´éœ²ç»™å¤–éƒ¨çš„ç”¨æˆ· è®¿é—®ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kubernetesçš„ç½‘ç»œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»:</span><br><span class="line">  1.èŠ‚ç‚¹ç½‘ç»œ:</span><br><span class="line">      ä¸»è¦æ˜¯æŒ‡`Master`å’Œå„ä¸ª`Node`ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ç½‘ç»œåœ°å€æ®µã€‚</span><br><span class="line">ã€€2.podç½‘ç»œ:</span><br><span class="line">ã€€ã€€ã€€ã€€å› ä¸ºæ¯ä¸ªpodçš„<span class="string">&#x27;åŠ¨æ€IPåœ°å€&#x27;</span>ï¼Œæ‰€ä»¥æ¯ä¸ªpodå¹¶ä¸çŸ¥é“æƒ³è¦è®¿é—®çš„ç›®çš„podçš„IPåœ°å€ï¼Œå®ƒä»¬å¦‚æœæƒ³è¦è®¿é—®ç›®çš„podéœ€è¦ç»è¿‡ä¸€</span><br><span class="line">ã€€ã€€ã€€ã€€ä¸ª<span class="string">&#x27;service&#x27;</span>å±‚ã€‚è¿™ä¸ªserviceæœ‰å¯¹æ¯ä¸ªpodçš„æ‰“äº†<span class="string">&#x27;æ ‡ç­¾&#x27;</span>ï¼Œå½“ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„podæƒ³è¦è®¿é—®å¦å¤–ä¸€ä¸ªpodå¿…é¡»å¾—è¿‡</span><br><span class="line">ã€€ã€€ã€€ã€€<span class="string">&#x27;serviceç½‘ç»œ&#x27;</span>ï¼Œserviceç½‘ç»œä¿å­˜ç€<span class="string">&#x27;æ ‡ç­¾é€‰æ‹©å™¨&#x27;</span>ï¼Œå¯ä»¥è¿…é€ŸåŒ¹é…åˆ°podæƒ³è¦èŒƒå›´å¦ä¸€ä¸ªpodçš„çœŸå®IPåœ°å€ï¼Œå½“podæ‹¿åˆ°</span><br><span class="line">ã€€ã€€ã€€ã€€IPåœ°å€åå°±å¯ä»¥è‡ªè¡Œè¿›è¡Œé€šä¿¡è¯·æ±‚äº†ã€‚</span><br><span class="line">  3.serviceç½‘ç»œ:</span><br><span class="line">ã€€ã€€ã€€ä¸»è¦æ˜¯ä¸ºpodæä¾›ä¸€ä¸ª<span class="string">&#x27;æ ‡ç­¾é€‰æ‹©å™¨&#x27;</span>çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¸®åŠ©ä¸€ä¸ªpodå»æŸ¥è¯¢è®¿é—®å¦å¤–ä¸€ä¸ªpodçš„labelå¯¹åº”çš„çœŸå®IPåœ°å€ã€‚è€Œ</span><br><span class="line">ã€€ã€€ã€€seviceç½‘ç»œåœ¨kubernetes1.11.xç‰ˆæœ¬ä¹‹å‰é»˜è®¤ä½¿ç”¨iptableå®ç°çš„ï¼Œåœ¨kubernetes 1.11.xç‰ˆæœ¬ä¹‹åå¼•å…¥äº†ipvså®ç°ã€‚</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;å„ä¸ªpodä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹æ¦‚è¦&#x27;</span>:</span><br><span class="line">      æ¯ä¸ªpodéƒ½æœ‰è¢«åŠ¨æ€åˆ†é…çš„IPåœ°å€ï¼Œå¦‚æœæƒ³è¦å’Œå¦å¤–ä¸€ä¸ªpodè¿›è¡Œé€šä¿¡ï¼Œå„ä¸ªpodéœ€è¦å…ˆå’Œserviceç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œæœ€ç»ˆæ‹¿åˆ°</span><br><span class="line">      å¦ä¸€ä¸ªæƒ³è¦è®¿é—®podçš„åŠ¨æ€IPåœ°å€è¿›è¡Œé€šä¿¡ã€‚</span><br></pre></td></tr></table></figure><h3 id="Serviceæä¾›äº†ä¸¤ç§ç½‘ç»œèµ„æº"><a href="#Serviceæä¾›äº†ä¸¤ç§ç½‘ç»œèµ„æº" class="headerlink" title="Serviceæä¾›äº†ä¸¤ç§ç½‘ç»œèµ„æº"></a>Serviceæä¾›äº†ä¸¤ç§ç½‘ç»œèµ„æº</h3><p><img src="https://cos.lukme.top/Pic/image-20240916151114679.png" alt="image-20240916151114679"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NodePortï¼šå®¿ä¸»æœºç«¯å£æ˜ å°„ClusterIPç«¯å£å¯¹å¤–æä¾›æœåŠ¡</span><br><span class="line"></span><br><span class="line">ClusterIPï¼šPODçš„è´Ÿè½½å‡è¡¡</span><br><span class="line">é—®é¢˜ï¼šPODçš„IPæ˜¯éšæœºçš„ï¼Œå¦‚æœä¸€ä¸ªPODå®•æœºäº†ï¼ŒK8Sä¼šè‡ªåŠ¨æ‹‰èµ·ä¸€ä¸ªæ–°çš„PODï¼ŒIPå˜åŒ–äº†å¦‚ä½•åŠ å…¥åˆ°</span><br><span class="line">ClusterIPè¿™ä¸ªè´Ÿè½½å‡è¡¡é›†ç¾¤ä¸­ï¼Ÿ</span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨DNSè§£æPODçš„IPåˆ°ä¸€ä¸ª<span class="string">&quot;å­—ç¬¦ä¸²ä¸Š&quot;</span>ï¼ˆæ ‡ç­¾ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DNSï¼š</span><br><span class="line">- coreDNS</span><br><span class="line">- bind9</span><br><span class="line">- dnsmsq</span><br></pre></td></tr></table></figure><h2 id="Labelæ ‡ç­¾"><a href="#Labelæ ‡ç­¾" class="headerlink" title="Labelæ ‡ç­¾"></a>Labelæ ‡ç­¾</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`Labelæ ‡ç­¾`æ˜¯K8Sä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªå±æ€§ï¼ŒLabelæ ‡ç­¾å°±åƒèº«ä»½è¯ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥è¯†åˆ«K8Sçš„å¯¹è±¡ã€‚</span><br><span class="line">ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œä¸åŒçš„æœåŠ¡åº”ç”¨ä¹‹é—´é€šè®¯ï¼Œéƒ½æ˜¯é€šè¿‡IPå’Œç«¯å£ï¼Œä½†æ˜¯åœ¨K8Sä¸­å¾ˆå¤šåŒ¹é…å…³ç³»éƒ½æ˜¯é€šè¿‡æ ‡ç­¾æ¥æ‰¾ã€‚</span><br></pre></td></tr></table></figure><p><strong>Controllerèµ„æºï¼ˆæ§åˆ¶å™¨èµ„æºï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Controllerç”¨æ¥ç®¡ç†Podã€‚</span></span><br><span class="line"><span class="comment">## Podæ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼š</span></span><br><span class="line">- RC Replication Controller æ§åˆ¶Podæœ‰å¤šä¸ªå‰¯æœ¬</span><br><span class="line">- RS ReplicaSet RCæ§åˆ¶å™¨çš„å‡çº§ç‰ˆï¼Œå¯ä»¥è‡ªåŠ¨æ‹‰èµ·å®•æœºçš„POD</span><br><span class="line">- Deployment æ¨èä½¿ç”¨ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ŒåŒ…å«äº†RSæ§åˆ¶å™¨ï¼Œå¯¹é•œåƒåšç‰ˆæœ¬ç®¡ç†</span><br><span class="line">- DaemonSet ä¿è¯æ‰€æœ‰çš„NodeèŠ‚ç‚¹ä¸Šï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªPodè¿è¡Œ</span><br><span class="line">- StatefulSet æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œä¸ºPodæä¾›å”¯ä¸€æ ‡è¯†ï¼Œå®ƒå¯ä»¥ä¿è¯éƒ¨ç½²å’Œscaleçš„é¡ºåº</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºä¸€ä¸ªpodæµç¨‹"><a href="#åˆ›å»ºä¸€ä¸ªpodæµç¨‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ªpodæµç¨‹"></a>åˆ›å»ºä¸€ä¸ªpodæµç¨‹</h2><p><img src="https://cos.lukme.top/Pic/create-pod.png" alt="create-pod"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">`ç¬¬ä¸€æ­¥ï¼š`</span><br><span class="line">    ç”¨æˆ·é€šè¿‡kubectlç­‰æ¥å£æäº¤åˆ›å»ºPodçš„yamlæ–‡ä»¶ï¼Œå‘Kubernetesç³»ç»Ÿå‘èµ·èµ„æºè¯·æ±‚</span><br><span class="line">`ç¬¬äºŒæ­¥ï¼š`</span><br><span class="line">    Api-serveræ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚ä¹‹åï¼Œä¼šåšå‡ºç›¸åº”çš„è®¤è¯ï¼Œç„¶åæ£€æŸ¥ä¿¡æ¯å¹¶ä¸”å°†å…ƒæ•°æ®ä¿¡æ¯å­˜å‚¨åˆ°etcdä¸­ï¼Œåˆ›å»ºPodèµ„æºåˆå§‹åŒ–ï¼Œ</span><br><span class="line">    è¿™æ˜¯ç¬¬ä¸€æ¬¡å†™etcdåŠ¨ä½œ</span><br><span class="line">`ç¬¬ä¸‰æ­¥ï¼š`</span><br><span class="line">    Scheduleré€šè¿‡list-watchçš„ç›‘å¬æœºåˆ¶ï¼ŒæŸ¥çœ‹è¦åˆ›å»ºPodèµ„æºï¼ŒAPIServerä¼šç«‹å³æŠŠåˆ›å»ºPodçš„æ¶ˆæ¯é€šçŸ¥Schedulerï¼Œ</span><br><span class="line">    Schedulerå‘ç°Podçš„å±æ€§ä¸­Dest Nodeä¸ºç©ºæ—¶ï¼ˆDest Node=â€â€ï¼‰ï¼Œä¾¿ä¼šç«‹å³è§¦å‘è°ƒåº¦æµç¨‹è¿›è¡Œè°ƒåº¦,è€Œè°ƒåº¦æµç¨‹åˆ†ä¸º</span><br><span class="line">    ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œå¦‚ä¸‹å›¾</span><br></pre></td></tr></table></figure><blockquote><p>â€Œ<strong>kube-controller-manager</strong>â€Œï¼šè™½ç„¶ä¸ç›´æ¥å‚ä¸Podçš„åˆ›å»ºï¼Œä½†å…¶å†…éƒ¨çš„æ§åˆ¶å™¨ï¼ˆå¦‚ReplicaSet Controllerï¼‰è´Ÿè´£ç¡®ä¿Podçš„æ•°é‡ä¸é¢„æœŸä¸€è‡´ï¼Œç»´æŠ¤é›†ç¾¤çŠ¶æ€</p></blockquote><p><img src="https://cos.lukme.top/Pic/scheduler.jpeg" alt="scheduler"></p><blockquote><p>â€‹    é¦–å…ˆæ˜¯kube-schedulerè°ƒåº¦å™¨ç”¨ä¸€ç»„è§„åˆ™è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºpredicateï¼Œæ¯”å¦‚æ˜ç¡®æŒ‡å®šæ‰€éœ€è¦çš„èµ„æºç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„ä¸»æœº</p><p>â€‹    å…¶æ¬¡ï¼Œå¯¹ç¬¬ä¸€æ­¥ç­›é€‰å‡ºçš„ç¬¦åˆè¦æ±‚çš„ä¸»æœºè¿›è¡Œæ‰“åˆ†ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º priorityï¼Œåœ¨æ­¤é˜¶æ®µï¼Œå¦‚æœåœ¨ predicateè¿‡ç¨‹ä¸­æ²¡æœ‰åˆé€‚çš„èŠ‚ç‚¹ï¼ŒPod ä¼šä¸€ç›´å¤„äºpendingçŠ¶æ€ï¼Œä¸æ–­é‡è¯•è°ƒåº¦ï¼Œç›´åˆ°æœ‰èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶ã€‚</p><p><strong>é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹</strong>ï¼šé€‰æ‹©å¾—åˆ†æœ€é«˜çš„ä¸»æœºï¼Œè¿›è¡Œbindingæ“ä½œï¼Œç»“æœå­˜å‚¨åˆ°Etcdä¸­</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬å››æ­¥ï¼š</span><br><span class="line">    kubeletæ ¹æ®è°ƒåº¦ç»“æœæ‰§è¡ŒPodåˆ›å»ºæ“ä½œï¼Œç»‘å®šæˆåŠŸåï¼Œä¼šå¯åŠ¨å®¹å™¨è¿è¡Œæ—¶ï¼Œcontainer, docker run, schedulerä¼šè°ƒç”¨API</span><br><span class="line">    Serverçš„APIåœ¨etcdä¸­åˆ›å»ºä¸€ä¸ªbound Podå¯¹è±¡ï¼Œå®ƒæè¿°åœ¨ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šç»‘å®šè¿è¡Œçš„æ‰€æœ‰podä¿¡æ¯ï¼›</span><br><span class="line">    è¿è¡Œåœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šçš„kubeletä¹Ÿä¼šå®šæœŸä¸api-serveråŒæ­¥bound Podçš„ä¿¡æ¯ï¼Œä¸€æ—¦å‘ç°åœ¨è¯¥å·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œçš„bound Podå¯¹</span><br><span class="line">    è±¡æ²¡æœ‰æ›´æ–°ï¼Œåˆ™è°ƒç”¨Docker APIåˆ›å»ºå¹¶å¯åŠ¨podå†…çš„å®¹å™¨.</span><br><span class="line">    </span><br><span class="line">ç¬¬äº”æ­¥ï¼š</span><br><span class="line">  kube-proxyä¸ºæ–°åˆ›å»ºçš„podæ³¨å†ŒåŠ¨æ€DNSåˆ°CoreOSï¼Œç„¶åç»™podçš„serviceæ·»åŠ å¯¹åº”çš„iptablesè§„åˆ™ï¼Œç”¨äºæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ç®€å•ä»‹ç»å®¹å™¨ä»¥åŠk8sç»„ä»¶</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
</feed>
