<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£ç­ä¸Šçš„çŒ«</title>
  
  
  <link href="https://lukme.top/atom.xml" rel="self"/>
  
  <link href="https://lukme.top/"/>
  <updated>2024-10-15T11:37:58.849Z</updated>
  <id>https://lukme.top/</id>
  
  <author>
    <name>LuayğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ­å»ºä¸ªäººäº‘ç›˜</title>
    <link href="https://lukme.top/posts/aca79867.html"/>
    <id>https://lukme.top/posts/aca79867.html</id>
    <published>2024-10-15T11:30:07.000Z</published>
    <updated>2024-10-15T11:37:58.849Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç³»ç»Ÿä»‹ç»">ç³»ç»Ÿä»‹ç»</h2><p>ownCloudæ˜¯ä¸€ä¸ªåŸºäºäº‘è®¡ç®—çš„å¼€æºæ–‡ä»¶å…±äº«å’Œåä½œå¹³å°ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨å¤šä¸ªè®¾å¤‡ä¸ŠåŒæ­¥ã€å…±äº«å’Œåä½œæ–‡ä»¶ã€‚</p><p><strong>ä¸»è¦ç‰¹ç‚¹</strong></p><ul><li>ç”¨æˆ·å¯ä»¥å°†ownCloudç§æœ‰äº‘ç›˜ä¸å…¶ä»–è®¾å¤‡åŒæ­¥ï¼Œéšæ—¶éšåœ°è®¿é—®å’Œç®¡ç†æ–‡ä»¶ã€‚</li><li>æ”¯æŒè·¨å¹³å°è®¿é—®ï¼ŒåŒ…æ‹¬Windowsã€Macã€Androidã€iOSã€Linuxç­‰ã€‚</li><li>æä¾›å…¬å…±é“¾æ¥åˆ†äº«åŠŸèƒ½ï¼Œå¯ä»¥è®¾ç½®å¯†ç å’Œè¿‡æœŸæ—¥æœŸï¼Œç¡®ä¿æ–‡ä»¶åˆ†äº«çš„å®‰å…¨æ€§ã€‚</li><li>å›¢é˜Ÿæˆå‘˜å¯ä»¥åœ¨åŒä¸€ä¸ªownCloudç§æœ‰äº‘ç›˜ä¸­å…±äº«å’Œåä½œæ–‡ä»¶ï¼Œæé«˜å›¢é˜Ÿæ•ˆç‡ã€‚</li><li>æ”¯æŒå®æ—¶åä½œï¼Œå¦‚åŒæ—¶ç¼–è¾‘æ–‡æ¡£ã€åˆ›å»ºæ¼”ç¤ºæ–‡ç¨¿ç­‰ã€‚</li><li>ownCloudå¯ä»¥ä½œä¸ºä¸€ä¸ªå¤‡ä»½è§£å†³æ–¹æ¡ˆï¼Œå°†ç”¨æˆ·çš„é‡è¦æ•°æ®å¤‡ä»½åˆ°ç§æœ‰äº‘ç›˜ä¸­ã€‚</li><li>æä¾›ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥æ¢å¤ä¹‹å‰çš„æ–‡ä»¶ç‰ˆæœ¬ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</li><li>ownCloudå¯ä»¥ä¸å¤šç§åº”ç”¨ç¨‹åºé›†æˆï¼Œå¦‚OnlyOfficeã€Microsoft 365ã€Collabora Onlineç­‰ï¼Œæ»¡è¶³ç”¨æˆ·çš„ä¸ªæ€§åŒ–éœ€æ±‚ã€‚</li><li>æ”¯æŒHTTPSå’ŒSSLåŠ å¯†ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚</li><li>æä¾›å¤šå› ç´ è®¤è¯ã€æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰å®‰å…¨åŠŸèƒ½ã€‚</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><ul><li>ç”¨äºä¸ªäººæ–‡ä»¶åŒæ­¥ã€å¤‡ä»½å’Œåˆ†äº«ã€‚è·¨å¹³å°è®¿é—®ï¼Œæ–¹ä¾¿åœ¨ä¸åŒè®¾å¤‡ä¹‹é—´åˆ‡æ¢ã€‚</li><li>ç”¨äºå›¢é˜Ÿåä½œã€æ–‡ä»¶å…±äº«å’Œç‰ˆæœ¬æ§åˆ¶ã€‚æé«˜å›¢é˜Ÿæ•ˆç‡ï¼Œé™ä½ITæˆæœ¬ã€‚</li><li>ç”¨äºå­¦ç”Ÿä½œä¸šæäº¤ã€æ•™å¸ˆèµ„æºå…±äº«ç­‰ã€‚æä¾›å®‰å…¨ã€å¯é çš„æ–‡ä»¶å­˜å‚¨å’Œåˆ†äº«ç¯å¢ƒ</li></ul><p><strong>æŠ€æœ¯æ¶æ„</strong></p><p>ownCloudé‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼Œå°†å­˜å‚¨ã€åç«¯å’Œå‰ç«¯ç»„ä»¶åˆ†ç¦»ï¼Œé€šè¿‡å®‰å…¨ã€æ˜ç¡®çš„APIè¿›è¡Œé€šä¿¡ã€‚è¿™ç§æ¶æ„ä½¿å¾—ownCloudå…·æœ‰é«˜å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚</p><p>å¦‚éœ€äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥è®¿é—®å…¶å®˜æ–¹ç½‘ç«™æˆ–æŸ¥é˜…ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£ã€‚</p><blockquote><p>å®˜æ–¹ç½‘ç«™</p><p><a href="https://owncloud.com/">https://owncloud.com/</a></p></blockquote><blockquote><p>Dockeré•œåƒ</p><p><a href="https://hub.docker.com/_/owncloud">https://hub.docker.com/_/owncloud</a></p></blockquote><blockquote><p>GitHubåœ°å€</p><p><a href="https://github.com/owncloud/core">https://github.com/owncloud/core</a></p></blockquote><h2 id="å®‰è£…æ•™ç¨‹">å®‰è£…æ•™ç¨‹</h2><p>Dockeréƒ¨ç½²æ“ä½œæ­¥éª¤ï¼šå®‰è£…Dockerã€æ‹‰å–é•œåƒã€å¯åŠ¨å®¹å™¨ã€‚æœ¬ç¯‡åŸºäºCentos7ç³»ç»Ÿæ“ä½œå®‰è£…</p><h3 id="å®‰è£…docker">å®‰è£…docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.æ·»åŠ å®˜æ–¹dockeræº</span></span><br><span class="line">[root@docker01 ~]# vim /etc/yum.repos.d/docker-ce.repo </span><br><span class="line">[docker-ce-stable]</span><br><span class="line">name=Docker CE Stable - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://download.docker.com/linux/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/stable</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://download.docker.com/linux/centos/gpg</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æ›¿æ¢åä¸ºæºï¼ˆdockerå®˜æ–¹ä¼—æ‰€å‘¨åŸå› ä¸èƒ½è®¿é—®ä»¥åŠä¸‹è½½æ…¢ï¼Œè¿™é‡Œä½¿ç”¨åä¸ºé•œåƒæºï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">&#x27;s+download.docker.com+mirrors.huaweicloud.com/docker-ce+&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å®‰è£…docker</span></span><br><span class="line">[root@docker01 ~]# yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æ›´æ”¹é•œåƒåŠ é€Ÿï¼ˆå¦‚æœå¤±æ•ˆï¼Œä¹Ÿå¯å¾€ä¸Šæ‰¾å…¶ä»–åŠ é€Ÿåœ°å€ï¼‰</span></span><br><span class="line">[root@docker01 ~]# <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;dns&quot;</span>: [<span class="string">&quot;8.8.8.8&quot;</span>, <span class="string">&quot;8.8.4.4&quot;</span>],</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://dockerproxy.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.nju.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://registry.docker-cn.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# systemctl daemon-reload</span><br><span class="line">[root@docker01 ~]# systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="æ‹‰å–é•œåƒ">æ‹‰å–é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹‰å–æ•°æ®åº“é•œåƒ</span></span><br><span class="line">[root@docker01 ~]# docker pull mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–owncloudé•œåƒ</span></span><br><span class="line">[root@docker01 ~]# docker pull owncloud</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å®¹å™¨">å¯åŠ¨å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºmysqlæœåŠ¡ï¼ˆè¿™é‡Œçš„æ•°æ®åº“å¯†ç ä¹Ÿæ˜¯ä½ è®¿é—®äº‘ç›˜çš„å¯†ç ï¼‰</span></span><br><span class="line">[root@docker01 ~]# docker run --name db --<span class="built_in">env</span> MYSQL_ROOT_PASSWORD=luay123 -d --restart=always mysql</span><br><span class="line"></span><br><span class="line">-name  db         ç»™å®¹å™¨èµ·ä¸ªåå­—ï¼Œå¯è‡ªå®šä¹‰</span><br><span class="line">--restart=always  dockeræ¯æ¬¡é‡å¯éƒ½ä¼šå¯åŠ¨è¿™ä¸ªå®¹å™¨</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ›å»ºä¸€ä¸ªè½¯ä»¶ç›®å½•ï¼Œæ–¹ä¾¿ç®¡ç†owncloudçš„æ•°æ®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä½ ä¸Šä¼ çš„å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰</span></span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> /app/owncloud/ -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ›å»ºowncloudæœåŠ¡</span></span><br><span class="line"><span class="comment"># --link mydb:mydbè¡¨ç¤ºè¿æ¥çš„å¦å¤–ä¸€ä¸ªå®¹å™¨mydb</span></span><br><span class="line">[root@docker01 ~]# docker run --name mycloud -p 8081:80 --<span class="built_in">link</span> mydb:mydb -d -v /app/owncloud/:/var/www/html --restart=always owncloud</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹è¿è¡ŒçŠ¶æ€  ï¼ˆæ˜¯å¦éƒ½æ˜¯upçŠ¶æ€ï¼Œä¸è¦æœ‰ç«¯å£å†²çªï¼‰</span></span><br><span class="line">[root@web01 ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE         CREATED          STATUS          PORTS                                   NAMES</span><br><span class="line">273ee893d887   owncloud    6 seconds ago    Up 4 seconds    0.0.0.0:8081-&gt;80/tcp, :::8081-&gt;80/tcp   mycloud</span><br><span class="line">a614a95ec067   mysql       33 minutes ago   Up 33 minutes   3306/tcp, 33060/tcp                     mydb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æµè§ˆå™¨è®¿é—®   ä½ çš„ip:8081   ä¾‹å¦‚æˆ‘çš„ipæ˜¯10.0.0.7     é‚£å°±è®¿é—®10.0.0.7:8081    </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºç®¡ç†å‘˜è´¦å·</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241015190649471.png" alt="image-20241015190649471"></p><p><strong>ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241015191024034.png" alt="image-20241015191024034"></p><p><img src="https://cos.lukme.top/Pic/image-20241015191332027.png" alt="image-20241015191332027"></p><h3 id="ç®¡ç†æ–‡ä»¶">ç®¡ç†æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¿˜è®°å¾—æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®æ–‡ä»¶ç›®å½•å—ï¼Ÿ  çœ‹çœ‹æˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡æ˜¯ä¸æ˜¯å°±åœ¨è¿™ğŸ˜</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# ll /app/owncloud/data/admin/files/</span><br><span class="line">-rw-r--r-- 1 33 tape  529735 May  6 14:09 8CE7E8A4D305671B267848D4E720CAE3.jpg</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¦‚ä½•æ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„äº‘ç›˜å‘¢ï¼Œè¿™é‡Œå¸¦ä½ ä½¿ç”¨dockeræ¥æ­å»ºå±äºè‡ªå·±çš„äº‘ç›˜å§ã€‚</summary>
    
    
    
    <category term="çˆ±è°ƒç ”" scheme="https://lukme.top/categories/%E7%88%B1%E8%B0%83%E7%A0%94/"/>
    
    
    <category term="ä¸ªäººäº‘ç›˜" scheme="https://lukme.top/tags/%E4%B8%AA%E4%BA%BA%E4%BA%91%E7%9B%98/"/>
    
  </entry>
  
  <entry>
    <title>zabbixå¾®ä¿¡å‘Šè­¦</title>
    <link href="https://lukme.top/posts/96fcc157.html"/>
    <id>https://lukme.top/posts/96fcc157.html</id>
    <published>2024-10-06T13:55:29.000Z</published>
    <updated>2024-10-06T14:17:32.936Z</updated>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.work.weixin.qq.com/document/path/99110">https://developer.work.weixin.qq.com/document/path/99110</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç»ˆç«¯æŸä¸ªç¾¤ç»„æ·»åŠ æœºå™¨äººä¹‹åï¼Œåˆ›å»ºè€…å¯ä»¥åœ¨æœºå™¨äººè¯¦æƒ…é¡µçœ‹åˆ°è¯¥æœºå™¨äººç‰¹æœ‰çš„webhookurlã€‚å¼€å‘è€…å¯ä»¥æŒ‰ä»¥ä¸‹è¯´æ˜å‘è¿™ä¸ªåœ°å€å‘èµ·HTTP POST è¯·æ±‚ï¼Œå³å¯å®ç°ç»™è¯¥ç¾¤ç»„å‘é€æ¶ˆæ¯</span><br><span class="line"><span class="comment">#å‡è®¾webhookæ˜¯   https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=693a91f6-7xxx-4bc4-97a0-0ec2sifa5aaa</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨curlå‘½ä»¤å‘æ¶ˆæ¯</span></span><br><span class="line">curl <span class="string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=693axxx6-7aoc-4bc4-97a0-0ec2sifa5aaa&#x27;</span> \</span><br><span class="line">   -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">   -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">   &#123;</span></span><br><span class="line"><span class="string">    &quot;msgtype&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">    &quot;text&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;content&quot;: &quot;hello world&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">   &#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ–‡æœ¬ç±»å‹</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;msgtype&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¹¿å·ä»Šæ—¥å¤©æ°”ï¼š29åº¦ï¼Œå¤§éƒ¨åˆ†å¤šäº‘ï¼Œé™é›¨æ¦‚ç‡ï¼š60%&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mentioned_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;wangqing&quot;</span><span class="punctuation">,</span><span class="string">&quot;@all&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mentioned_mobile_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;13800001111&quot;</span><span class="punctuation">,</span><span class="string">&quot;@all&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>msgtype</td><td>æ˜¯</td><td>æ¶ˆæ¯ç±»å‹ï¼Œæ­¤æ—¶å›ºå®šä¸ºtext</td></tr><tr><td>content</td><td>æ˜¯</td><td>æ–‡æœ¬å†…å®¹ï¼Œæœ€é•¿ä¸è¶…è¿‡2048ä¸ªå­—èŠ‚ï¼Œå¿…é¡»æ˜¯utf8ç¼–ç </td></tr><tr><td>mentioned_list</td><td>å¦</td><td>useridçš„åˆ—è¡¨ï¼Œæé†’ç¾¤ä¸­çš„æŒ‡å®šæˆå‘˜(@æŸä¸ªæˆå‘˜)ï¼Œ@allè¡¨ç¤ºæé†’æ‰€æœ‰äººï¼Œå¦‚æœå¼€å‘è€…è·å–ä¸åˆ°useridï¼Œå¯ä»¥ä½¿ç”¨mentioned_mobile_list</td></tr><tr><td>mentioned_mobile_list</td><td>å¦</td><td>æ‰‹æœºå·åˆ—è¡¨ï¼Œæé†’æ‰‹æœºå·å¯¹åº”çš„ç¾¤æˆå‘˜(@æŸä¸ªæˆå‘˜)ï¼Œ@allè¡¨ç¤ºæé†’æ‰€æœ‰äºº</td></tr></tbody></table><h3 id="ä½¿ç”¨pythonè°ƒç”¨æ¥å£">ä½¿ç”¨pythonè°ƒç”¨æ¥å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£…pythonç¯å¢ƒ</span></span><br><span class="line">[root@zabbix5-server alertscripts]# yum install -y python36-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£…Pythonçš„requestsæ¨¡å—</span></span><br><span class="line">[root@zabbix5-server alertscripts]# pip3 install requests -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ç¼–å†™pythonè„šæœ¬</span></span><br><span class="line">[root@web01 ~]# vim wechat.py</span><br><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>&#125;</span><br><span class="line">api_url = <span class="string">&quot;webhookåœ°å€&quot;</span></span><br><span class="line">def msg(text):</span><br><span class="line">json_text= &#123;</span><br><span class="line"><span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line"><span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;content&quot;</span>: text</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(requests.post(api_url,json.dumps(json_text),headers=headers).content)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">text = sys.argv[1]</span><br><span class="line">msg(text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å°†è„šæœ¬æ”¾åœ¨/usr/lib/zabbix/alertscripts</span></span><br><span class="line">[root@zabbix5-server ~]# vim /usr/lib/zabbix/alertscripts/wechat.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æˆæƒæ‰§è¡Œæƒé™</span></span><br><span class="line">[root@zabbix5-server ~]# <span class="built_in">chmod</span> +x /usr/lib/zabbix/alertscripts/wechat.py</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ æŠ¥è­¦åª’ä»‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#webç«¯é…ç½®</span></span><br><span class="line">ç®¡ç†&gt;æŠ¥è­¦åª’ä»‹ç±»å‹&gt;åˆ›å»ºåª’ä½“ç±»å‹</span><br><span class="line"></span><br><span class="line">è„šæœ¬å‚æ•°ï¼š&#123;ALERT.MESSAGE&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722843581583.png" alt="QQ_1722843581583"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722843667085.png" alt="QQ_1722843667085"></p><p><strong>æ·»åŠ åŠ¨ä½œ</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722843783104.png" alt="QQ_1722843783104"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722843908351.png" alt="QQ_1722843908351"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722844043228.png" alt="QQ_1722844043228"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722844217316.png" alt="QQ_1722844217316"></p><p><strong>æ·»åŠ æ”¶ä»¶äºº</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722844455876.png" alt="QQ_1722844455876"></p><h3 id="ä½¿ç”¨shellè„šæœ¬è°ƒç”¨æ¥å£">ä½¿ç”¨shellè„šæœ¬è°ƒç”¨æ¥å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ç¼–å†™shellè„šæœ¬åœ¨æŒ‡å®šç›®å½•ä¸‹</span></span><br><span class="line">[root@zabbix5-server alertscripts]# vim /usr/lib/zabbix/alertscripts/wechat.sh</span><br><span class="line">[root@zabbix5-server alertscripts]# <span class="built_in">cat</span> wechat.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">web_hook=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=96462ac7-122d-4f51-946e-694a4c11d2ed&quot;</span></span><br><span class="line">headers=<span class="string">&quot;Content-Type: application/json&quot;</span></span><br><span class="line">json_file=<span class="string">&quot;/usr/lib/zabbix/alertscripts/msg.json&quot;</span></span><br><span class="line">/bin/cat &gt; <span class="variable">$&#123;json_file&#125;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">&quot;msgtype&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">&quot;text&quot;: &#123;</span></span><br><span class="line"><span class="string">&quot;content&quot;: &quot;$1&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">/usr/bin/curl <span class="string">&quot;<span class="variable">$&#123;web_hook&#125;</span>&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;<span class="variable">$&#123;headers&#125;</span>&quot;</span> \</span><br><span class="line">-d <span class="string">&quot;<span class="subst">$(cat $&#123;json_file&#125;)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.åˆ›å»ºä¸€ä¸ªjsonæ–‡ä»¶</span></span><br><span class="line">[root@zabbix5 ~]#vim /usr/lib/zabbix/alertscripts/msg.json</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line"><span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;content&quot;</span>: <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æˆæƒæ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/lib/zabbix/alertscripts/wechat.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æ›´æ”¹å±ä¸»å±ç»„ï¼ˆzabbixå¯åŠ¨ç”¨æˆ·æ˜¯zabbixï¼Œä¸æ”¹åˆ™æ²¡æœ‰æƒé™è°ƒç”¨ï¼‰</span></span><br><span class="line"><span class="built_in">chown</span> zabbix.zabbix /usr/lib/zabbix/alertscripts/wechat.sh</span><br><span class="line"><span class="built_in">chown</span> zabbix.zabbix /usr/lib/zabbix/alertscripts/msg.json</span><br></pre></td></tr></table></figure><p><strong>webç•Œé¢æ·»åŠ æŠ¥è­¦ç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç®¡ç†&gt;æŠ¥è­¦åª’ä»‹ç±»å‹&gt;åˆ›å»ºåª’ä»‹ç±»å‹</span><br><span class="line"></span><br><span class="line">è„šæœ¬å‚æ•°ï¼š&#123;ALERT.MESSAGE&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722845658579.png" alt="QQ_1722845658579"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722845826346.png" alt="QQ_1722845826346"></p><p><strong>æ·»åŠ åŠ¨ä½œ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®&gt;åŠ¨ä½œ&gt;åˆ›å»ºåŠ¨ä½œ</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722845872056.png" alt="QQ_1722845872056"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722846012723.png" alt="QQ_1722846012723"></p><p><strong>æ·»åŠ ä¿å­˜</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722846086534.png" alt="QQ_1722846086534"></p><p><strong>æ·»åŠ æ¥æ”¶äºº</strong></p><p><code>æ·»åŠ å®Œè®°å¾—ç‚¹æ›´æ–°</code></p><p><img src="https://cos.lukme.top/Pic/QQ_1722846168458.png" alt="QQ_1722846168458"></p>]]></content>
    
    
    <summary type="html">æ•™ä½ å®ç°zabbixç›‘æ§æœºå™¨ï¼Œå¾®ä¿¡æœºå™¨äººå‘Šè­¦é€šçŸ¥</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>filebeatæ¨¡å—åŒ–åˆ†ææ—¥å¿—</title>
    <link href="https://lukme.top/posts/907ae385.html"/>
    <id>https://lukme.top/posts/907ae385.html</id>
    <published>2024-10-04T17:19:53.000Z</published>
    <updated>2024-10-04T17:22:33.062Z</updated>
    
    <content type="html"><![CDATA[<h2 id="filebeaté‡‡é›†dockeræ—¥å¿—">filebeaté‡‡é›†dockeræ—¥å¿—</h2><p><strong>1.è¿è¡Œä¸€ä¸ªnginxçš„dockerå®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# docker run --name nginx -d -p 88:80 nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨ï¼šdockerçš„å®‰è£…ä¸å†èµ˜è¿°</span></span><br></pre></td></tr></table></figure><p><strong>2.è®¿é—®æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# curl 10.0.0.211:88</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦è¿”å›nginxç•Œé¢ï¼Œæ³¨æ„ç«¯å£æ˜¯å¦æœ‰å†²çª</span></span><br></pre></td></tr></table></figure><p><strong>3.ç¼–å†™filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/08-docker-log.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: docker</span><br><span class="line">  tags: <span class="string">&#x27;docker&#x27;</span></span><br><span class="line">  <span class="comment">#ä¸‹é¢å†™å®¹å™¨çš„idå·ï¼Œå†™*ä»£è¡¨æ”¶é›†æ‰€æœ‰å®¹å™¨æ—¥å¿—</span></span><br><span class="line">  containers.ids:   </span><br><span class="line">  - <span class="string">&quot;*&quot;</span></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>]</span><br><span class="line">  indices:</span><br><span class="line">    - index: <span class="string">&quot;filebeat-docker-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;docker&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;filebeat&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;filebeat*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:2 ~]# filebeat -e -c /etc/filebeat/08-docker-log.yaml</span><br></pre></td></tr></table></figure><p><strong>3.è®¿é—®nginxä½¿ä¹‹äº§ç”Ÿæ—¥å¿—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# curl 10.0.0.211:88</span><br><span class="line"><span class="comment">#dockerå·²ç»æ˜ å°„æœ¬åœ°88ç«¯å£</span></span><br></pre></td></tr></table></figure><h2 id="filebeatæ¨¡å—">filebeatæ¨¡å—</h2><p>æ¨¡å—æ˜¯filebeatå†…ç½®çš„ä¸€äº›ä¸­é—´ä»¶æ—¥å¿—ç›‘æ§æ–¹æ¡ˆï¼Œæ¯”å¦‚å¸¸è§çš„nginxï¼Œtomcatï¼Œmysqlï¼Œzookeeperç­‰æ—¥å¿—ç›‘æ§ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filebeatå†…ç½®æ¨¡å—åœ¨ /etc/filebeat/modules.d/ä¸‹ã€‚</span><br><span class="line">è¢«ç¦ç”¨çš„æ¨¡å—åç¼€å¸¦.disabled</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ¨¡å—åˆ—è¡¨</span></span><br><span class="line">[root@elk01:2 ~]#  filebeat modules list</span><br></pre></td></tr></table></figure><p><strong>å¯ç¦ç”¨æ¨¡å—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# filebeat modules <span class="built_in">enable</span> nginx tomcat</span><br><span class="line"></span><br><span class="line">[root@elk01:2 ~]# filebeat modules <span class="built_in">disable</span> tomcat</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å—åˆ†ænginxè®¿é—®æ—¥å¿—">æ¨¡å—åˆ†ænginxè®¿é—®æ—¥å¿—</h2><h3 id="å‰æå‡†å¤‡">å‰æå‡†å¤‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.é˜²æ­¢ç´¢å¼•å†²çªï¼Œåˆ é™¤æ‰€æœ‰ç´¢å¼•å’Œç´¢å¼•æ¨¡å¼</span><br><span class="line">2.è¿˜åŸnginxæ—¥å¿—æ ¼å¼ï¼ˆå¦‚æœä¹‹å‰ä½ åšè¿‡nginxè¾“å‡ºæ ¼å¼ä¸ºjsonæ ¼å¼çš„è¯å°±å°†nginxé…ç½®æ–‡ä»¶è¿˜åŸä¸ºåŸæ ¼å¼ï¼‰</span><br><span class="line">3.æ£€æŸ¥nginxæ˜¯å¦å¯ç”¨ï¼Œé…ç½®æ–‡ä»¶æ˜¯å¦OKï¼ˆnginx -tï¼‰ï¼Œå¯ç”¨nginxæ¨¡å—ï¼ˆfilebeat modules <span class="built_in">enable</span> nginxï¼‰</span><br><span class="line">4.å¦‚æœä½ çš„nginxæ—¥å¿—æ–‡ä»¶ä¸åœ¨é»˜è®¤çš„ç›®å½•åˆ™ä¿®æ”¹å®ä¾‹nginxæ–‡ä»¶ï¼Œå¦‚æœé»˜è®¤ç›®å½•åˆ™è·³è¿‡</span><br><span class="line">[root@elk01:2 ~]#  vim /etc/filebeat/modules.d/nginx.yml </span><br><span class="line">Â·Â·Â·#ä¿®æ”¹ä½ çš„æ—¥å¿—æ–‡ä»¶ç›®å½•</span><br><span class="line">var.paths: [<span class="string">&quot;/yourpath/nginx/access.log*&quot;</span>]</span><br><span class="line">Â·Â·Â·</span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶">ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/10-nginx-modules.yaml </span><br><span class="line"><span class="comment"># é…ç½®filebeatçš„å¯ç”¨æ¨¡å—</span></span><br><span class="line">filebeat.config.modules:</span><br><span class="line">  <span class="comment"># é»˜è®¤ä¼šå»æ‰¾filebeatå®‰è£…ç›®å½•ä¸‹çš„&quot;modules.d&quot;æ‰€æœ‰ä»¥&quot;.yml&quot;ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">  path: <span class="variable">$&#123;path.config&#125;</span>/modules.d/*.yml</span><br><span class="line">  <span class="comment"># æ˜¯å¦æ”¯æŒçƒ­åŠ è½½</span></span><br><span class="line">  reload.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>] </span><br><span class="line">  index: <span class="string">&quot;filebeat-nginx-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;filebeat-nginx&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;filebeat-nginx*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/10-nginx-modules.yaml</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004102923489.png" alt="image-20241004102923489"></p><blockquote><p>æ—¥åä¾¿å¯ä»¥åœ¨  èœå•æ â€“&gt;Discoveré‡ŒæŸ¥è¯¢åˆ†ænginxæ—¥å¿—  å¦‚ä¸‹å›¾</p></blockquote><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004103225591.png" alt="image-20241004103225591"></p><h3 id="ç»Ÿè®¡ç½‘ç«™æ—¥PVé‡">ç»Ÿè®¡ç½‘ç«™æ—¥PVé‡</h3><blockquote><p>å¯ä»¥ç†è§£ä¸º  ä¸€ä¸ªé¡µé¢å°±æ˜¯ä¸€æ¡PVï¼Œfilebeatæ˜¯æŒ‰è¡Œç»Ÿè®¡ï¼Œnginxçš„æ¯ä¸ªè®¿é—®è®°å½•éƒ½ä¸ºä¸€è¡Œï¼Œä»¥è®¡æ•°æ–¹å¼ç»Ÿè®¡ä¸ºæ—¥PV</p><p>ç‚¹å‡»ä¿å­˜å³å¯ä¿å­˜å¯è§†åŒ–åº“</p></blockquote><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004103908465.png" alt="image-20241004103908465"></p><h3 id="ç»Ÿè®¡ç½‘ç«™æ—¥UV">ç»Ÿè®¡ç½‘ç«™æ—¥UV</h3><blockquote><p>è¿™ä¸ªç»Ÿè®¡ä¸å¤ªå‡†ç¡®ï¼Œè·å–çš„ipæ˜¯æ—¥å¿—é‡Œæ¯è¡Œç¬¬ä¸€ä¸ªçš„ipï¼Œè¿™ä¸ªipå…¶å®æ˜¯è´Ÿè½½å‡è¡¡çš„ipï¼Œå¦‚æœæƒ³è¦è·å–æ¯ä¸ªç”¨æˆ·çœŸå®ipï¼Œnginxé…ç½®æ–‡ä»¶éœ€è¦è®¾ç½®è·å–ç”¨æˆ·çœŸå®ipæ‰ç®—æ˜¯æ—¥UVé‡ï¼Œä¿å­˜uvåº“</p></blockquote><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004111335927.png" alt="image-20241004111335927"></p><h3 id="ç»Ÿè®¡å¸¦å®½">ç»Ÿè®¡å¸¦å®½</h3><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004112012078.png" alt="image-20241004112012078"></p><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004112552478.png" alt="image-20241004112552478"></p><h3 id="ç»Ÿè®¡è®¾å¤‡ç±»å‹">ç»Ÿè®¡è®¾å¤‡ç±»å‹</h3><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004112842696.png" alt="image-20241004112842696"></p><h3 id="ç»Ÿè®¡è®¾å¤‡æ“ä½œç³»ç»Ÿ">ç»Ÿè®¡è®¾å¤‡æ“ä½œç³»ç»Ÿ</h3><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004120352348.png" alt="image-20241004120352348"></p><h3 id="å…¨çƒæµé‡ç»Ÿè®¡">å…¨çƒæµé‡ç»Ÿè®¡</h3><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004115735265.png" alt="image-20241004115735265"></p><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/global-traffic.gif" alt="recording"></p><h3 id="åˆ›å»ºä»ªè¡¨æ¿">åˆ›å»ºä»ªè¡¨æ¿</h3><blockquote><p>èœå•æ â€“&gt;Dashboard   æ–°å»ºä»ªè¡¨æ¿ï¼Œæ•°æ®ä»å‰é¢ä¿å­˜çš„åº“ä¸­æ·»åŠ </p><p>åˆ·æ–°å¯æ˜¾ç¤ºåœ¨çº¿å®æ—¶æ•°æ®</p></blockquote><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004121524063.png" alt="image-20241004121524063"></p><h2 id="filebeatçš„å¤šè¡Œå¤„ç†">filebeatçš„å¤šè¡Œå¤„ç†</h2><blockquote><p>filestreamæ–‡ä»¶æµä¹Ÿæ˜¯é‡‡é›†æ–‡ä»¶çš„ï¼Œlogçš„æ›¿ä»£</p></blockquote><p><a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/multiline-examples.html">å®˜ç½‘</a></p><p><strong>multilineçš„countç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/11-filestream_multiline.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: filestream</span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/student.info</span><br><span class="line">  parsers:</span><br><span class="line">  - multiline:</span><br><span class="line">      <span class="built_in">type</span>: count</span><br><span class="line">      count_lines: 4</span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Š</span></span><br><span class="line">      <span class="comment"># typeæŒ‡å®šç±»å‹ï¼Œæœ‰æ•ˆå€¼ä¸º: patternå’Œcount</span></span><br><span class="line">      <span class="comment">#  pattern:      åŸºäºæ­£åˆ™åŒ¹é…äº‹ä»¶ã€‚</span></span><br><span class="line">      <span class="comment">#  count:         å°†å‡ è¡Œæ•°æ®ä½œä¸ºä¸€ä¸ªäº‹ä»¶</span></span><br><span class="line">      <span class="comment">#count_lines:  å°†æŒ‡å®šçš„è¡Œæ•°åˆå¹¶ä¸ºä¸€ä¸ªäº‹ä»¶</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">#æç¤º ï¼šcountç±»å‹è¿™ç§ï¼Œéœ€è¦è¢«æ”¶é›†çš„ä¿¡æ¯æ ¼å¼æ˜¯æœ‰è§„å¾‹çš„</span></span><br><span class="line">ä¾‹å¦‚ï¼š   count: 2  ï¼ˆæ•°æ®éƒ½æ˜¯4è¡Œ4è¡Œçš„æˆ–Nè¡ŒNè¡Œçš„ï¼‰</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /tmp/student.info </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hobby&quot;</span>: [<span class="string">&quot;å­¦ä¹ &quot;</span>,<span class="string">&quot;è·‘æ­¥&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;æå››&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hobby&quot;</span>: [<span class="string">&quot;å­¦ä¹ &quot;</span>,<span class="string">&quot;çœ‹ä¹¦&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> [root@elk01:0 ~]# filebeat -e -c /etc/filebeat/11-filestream_multiline-.yaml</span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 384,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/student.info&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;flags&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;multiline&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;&#123;\n  \&quot;name\&quot;: \&quot;å¼ ä¸‰\&quot;,\n  \&quot;hobby\&quot;: [\&quot;å­¦ä¹ \&quot;,\&quot;è·‘æ­¥\&quot;]\n&#125;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filestream&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#å°†å¤šè¡Œæ•°æ®é‡‡é›†ä¸ºä¸€è¡Œï¼Œä½†å¿…é¡»æ˜¯æœ‰è§„å¾‹çš„ï¼Œé‡‡é›†çš„æ˜¯ä¸Šé¢æ–‡ä»¶æ¯4è¡Œä¸ºä¸€ç»„æ•°æ®</span></span><br></pre></td></tr></table></figure><p><strong>multilineçš„patternç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/12-filestream_multiline_pattern.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: filestream</span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/student.info</span><br><span class="line">  parsers:</span><br><span class="line">  - multiline:</span><br><span class="line">      <span class="built_in">type</span>: pattern</span><br><span class="line">      pattern: <span class="string">&#x27;^\&#123;&#x27;</span></span><br><span class="line">      negate: <span class="literal">true</span></span><br><span class="line">      match: after</span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Š</span></span><br><span class="line">patternï¼š <span class="string">&#x27;^\&#123;&#x27;</span> åŒ¹é…ä»¥&#123;å¼€å¤´çš„</span><br><span class="line">negate: åŒ¹é…è§„åˆ™</span><br><span class="line">match: åŒ¹é…è§„åˆ™   è§ä¸‹å›¾</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241004212526358.png" alt="image-20241004212526358"></p><h2 id="filebeaté‡‡é›†tomcatæ—¥å¿—">filebeaté‡‡é›†tomcatæ—¥å¿—</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.éƒ¨ç½²tomcat</span><br><span class="line">[root@elk01:0 app]# wget https://dlcdn.apache.org/tomcat/tomcat-10/v10.1.30/bin/apache-tomcat-10.1.30.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹å®‰è£…tomcat(æå‰åˆ›å»ºå®‰è£…ç›®å½•)</span><br><span class="line">[root@elk01:0 app]# tar xf apache-tomcat-10.1.30.tar.gz -C /app</span><br><span class="line">[root@elk01:0 app]# <span class="built_in">ln</span> -s /app/apache-tomcat-10.1.30/ /app/tomcat</span><br><span class="line"></span><br><span class="line">3.é…ç½®tomatoçš„jdkç¯å¢ƒï¼Œä½¿ç”¨elasticsearchçš„jdkå³å¯ï¼ŒæŸ¥çœ‹javaç‰ˆæœ¬</span><br><span class="line">[root@elk01:0 app]#  /usr/share/elasticsearch/jdk/bin/java --version</span><br><span class="line">openjdk 22.0.1 2024-04-16</span><br><span class="line">OpenJDK Runtime Environment (build 22.0.1+8-16)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 22.0.1+8-16, mixed mode, sharing)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:0 app]# <span class="built_in">cat</span> /etc/profile.d/jdk.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/share/elasticsearch/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01:0 app]# <span class="built_in">source</span> /etc/profile.d/jdk.sh </span><br><span class="line">[root@elk01:0 app]# java --version</span><br><span class="line">openjdk 22.0.1 2024-04-16</span><br><span class="line">OpenJDK Runtime Environment (build 22.0.1+8-16)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 22.0.1+8-16, mixed mode, sharing)</span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨tomcat</span><br><span class="line">[root@elk01:0 app]# /app/tomcat/bin/startup.sh </span><br></pre></td></tr></table></figure><p><strong>ç¼–å†™filebeatå®ä¾‹</strong>   ä½¿ç”¨tomcaté‡‡é›†æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1.å¯ç”¨tomcatæ¨¡å—</span><br><span class="line">[root@elk01:0 app]# filebeat modules <span class="built_in">enable</span> tomcat</span><br><span class="line"></span><br><span class="line">2.ä¿®æ”¹tomcatæ¨¡å—é‡Œæ—¥å¿—è·¯å¾„</span><br><span class="line">[root@elk01:0 app]# vim /etc/filebeat/modules.d/tomcat.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    <span class="comment">## é»˜è®¤æ˜¯udpç±»å‹ï¼Œæœ‰æ•ˆå€¼: udp,tcp,file</span></span><br><span class="line">    <span class="comment"># å½“ç±»å‹ä¸ºfileæ—¶ï¼Œä¸‹é¢å®šä¹‰çš„è·¯å¾„æ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class="line">    var.input: file</span><br><span class="line">    var.paths:</span><br><span class="line">      - /app/tomcat/logs/localhost_access_log.* </span><br><span class="line">Â·Â·Â·</span><br><span class="line"></span><br><span class="line">3.ç¼–å†™filebeatå®ä¾‹</span><br><span class="line">[root@elk01:0 app]# <span class="built_in">cat</span> /etc/filebeat/13.modules_tomcat.yaml </span><br><span class="line">filebeat.config.modules:</span><br><span class="line">  path: <span class="variable">$&#123;path.config&#125;</span>/modules.d/*.yml</span><br><span class="line">  reload.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">  elasticsearch:</span><br><span class="line">    hosts: </span><br><span class="line">    - <span class="string">&quot;http://10.0.0.211:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.212:9200&quot;</span></span><br><span class="line">    - <span class="string">&quot;http://10.0.0.213:9200&quot;</span></span><br><span class="line">    index: <span class="string">&quot;modules-tomcat-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;modules-tomcat&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;modules-tomcat*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 3</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨å®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/13.modules_tomcat.yaml </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡è®²è¿°äº†ä½¿ç”¨filebeatçš„å†…ç½®nginxæ¨¡å—æ¥åˆ†ænginxæ—¥å¿—ï¼Œå¹¶ç»Ÿè®¡å‡ºå›¾</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>filebeatå¤šå®ä¾‹</title>
    <link href="https://lukme.top/posts/29cf1fa5.html"/>
    <id>https://lukme.top/posts/29cf1fa5.html</id>
    <published>2024-10-04T17:16:01.000Z</published>
    <updated>2024-10-04T17:22:33.057Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æŒ‡å®šESçš„åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡">æŒ‡å®šESçš„åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡</h2><p><strong>ESç´¢å¼•åç§°çš„åˆ›å»ºè§„èŒƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.åç§°æœ€å¥½è§åçŸ¥æ„ï¼Œæœ€å¥½å’Œä½ å®é™…å†™å…¥çš„ä¸šåŠ¡æœ‰å…³;</span><br><span class="line">2.åç§°ä¸è¦ä»¥<span class="string">&quot;.&quot;</span>å¼€å¤´ï¼Œä»¥<span class="string">&quot;.&quot;</span>å¼€å¤´å¤šç´¢å¼•æˆ‘ä»¬ç§°ä¹‹ä¸º<span class="string">&quot;éšè—ç´¢å¼•&quot;</span>;</span><br><span class="line">3.ä¸€èˆ¬éšè—ç´¢å¼•éƒ½æ˜¯ç»„ä»¶å»åˆ›å»ºï¼Œå»ºè®®ä¸è¦äººä¸ºåˆ›å»ºï¼Œé»˜è®¤kibanaå°±éšè—äº†ä»¥<span class="string">&quot;.&quot;</span>å¼€å¤´çš„ç´¢å¼•</span><br><span class="line">4.å­—ç¬¦æ”¯æŒå°å†™å­—æ¯ï¼Œæ•°å­—åŠè¿å­—ç¬¦(-)ï¼Œå’Œå†…ç½®ä¸€äº›å˜é‡æ¯”å¦‚<span class="string">&quot;%&#123;...&#125;&quot;</span>;</span><br><span class="line">5.ä¸è¦å‡ºç°ç‰¹æ®Šå­—ç¬¦;</span><br></pre></td></tr></table></figure><p><strong>1.é€šè¿‡ESçš„APIæ“ä½œå‰¯æœ¬å’Œåˆ†ç‰‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/school&#x27;</span> \</span><br><span class="line">-H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">-d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;settings&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;number_of_shards&quot;: 5,</span></span><br><span class="line"><span class="string">      &quot;number_of_replicas&quot;: 0</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºç´¢å¼•schoolï¼Œä¸»åˆ†ç‰‡5ï¼Œå‰¯æœ¬0</span></span><br></pre></td></tr></table></figure><p><strong>2.é€šè¿‡ç´¢å¼•æ¨¡æ¿æ“ä½œå‰¯æœ¬å’Œåˆ†ç‰‡</strong></p><blockquote><p>ç´¢å¼•æ¨¡æ¿ï¼šåˆ›å»ºç´¢å¼•æ—¶ï¼Œä¼šè‡ªåŠ¨åŒ¹é…æ˜¯å¦æœ‰å¯¹åº”çš„ç´¢å¼•æ¨¡æ¿ï¼Œè‹¥åŒ¹é…åˆ™æ ¹æ®ç´¢å¼•æ¨¡æ¿åˆ›å»ºã€‚</p></blockquote><p>â€‹    <strong>2.1åˆ›å»ºç´¢å¼•æ¨¡æ¿</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/_index_template/linux-school&#x27;</span> \</span><br><span class="line">-H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">-d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;template&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;settings&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;number_of_replicas&quot;: 0,</span></span><br><span class="line"><span class="string">      &quot;number_of_shards&quot;: 5</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;index_patterns&quot;: [</span></span><br><span class="line"><span class="string">    &quot;linux-school*&quot;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Šï¼šindex_patternsï¼Œè¿™é‡Œæ˜¯ç”¨äºåŒ¹é…ç´¢å¼•çš„ï¼Œå‡¡æ˜¯ç´¢å¼•æ˜¯linux-schoolçš„éƒ½ä¼šå…³è”æ­¤æ¨¡æ¿</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002233116968.png" alt="image-20241002233116968"></p><p><strong>éªŒè¯æ¨¡æ¿</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/linux-school-01&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;linux-school-01&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°åŠ è½½ç´¢å¼•ç®¡ç†ï¼Œå‘ç°åˆ›å»ºçš„ç´¢å¼•å…³è”äº†æ¨¡æ¿ï¼Œåˆ›å»ºäº†5ä¸ªåˆ†ç‰‡</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002233631403.png" alt="image-20241002233631403"></p><p>2.2å›¾å½¢åŒ–åˆ›å»ºç´¢å¼•æ¨¡æ¿</p><p><img src="https://cos.lukme.top/Pic/index.gif" alt="recording"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">éªŒè¯ç´¢å¼•æ¨¡æ¿ï¼š</span><br><span class="line">[root@elk01:2 ~]# curl -X PUT <span class="string">&#x27;http://10.0.0.211:9200/student01&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;student01&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">ç´¢å¼•ç®¡ç†é‡ŒæŸ¥çœ‹æ–°åˆ›å»ºçš„student-01ç´¢å¼•æ˜¯å¦æ˜¯  3åˆ†ç‰‡ï¼Œ0å‰¯æœ¬ è‡ªç„¶æ˜¯OKçš„</span><br></pre></td></tr></table></figure><p><strong>3.é€šè¿‡filebeatç»„ä»¶æ“ä½œå‰¯æœ¬å’Œåˆ†ç‰‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/filebeat/06-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>] </span><br><span class="line">  <span class="comment"># è‡ªå®šä¹‰ç´¢å¼•åç§°  ,å‰ææ˜¯å…³é—­ç´¢å¼•çš„ç”Ÿå‘½å‘¨æœŸ  </span></span><br><span class="line">  index: <span class="string">&quot;test-filebeat-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#å…³é—­ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line"><span class="comment">#å®šä¹‰ç´¢å¼•æ¨¡æ¿çš„åç§°</span></span><br><span class="line">setup.template.name: <span class="string">&quot;test-filebeat&quot;</span></span><br><span class="line"><span class="comment">#å®šä¹‰æ¨¡æ¿çš„åŒ¹é…æ¨¡å¼</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;test-filebeat*&quot;</span></span><br><span class="line"><span class="comment">#è‹¥ç´¢å¼•æ¨¡å¼æ¨¡æ¿å­˜åœ¨ï¼Œæ˜¯å¦è¦†ç›–  </span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line"><span class="comment">#å®šä¹‰ç´¢å¼•æ¨¡æ¿è®¾ç½®</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 5</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¦‚ä¸‹ç´¢å¼•ç®¡ç†é‡Œä¾¿åˆ›å»ºäº†ä¸€ä¸ªåä¸ºtest-filebeatçš„ç´¢å¼•å’Œtest-filebeatçš„æ¨¡æ¿</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241003002143618.png" alt="image-20241003002143618"></p><blockquote><p>æç¤ºï¼šåŸºäºfilebeaté…ç½®çš„ESé›†ç¾¤çš„ç´¢å¼•åŠåˆ†ç‰‡ï¼Œå‰¯æœ¬ä¿¡æ¯ï¼Œæœ¬è´¨ä¸Šåˆ›å»ºæ—¶ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºESçš„httpè¯·æ±‚è¿›è¡Œåˆ›å»ºç´¢å¼•ã€‚</p></blockquote><h2 id="å¤šä¸ªintputå†™åˆ°ä¸åŒç´¢å¼•">å¤šä¸ªintputå†™åˆ°ä¸åŒç´¢å¼•</h2><blockquote><p>éœ€æ±‚ï¼šå¤šä¸ªinputså†™å…¥åˆ°ESé›†ç¾¤é‡Œçš„ä¸åŒç´¢å¼•é‡Œ</p></blockquote><p><strong>1.ç¼–å†™é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/filebeat/07-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  <span class="comment">#ç»™äº‹ä»¶æ‰“æ ‡ç­¾ä¸ºfile</span></span><br><span class="line">  tags: <span class="string">&quot;file&quot;</span></span><br><span class="line">  paths:</span><br><span class="line">  - /tmp/test.log </span><br><span class="line">  </span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  tags: <span class="string">&quot;tcp&quot;</span></span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line">  </span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  tags: <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>]</span><br><span class="line">  <span class="comment">#index: &quot;student-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">  <span class="comment">#å¤šä¸ªç´¢å¼•æ¨¡å¼</span></span><br><span class="line">  indices:</span><br><span class="line">    - index: <span class="string">&quot;study-file-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;file&quot;</span></span><br><span class="line">    - index: <span class="string">&quot;study-tcp-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;tcp&quot;</span></span><br><span class="line">    - index: <span class="string">&quot;study-nginx-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">&quot;nginx&quot;</span></span><br><span class="line"></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line">setup.template.name: <span class="string">&quot;study&quot;</span></span><br><span class="line">setup.template.pattern: <span class="string">&quot;study*&quot;</span></span><br><span class="line">setup.template.overwrite: <span class="literal">false</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 8</span><br><span class="line">  index.number_of_replicas: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™æ¯ä¸ªäº‹ä»¶æ‰“ä¸Šä¸“å±æ ‡ç­¾ï¼Œç´¢å¼•é‡Œæ ¹æ®æ ‡ç­¾åˆ¤æ–­å†™å…¥å“ªé‡Œ</span></span><br></pre></td></tr></table></figure><p><strong>2.å¯åŠ¨filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/07-nginx-es.yaml </span><br></pre></td></tr></table></figure><p><strong>3.æµ‹è¯•tcpæ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;999&quot;</span> | nc 10.0.0.211 9000</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;666&quot;</span> | nc 10.0.0.211 9000</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;000&quot;</span> | nc 10.0.0.211 9000</span><br></pre></td></tr></table></figure><p><strong>4.æµ‹è¯•nginx</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> curl 10.0.0.211;<span class="built_in">sleep</span> 0.5;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>5.æµ‹è¯•æœ¬åœ°æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> â€˜hello world<span class="string">&#x27; &gt;/tmp/test.log</span></span><br></pre></td></tr></table></figure><p><strong>6.kibanaåŸºäºDiscoveråˆ†ææ•°æ®</strong></p><p>â€‹    6.1æŸ¥çœ‹ç´¢å¼•æ˜¯å¦éƒ½åˆ›å»ºå®Œæˆ</p><p><img src="https://cos.lukme.top/Pic/image-20241003114353521.png" alt="image-20241003114353521"></p><p>6.2åˆ›å»ºç´¢å¼•æ¨¡å¼ä¸º     study*</p><p>6.3 è¿›å…¥Discoverï¼Œé€‰æ‹©ç›¸åº”å­—æ®µï¼ŒæŸ¥çœ‹åˆ†ææ•°æ®</p><p><img src="https://cos.lukme.top/Pic/image-20241003114810243.png" alt="image-20241003114810243"></p><h2 id="æ§åˆ¶å¤šä¸ªinputæºçš„æ˜¯å¦å¯ç”¨">æ§åˆ¶å¤šä¸ªinputæºçš„æ˜¯å¦å¯ç”¨</h2><blockquote><p>ä½¿ç”¨enabledï¼Œæ§åˆ¶inputså¤šä¸ªæºæ˜¯å¦å¯ç”¨ï¼Œtrue / false</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  <span class="comment"># é…ç½®è¯¥ä»£ç å—æ˜¯å¦æ‰§è¡Œï¼Œé»˜è®¤å€¼ä¸ºtrueï¼Œè‹¥ä¸æƒ³è¦åŠ è½½ï¼Œåˆ™è®¾ç½®ä¸ºfalseå³å¯</span></span><br><span class="line">  enabled: <span class="literal">false</span></span><br><span class="line">  tags: <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log*</span><br></pre></td></tr></table></figure><h2 id="filebeat-å¤šå®ä¾‹">filebeat å¤šå®ä¾‹</h2><p><strong>1.å¯åŠ¨ç¬¬ä¸€ä¸ªå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/02-tcp-console.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/02-tcp-console.yaml </span><br></pre></td></tr></table></figure><p><strong>2.å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/filebeat/04-nginx-console.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_keys: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/04-nginx-console.yaml</span><br><span class="line">2024-10-03T12:15:44.735+0800    INFO    instance/beat.go:698    Home path: [/usr/share/filebeat] Config path: [/etc/filebeat] Data path: [/var/lib/filebeat] Logs path: [/var/log/filebeat] Hostfs Path: [/]</span><br><span class="line">2024-10-03T12:15:44.737+0800    ERROR   instance/beat.go:1027   Exiting: <span class="string">&#x27;data path already locked by another beat&#x27;</span>. Please make sure that multiple beats are not sharing the same data path (path.data).</span><br><span class="line">Exiting: data path already locked by another beat. Please make sure that multiple beats are not sharing the same data path (path.data).</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨ç¬¬äºŒä¸ªçš„å®ä¾‹æ—¶å€™æç¤ºï¼Œæ•°æ®ç›®å½•å·²ç»è¢«å…¶ä»–çš„å®ä¾‹é”å®šäº†ï¼ŒæŸ¥çœ‹/var/lib/filebeat/ç›®å½•é‡Œå­˜åœ¨ä¸€ä¸ªé”æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#ä¸èƒ½å…±ç”¨æ•°æ®ç›®å½•ï¼Œå½“é€€å‡ºè¿™ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªé”æ–‡ä»¶ä¹Ÿä¼šæ¶ˆå¤±</span></span><br><span class="line">[root@elk01:1 ~]# ll /var/lib/filebeat/</span><br><span class="line">-rw------- 1 root root    0 Oct  3 12:15 filebeat.lock</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹ï¼Œéœ€è¦æŒ‡å®šæ•°æ®ç›®å½•</span></span><br><span class="line">[root@elk01:2 ~]# filebeat -e -c /etc/filebeat/04-nginx-console.yaml --path.data /tmp/nginx-filebeat</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ€»ç»“:</span><br><span class="line">- 1.åŒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å¯åŠ¨å¤šä¸ªfilebeatå®ä¾‹ï¼Œä½†éœ€è¦æŒ‡å®šä¸åŒçš„æ•°æ®ç›®å½•;</span><br><span class="line">- 2.å¦‚æœfilebeaté‡‡é›†å¤šä¸ªæ•°æ®æºæœ‰ä¸¤ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Œè¦ä¹ˆé…ç½®å¤šä¸ªinputï¼Œè¦ä¹ˆä½¿ç”¨å¤šå®ä¾‹;</span><br><span class="line"></span><br><span class="line">å¦‚æœæ‰€æœ‰é…ç½®éƒ½æ”¾åœ¨åŒä¸€ä¸ªfilebeatä¼˜ç¼ºç‚¹:</span><br><span class="line">ä¼˜ç‚¹:</span><br><span class="line">éƒ¨ç½²æ–¹ä¾¿ï¼Œå¯åŠ¨ä¸€ä¸ªå®ä¾‹å³å¯ã€‚</span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">-1.å½“å¤šä¸ªinputä¸­æœ‰ä»»æ„ä¸€ä¸ªéœ€è¦ä¿®æ”¹æ—¶ï¼Œåœ¨é‡å¯æœŸé—´ï¼Œå…¶ä»–çš„inputéƒ½ä¼šå—åˆ°å½±å“ã€‚</span><br><span class="line">-2.å½“é…ç½®å¤šäº‹ï¼Œå¤šä¸ªinputé…ç½®æ¯”è¾ƒç¹ç;</span><br><span class="line"></span><br><span class="line">å¦‚æœæ‰€æœ‰é…ç½®éƒ½ä½¿ç”¨ä¸åŒfilebeatï¼Œå¤šå®ä¾‹ä¼˜ç¼ºç‚¹:</span><br><span class="line">ä¼˜ç‚¹:</span><br><span class="line">- 1.å®ç°äº†é…ç½®æ–‡ä»¶å’Œç¨‹åºçš„è§£è€¦ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯ä¸€ä¸ªå®ä¾‹æŒ‚æ‰ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–å®ä¾‹;</span><br><span class="line">- 2.é…ç½®ç®€å•</span><br><span class="line">ç¼ºç‚¹:</span><br><span class="line">- 1.éƒ¨ç½²ä¸æ–¹ä¾¿ï¼Œè¦åŒæ—¶éƒ¨ç½²å¤šä¸ªfilebeatï¼Œä¸”æ•°æ®ç›®å½•éœ€è¦å•ç‹¬æŒ‡å®šç»´æŠ¤;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡é€šè¿‡filebeatå†™å…¥ä¸åŒç´¢å¼•å’Œä½¿ç”¨ä¸åŒæ•°æ®ç›®å½•å®ç°å¤šå®ä¾‹</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>EFKæ¶æ„éƒ¨ç½²</title>
    <link href="https://lukme.top/posts/fab536ab.html"/>
    <id>https://lukme.top/posts/fab536ab.html</id>
    <published>2024-10-04T17:14:30.000Z</published>
    <updated>2024-10-04T17:22:33.063Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¯´æ˜ï¼šå…¨ç¯‡elasticæ˜¯åŸºäºUbuntuç³»ç»Ÿå®‰è£…çš„ï¼Œä¸Centoså·®åˆ«ä¸æ˜¯å¤ªå¤§ï¼Œä¸‹è½½è½¯ä»¶è¿æ¥å¯å»å®˜ç½‘ä¸‹è½½</p></blockquote><h2 id="ElasitcStackæ¦‚è¿°">ElasitcStackæ¦‚è¿°</h2><h3 id="1-ä»€ä¹ˆæ˜¯ElasticStackï¼Ÿ">1.ä»€ä¹ˆæ˜¯ElasticStackï¼Ÿ</h3><p>æ‰€è°“çš„ElasticStackåˆ«åä¸ºelk stackã€‚</p><p>ELKæŒ‡çš„æ˜¯ä¸‰ä¸ªæŠ€æœ¯æ ˆ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- ElasticSearchï¼Œç®€ç§°ï¼š es</span><br><span class="line">æ•°æ®åº“ï¼Œåº”ç”¨åœºæ™¯ä¸ºæ•°æ®çš„å¿«é€Ÿæ£€ç´¢ã€‚ä½†å‡¡å’Œæœç´¢æ¡†ç›¸å…³çš„ï¼Œéƒ½ä¼šç”¨ESè¿›è¡Œæ•°æ®çš„æŸ¥è¯¢ã€‚</span><br><span class="line"></span><br><span class="line">- Logstash:</span><br><span class="line">é‡‡é›†æ•°æ®ï¼Œæ—¥å¿—èšåˆï¼Œå¤„ç†æ•°æ®ï¼Œå°†æ•°æ®å†™å…¥åˆ°ESå­˜å‚¨åº“ã€‚</span><br><span class="line"></span><br><span class="line">- Kibana:</span><br><span class="line">ç”¨äºå‡ºå›¾å±•ç¤ºæ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç”±äºLogstashæ¯”è¾ƒé‡é‡çº§ï¼Œé‡‡é›†æ—¥å¿—æ—¶å¯åŠ¨è¾ƒæ…¢ï¼Œä½¿ç”¨JRubyè¯­è¨€ç ”å‘ï¼Œå¯åŠ¨æ—¶éœ€è¦å…ˆå¯åŠ¨è™šæ‹Ÿæœºã€‚å› æ­¤å®˜æ–¹å¼€å‘äº†beatsç»„ä»¶ï¼Œbeatsç»„ä»¶æ˜¯ä¸€ç³»åˆ—beatçš„é›†åˆï¼Œæ¯”å¦‚filebeatå°±æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„beatç»„ä»¶ï¼Œå¤šç”¨äºæ–‡æœ¬æ—¥å¿—é‡‡é›†ã€‚</span><br></pre></td></tr></table></figure><h3 id="2-å¸¸ç”¨çš„æ¶æ„">2.å¸¸ç”¨çš„æ¶æ„</h3><p>EFK:<br>- ElasticSearch<br>- Filebeat:<br>é‡‡é›†æ•°æ®å†™å…¥ESé›†ç¾¤ã€‚<br>- Kibana</p><p>ELFK:<br>- ElasticSearch<br>- Filebeat:<br>- Logstash<br>- Kibana</p><p>ELKF+KAFKA:<br>- zookeeper<br>- kafka</p><h2 id="ElasticSearch">ElasticSearch</h2><h3 id="1-ä»€ä¹ˆæ˜¯ElasticSearch">1.ä»€ä¹ˆæ˜¯ElasticSearch</h3><p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ï¼Œèƒ½å¤Ÿè§£å†³ä¸æ–­æ¶Œç°å‡ºçš„å„ç§ç”¨ä¾‹ã€‚ä½œä¸º Elastic Stack çš„æ ¸å¿ƒï¼ŒElasticsearch ä¼šé›†ä¸­å­˜å‚¨æ‚¨çš„æ•°æ®ï¼Œè®©æ‚¨é£å¿«å®Œæˆæœç´¢ï¼Œå¾®è°ƒç›¸å…³æ€§ï¼Œè¿›è¡Œå¼ºå¤§çš„åˆ†æï¼Œå¹¶è½»æ¾ç¼©æ”¾è§„æ¨¡ã€‚ESçš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å­˜å‚¨æ•°æ®å’Œå¿«é€Ÿè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ã€‚</p><h3 id="2-å®‰è£…éƒ¨ç½²ES">2.å®‰è£…éƒ¨ç½²ES</h3><p><strong>å•ç‚¹éƒ¨ç½²ES</strong>   ä¸€èˆ¬ç”¨äºæµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">`æœ¬æœºipï¼š10.0.0.211`</span><br><span class="line">1.ä¸‹è½½ES</span><br><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">2.å®‰è£…ES</span><br><span class="line">[root@elk01 ~]# dpkg -i elasticsearch-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">3.ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk01 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line">cluster.name: elk</span><br><span class="line">path.data: /var/lib/elasticsearch</span><br><span class="line">path.logs: /var/log/elasticsearch</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.port: 9300</span><br><span class="line">discovery.type: single-node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`ç›¸å…³å‚æ•°è¯´æ˜:`</span><br><span class="line">cluster.name: <span class="comment">#æŒ‡å®šESé›†ç¾¤çš„åç§°</span></span><br><span class="line">path.data: <span class="comment">#æŒ‡å®šæ•°æ®ç›®å½•</span></span><br><span class="line">path.logs: <span class="comment">#æŒ‡å®šæ—¥å¿—ç›®å½•</span></span><br><span class="line">network.host: <span class="comment">#æŒ‡å®šå®¿ä¸»æœºçš„ç›‘å¬IPã€‚</span></span><br><span class="line">http.port: 9200<span class="comment">#å¯¹å¤–æä¾›http|httpsæ¥å£çš„ç«¯å£ã€‚</span></span><br><span class="line">transport.port: 9300<span class="comment">#é›†ç¾¤å†…éƒ¨æ•°æ®ä¼ è¾“çš„ç«¯å£ï¼Œä¼šä¼˜å…ˆå¯åŠ¨è¯¥ç«¯å£é€‰ä¸¾masterååœ¨å¯åŠ¨9200ç«¯å£ã€‚</span></span><br><span class="line">discovery.type: <span class="comment">#æŒ‡å®šESé›†ç¾¤çš„ç±»å‹ï¼Œsingle-nodeè¡¨ç¤ºçš„æ˜¯å•ç‚¹ã€‚</span></span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨ESå¹¶è®¾ç½®å¼€æœºè‡ªå¯</span><br><span class="line">[root@elk01 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch</span><br><span class="line"></span><br><span class="line">5.æ£€æŸ¥ç›‘å¬çš„ç«¯å£å·</span><br><span class="line">[root@elk01 ~]# ss -lntup |egrep <span class="string">&#x27;9[23]00&#x27;</span></span><br><span class="line">tcp6       0      0 :::9200        :::*       LISTEN      6431/java</span><br><span class="line">tcp6       0      0 :::9300        :::*       LISTEN      6431/java</span><br><span class="line"></span><br><span class="line">6.æµ‹è¯•è®¿é—®</span><br><span class="line">[root@elk01:0 ~]# curl 10.0.0.211:9200</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;vV46E9vqRK-MxDs6I-3ceg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;deb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;61d76462eecaf09ada684d1b5d319b5ff6865a83&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2024-07-25T14:37:42.448799567Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.11.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</span></span><br><span class="line">[root@elk01:0 ~]# curl 10.0.0.211:9200/_cat/nodes</span><br><span class="line">10.0.0.211 19 91 11 0.10 0.23 0.11 cdfhilmrstw * elk01</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºè¡¨å¤´ä¿¡æ¯    *ä»£è¡¨masterèŠ‚ç‚¹</span></span><br><span class="line">[root@elk01:0 ~]# curl 10.0.0.211:9200/_cat/nodes?v</span><br><span class="line">ip         heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line">10.0.0.211           20          91   0    0.06    0.21     0.11 cdfhilmrstw *      elk01</span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•å¸è½½ESï¼Ÿ</strong></p><pre><code>1.åœæ­¢ESæœåŠ¡[root@elk91 ~]# systemctl disable --now elasticsearch.service 2.åˆ é™¤æ•°æ®[root@elk91 ~]# \rm -rf  /var/&#123;lib,log&#125;/elasticsearch/ /tmp/*  /etc/elasticsearch3.åˆ é™¤è½¯ä»¶[root@elk91 ~]# sudo yum remove elasticsearch[root@elk91 ~]# sudo rpm -e elasticsearch</code></pre><h3 id="3-éƒ¨ç½²ESé›†ç¾¤">3.éƒ¨ç½²ESé›†ç¾¤</h3><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>LanIP</th></tr></thead><tbody><tr><td>elk01</td><td>10.0.0.211</td><td>172.16.1.211</td></tr><tr><td>elk02</td><td>10.0.0.222</td><td>172.16.1.222</td></tr><tr><td>elk03</td><td>10.0.0.233</td><td>172.16.1.233</td></tr></tbody></table><p><strong>1.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ElasticSearch</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½ES</span><br><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.23-amd64.deb</span><br><span class="line">[root@elk01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 212 213;<span class="keyword">do</span> scp elasticsearch-7.17.23-x86_64.rpm root@172.16.1.<span class="variable">$i</span>:/root ;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">2.å®‰è£…ES</span><br><span class="line">[root@elk01 ~]#dpkg -i elasticsearch-7.17.23-amd64.deb</span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line">cluster.name: elk</span><br><span class="line">path.data: /var/lib/elasticsearch</span><br><span class="line">path.logs: /var/log/elasticsearch</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.port: 9300</span><br><span class="line">discovery.seed_hosts: [<span class="string">&quot;10.0.0.211&quot;</span>, <span class="string">&quot;10.0.0.212&quot;</span>,<span class="string">&quot;10.0.0.213&quot;</span>]</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">&quot;10.0.0.211&quot;</span>, <span class="string">&quot;10.0.0.212&quot;</span>,<span class="string">&quot;10.0.0.213&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`ç›¸å…³å‚æ•°è¯´æ˜:`</span><br><span class="line">discovery.seed_hosts:<span class="comment">#å½“å‰ESé›†ç¾¤çš„ä¸»æœºåˆ—è¡¨ã€‚</span></span><br><span class="line">cluster.initial_master_nodes:<span class="comment">#é›†ç¾¤å¯åŠ¨æ—¶é¦–æ¬¡å‚ä¸masteré€‰ä¸¾çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>3.å°†é…ç½®æ–‡ä»¶æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹</strong></p><pre><code>[root@elk01 ~]# scp /etc/elasticsearch/elasticsearch.yml root@172.16.1.212:/etc/elasticsearch/[root@elk01 ~]# scp /etc/elasticsearch/elasticsearch.yml root@172.16.1.213:/etc/elasticsearch/</code></pre><p>**4.å¯åŠ¨ESé›†ç¾¤ **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch.service </span><br><span class="line">[root@elk02 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch.service </span><br><span class="line">[root@elk03 ~]# systemctl <span class="built_in">enable</span> --now elasticsearch.service </span><br></pre></td></tr></table></figure><p><strong>5.æŸ¥çœ‹ç«¯å£æ˜¯å¦ç›‘å¬é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# ss -lntup |egrep <span class="string">&#x27;9[23]00&#x27;</span></span><br><span class="line">tcp6       0      0 :::9200        :::*       LISTEN      6431/java</span><br><span class="line">tcp6       0      0 :::9300        :::*       LISTEN      6431/java</span><br></pre></td></tr></table></figure><p><strong>6.æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# curl 10.0.0.213:9200/_cat/nodes</span><br><span class="line">10.0.0.212  9 94  8 0.46 0.49 0.31 cdfhilmrstw - elk02</span><br><span class="line">10.0.0.211 25 95 21 0.56 0.47 0.25 cdfhilmrstw * elk01</span><br><span class="line">10.0.0.213 28 90 25 1.21 0.78 0.43 cdfhilmrstw - elk03</span><br><span class="line"></span><br><span class="line"><span class="comment">#elk02æ˜¯ä¸»èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nameå’Œuuid</span></span><br><span class="line">[root@elk01 ~]# curl -s 10.0.0.211:9200|egrep <span class="string">&#x27;_name|_uuid&#x27;</span></span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ï¼Ÿ</span></span><br><span class="line">[root@elk01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 211 213`;<span class="keyword">do</span> curl -s 10.0.0.<span class="variable">$i</span>:9200|egrep <span class="string">&#x27;_name|_uuid&#x27;</span>;<span class="keyword">done</span></span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;my-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;pI91AngOTf2G4LYIUzd9FA&quot;</span>,</span><br></pre></td></tr></table></figure><p><strong>7.ESé›†ç¾¤å†™å…¥å’Œè¯»å–æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†™å…¥æ•°æ®  ï¼ˆtestæ˜¯ç´¢å¼•ï¼Œè‡ªå®šä¹‰ï¼‰</span></span><br><span class="line">curl -X POST -H <span class="string">&quot;Content-Type:application/json&quot;</span> 10.0.0.211:9200/test/_doc -d <span class="string">&#x27;&#123;&quot;name&quot;:&quot;zhang3&quot;,&quot;age&quot;:&quot;18&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¯»å–æ•°æ®ï¼ˆjqéœ€è¦å®‰è£…ï¼Œæ ¼å¼åŒ–è¾“å‡ºï¼Œ212/213ä¹Ÿèƒ½è¯»å–åˆ°æ•°æ®ï¼Œå› ä¸ºæ˜¯esé›†ç¾¤ï¼‰</span></span><br><span class="line">[root@elk01 ~]# curl -s 10.0.0.211:9200/test/_search | jq .hits</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;value&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;max_score&quot;</span>: 1,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;ppKQ0ZEB6pCPlAoKbzPE&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_score&quot;</span>: 1,</span><br><span class="line">      <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;zhang3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="string">&quot;18&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="kibanaè¯»å–æ•°æ®">kibanaè¯»å–æ•°æ®</h2><h3 id="1-kibanaæ¦‚è¿°">1.kibanaæ¦‚è¿°</h3><p>ä½¿ç”¨ Kibana é’ˆå¯¹å¤§è§„æ¨¡æ•°æ®å¿«é€Ÿè¿è¡Œæ•°æ®åˆ†æï¼Œä»¥å®ç°å¯è§‚æµ‹æ€§ã€å®‰å…¨å’Œæœç´¢ã€‚å¯¹æ¥è‡ªä»»ä½•æ¥æºçš„ä»»ä½•æ•°æ®è¿›è¡Œå…¨é¢é€å½»çš„åˆ†æï¼Œä»å¨èƒæƒ…æŠ¥åˆ°æœç´¢åˆ†æï¼Œä»æ—¥å¿—åˆ°åº”ç”¨ç¨‹åºç›‘æµ‹ï¼Œä¸ä¸€è€Œè¶³ã€‚è¯´ç™½äº†ï¼Œkibanaå°±æ˜¯ä»ESæŸ¥è¯¢æ•°æ®å¹¶å±•ç¤ºæ•°æ®ã€‚</p><h3 id="2-éƒ¨ç½²kibana">2.éƒ¨ç½²kibana</h3><p><strong>1.ä¸‹è½½ &amp; å®‰è£…kibana</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/kibana/kibana-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">[root@elk01 ~]# dpkg -i kibana-7.17.23-amd64.deb </span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# vim /etc/kibana/kibana.yml </span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">server.name: <span class="string">&quot;kibana&quot;</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>]</span><br><span class="line">i18n.locale: <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨kibana">3.å¯åŠ¨kibana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# systemctl <span class="built_in">enable</span> --now kibana</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç«¯å£æ˜¯å¦å¯åŠ¨</span></span><br><span class="line">[root@elk01 ~]# ss  -lntup|grep 5601</span><br><span class="line">tcp        0      0 0.0.0.0:5601      0.0.0.0:*     LISTEN      9696/node  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">10.0.0.211:5601</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1725800433992.png" alt="QQ_1725800433992"></p><p><strong>ç´¢å¼•ç®¡ç†å°±æœ‰æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002121943290.png" alt="image-20241002121943290"></p><p><strong>å¦‚ä½•æŸ¥è¯¢é‚£ä¸ªæ•°æ®å‘¢ï¼Ÿ</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1725800690692.png" alt="QQ_1725800690692"></p><p><img src="https://cos.lukme.top/Pic/QQ_1725800736873.png" alt="QQ_1725800736873"></p><p><img src="https://cos.lukme.top/Pic/QQ_1725800780918.png" alt="QQ_1725800780918"></p><h3 id="4-kibanaæŸ¥è¯¢ESæ•°æ®">4.kibanaæŸ¥è¯¢ESæ•°æ®</h3><p><strong>1.å‡†å¤‡æµ‹è¯•æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H <span class="string">&quot;Content-Type:application/json&quot;</span> 10.0.0.211:9200/_bulk -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot; : &#123; &quot;_index&quot; : &quot;student1&quot;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;:&quot;æå››&quot;,&quot;hobby&quot;:[&quot;å­¦ä¹ &quot;,&quot;ç©æ‰‹æœº&quot;,&quot;çœ‹ç¾å¥³&quot;]&#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot; : &#123; &quot;_index&quot; : &quot;student2&quot;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;hobby&quot;:[&quot;å¤§é•¿è…¿&quot;,&quot;å­¦ä¹ &quot;]&#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»ˆç«¯è¾“å‡ºå¦‚ä¸‹å³OK</span></span><br><span class="line">&#123;<span class="string">&quot;took&quot;</span>:780,<span class="string">&quot;errors&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;items&quot;</span>:[&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;student&quot;</span>,<span class="string">&quot;_type&quot;</span>:<span class="string">&quot;_doc&quot;</span>,<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;YWacOJIBCijr5nh3GosC&quot;</span>,<span class="string">&quot;_version&quot;</span>:1,<span class="string">&quot;result&quot;</span>:<span class="string">&quot;created&quot;</span>,<span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:2,<span class="string">&quot;successful&quot;</span>:2,<span class="string">&quot;failed&quot;</span>:0&#125;,<span class="string">&quot;_seq_no&quot;</span>:0,<span class="string">&quot;_primary_term&quot;</span>:1,<span class="string">&quot;status&quot;</span>:201&#125;&#125;,&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;student&quot;</span>,<span class="string">&quot;_type&quot;</span>:<span class="string">&quot;_doc&quot;</span>,<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;YmacOJIBCijr5nh3GosC&quot;</span>,<span class="string">&quot;_version&quot;</span>:1,<span class="string">&quot;result&quot;</span>:<span class="string">&quot;created&quot;</span>,<span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:2,<span class="string">&quot;successful&quot;</span>:2,<span class="string">&quot;failed&quot;</span>:0&#125;,<span class="string">&quot;_seq_no&quot;</span>:1,<span class="string">&quot;_primary_term&quot;</span>:1,<span class="string">&quot;status&quot;</span>:201&#125;&#125;]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#apiè°ƒå–æ–¹æ³•--å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/7.17/docs-bulk.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨å†æ¬¡è®¿é—®  kibana  ï¼Œå‘ç°ç´¢å¼•ç®¡ç†ä¼šå¤šå‡ºæ¥ä¸€ä¸ªæˆ‘ä»¬åˆ›å»ºçš„studentç´¢å¼•</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002122102175.png" alt="image-20241002122102175"></p><p><strong>2.åˆ›å»ºç´¢å¼•æ¨¡å¼</strong></p><p>kibanaçš„ç´¢å¼•æ¨¡å¼ç”¨äºåŒ¹é…ESé›†ç¾¤çš„ä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•ã€‚     student*</p><p><img src="https://cos.lukme.top/Pic/image-20241002122146329.png" alt="image-20241002122146329"></p><p><strong>3.kibanaæŸ¥è¯¢æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002122628647.png" alt="image-20241002122628647"></p><p><strong>ä»¥å­—æ®µæŸ¥è¯¢</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002122712583.png" alt="image-20241002122712583"></p><p><img src="https://cos.lukme.top/Pic/image-20241002122754986.png" alt="image-20241002122754986"></p><p><strong>ä½¿ç”¨jsonæ ¼å¼æŸ¥è¯¢</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002122306868.png" alt="image-20241002122306868"></p><p><strong>å…¶å®ƒæ–¹å¼æŸ¥è¯¢é›†ç¾¤é¢œè‰²</strong></p><p>1.é€šè¿‡es-headç»„ä»¶æŸ¥è¯¢ï¼ˆä¸€ä¸ªæ’ä»¶ï¼‰</p><p>2.åŸºäºå®˜æ–¹çš„APIæŸ¥è¯¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# curl -s 10.0.0.211:9200/_cat/indices?v</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002122830955.png" alt="image-20241002122830955"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# curl -s 10.0.0.211:9200/_cat/indices|awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line">green</span><br><span class="line">green</span><br><span class="line">green</span><br><span class="line">green</span><br><span class="line">green</span><br></pre></td></tr></table></figure><h2 id="Filebeaté‡‡é›†æ•°æ®">Filebeaté‡‡é›†æ•°æ®</h2><p><strong>filebeat</strong><br>æ— è®ºæ‚¨æ˜¯ä»å®‰å…¨è®¾å¤‡ã€äº‘ã€å®¹å™¨ã€ä¸»æœºè¿˜æ˜¯ OT è¿›è¡Œæ•°æ®æ”¶é›†ï¼ŒFilebeat éƒ½å°†ä¸ºæ‚¨æä¾›ä¸€ç§è½»é‡å‹æ–¹æ³•ï¼Œç”¨äºè½¬å‘å’Œæ±‡æ€»æ—¥å¿—ä¸æ–‡ä»¶ï¼Œè®©ç®€å•çš„äº‹æƒ…ä¸å†ç¹æ‚ã€‚è¯´ç™½äº†ï¼Œfilebeatçš„æ ¸å¿ƒå°±æ˜¯é‡‡é›†æ—¥å¿—å¹¶å°†æ—¥å¿—å‘é€åˆ°æˆ‘ä»¬æœŸæœ›çš„ç›®çš„ç«¯ã€‚æœ¬è´¨æ ¸å¿ƒå°±æ˜¯input(æ•°æ®ä»å“ªæ¥)å’Œoutput(æ•°æ®åˆ°å“ªå»)ã€‚</p><p><strong>==filebeaté»˜è®¤æ˜¯æŒ‰è¡Œè¯»å–æ•°æ®==</strong></p><p><img src="https://cos.lukme.top/Pic/elkmassage.png" alt="elkmassage"></p><h3 id="éƒ¨ç½²filebeat">éƒ¨ç½²filebeat</h3><p><a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/configuring-howto-filebeat.html">Filebeat Reference å®˜æ–¹æ–‡æ¡£</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½filebeatåŒ…</span><br><span class="line">[root@elk01 ~]# wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.23-amd64.deb</span><br><span class="line"></span><br><span class="line">2.å®‰è£…filebeat </span><br><span class="line">[root@elk01 ~]# dpkg -i filebeat-7.17.23-amd64.deb </span><br></pre></td></tr></table></figure><h3 id="é‡‡é›†æ•°æ®ç»ˆç«¯åˆ°ç»ˆç«¯">é‡‡é›†æ•°æ®ç»ˆç«¯åˆ°ç»ˆç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†™æ³•è§å®˜æ–¹ï¼Œç›´æ¥å¤åˆ¶ä½¿ç”¨  (åœ¨ inputs å’Œ Output é‡Œé€‰æ‹©ç›¸åº”çš„æ–¹å¼)</span></span><br><span class="line"><span class="string">&#x27;https://www.elastic.co/guide/en/beats/filebeat/7.17/configuring-howto-filebeat.html&#x27;</span></span><br><span class="line">1.ç¼–å†™filebeatçš„é…ç½®æ–‡ä»¶      ï¼ˆinputs&gt;Stdin  æ ‡å‡†è¾“å…¥    output&gt;Console  ç»ˆç«¯è¾“å‡ºï¼‰</span><br><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /etc/filebeat/01-stdin-stdout.yaml </span><br><span class="line"><span class="comment"># æ•°æ®ä»æ ‡å‡†è¾“å…¥æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: stdin</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#2.å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">ç›¸å…³å‚æ•°è¯´ ï¼š</span><br><span class="line">-c &lt;config&gt;:</span><br><span class="line">æŒ‡å®šçš„æ˜¯é…ç½®æ–‡ä»¶ </span><br><span class="line">-e :</span><br><span class="line">å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°ç»ˆç«¯ã€‚</span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/01-stdin-stdout.yaml </span><br><span class="line"><span class="comment">#ç»ˆç«¯æˆ‘è¾“å…¥çš„</span></span><br><span class="line">66666666666666666666666666666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºå†…å®¹ï¼šå¾ˆæ˜æ˜¾ï¼Œæ•°æ®è¢«å°è£…åˆ°äº†ä¸€ä¸ª&quot;message&quot;å­—æ®µä¸­ã€‚</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:23:12.146Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;stdin&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;13686d12-e255-4c48-a609-dcc4b8331c44&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;66666666666666666666666666666666&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">2024-09-28T21:23:13.147+0800    ERROR   file/states.go:125      State <span class="keyword">for</span>  should have been dropped, but couldn<span class="string">&#x27;t as state is not finished.</span></span><br></pre></td></tr></table></figure><h3 id="filebeatç›‘å¬tcpç«¯å£">filebeatç›‘å¬tcpç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1ã€‚ç¼–å†™filebeaté…ç½®æ–‡ä»¶       ï¼ˆinputs&gt;tcp   æŒ‡å®štcpç«¯å£ï¼‰</span></span><br><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /etc/filebeat/02-tcp-console.yaml </span><br><span class="line"><span class="comment"># æ•°æ®ä»ç›‘å¬çš„æŒ‡å®štcpç«¯å£æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: tcp</span><br><span class="line">  host: <span class="string">&quot;0.0.0.0:9000&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#2.å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/02-tcp-console.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å‘é€æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk03:0 ~]# <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> | nc 10.0.0.211 9000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.è§‚å¯Ÿfilebeatæ˜¯å¦é‡‡é›†åˆ°æ•°æ®</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:33:01.962Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;tcp&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;a43721b4-8160-4985-9f6f-67c0178affa7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;address&quot;</span>: <span class="string">&quot;10.0.0.213:47174&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡‡é›†æœ¬åœ°æ–‡ä»¶è¾“å‡ºæ•°æ®åˆ°ç»ˆç«¯">é‡‡é›†æœ¬åœ°æ–‡ä»¶è¾“å‡ºæ•°æ®åˆ°ç»ˆç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">1.ç¼–å†™filebeaté…ç½®æ–‡ä»¶    ï¼ˆinputs&gt;<span class="built_in">log</span>ï¼‰</span><br><span class="line">[root@elk01 ~]# <span class="built_in">cat</span> /etc/filebeat/03-log-console.yaml</span><br><span class="line"><span class="comment"># æ•°æ®ä»ç›‘å¬çš„æŒ‡å®šæ–‡ä»¶æ¥</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/test.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åˆ°ç»ˆç‚¹</span></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">2.å¯åŠ¨filebeatå®ä¾‹</span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/03-log-console.yaml</span><br><span class="line"></span><br><span class="line">3.å†™å…¥æµ‹è¯•æ•°æ®(å¦å¼€ä¸€ä¸ªç»ˆç«¯å†™å…¥)</span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&#x27;999&#x27;</span> &gt; /tmp/test.log</span><br><span class="line"></span><br><span class="line">4.è§‚å¯Ÿç»ˆç«¯è¾“å‡º</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:48:53.645Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 0,           <span class="comment">#æ³¨æ„è¿™ä¸ªå­—æ®µ</span></span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.log&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;10485e22-a3e8-40f0-bbb9-c194f9541bf4&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.éªŒè¯filebeaté‡‡é›†æ•°æ®æ˜¯æŒ‰è¡Œè¯»å–    (æ³¨æ„offset å­—æ®µå˜åŒ–)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†æ¬¡å†™å…¥æ•°æ®è§‚å¯Ÿé‡‡é›†æƒ…å†µ</span></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> <span class="string">&#x27;hello world&#x27;</span> &gt;&gt; /tmp/test.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§‚å¯Ÿoffsetï¼ˆåç§»é‡ï¼‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-09-28T13:54:03.721Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 4,    <span class="comment">#ä¸ºå•¥æ˜¯å››ä¸ªåç§»é‡ï¼Ÿ</span></span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.log&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;999hello world&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;10485e22-a3e8-40f0-bbb9-c194f9541bf4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å› ä¸ºä¸Šæ¬¡999ä¸‰ä¸ªä¹‹åæœ‰ä¸ªç‰¹æ®Šå­—ç¬¦--æ¢è¡Œç¬¦ï¼Œæ‰€ä»¥offsetä¹‹å‰é‡‡é›†çš„åç§»é‡æ˜¯4ä¸ª</span></span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•éªŒè¯filebeatæ˜¯æŒ‰è¡Œé‡‡é›†æ•°æ®çš„ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">echo</span> -n <span class="string">&#x27;ABCD&#x27;</span> &gt;&gt; /tmp/test.log      -n ä¸æ¢è¡Œ</span><br><span class="line"></span><br><span class="line">è§‚å¯Ÿç»ˆç«¯æ˜¯å¦æœ‰é‡‡é›†æ•°æ®,å¾ˆæ˜æ˜¾æ²¡æœ‰é‡‡é›†</span><br></pre></td></tr></table></figure><p><strong>6.é‡å¯filebeatå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœæ­¢filebeat   Ctrl+c</span><br><span class="line">å†æ¬¡æ‰§è¡Œå®ä¾‹    filebeat -e -c /etc/filebeat/03-log-console.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ­¤æ—¶æˆ‘ä»¬å‘ç°filebeatå¹¶ä¸ä¼šé‡‡é›†æ•°æ®ï¼Œå› ä¸ºfilebeatå·²ç»é‡‡é›†è¿‡äº†ï¼Œ</span></span><br><span class="line"><span class="comment">#filebeatæ˜¯å¦‚ä½•çŸ¥é“æœ‰æ²¡æœ‰é‡‡é›†è¿‡æ•°æ®ï¼Ÿå¾€ä¸Šç¿»çœ‹åŠ è½½ä¿¡æ¯å¦‚ä¸‹å›¾</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241002105509955.png" alt="image-20241002105509955"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Finished loading transaction <span class="built_in">log</span> file <span class="keyword">for</span> <span class="string">&#x27;/var/lib/filebeat/registry/filebeat&#x27;</span>. Active transaction <span class="built_in">id</span>=63</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªè¡¨ç¤ºçš„æ˜¯ï¼Œåœ¨é‡‡é›†æ•°æ®ä¹‹å‰å…ˆåŠ è½½<span class="string">&#x27;/var/lib/filebeat/registry/filebeat&#x27;</span>ä¸‹çš„äº‹åŠ¡æ—¥å¿—log.jsonï¼Œé‡Œé¢è®°å½•äº†å·²ç»é‡‡é›†è¿‡çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‰å»æŸ¥çœ‹ä¸‹ï¼Œ</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹æœ€åä¸€æ¡æ•°æ®</span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">tail</span> -1 /var/lib/filebeat/registry/filebeat/log.json </span><br><span class="line">&#123;<span class="string">&quot;k&quot;</span>:<span class="string">&quot;filebeat::logs::native::788078-64768&quot;</span>,<span class="string">&quot;v&quot;</span>:&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;native::788078-64768&quot;</span>,<span class="string">&quot;offset&quot;</span>:24,<span class="string">&quot;timestamp&quot;</span>:[2061673550511,1727837342],<span class="string">&quot;ttl&quot;</span>:-1,<span class="string">&quot;prev_id&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;source&quot;</span>:<span class="string">&quot;/tmp/test.log&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;log&quot;</span>,<span class="string">&quot;FileStateOS&quot;</span>:&#123;<span class="string">&quot;inode&quot;</span>:788078,<span class="string">&quot;device&quot;</span>:64768&#125;,<span class="string">&quot;identifier_name&quot;</span>:<span class="string">&quot;native&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°æ®æœ‰ä¸ªoffsetå­—æ®µï¼Œè¿™é‡Œè®°å½•çš„æ˜¯ä¸Šä¸€æ¬¡é‡‡é›†è¿‡çš„åç§»é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥æŸ¥çœ‹ä¸‹è¿™ä¸ªæ—¥å¿—çš„åç§»é‡æ˜¯ä¸æ˜¯24</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /tmp/test.log </span><br><span class="line">999</span><br><span class="line">hello world</span><br><span class="line">ABCD666</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶ä¸­æ¯ä¸ªæ¢è¡Œä¹‹åéƒ½æœ‰ä¸€ä¸ªæ¢è¡Œç¬¦å ä¸€ä¸ªåç§»é‡ï¼Œæ‰€ä»¥æ€»è¿‡æ˜¯24ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡æ—¥å¿—è®°å½•çš„æ˜¯æ²¡æœ‰é”™çš„ã€‚å½“æˆ‘ä»¬åˆ é™¤è¿™ä¸ªäº‹åŠ¡æ—¥å¿—log.jsonæ—¶å€™ï¼Œé‡æ–°æ‰§è¡Œfilebeatå®ä¾‹ï¼Œä¾¿ä¼šé‡æ–°é‡‡é›†æ•°æ®</span></span><br></pre></td></tr></table></figure><p><strong>7.è‡ªå®šä¹‰é‡‡é›†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ¹æ®æ­¥éª¤6ä¸­é‡æ–°filebeatå®ä¾‹æ‰€è¿°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰é‡‡é›†ä¾¿å¯ä»¥æ ¹æ®è®¾ç½®åç§»é‡æ¥è¾¾åˆ°è‡ªå®šä¹‰é‡‡é›†æ•°æ®</span></span><br><span class="line"><span class="comment">#ä¿®æ”¹äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å¦‚ä¸‹ï¼Œåªä¿®æ”¹åç§»é‡ï¼Œéœ€æ±‚æ˜¯åªé‡‡é›†ABCD666åŠä»¥åçš„æ•°æ®</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /tmp/test.log </span><br><span class="line">999</span><br><span class="line">hello world</span><br><span class="line">ABCD666  <span class="comment">#å°†offsetè®¾ç½®ä¸º16ï¼Œè®°å¾—æ•°æ¢è¡Œç¬¦</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@elk01:1 ~]# vim /var/lib/filebeat/registry/filebeat/log.json </span><br><span class="line">&#123;<span class="string">&quot;op&quot;</span>:<span class="string">&quot;set&quot;</span>,<span class="string">&quot;id&quot;</span>:65&#125;</span><br><span class="line">&#123;<span class="string">&quot;k&quot;</span>:<span class="string">&quot;filebeat::logs::native::788078-64768&quot;</span>,<span class="string">&quot;v&quot;</span>:&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;native::788078-64768&quot;</span>,<span class="string">&quot;offset&quot;</span>:16,<span class="string">&quot;timestamp&quot;</span>:[2061673550511,1727837342],<span class="string">&quot;ttl&quot;</span>:-1,<span class="string">&quot;prev_id&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;source&quot;</span>:<span class="string">&quot;/tmp/test.log&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;log&quot;</span>,<span class="string">&quot;FileStateOS&quot;</span>:&#123;<span class="string">&quot;inode&quot;</span>:788078,<span class="string">&quot;device&quot;</span>:64768&#125;,<span class="string">&quot;identifier_name&quot;</span>:<span class="string">&quot;native&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°æ‰§è¡Œå®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/03-log-console.yaml </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;@timestamp&quot;</span>: <span class="string">&quot;2024-10-02T03:12:45.360Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;beat&quot;</span>: <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ephemeral_id&quot;</span>: <span class="string">&quot;c8d05474-6175-4dd1-93e8-933cb7760b92&quot;</span>,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9e9b0f4e-cbe0-4e5b-bab2-501e50f67620&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;filebeat&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;offset&quot;</span>: 16,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.log&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ABCD666&quot;</span>,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ecs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;elk01&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h2><h3 id="é‡‡é›†nginxæ—¥å¿—æ¡ˆä¾‹">é‡‡é›†nginxæ—¥å¿—æ¡ˆä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">1.å®‰è£…nginx   ï¼ˆå¯ä»¥å…ˆå°è¯•è·³è¿‡2æ­¥éª¤ï¼Œçœ‹çœ‹ä¸ä¿®æ”¹é…ç½®æ–‡ä»¶çš„è¾“å‡ºï¼Œå’Œä¿®æ”¹ä¹‹åçš„åŒºåˆ«ï¼‰</span><br><span class="line">[root@elk01:1 ~]# apt -y install nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.å°†nginxé‡‡é›†çš„æ•°æ®ä»¥jsonæ ¼å¼å±•ç¤ºï¼Œä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶ï¼ˆæ ¼å¼åŒ–å±•ç¤ºï¼Œæ–¹ä¾¿åˆ†ææ•°æ®ï¼Œè®¿é—®ipï¼ŒçŠ¶æ€ç ç­‰ï¼‰</span><br><span class="line">[root@elk01:1 ~]# vim /etc/nginx/nginx.conf </span><br><span class="line"><span class="comment">#httpæ¨¡å—é‡Œæ·»åŠ å¦‚ä¸‹ï¼Œæ³¨é‡Šå®˜æ–¹çš„   access_log /var/log/nginx/access.log</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">  log_format nginx_json <span class="string">&#x27;&#123;&quot;timestamp&quot;:&quot;$time_iso8601&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;vhost&quot;:&quot;$server_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;clientip&quot;:&quot;$remote_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;SendBytes&quot;:$body_bytes_sent,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;responsetime&quot;:$request_time,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;http_host&quot;:&quot;$host&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;uri&quot;:&quot;$uri&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;domain&quot;:&quot;$host&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;referer&quot;:&quot;$http_referer&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;tcp_xff&quot;:&quot;$proxy_protocol_addr&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&#x27;</span></span><br><span class="line">       <span class="string">&#x27;&quot;status&quot;:&quot;$status&quot;&#125;&#x27;</span>;</span><br><span class="line"> access_log /var/log/nginx/access.log nginx_json;</span><br><span class="line"><span class="comment">#2.1 æ£€æŸ¥nginxè¯­æ³•æ˜¯å¦æœ‰é—®é¢˜</span></span><br><span class="line">[root@elk01:1 ~]# nginx -t </span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"><span class="comment">#2.2 é‡æ–°nginx</span></span><br><span class="line">[root@elk01:1 ~]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.ç¼–å†™filebeaté…ç½®æ–‡ä»¶    ï¼ˆinputs&gt;<span class="built_in">log</span>ï¼‰</span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/filebeat/04-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    <span class="comment">#å½“json.keys_under_rootçš„å€¼ä¸ºtrueæ—¶ï¼Œä¼šè‡ªåŠ¨è§£æjsonæ ¼å¼ï¼Œå¹¶å°†å­—æ®µæ”¾åœ¨é¡¶çº§å­—æ®µä¸­</span></span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    <span class="comment">#å½“jsonæ ¼å¼è§£æé”™è¯¯æ—¶ï¼Œå¯ä»¥å°†é”™è¯¯ä¿¡æ¯å†™å…¥åˆ°eventäº‹ä»¶(æŒ‡çš„æ˜¯filebeaté‡‡é›†çš„æ¯ä¸€æ¡æ•°æ®)ä¸­ã€‚</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    <span class="comment">#å¦‚æœé‡‡é›†çš„å­—æ®µå’Œfilebeatè‡ªå·±çš„å­—æ®µå†²çªï¼Œåˆ™è¦†ç›–æ•°æ®</span></span><br><span class="line">    overwirte_kes: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">2.å¯åŠ¨filebeatå®ä¾‹</span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/03-log-console.yaml</span><br><span class="line">3.å¦å¼€ä¸€ä¸ªç»ˆç«¯æµ‹è¯•</span><br><span class="line">[root@elk01:1 ~]# curl 10.0.0.211</span><br><span class="line"><span class="comment">#æŸ¥çœ‹filebeatæ”¶é›†æ—¥å¿—</span></span><br><span class="line">1.è¿™æ˜¯æœªé…ç½®  json.keys_under_root: <span class="literal">true</span>  çš„å±•ç¤º</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;&#123;\&quot;timestamp\&quot;:\&quot;2024-10-02T11:40:24+08:00\&quot;,\&quot;vhost\&quot;:\&quot;10.0.0.211\&quot;,\&quot;clientip\&quot;:\&quot;10.0.0.211\&quot;,\&quot;SendBytes\&quot;:612,\&quot;responsetime\&quot;:0.000,\&quot;upstreamtime\&quot;:\&quot;-\&quot;,\&quot;upstreamhost\&quot;:\&quot;-\&quot;,\&quot;http_host\&quot;:\&quot;10.0.0.211\&quot;,\&quot;uri\&quot;:\&quot;/index.nginx-debian.html\&quot;,\&quot;domain\&quot;:\&quot;10.0.0.211\&quot;,\&quot;xff\&quot;:\&quot;-\&quot;,\&quot;referer\&quot;:\&quot;-\&quot;,\&quot;tcp_xff\&quot;:\&quot;-\&quot;,\&quot;http_user_agent\&quot;:\&quot;curl/7.81.0\&quot;,\&quot;status\&quot;:\&quot;200\&quot;&#125;&quot;</span>,</span><br><span class="line">  </span><br><span class="line">2.è¿™æ˜¯é…ç½®json.keys_under_root: <span class="literal">true</span>çš„å±•ç¤º  ï¼ˆipï¼ŒçŠ¶æ€ç ï¼Œæ—¶é—´æˆ³éƒ½ä»¥é¡¶çº§å­—æ®µå±•ç¤ºäº†ï¼Œæ›´åŠ æ–¹ä¾¿è¯»å–åˆ†ææ•°æ®ï¼‰</span><br><span class="line">  <span class="string">&quot;json&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;clientip&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;domain&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2024-10-02T11:55:24+08:00&quot;</span>,</span><br><span class="line">    <span class="string">&quot;referer&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vhost&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http_host&quot;</span>: <span class="string">&quot;10.0.0.211&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tcp_xff&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;xff&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uri&quot;</span>: <span class="string">&quot;/index.nginx-debian.html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http_user_agent&quot;</span>: <span class="string">&quot;curl/7.81.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;responsetime&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;upstreamhost&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;SendBytes&quot;</span>: 612,</span><br><span class="line">    <span class="string">&quot;upstreamtime&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: <span class="string">&quot;200&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ESæ¶æ„é‡‡é›†nginxæ—¥å¿—å¹¶åˆ†æ">ESæ¶æ„é‡‡é›†nginxæ—¥å¿—å¹¶åˆ†æ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ç¼–å†™filebeatå¸å…¥ESé›†ç¾¤é…ç½®æ–‡ä»¶   ï¼ˆé€‰æ‹©output&gt;Elasticsearchå¤åˆ¶å®˜æ–¹æ¡ˆä¾‹ä¿®æ”¹ï¼‰</span></span><br><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> /etc/filebeat/05-nginx-es.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  json:</span><br><span class="line">    keys_under_root: <span class="literal">true</span></span><br><span class="line">    add_error_key: <span class="literal">true</span></span><br><span class="line">    overwirte_kes: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access.log* </span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">&quot;http://10.0.0.211:9200&quot;</span>,<span class="string">&quot;http://10.0.0.212:9200&quot;</span>,<span class="string">&quot;http://10.0.0.213:9200&quot;</span>] </span><br><span class="line">  </span><br><span class="line"><span class="comment">#2.å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:1 ~]# filebeat -e -c /etc/filebeat/05-nginx-es.yaml </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.è®¿é—®nginxæœåŠ¡</span></span><br><span class="line">[root@elk01:1 ~]# <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> curl 10.0.0.211; <span class="built_in">sleep</span> 1 ;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®ï¼š10.0.0.211:5601</p><p><img src="https://cos.lukme.top/Pic/image-20241002155103512.png" alt="image-20241002155103512"></p><p><strong>åˆ›å»ºç´¢å¼•</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002160236505.png" alt="image-20241002160236505"></p><p><strong>è¿›å…¥èœå•æ é€‰æ‹©Discover</strong></p><p><strong>æŸ¥çœ‹æ•°æ®ï¼ˆæ”¯æŒå¤šæ¡ä»¶æŸ¥è¯¢ï¼‰</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241002160129138.png" alt="image-20241002160129138"></p><p><img src="https://cos.lukme.top/Pic/image-20241002161758175.png" alt="image-20241002161758175"></p><h2 id="ESçš„å¸¸è§æœ¯è¯­-åˆ†ç‰‡">ESçš„å¸¸è§æœ¯è¯­-åˆ†ç‰‡</h2><p><img src="https://cos.lukme.top/Pic/image-20241002160849403.png" alt="image-20241002160849403"></p><p><strong>index</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- index: ç´¢å¼•</span><br><span class="line">ç´¢å¼•æ˜¯ä¸€ä¸ªé€»è¾‘çš„å­˜å‚¨å•å…ƒï¼Œä¸€èˆ¬ç”¨äºæ ‡è¯†ä¸åŒçš„ä¸šåŠ¡ç±»å‹ï¼Œå› æ­¤ç´¢å¼•çš„åç§°å¤§å®¶å¯ä»¥è‡ªå®šä¹‰ã€‚</span><br><span class="line">ç”¨æˆ·åŸºäºç´¢å¼•è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚</span><br></pre></td></tr></table></figure><p><strong>shard</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- shard: åˆ†ç‰‡</span><br><span class="line">ä¸€ä¸ªç´¢å¼•æœ€å°‘æœ‰ä¸€ä¸ªåˆ†ç‰‡ï¼Œæ•°æ®å­˜å‚¨åœ¨åˆ†ç‰‡ä¸­ã€‚</span><br><span class="line">å½“ç´¢å¼•çš„åˆ†ç‰‡æ•°é‡å¤§äº1æ—¶ï¼ŒESé›†ç¾¤è‡ªåŠ¨å°†åˆ†ç‰‡åˆ†æ•£åœ°å­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®èŠ‚ç‚¹ï¼Œè€Œæ˜¯å®ç°äº†æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ã€‚</span><br></pre></td></tr></table></figure><blockquote><p>â€‹    ä¸€ä¸ª åˆ†ç‰‡ æ˜¯ä¸€ä¸ªåº•å±‚çš„ å·¥ä½œå•å…ƒ ï¼Œå®ƒä»…ä¿å­˜äº†å…¨éƒ¨æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ åœ¨åˆ†ç‰‡å†…éƒ¨æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»åˆ†ç‰‡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€Œç°åœ¨æˆ‘ä»¬åªéœ€çŸ¥é“ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ª Lucene çš„å®ä¾‹ï¼Œä»¥åŠå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœç´¢å¼•æ“ã€‚ æˆ‘ä»¬çš„æ–‡æ¡£è¢«å­˜å‚¨å’Œç´¢å¼•åˆ°åˆ†ç‰‡å†…ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºæ˜¯ç›´æ¥ä¸ç´¢å¼•è€Œä¸æ˜¯ä¸åˆ†ç‰‡è¿›è¡Œäº¤äº’ã€‚<br>â€‹     Elasticsearch æ˜¯åˆ©ç”¨åˆ†ç‰‡å°†æ•°æ®åˆ†å‘åˆ°é›†ç¾¤å†…å„å¤„çš„ã€‚åˆ†ç‰‡æ˜¯æ•°æ®çš„å®¹å™¨ï¼Œæ–‡æ¡£ä¿å­˜åœ¨åˆ†ç‰‡å†…ï¼Œåˆ†ç‰‡åˆè¢«åˆ†é…åˆ°é›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹é‡Œã€‚ å½“ä½ çš„é›†ç¾¤è§„æ¨¡æ‰©å¤§æˆ–è€…ç¼©å°æ—¶ï¼Œ Elasticsearch ä¼šè‡ªåŠ¨çš„åœ¨å„èŠ‚ç‚¹ä¸­è¿ç§»åˆ†ç‰‡ï¼Œä½¿å¾—æ•°æ®ä»ç„¶å‡åŒ€åˆ†å¸ƒåœ¨é›†ç¾¤é‡Œã€‚</p><p>â€‹    ä¸€ä¸ªåˆ†ç‰‡å¯ä»¥æ˜¯ ä¸» åˆ†ç‰‡æˆ–è€… å‰¯æœ¬ åˆ†ç‰‡ã€‚ ç´¢å¼•å†…ä»»æ„ä¸€ä¸ªæ–‡æ¡£éƒ½å½’å±äºä¸€ä¸ªä¸»åˆ†ç‰‡ï¼Œæ‰€ä»¥ä¸»åˆ†ç‰‡çš„æ•°ç›®å†³å®šç€ç´¢å¼•èƒ½å¤Ÿä¿å­˜çš„æœ€å¤§æ•°æ®é‡ã€‚</p></blockquote><p><strong>replica</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- replica: å‰¯æœ¬</span><br><span class="line">æ¯ä¸ªåˆ†ç‰‡æœ‰0ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ï¼Œè‹¥å‰¯æœ¬æ•°é‡å¤§äº0æ—¶ï¼Œåˆ™å¯ä»¥å®ç°å¯¹ä¸»åˆ†ç‰‡çš„å¤‡ä»½ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£å°†å…¶åˆ†ç‰‡ä¸»åˆ†ç‰‡(primary shard)å’Œå‰¯æœ¬åˆ†ç‰‡(replica shard)ã€‚</span><br><span class="line">ä¸»åˆ†ç‰‡(primary shard)å’Œå‰¯æœ¬åˆ†ç‰‡(replica shard)ä¸èƒ½åœ¨åŒä¸€å°èŠ‚ç‚¹ã€‚</span><br><span class="line">ä¸»åˆ†ç‰‡è´Ÿè´£æ•°æ®çš„è¯»å†™ï¼Œè€Œå‰¯æœ¬åˆ†ç‰‡åªè´Ÿè´£æ•°æ®çš„è¯»å–å’ŒåŒæ­¥ã€‚</span><br><span class="line">å½“ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡è¾ƒå¤šæ—¶ï¼Œé»˜è®¤çš„å†™å…¥ç­–ç•¥ä¸ºï¼š <span class="string">&quot;(ä¸»åˆ†ç‰‡æ•°é‡ + å‰¯æœ¬åˆ†ç‰‡æ•°é‡) / 2 + 1&quot;</span>ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯åŠæ•°ä»¥ä¸Šå†™å…¥æœºåˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚1ä¸ªä¸»åˆ†ç‰‡ï¼Œå’Œ1ä¸ªå‰¯æœ¬åˆ†ç‰‡æ€»å…±2ä¸ªåˆ†ç‰‡çš„æ•°æ®ç›¸åŒï¼Œå…¶å†™å…¥ç­–ç•¥ä¸ºï¼š (1 + 1) / 2 + 1ï¼Œç»“æœä¸ºï¼š2ï¼Œè¡¨ç¤ºä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å¿…é¡»å†™å…¥æˆåŠŸåˆ™åˆ¤å®šæˆåŠŸã€‚</span><br></pre></td></tr></table></figure><blockquote><p>â€‹    ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡åªæ˜¯ä¸€ä¸ªä¸»åˆ†ç‰‡çš„æ‹·è´ã€‚å‰¯æœ¬åˆ†ç‰‡ä½œä¸ºç¡¬ä»¶æ•…éšœæ—¶ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±çš„å†—ä½™å¤‡ä»½ï¼Œå¹¶ä¸ºæœç´¢å’Œè¿”å›æ–‡æ¡£ç­‰è¯»æ“ä½œæä¾›æœåŠ¡ã€‚<br>å‰¯æœ¬åˆ†ç‰‡çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†æ•…éšœè½¬ç§»ï¼Œå¦‚æœæŒæœ‰ä¸»åˆ†ç‰‡çš„èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡å°±ä¼šæ™‹å‡ä¸ºä¸»åˆ†ç‰‡çš„è§’è‰²ã€‚åœ¨ç´¢å¼•å†™å…¥æ—¶ï¼Œå‰¯æœ¬åˆ†ç‰‡åšç€ä¸ä¸»åˆ†ç‰‡ç›¸åŒçš„å·¥ä½œã€‚æ–°æ–‡æ¡£é¦–å…ˆè¢«ç´¢å¼•è¿›ä¸»åˆ†ç‰‡ç„¶åå†åŒæ­¥åˆ°å…¶å®ƒæ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡ã€‚</p><p>â€‹    å¢åŠ å‰¯æœ¬æ•°å¹¶ä¸ä¼šå¢åŠ ç´¢å¼•å®¹é‡ï¼Œåœ¨ç´¢å¼•å»ºç«‹çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ä¸»åˆ†ç‰‡æ•°ï¼Œä½†æ˜¯å‰¯æœ¬åˆ†ç‰‡æ•°å¯ä»¥éšæ—¶ä¿®æ”¹</p></blockquote><p>é€šä¿—ç†è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åˆ†ç‰‡æ•°ï¼ˆnumber_of_shardsï¼‰å°±æ˜¯ä¸»åˆ†ç‰‡ä¸ªæ•°</span><br><span class="line">å‰¯æœ¬æ•°ï¼ˆnumber_of_replicasï¼‰ å¯ä»¥ç†è§£æˆä¸»åˆ†ç‰‡çš„æ‹·è´ä¸ªæ•°</span><br><span class="line">å¦‚æœä¸»åˆ†ç‰‡æ•°æ˜¯5ï¼Œåˆ™æ¯ä¸ªå‰¯æœ¬éƒ½æœ‰5ä¸ªåˆ†ç‰‡</span><br><span class="line">å› æ­¤ESé›†ç¾¤æ€»çš„åˆ†ç‰‡æ•° = åˆ†ç‰‡æ•° * (å‰¯æœ¬æ•° + 1)</span><br></pre></td></tr></table></figure><p><strong>å‰¯æœ¬æ•°åˆ†é…ç®—æ³•ï¼š</strong></p><blockquote><p>å‰¯æœ¬æ•° &lt;= ESé›†ç¾¤çš„æœåŠ¡å™¨ä¸ªæ•° - 1</p></blockquote><p>å‰¯æœ¬é™¤äº†æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä¸»è¦ç›®çš„ä¸ºäº†å®¹ç¾ï¼Œæ•°æ®å†—ä½™å­˜å‚¨ï¼Œä¿è¯æ•°æ®å®‰å…¨ï¼Œå› æ­¤ï¼Œå‰¯æœ¬æ•°åº”è·Ÿæ®ESé›†ç¾¤ä¸­çš„æ•°æ®åº“æ•°é‡ï¼ˆN-1ï¼‰è¿›è¡Œé…ç½®ï¼Œå¦‚æœESé›†ç¾¤ä¸­æœ‰3å°æœåŠ¡å™¨ï¼Œåˆ™å‰¯æœ¬æ•°è®¾ç½®ä¸º2ï¼Œå‡ 1 å› ä¸ºä¸»åˆ†ç‰‡æœ¬èº«ä¹Ÿç®—ä¸€ä»½ã€‚å‰¯æœ¬æ•°è®¾ç½®ä¸º2ï¼Œæ•°æ®å®é™…ä¸Šæœ‰3ä»½ï¼Œåˆ†æ•£åˆ°3å°æœåŠ¡å™¨ä¸­ã€‚</p><blockquote><p>é¢„ä¼°è¦å­˜å…¥ESæ€»æ•°æ®é‡ * (å‰¯æœ¬æ•°+1) &lt;= ESé›†ç¾¤çš„æ€»å†…å­˜ / 2</p></blockquote><p>å­˜å…¥ESæœç´¢å¼•æ“ çš„æ•°æ®å¯ä»¥é¢„ä¼°ï¼Œæ¯”å¦‚é¢„ä¼°å­˜å…¥çš„æ•°æ®æœ‰ 100Gï¼Œåˆ™å®é™…ä¸Šä¼šå ç”¨çš„å†…å­˜ä¸º 100G * (å‰¯æœ¬æ•°+1) åŠ  1 å› ä¸ºè®¡å…¥äº†ä¸»åˆ†ç‰‡ï¼Œæ•°é‡é‡Œè¶…é™äº†ä¹Ÿå¯ä»¥å­˜å…¥ï¼Œåªè¦ç£ç›˜å¤Ÿå¤§ï¼Œä½†æ˜¯è®¡ç®—æ—¶å°±å¯èƒ½ç”¨åˆ°äº†ç£ç›˜ï¼Œç£ç›˜çš„IOæ€§èƒ½ä¼šè®©æ•´ä¸ªESé›†ç¾¤æ€§èƒ½å¤§å‰¯ä¸‹é™ã€‚</p><p>ESé›†ç¾¤çš„æ€»å†…å­˜åªå–äº†ä¸€åŠï¼Œå› ä¸ºè€ƒè™š ES çš„ java. ç¨‹åºæœ¬èº«å ç”¨çš„å†…å­˜ï¼Œæ•°æ®èšåˆè¿ç®—æ¶ˆè€—çš„å†…å­˜ï¼Œå¦‚æœå®é™…é¡¹ç›®ä¸­å¤§é‡å¤æ‚è¿ç®—ï¼Œå ç”¨çš„å†…å­˜éœ€è¦æ›´å¤šã€‚</p><p><strong>åˆ†ç‰‡æ•°åˆ†é…ç®—æ³•ï¼š</strong></p><blockquote><p>åˆ†ç‰‡æ•° * (å‰¯æœ¬æ•° + 1) &lt;= ESé›†ç¾¤çš„æ€»CPUæ ¸å¿ƒä¸ªæ•°</p></blockquote><p>åˆ†ç‰‡å†…çš„æ£€ç´¢è¿ç®—èšåˆéœ€è¦ CPUï¼Œ ä¸ºäº†å……åˆ†å‘æŒ¥å¤šæ ¸CPUçš„æ€§èƒ½ï¼Œä¸”åˆé¿å…CPUé¢‘ç¹è°ƒåº¦ï¼Œå› æ­¤ï¼ŒESé›†ç¾¤å†…æ€»çš„åˆ†ç‰‡æ•°åº”å°äºç­‰äºæ€»çš„CPUæ ¸å¿ƒä¸ªæ•°ã€‚</p><p><strong>document</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- document: æ–‡æ¡£</span><br><span class="line">ESæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£å‹æ•°æ®åº“ï¼Œå’ŒmangoDBç±»ä¼¼ã€‚</span><br><span class="line">æ¯ä¸ªæ–‡ä»¶çš„æ•°æ®åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š å…ƒæ•°æ®å’Œæºæ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">1.å…ƒæ•°æ®(metadata):</span><br><span class="line">ç”¨äºæè¿°æºæ•°æ®çš„æ•°æ®ã€‚</span><br><span class="line">å¸¸è§çš„å­—æ®µå¦‚ä¸‹:</span><br><span class="line">_index:</span><br><span class="line">è¡¨ç¤ºæ–‡æ¡£éš¶å±äºå“ªä¸ªç´¢å¼•ã€‚</span><br><span class="line">_id:</span><br><span class="line">è¡¨ç¤ºæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ã€‚</span><br><span class="line">_source:</span><br><span class="line">ä»£è¡¨ç”¨æˆ·å®é™…å­˜å‚¨çš„æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">2.æºæ•°æ®(<span class="built_in">source</span> data):</span><br><span class="line">ç”¨æˆ·å®é™…å†™å…¥çš„æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">- allocation(åˆ†é…):</span><br><span class="line">  æŒ‡çš„æ˜¯å°†ç´¢å¼•çš„ä¸åŒåˆ†ç‰‡å’Œå‰¯æœ¬åˆ†é…åˆ°æ•´ä¸ªESé›†ç¾¤çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªåˆ†é…è¿‡ç¨‹ç”±ESé›†ç¾¤è‡ªå·±å®ç°ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡è®²è¿°äº†åŸºäºEFKæ¶æ„çš„æ—¥å¿—æ”¶é›†éƒ¨ç½²åŠç®€å•æ—¥å¿—åˆ†æ</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>03-k8sPODèµ„æº</title>
    <link href="https://lukme.top/posts/df6c32c8.html"/>
    <id>https://lukme.top/posts/df6c32c8.html</id>
    <published>2024-10-04T14:14:29.000Z</published>
    <updated>2024-10-06T14:17:32.938Z</updated>
    
    <content type="html"><![CDATA[<h2 id="k8sèµ„æºæ¸…å•æè¿°">k8sèµ„æºæ¸…å•æè¿°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ApiVersion:</span><br><span class="line">èµ„æºçš„ç‰ˆæœ¬ï¼Œå®˜æ–¹å¯¹æ¯ä¸ªèµ„æºè§„å®šäº†ä¸åŒçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®èµ„æºçš„ç‰ˆæœ¬è¿›è¡Œä¹¦å†™ã€‚</span><br><span class="line">ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œèµ„æºçš„ç‰ˆæœ¬å¾ˆå°‘å˜åŠ¨ï¼Œé™¤éåœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œéšç€åŠŸèƒ½çš„å¢å¼ºï¼Œç‰ˆæœ¬å¯èƒ½ä¹Ÿä¼šå¾®è°ƒã€‚</span><br><span class="line"></span><br><span class="line">kind:</span><br><span class="line">èµ„æºçš„ç±»å‹ï¼ŒK8Sé›†ç¾¤ä¸­ä¸€åˆ‡çš†èµ„æºã€‚</span><br><span class="line"></span><br><span class="line">metadata:</span><br><span class="line">èµ„æºçš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š </span><br><span class="line">- èµ„æºçš„åç§°;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºæ‰€å±çš„åç§°ç©ºé—´;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„æ ‡ç­¾;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„æ³¨è§£;(æ—©æœŸç‰ˆæœ¬å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„åˆ›å»ºæ—¶é—´;</span><br><span class="line">- ...</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line">å®šä¹‰äº†ç”¨æˆ·å¯¹Podçš„æœŸæœ›çŠ¶æ€ã€‚ç”¨æˆ·å¯ä»¥åšå¦‚ä¸‹æ“ä½œ:</span><br><span class="line">- æŒ‡å®šèŠ‚ç‚¹è°ƒåº¦;</span><br><span class="line">- æŒ‡å®šè°ƒåº¦çš„äº²å’Œæ€§æˆ–åäº²å’Œæ€§;</span><br><span class="line">- èµ„æºçš„æ•°æ®æ˜¯å¦è¿›è¡ŒæŒä¹…åŒ–;</span><br><span class="line">- èµ„æºçš„é…ç½®æ–‡ä»¶æ˜¯å¦éœ€è¦ä¿®æ”¹;</span><br><span class="line">- èµ„æºçš„å®¹å™¨ä½¿ç”¨å…·ä½“çš„é•œåƒ;</span><br><span class="line">- èµ„æºçš„é™åˆ¶</span><br><span class="line">- èµ„æºçš„è®¤è¯ä¿¡æ¯</span><br><span class="line">- èµ„æºçš„å®‰å…¨ä¿¡æ¯</span><br><span class="line">- ...</span><br><span class="line"></span><br><span class="line">status:</span><br><span class="line">èµ„æºå®é™…çš„çŠ¶æ€ï¼Œæ¯”å¦‚è°ƒåº¦åˆ°å“ªä¸ªworkerèŠ‚ç‚¹ï¼Œå®é™…åˆ†é…çš„IPåœ°å€ï¼Œè¿è¡Œå‘¨æœŸï¼Œé‡å¯æ¬¡æ•°ç­‰ã€‚</span><br><span class="line">è¯¥èµ„æºä¸€èˆ¬ä¸éœ€è¦äººä¸ºå®šä¹‰ï¼Œè€Œæ˜¯æœ‰K8Sé›†ç¾¤è‡ªèº«ç»´æŠ¤ã€‚</span><br></pre></td></tr></table></figure><h2 id="podèµ„æºåŠèµ„æºæ¸…å•">podèµ„æºåŠèµ„æºæ¸…å•</h2><p><strong>1.PODèµ„æº</strong></p><p><strong>kubernetesèµ„æºå¯¹è±¡æ“ä½œ</strong></p><table><thead><tr><th>èµ„æºå¯¹è±¡</th><th>å¢</th><th>åˆ </th><th>æ”¹</th><th>æŸ¥</th></tr></thead><tbody><tr><td>node</td><td></td><td>kubectl delete node</td><td></td><td>kubectl get nodes</td></tr><tr><td>namespace</td><td>kubectl create ns [èµ„æºå]</td><td>kubectl delete ns [èµ„æºå]</td><td>kubectl edit ns [èµ„æºå]</td><td>kubectl get ns</td></tr><tr><td>pod</td><td></td><td>kubectl delete pod [èµ„æºå]</td><td>kubectl edit pod[èµ„æºå]</td><td>kubectl get pod</td></tr></tbody></table><p><strong>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE     VERSION</span><br><span class="line">master   Ready    master   4d13h   v1.19.3</span><br><span class="line">node01   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br><span class="line">node02   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br><span class="line">node03   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹åç§°ç©ºé—´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   4d13h</span><br><span class="line">kube-flannel      Active   4d12h</span><br><span class="line">kube-node-lease   Active   4d13h</span><br><span class="line">kube-public       Active   4d13h</span><br><span class="line">kube-system       Active   4d13h</span><br><span class="line">luay              Active   4h17m</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹pod  (é»˜è®¤defaultåç§°ç©ºé—´)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   0          6h8m</span><br><span class="line">nginx-pod                1/1     Running   0          5h43m</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹pod  (æŒ‡å®šåç§°ç©ºé—´)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -n luay</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">busybox-pod   2/2     Running   0          3m30s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master ~]# kubectl get pod -n luay -o wide</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE     IP         NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">busybox-pod   2/2     Running   0          4m14s   10.2.2.6   node03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">-n æŒ‡å®šå‘½åç©ºé—´</span><br><span class="line">-o æŒ‡å®šè¾“å‡ºæ–¹å¼</span><br><span class="line">jsonï¼šè¾“å‡ºjsonæ ¼å¼</span><br><span class="line">yamlï¼šè¾“å‡ºyamlæ ¼å¼</span><br><span class="line">wideï¼šè¾“å‡ºè¯¦ç»†ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><strong>2.podçš„èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# vim nginx.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pod</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: nginx-containers</span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line">apiVersion: v1       <span class="comment"># K8Sèµ„æºæ¥å£</span></span><br><span class="line">kind: Pod            <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line">metadata:            <span class="comment">#èµ„æºçš„å…ƒæ•°æ®</span></span><br><span class="line">  name: nginx-pod    <span class="comment"># PODåå­—</span></span><br><span class="line">  namespace: default <span class="comment"># æŒ‡å®šèµ„æºå¯åŠ¨åœ¨å“ªä¸ªåç§°ç©ºé—´ï¼Œé»˜è®¤default</span></span><br><span class="line">spec:                <span class="comment">#å®¹å™¨ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">  containers:        <span class="comment">#å®¹å™¨ä¿¡æ¯</span></span><br><span class="line">  - image: nginx:alpine           <span class="comment">#æŒ‡å®šå®¹å™¨é•œåƒ</span></span><br><span class="line">    imagePullPolicy: IfNotPresent <span class="comment">#æŒ‡å®šé•œåƒæ‹‰å–è§„åˆ™</span></span><br><span class="line">    name: nginx-containers        <span class="comment">#å®¹å™¨åå­—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Alwaysï¼šæ€»æ˜¯æ‹‰å–é•œåƒï¼Œä¸ç®¡å½“å‰æœºå™¨ä¸Šæ˜¯å¦æœ‰è¯¥é•œåƒéƒ½æ‹‰å– nginx:latest</span><br><span class="line">Neverï¼šä»ä¸æ‹‰å–é•œåƒï¼Œéœ€è¦æå‰docker pull</span><br><span class="line">IfNotPresentï¼šå¦‚æœé•œåƒä¸å­˜åœ¨ï¼Œåˆ™æ‹‰å–</span><br></pre></td></tr></table></figure><h2 id="podæŠ¥é”™åŠå¯èƒ½åŸå› ">podæŠ¥é”™åŠå¯èƒ½åŸå› </h2><pre><code>1.ImagePullBackOff  é—®é¢˜åŸå› :  é•œåƒæ‹‰å–å¤±è´¥ã€‚  å¯èƒ½åŸå› ï¼š  1.å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜å¯¼è‡´ï¼Œæ£€æŸ¥Podæ‰€åœ¨èŠ‚ç‚¹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è®¿é—®ç½‘ç»œ;  2.é•œåƒåç§°å†™é”™ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé”™è¯¯;  3.é•œåƒæ˜¯ç§æœ‰ä»“åº“ï¼Œé•œåƒæ— æƒé™æ‹‰å–;  2.ContainerCreatingé—®é¢˜åˆ†æ:å®¹å™¨æ­£åœ¨åˆ›å»ºé˜¶æ®µï¼Œç­‰å¾…å®¹å™¨åˆ›å»ºï¼Œè¯¥è¿‡ç¨‹åŒ…å«æ‹‰å–é•œåƒçš„æ—¶é—´ã€‚3.Pendingé—®é¢˜åˆ†æ:ä»»åŠ¡å·²ç»è¢«K8Sé›†ç¾¤æ¥å—ï¼Œä½†æ˜¯æœªè°ƒåº¦åˆ°æŒ‡å®šèŠ‚ç‚¹ã€‚å¯èƒ½åŸå› :1.å½“å‰é›†ç¾¤ä¸æ­£å¸¸å·¥ä½œï¼Œè¯·æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼Œæ¯”å¦‚CNIç»„ä»¶æœªå®‰è£…;2.æŒ‡å®šçš„è°ƒåº¦çš„èŠ‚ç‚¹ä¸å­˜åœ¨æ—¶ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜;3.ç«¯å£å†²çªï¼Œæ— æ³•å®Œæˆè°ƒåº¦;4.æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«æ‰“ä¸Šæ±¡ç‚¹ï¼Œä¸”podæ²¡æœ‰é…ç½®æ±¡ç‚¹å®¹å¿ä¹Ÿä¼šå¯¼è‡´è¯¥çŠ¶æ€;4.CrashLoopBackOffé—®é¢˜åˆ†æ:å¤„äºè¯¥çŠ¶æ€ï¼Œè¯´æ˜Podå†…è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨é‡å¯ã€‚å¯èƒ½åŸå› :1.å¯èƒ½æ˜¯å®¹å™¨çš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œå‘½ä»¤ç»“æŸå¯¼è‡´çš„;5.Completedé—®é¢˜åˆ†æ:å®¹å™¨æ­£å¸¸é€€å‡ºï¼Œå®¹å™¨æ²¡æœ‰è¢«å¼ºåˆ¶ä¸­æ–­ã€‚6.Runningé—®é¢˜åˆ†æ:è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ã€‚7.Init:1/2 é—®é¢˜åˆ†æ:å½“å‰çš„Podå¤„äºåˆå§‹åŒ–å®¹å™¨é˜¶æ®µï¼Œç›®å‰å·²ç»å®Œæˆä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ï¼Œæ­£åœ¨è¿›è¡Œç¬¬äºŒä¸ªå®¹å™¨åˆå§‹åŒ–ã€‚8.PodInitializingé—®é¢˜åˆ†æ:Podæ­£å¤„äºåˆå§‹åŒ–é˜¶æ®µã€‚9.ErrImageNeverPull é—®é¢˜åˆ†æ:å°†é•œåƒä¸‹è½½ç­–ç•¥è®¾ç½®ä¸ºNeverï¼Œä¸”æœ¬åœ°ä¹Ÿæ²¡æœ‰ç¼“å­˜é•œåƒï¼Œå› æ­¤å¯åŠ¨å®¹å™¨å¤±è´¥ã€‚10.OutOfcpué—®é¢˜åˆ†æ:ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç”±äºCPUèµ„æºä¸è¶³å¯¼è‡´çš„ã€‚11.OutOfmemoryé—®é¢˜åˆ†æ:ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç”±äºå†…å­˜ä¸è¶³æ— æ³•åˆ†é…å¯¼è‡´çš„ã€‚12.NodePortsé—®é¢˜åˆ†æ:å½“å‰çš„workerèŠ‚ç‚¹çš„ç«¯å£å¯èƒ½å­˜åœ¨å†²çªã€‚13.RunContainerErroré—®é¢˜åˆ†æ:è¿è¡Œå®¹å™¨æ—¶å‡ºé”™ï¼Œå¯ä»¥é€šè¿‡kubectl describe pods &lt;POD_NAME&gt;æŸ¥çœ‹è¯¦ç»†çš„ä¿¡æ¯ã€‚14.ErrImagePullé—®é¢˜åˆ†æ:æ‹‰å–é•œåƒæ˜¯å¤±è´¥ã€‚å¯èƒ½åŸå› :1.é•œåƒåç§°å†™é”™äº†;2.æ²¡æœ‰è®¿é—®æƒé™;15.Terminatingé—®é¢˜åˆ†æ:Podçš„å®¹å™¨æ­£åœ¨åˆ é™¤ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šè¶…è¿‡30sã€‚16.CreateContainerConfigErroré—®é¢˜åˆ†æ:è¿è¡Œå®¹å™¨å‡ºé”™ï¼Œä¸€èˆ¬æƒ…ä¸‹ï¼Œæ˜¯é…ç½®å‡ºé”™ã€‚17.ContainerStatusUnknowné—®é¢˜åˆ†æ:å®¹å™¨é‡å¯ç­–ç•¥ä¸ºNerverï¼Œä¸”æˆ‘ä»¬æµ‹è¯•æ—¶å°†å·¥ä½œèŠ‚ç‚¹çš„å®¹å™¨ç›´æ¥åˆ é™¤å•¦ã€‚æ— æ³•è·å–</code></pre><h2 id="èµ„æºæ¸…å•ç¼–å†™æ¡ˆä¾‹">èµ„æºæ¸…å•ç¼–å†™æ¡ˆä¾‹</h2><p><strong>åŸºäºä¸€ä¸ªpodéƒ¨ç½²wordpress</strong></p><p><strong>1.ç¼–å†™èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# <span class="built_in">cat</span> wordpress.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-pod</span><br><span class="line">spec:</span><br><span class="line"> <span class="comment"># ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œåç§°ç©ºé—´</span></span><br><span class="line">  hostNetwork: <span class="literal">true</span></span><br><span class="line">  containers:</span><br><span class="line">  - name: db</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: wp</span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  - name: wp</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: WORDPRESS_DB_HOST</span><br><span class="line">      value: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_NAME</span><br><span class="line">      value: wp</span><br><span class="line">    - name: WORDPRESS_DB_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>2.æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºpod</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl apply -f wordpress.yaml</span><br><span class="line"></span><br><span class="line">`å› ä¸ºä½¿ç”¨çš„å®¿ä¸»æœºç½‘ç»œåç§°ç©ºé—´ï¼Œéœ€ä¿è¯80ç«¯å£ä¸è¢«å ç”¨`</span><br></pre></td></tr></table></figure><p><strong>3.æŸ¥çœ‹podèŠ‚ç‚¹ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl get pod -o wide</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   IP           NODE    </span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   0          8h    10.2.2.2     node03  </span><br><span class="line">nginx-pod                1/1     Running   0          8h    10.2.2.3     node03  </span><br><span class="line">wordpress-pod            2/2     Running   0          36m   10.0.0.203   node03  </span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºèŠ‚ç‚¹node03   ip 10.0.0.203</span></span><br><span class="line">æµè§ˆå™¨è®¿é—®10.0.0.203</span><br></pre></td></tr></table></figure><p><strong>åŸºäºä¸€ä¸ªpodèµ·wordpressï¼ŒåšæŒä¹…åŒ–</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# <span class="built_in">cat</span> wordpress.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">    run: mysql</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#å¦‚æœä½¿ç”¨ä¸‹é¢portsï¼Œè¿™ä¸ªå¯ä»¥ä¸ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span></span><br><span class="line">  hostNetwork: <span class="literal">true</span></span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql</span><br><span class="line">  containers:</span><br><span class="line">  - name: db</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: wp</span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: mysql-data</span><br><span class="line">      mountPath: /var/lib/mysql</span><br><span class="line">      </span><br><span class="line">  - name: wp</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="comment">#ç›¸å½“äºæš´éœ²ç«¯å£ï¼Œç›´æ¥ä½¿ç”¨èŠ‚ç‚¹çš„å®¿ä¸»æœºipè®¿é—®å³å¯Â·</span></span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 80</span><br><span class="line">      hostPort: 80</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: WORDPRESS_DB_HOST</span><br><span class="line">      value: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_NAME</span><br><span class="line">      value: wp</span><br><span class="line">    - name: WORDPRESS_DB_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="è¿æ¥pod">è¿æ¥pod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## è¿æ¥åˆ°POD</span></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it nginx-pod -- /bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment">## å½“ä¸€ä¸ªPODä¸­æœ‰å¤šä¸ªå®¹å™¨æ—¶ï¼Œä½¿ç”¨-cæŒ‡å®šå®¹å™¨åï¼Œè¿æ¥åˆ°æŒ‡å®šçš„å®¹å™¨</span></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it nginx-busybox -c busybox-container -- /bin/sh</span><br></pre></td></tr></table></figure><h2 id="podçš„ç½‘ç»œå…±äº«">podçš„ç½‘ç»œå…±äº«</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.PODå†…çš„å®¹å™¨ä½¿ç”¨Containeræ¨¡å¼å…±äº«æ ¹å®¹å™¨çš„ç½‘ç»œ</span><br><span class="line">2.å®¹å™¨çœ‹åˆ°çš„ç½‘ç»œè®¾å¤‡ä¿¡æ¯å’Œæ ¹å®¹å™¨å®Œå…¨ç›¸åŒ</span><br><span class="line">3.PODå†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥ä½¿ç”¨localhostè¿›è¡Œç½‘ç»œé€šè®¯</span><br><span class="line">4.PODå†…çš„å¤šä¸ªå®¹å™¨ä¸èƒ½ç»‘å®šç›¸åŒçš„ç«¯å£</span><br><span class="line">5.PODçš„ç”Ÿå‘½å‘¨æœŸå’Œæ ¹å®¹å™¨ä¸€æ ·ï¼Œå¦‚æœæ ¹å®¹å™¨é€€å‡ºäº†ï¼ŒPODå°±é€€å‡ºäº†</span><br></pre></td></tr></table></figure><h2 id="podçš„æ–‡ä»¶å…±äº«">podçš„æ–‡ä»¶å…±äº«</h2><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241002101149735.png" alt="image-20241002101149735"></p><h3 id="æŒ‚è½½æ–¹å¼hostPath">æŒ‚è½½æ–¹å¼hostPath</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> mysql.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql57-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">    run: mysql</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data</span><br><span class="line">  <span class="comment">#å®¿ä¸»æœºæŒ‚è½½çš„ç›®å½•</span></span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql</span><br><span class="line">  containers:</span><br><span class="line">  - name: mysql57-container</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  <span class="built_in">env</span>:</span><br><span class="line">  - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  - name: MYSQL_DATABASE</span><br><span class="line">    value: <span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">  - name: MYSQL_USER</span><br><span class="line">    value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">  - name: MYSQL_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  <span class="comment">#ä¼ é€’å‘½ä»¤æŒ‡å®šå­—ç¬¦é›†</span></span><br><span class="line">  args:</span><br><span class="line">  - --character-set-server=utf8mb4</span><br><span class="line">  - --collation-server=utf8mb4_unicode_ci</span><br><span class="line">  volumeMounts:</span><br><span class="line">  <span class="comment">#nameè¦å’Œä¸Šé¢æŒ‚è½½ç›®å½•çš„nameä¸€è‡´ï¼ŒmountPathæ˜¯å®¹å™¨å†…çš„è¦æŒ‚è½½çš„ç›®å½•</span></span><br><span class="line">  - name: mysql-data</span><br><span class="line">    mountPath: /var/lib/mysql</span><br></pre></td></tr></table></figure><h3 id="hostPathçš„typeç±»å‹">hostPathçš„typeç±»å‹</h3><blockquote><p>hostPath:<br>path: string<br>type : string</p><p>type ä¸ºç©ºæ—¶ä¸ºé»˜è®¤ç±»å‹</p><p><code>å®˜æ–¹ï¼šhttps://kubernetes.io/docs/concepts/storage/volumes/#hostpath</code></p></blockquote><table><thead><tr><th>typeç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>â€œâ€</td><td>ä¸ºç©ºæ—¶   é»˜è®¤</td></tr><tr><td>DirectoryOrCreate</td><td>ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œæƒé™å¿…é¡»æ˜¯755</td></tr><tr><td>Directory</td><td>ç›®å½•å¿…é¡»å­˜åœ¨</td></tr><tr><td>FileOrCreate</td><td>æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œæƒé™å¿…é¡»æ˜¯644</td></tr><tr><td>File</td><td>æ–‡ä»¶å¿…é¡»å­˜åœ¨</td></tr><tr><td>Socket</td><td>æŒ‚è½½socketæ–‡ä»¶</td></tr><tr><td>CharDevice</td><td>æŒ‚è½½å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼ˆé”®ç›˜ï¼Œç»ˆç«¯â€¦ï¼‰</td></tr><tr><td>BlockDevice</td><td>æŒ‚è½½å¿«è®¾å¤‡æ–‡ä»¶ï¼ˆç£ç›˜ï¼ŒUç›˜ï¼Œç§»åŠ¨ç¡¬ç›˜â€¦ï¼‰</td></tr></tbody></table><h3 id="æŒ‚è½½æ–¹å¼emptyDir">æŒ‚è½½æ–¹å¼emptyDir</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å°†podå†…å®¹å™¨ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œå¦‚æœPODç»“æŸï¼Œç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> mysql.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql57-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">    run: mysql</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql</span><br><span class="line">  - name: empty-data</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">  containers:</span><br><span class="line">  - name: mysql57-container</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  <span class="built_in">env</span>:</span><br><span class="line">  - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  - name: MYSQL_DATABASE</span><br><span class="line">    value: <span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">  - name: MYSQL_USER</span><br><span class="line">    value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">  - name: MYSQL_PASSWORD</span><br><span class="line">    value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  args:</span><br><span class="line">  - --character-set-server=utf8mb4</span><br><span class="line">  - --collation-server=utf8mb4_unicode_ci</span><br><span class="line">  volumeMounts:</span><br><span class="line">  - name: empty-data</span><br><span class="line">    mountPath: /var/lib/mysql</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">## å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•</span></span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> busybox.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-busybox</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: empty-data</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: empty-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: empty-data</span><br><span class="line">      mountPath: /opt/ html</span><br></pre></td></tr></table></figure><h2 id="æ ‡ç­¾çš„ä½¿ç”¨åŠè®¾ç½®">æ ‡ç­¾çš„ä½¿ç”¨åŠè®¾ç½®</h2><h3 id="nodeèŠ‚ç‚¹æ‰“æ ‡ç­¾">nodeèŠ‚ç‚¹æ‰“æ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">kubectl get [èµ„æº] -n åç§°ç©ºé—´ --show-labels</span><br><span class="line"><span class="comment">## æŸ¥çœ‹nodeæ ‡ç­¾</span></span><br><span class="line">[root@master01 ~]# kubectl get nodes --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™nodeæ‰“æ ‡ç­¾</span></span><br><span class="line">[root@master01 ~]# kubectl label node node01 MEM=16g</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nodeè§’è‰²æ ‡ç­¾role</span></span><br><span class="line">[root@master kubernetes]# kubectl get nodes </span><br><span class="line">NAME     STATUS   ROLES    AGE     VERSION</span><br><span class="line">master   Ready    master   5d15h   v1.19.3</span><br><span class="line">node01   Ready    None     5d15h   v1.19.3</span><br><span class="line">node02   Ready    None     5d15h   v1.19.3</span><br><span class="line">node03   Ready    None     5d15h   v1.19.3</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™nodeè§’è‰²æ ‡ç­¾role</span></span><br><span class="line">[root@master kubernetes]# kubectl label node node01 node-role.kubernetes.io/node=</span><br><span class="line">[root@master kubernetes]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES        AGE     VERSION</span><br><span class="line">master   Ready    master       5d15h   v1.19.3</span><br><span class="line">node01   Ready    node         5d15h   v1.19.3</span><br><span class="line">node02   Ready    None         5d15h   v1.19.3</span><br><span class="line">node03   Ready    None         5d15h   v1.19.3</span><br><span class="line"></span><br><span class="line">kubectl label node node01 node-role.kubernetes.io/node=</span><br><span class="line">                   èŠ‚ç‚¹å    è°ƒç”¨æ¥å£             /rolesæ ‡ç­¾å=</span><br><span class="line">                   </span><br><span class="line"><span class="comment">#åˆ é™¤nodeè§’è‰²æ ‡ç­¾role</span></span><br><span class="line">[root@master kubernetes]# kubectl label node node01 node-role.kubernetes.io/node-</span><br></pre></td></tr></table></figure><h3 id="ç»™podæ‰“æ ‡ç­¾">ç»™podæ‰“æ ‡ç­¾</h3><p><strong>ç»™podæ‰“æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹podæ ‡ç­¾</span></span><br><span class="line">[root@master kubernetes]# kubectl get pods --show-labels </span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          33h     app=nginx</span><br><span class="line">nginx-pod                1/1     Running   2          33h     &lt;none&gt;</span><br><span class="line">wordpress-pod            2/2     Running   0          2m11s   &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰“æ ‡ç­¾</span></span><br><span class="line">kubectl label èµ„æºç±»å‹ èµ„æºå æ ‡ç­¾</span><br><span class="line">[root@master kubernetes]# kubectl label pod nginx-pod name=nginx</span><br><span class="line"><span class="string">&#x27;pod/nginx-pod labeled</span></span><br><span class="line"><span class="string">[root@master kubernetes]# kubectl get pods --show-labels </span></span><br><span class="line"><span class="string">NAME                     READY   STATUS    RESTARTS   AGE     LABELS</span></span><br><span class="line"><span class="string">nginx-565785f75c-tpjmj   1/1     Running   2          33h     app=nginx</span></span><br><span class="line"><span class="string">nginx-pod                1/1     Running   2          33h     name=nginx</span></span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨èµ„æºæ¸…å•æ‰“æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">Kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    run: nginx</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure><p><strong>åˆ©ç”¨æ ‡ç­¾ï¼Œå¯åŠ¨podåœ¨æŒ‡å®šæ ‡ç­¾çš„nodeä¸Š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> nginx-2.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pod-v2</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    run: nginx</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#è¿™é‡Œæ˜¯é€‰æ‹©èµ·åœ¨æ ‡ç­¾æ˜¯MEM: 16gçš„nodeèŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨kubectl get nodes --show-labels æŸ¥çœ‹nodeæ ‡ç­¾</span></span><br><span class="line">  nodeSelector:</span><br><span class="line">  MEM: 16g</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container-v2</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤podæ ‡ç­¾">åˆ é™¤podæ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kubectl label [èµ„æº] [èµ„æºå] [æ ‡ç­¾åã€æ ‡ç­¾key]-</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰podæœ‰çš„æ ‡ç­¾</span></span><br><span class="line">[root@master kubernetes]# kubectl get pods --show-labels</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          35h   app=nginx,pod-template-hash=565785f75c</span><br><span class="line">nginx-pod                1/1     Running   2          34h   name=nginx</span><br><span class="line">wordpress-pod            2/2     Running   0          39m   &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤podæ ‡ç­¾</span></span><br><span class="line">[root@master kubernetes]# kubectl label pod nginx-pod name-</span><br><span class="line">pod/nginx-pod labeled</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹</span></span><br><span class="line">[root@master kubernetes]# kubectl get pods --show-labels</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          35h   app=nginx,pod-template-hash=565785f75c</span><br><span class="line">nginx-pod                1/1     Running   2          34h   &lt;none&gt;</span><br><span class="line">wordpress-pod            2/2     Running   0          39m   &lt;none&gt;</span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾pod">æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾pod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl get pod --show-labels -l app</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   2          35h   app=nginx,pod-template-hash=565785f75c</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨  `-l`  æŸ¥æ‰¾æŒ‡å®šçš„pod</span></span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®æ ‡ç­¾åˆ é™¤pod">æ ¹æ®æ ‡ç­¾åˆ é™¤pod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl delete pod -l app=nginx</span><br></pre></td></tr></table></figure><h2 id="kubectlç”¨äºæ’é”™å‘½ä»¤">kubectlç”¨äºæ’é”™å‘½ä»¤</h2><h3 id="describe">describe</h3><blockquote><p><code> kubectl describe pod</code></p><p>æŸ¥çœ‹ç›¸å…³ Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬äº†è§£ Pod çš„çŠ¶æ€ã€é…ç½®å’Œè¿è¡ŒçŠ¶å†µã€‚å°¤å…¶æ˜¯Eventså¯ä»¥å¸®åŠ©æˆ‘ä»¬åšä¸€äº›æ•…éšœæ’æŸ¥ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl describe pod busybox-pod -n luay</span><br><span class="line"><span class="comment">#å¦‚æœæŸ¥çœ‹çš„podçš„åç§°ç©ºé—´ä¸æ˜¯é»˜è®¤defaultï¼Œåˆ™éœ€è¦æŒ‡å®š -n</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  18m   default-scheduler  Successfully assigned luay/busybox-pod to node03</span><br><span class="line">  Normal  Pulled     18m   kubelet            Container image <span class="string">&quot;busybox&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    18m   kubelet            Created container busybox-container</span><br><span class="line">  Normal  Started    18m   kubelet            Started container busybox-container</span><br><span class="line">  Normal  Pulled     18m   kubelet            Container image <span class="string">&quot;nginx:alpine&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    18m   kubelet            Created container nginx-container</span><br><span class="line">  Normal  Started    18m   kubelet            Started container nginx-container</span><br><span class="line">  </span><br><span class="line"><span class="comment">#æŸ¥çœ‹nodeèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">[root@master ~]# kubectl describe node master01</span><br></pre></td></tr></table></figure><h3 id="logs">logs</h3><blockquote><p><code> kubectl logs èµ„æºå</code>   å¯ä»¥ä½¿ç”¨kubectl get pod  æŸ¥çœ‹èµ„æºå</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;kubectl logs èµ„æºåç§°&#x27;</span></span><br><span class="line">[root@master ~]# kubectl logs mysql80 </span><br><span class="line"></span><br><span class="line"><span class="comment">#å®æ—¶æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">[root@master ~]# kubectl logs -f mysql80 </span><br><span class="line"></span><br><span class="line"><span class="comment">#åŸºäºä¸€ä¸ªPodå†…å¤šä¸ªå®¹å™¨æŸ¥çœ‹æŒ‡çš„å®¹å™¨çš„æ—¥å¿—   -c  æŒ‡å®šå®¹å™¨å</span></span><br><span class="line">[root@master ~]# kubectl logs -f multiple-wordpress -c db</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;multiple-wordpress&#x27;</span> podå</span><br><span class="line">-c æŒ‡å®špodé‡Œçš„æŸä¸€ä¸ªå®¹å™¨å</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹podä¸Šä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—ï¼ˆå‰ææ˜¯è¯¥å®¹å™¨å­˜åœ¨ï¼Œè‹¥ç§»é™¤äº†åˆ™çœ‹ä¸åˆ°ï¼‰</span></span><br><span class="line"><span class="string">&#x27;è¿™ç§æƒ…å†µå­˜åœ¨äºï¼Œæ€æ‰äº†podé‡ŒæŸä¸ªå®¹å™¨ï¼Œåˆè¢«kubeleté‡æ–°æ‹‰å–äº†å¦ä¸€ä¸ªæ–°çš„å®¹å™¨,-pæŸ¥çœ‹ä¸Šä¸ªå®¹å™¨æ—¥å¿—&#x27;</span></span><br><span class="line">[root@master ~]#  kubectl logs -f mysql80 -p</span><br><span class="line"><span class="string">&#x27;mysql80&#x27;</span> å®¹å™¨å   ----å¾…éªŒè¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹5åˆ†é’Ÿå†…çš„æ—¥å¿—ä¿¡æ¯ï¼Œ é»˜è®¤æ˜¯æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼Œå¯ä»¥è‡ªå®šä¹‰æŒ‡å®šæ—¶é—´ï¼Œä¾‹å¦‚: 5s, 2m, or 3h.</span></span><br><span class="line">[root@master ~]# kubectl logs -f mysql80 --since  5m</span><br></pre></td></tr></table></figure><h3 id="cp">cp</h3><p><strong>å°†æœ¬åœ°çš„æ–‡ä»¶æ‹·è´åˆ°Podçš„å®¹å™¨ä¸­</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl <span class="built_in">cp</span> wordpress.yaml mysql80:/tmp</span><br><span class="line"></span><br><span class="line">å¦‚ä½•æŸ¥çœ‹ï¼Ÿ</span><br><span class="line">[root@master ~]# kubectl <span class="built_in">exec</span> -it mysql80 --<span class="built_in">ls</span> /tmp</span><br><span class="line">ç±»ä¼¼äºdocker <span class="built_in">exec</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨-cæŒ‡å®š </span></span><br><span class="line">kubectl <span class="built_in">cp</span>  wordpress.yaml  -c wp multiple-wordpress:/</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;multiple-wordpress&#x27;</span>   <span class="comment">#podå   ---å¾…éªŒè¯</span></span><br><span class="line"><span class="string">&#x27;wp&#x27;</span> <span class="comment">#å®¹å™¨å</span></span><br><span class="line"></span><br><span class="line">å¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨-cæŒ‡å®šå®¹å™¨çš„åç§°ï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤Podè¿æ¥ç¬¬ä¸€ä¸ªå®¹å™¨</span><br></pre></td></tr></table></figure><h3 id="explain">explain</h3><p><strong>æŸ¥çœ‹æŒ‡å®šå­—æ®µçš„å¸®åŠ©ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl explain pods.</span><br><span class="line">[root@master ~]# kubectl explain pods.metadata</span><br><span class="line">[root@master ~]# kubectl explain pods.metadata.name</span><br><span class="line">[root@master ~]# kubectl explain pods.spec.containers</span><br></pre></td></tr></table></figure><p><strong>å¸¸è§çš„èµ„æºç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;ï¼š</span><br><span class="line">è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">&lt;Object&gt;:</span><br><span class="line">è¡¨ç¤ºæœ‰ä¸‹çº§å­—æ®µã€‚</span><br><span class="line"></span><br><span class="line"> &lt;[]Object&gt;:</span><br><span class="line">è¡¨ç¤ºæ•°ç»„å¯¹è±¡è¯´å¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸ªå¯¹è±¡çš„åŒºåˆ†ä½¿ç”¨<span class="string">&quot;-&quot;</span>ï¼ŒåŒä¸€ä¸ªå¯¹è±¡æ•°ç»„å†…çš„ç›¸å…³å­—æ®µå¯ä»¥ç›¸äº’äº¤æ¢ã€‚</span><br><span class="line"></span><br><span class="line">&lt;boolean&gt;:</span><br><span class="line">åªæœ‰<span class="literal">true</span>å’Œ<span class="literal">false</span>ä¸¤ä¸ªæœ‰æ•ˆå€¼ã€‚</span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">integer</span>&gt;:</span><br><span class="line">æ•´å‹ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚</span><br><span class="line"></span><br><span class="line">-required-</span><br><span class="line">è¡¨ç¤ºè¯¥å­—æ®µå¿…é¡»å®šä¹‰ï¼Œä¸å®šä¹‰åˆ™ä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä¸Šå¹²è´§äº†ï¼Œk8sçš„PODèµ„æºä»¥åŠç½‘ç»œå…±äº«ï¼Œæ–‡ä»¶æŒ‚è½½ç­‰åœ¨è¿™é‡Œéƒ½èƒ½çœ‹åˆ°</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>02-k8séƒ¨ç½²</title>
    <link href="https://lukme.top/posts/24ecfc3b.html"/>
    <id>https://lukme.top/posts/24ecfc3b.html</id>
    <published>2024-10-02T16:49:49.000Z</published>
    <updated>2024-10-06T14:13:40.873Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h2><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>LanIP</th><th>è§’è‰²</th><th>åº”ç”¨</th><th>é…ç½®</th></tr></thead><tbody><tr><td>master01</td><td>10.0.0.200</td><td>172.16.1.200</td><td>master</td><td>kubectlã€apiserverã€ schedulerã€controllerã€ etcdã€kubeletã€dockerã€ kube-proxy</td><td>1h2g</td></tr><tr><td>node01</td><td>10.0.0.201</td><td>172.16.1.201</td><td>node</td><td>kubeletã€dockerã€kubeproxyã€proxy</td><td>1h2g</td></tr><tr><td>node02</td><td>10.0.0.202</td><td>172.16.1.202</td><td>node</td><td>kubeletã€dockerã€kubeproxyã€proxy</td><td>1h2g</td></tr><tr><td>node03</td><td>10.0.0.203</td><td>172.16.1.203</td><td>node</td><td>kubeletã€dockerã€kubeproxyã€proxy</td><td>2h4g</td></tr></tbody></table><p><strong>IPè§„åˆ’</strong></p><table><thead><tr><th>ä¸‰ç§Service</th><th>IP</th></tr></thead><tbody><tr><td>PodIP</td><td>10.2.0.0</td></tr><tr><td>ClusterIP</td><td>10.1.0.0</td></tr><tr><td>NodeIP</td><td>10.0.0.0</td></tr></tbody></table><h2 id="åŸºç¡€ç¯å¢ƒä¼˜åŒ–">åŸºç¡€ç¯å¢ƒä¼˜åŒ–</h2><blockquote><p>æ³¨æ„ï¼šå››ä¸ªèŠ‚ç‚¹éƒ½æ“ä½œ</p></blockquote><p><strong>1.é…ç½®kubeleté…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„Cgroupé©±åŠ¨å’Œç¦ç”¨swap</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> &gt;/etc/sysconfig/kubelet &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">KUBELET_CGROUP_ARGS=&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"><span class="string">KUBELET_EXTRA_ARGS=&quot;--fail-swap-on=false&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line"><span class="comment">## è®©kubeletä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„Cgroupé©±åŠ¨</span></span><br><span class="line">KUBELET_CGROUP_ARGS=<span class="string">&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"><span class="comment">## è®©kubeletç¦æ­¢ä½¿ç”¨swapï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰</span></span><br><span class="line">KUBELET_EXTRA_ARGS=<span class="string">&quot;--fail-swap-on=false&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2.å†…æ ¸å‚æ•°è°ƒä¼˜</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]#  <span class="built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables=1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables=1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1</span></span><br><span class="line"><span class="string">vm.swappiness=0</span></span><br><span class="line"><span class="string">fs,file-max=52706963</span></span><br><span class="line"><span class="string">fs.nr_open=52706963</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line"><span class="comment">## å¼€å¯iptablesåŠŸèƒ½ ipv6</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="line"><span class="comment">## å¼€å¯iptablesåŠŸèƒ½ ipv4</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line"><span class="comment">## å¼€å¯å†…æ ¸è½¬å‘</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"><span class="comment">## å†…æ ¸å‚æ•°ç¦ç”¨swap</span></span><br><span class="line">vm.swappiness=0</span><br><span class="line"><span class="comment">## æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶æœ€å¤§å€¼</span></span><br><span class="line">fs,file-max=52706963</span><br><span class="line"><span class="comment">## æ–‡ä»¶æè¿°ç¬¦å¼€å¯æ•°é‡</span></span><br><span class="line">fs.nr_open=52706963</span><br></pre></td></tr></table></figure><p><strong>3.æ›´æ”¹dockeræº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ·»åŠ docekræº</span></span><br><span class="line">[root@master ~]#  <span class="built_in">cat</span> &gt; /etc/yum.repos.d/docker-ce.repo &lt;&lt;<span class="string">&quot;EOF&quot;</span></span><br><span class="line">[docker-ce-stable]</span><br><span class="line">name=Docker CE Stable - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://download.docker.com/linux/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/stable</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://download.docker.com/linux/centos/gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›¿æ¢ä¸ºåä¸ºæº</span></span><br><span class="line">[root@master ~]# sed -i <span class="string">&#x27;s+download.docker.com+mirrors.huaweicloud.com/docker-ce+&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br></pre></td></tr></table></figure><p><strong>4.å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y chrony</span><br><span class="line">[root@master ~]# systemctl start chronyd</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> chronyd</span><br></pre></td></tr></table></figure><p><strong>5.å…³é—­swap</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸´æ—¶å…³é—­swap</span></span><br><span class="line">[root@master ~]#  swapoff -a &amp;&amp; sysctl -w vm.swappiness=0</span><br><span class="line"><span class="comment">#æ°¸ä¹…å…³é—­</span></span><br><span class="line">[root@master ~]#  sed -i <span class="string">&#x27;/swap/d&#x27;</span> /etc/fstab</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦å…³é—­</span></span><br><span class="line">[root@master ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.9G         95M        1.6G        9.5M        283M        1.7G</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><p><strong>6.åŠ è½½ipvsæ¨¡å—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span>  &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#! /bin/bash</span></span><br><span class="line"><span class="string">modprobe -- ip_vs</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_rr</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_wrr</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_sh</span></span><br><span class="line"><span class="string">modprobe -- nf_conntrack_ipv4</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆæƒ</span></span><br><span class="line">[root@master ~]# <span class="built_in">chmod</span> +x /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"><span class="comment">#sourceä½¿ç”Ÿæ•ˆ</span></span><br><span class="line">[root@master ~]# <span class="built_in">source</span> /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</span></span><br><span class="line">[root@master ~]# lsmod|grep -e <span class="string">&#x27;ip_vs&#x27;</span> -e <span class="string">&#x27;nf_conntrack_ipv&#x27;</span></span><br><span class="line">nf_conntrack_ipv4      15053  0 </span><br><span class="line">nf_defrag_ipv4         12729  1 nf_conntrack_ipv4</span><br><span class="line">ip_vs_sh               12688  0 </span><br><span class="line">ip_vs_wrr              12697  0 </span><br><span class="line">ip_vs_rr               12600  0 </span><br><span class="line">ip_vs                 145497  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr</span><br><span class="line">nf_conntrack          133095  2 ip_vs,nf_conntrack_ipv4</span><br><span class="line">libcrc32c              12644  3 xfs,ip_vs,nf_conntrack</span><br><span class="line"></span><br><span class="line"><span class="comment">#äº†è§£ä¸‹IPVS  LVS:ipvsadm</span></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…docker">å®‰è£…docker</h2><blockquote><p>æ³¨æ„ï¼šæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</p></blockquote><p><strong>1.å®‰è£…æŒ‡å®šç‰ˆæœ¬docekrå’Œå®¹å™¨è¿è¡Œæ—¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y docker-ce-19.03.15 docker-ce-cli-19.03.15 containerd.io</span><br><span class="line"></span><br><span class="line">`å®¹å™¨è¿è¡Œæ—¶ï¼ŒDockerã€containerdã€CRI-O`</span><br></pre></td></tr></table></figure><p><strong>2.å¯åŠ¨å’Œå¼€æœºè‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl start docker</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p><strong>3.æ·»åŠ dockeré•œåƒåŠ é€Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span><br><span class="line"><span class="string">    &quot;registry-mirrors&quot;: [</span></span><br><span class="line"><span class="string">    &quot;https://docker.1panel.live&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dockercf.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker-cf.registry.cyou&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.chenby.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.m.daocloud.io&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.m.daocloud.io&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.nju.edu.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dockerproxy.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.rainbond.cc&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.registry.cyou&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dockertest.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://hub-mirror.c.163.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://hub.rat.dev/&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://mirror.aliyuncs.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://mirror.baidubce.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://mirror.iscas.ac.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://registry.docker-cn.com&quot;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">`<span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>], `#é•œåƒåŠ é€Ÿä½¿ç”¨ç³»ç»ŸCgroupé©±åŠ¨</span><br></pre></td></tr></table></figure><p><strong>4.é‡å¯docerk</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl daemon-reload</span><br><span class="line">[root@master ~]# systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…kubeadm">å®‰è£…kubeadm</h2><blockquote><p>æ³¨æ„ï¼šæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</p></blockquote><p><strong>1.æ›´æ¢kubernetesçš„yumæº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">&quot;EOF&quot;</span> &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.huaweicloud.com/kubernetes/yum/repos/kubernetes-el7-<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.huaweicloud.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.huaweicloud.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p><strong>2.ä¸‹è½½æŒ‡å®šç‰ˆæœ¬kubernetes</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install kubelet-1.19.3 kubeadm-1.19.3  kubectl-1.19.3  ipvsadm -y</span><br><span class="line"></span><br><span class="line">`kubelet`: nodeèŠ‚ç‚¹å®¹å™¨è¿è¡Œæ—¶çš„æ§åˆ¶å™¨ </span><br><span class="line">`kubeadm`: åšk8sé›†ç¾¤ kubectl k8sçš„å‘½ä»¤å®¢æˆ·ç«¯</span><br><span class="line">`ipvsadm`: åŠ è½½ipvsæ¨¡å—</span><br></pre></td></tr></table></figure><p><strong>3.å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl start kubelet</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> kubelet</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–é›†ç¾¤">åˆå§‹åŒ–é›†ç¾¤</h2><blockquote><p>:dango:æ³¨æ„ï¼šä»…masterèŠ‚ç‚¹æ‰§è¡Œ</p><p>æ­¥éª¤1-3éƒ½æ˜¯masterèŠ‚ç‚¹æ‰§è¡Œ</p></blockquote><p><strong>1.åˆå§‹åŒ–é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubeadm init \</span><br><span class="line">--apiserver-advertise-address=10.0.0.200 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers  \</span><br><span class="line">--kubernetes-version=v1.19.3 \</span><br><span class="line">--service-cidr=10.1.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.2.0.0/16 \</span><br><span class="line">--service-dns-domain=cluster.local \</span><br><span class="line">--ignore-preflight-errors=Swap \</span><br><span class="line">--ignore-preflight-errors=NumCPU</span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line">`--apiserver-advertise-address=10.0.0.200`  <span class="comment">#å½“å‰masterä¸»æœºip</span></span><br><span class="line">`--service-cidr=10.1.0.0/16` <span class="comment">#è§„åˆ’ClusterIPç½‘æ®µ</span></span><br><span class="line">`--pod-network-cidr=10.2.0.0/16` <span class="comment">#è§„åˆ’çš„podIP</span></span><br><span class="line">`--service-dns-domain=cluster.local` <span class="comment">#ä½¿ç”¨æœ¬åœ°DNSé›†ç¾¤ï¼Œk8ä¼šè‡ªå·±è£…Coredns</span></span><br><span class="line">`--ignore-preflight-errors=Swap`<span class="comment">#å¿½ç•¥SwapæŠ¥é”™</span></span><br><span class="line">`--ignore-preflight-errors=NumCPU`<span class="comment">#å¿½ç•¥CPUæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">`ClusterIP`: ç”¨äºæ„å»ºå®¹å™¨åŒ–åº”ç”¨çš„å†…éƒ¨é€šä¿¡ç½‘ç»œï¼Œä½œä¸ºPODçš„è´Ÿè½½å‡è¡¡</span><br><span class="line"></span><br><span class="line"><span class="comment">###åˆå§‹åŒ–æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ²¡æœ‰æŠ¥é”™ç­‰å¾…å³å¯</span></span><br></pre></td></tr></table></figure><p><strong>ä¿å­˜token</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">`åˆå§‹åŒ–æˆåŠŸåä¼šè¾“å…¥å¦‚ä¸‹ï¼Œä½ çš„å’Œæˆ‘çš„ä¸ä¸€æ ·ï¼Œæ³¨æ„ä¿å­˜,24håä¼šæ¶ˆå¤±`</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">`#è¿™ä¸ªå‘½ä»¤ä¹Ÿä¿å­˜ï¼Œç­‰ä¸€ä¸‹ç›´æ¥å¤åˆ¶æ‰§è¡Œ`</span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line">kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br></pre></td></tr></table></figure><blockquote><p>!!!  åˆ°è¿™ä¸€æ­¥å‰é¢æ²¡æŠ¥é”™å°±å¯ä»¥æ‰“å¿«ç…§ï¼Œä¸‡ä¸€åé¢å‡ºé”™æ–¹ä¾¿å›æ»šï¼Œå»ºè®®æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥æ‰“ä¸€æ¬¡ï¼Œå¦‚æœæŠ¥é”™å¯ä»¥å›æ»šåˆ°åŒä¸€èµ·å§‹ç‚¹</p></blockquote><blockquote><p>!! å¦‚æœæ—¶é—´å¤ªä¹…å¿˜è®°åŠ å…¥ä»¤ç‰Œçš„å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤</p><p><code>kubeadm token create --print-join-command</code></p><p>è·å–æ–°çš„joinä»¤ç‰Œ</p></blockquote><p><strong>2.åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]#   <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">[root@master ~]#   <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">[root@master ~]#   <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">`ç›´æ¥å¤åˆ¶ä¸Šé¢çš„ä¸‰æ¡è¾“å‡º`</span><br></pre></td></tr></table></figure><p><strong>3.æŸ¥çœ‹k8sé›†ç¾¤èŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS     ROLES    AGE   VERSION</span><br><span class="line">master   NotReady   master   11m   v1.19.3</span><br></pre></td></tr></table></figure><p><strong>4.å…¶ä»–nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</strong></p><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œæ˜¯3ä¸ªnodeèŠ‚ç‚¹æ‰§è¡Œ  <code>å¤åˆ¶è‡ªå·±çš„ï¼Œå«æœ‰tokençš„å‘½ä»¤ï¼Œä¸è¦å¤åˆ¶æˆ‘çš„</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br><span class="line">    </span><br><span class="line">[root@node02 ~]# kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br><span class="line"></span><br><span class="line">[root@node03 ~]# kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token ao4unc.i520imoy7frmmucj \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:77e1fdf379200e1e377304865da17a4f35212955eaf331d2df736c452a2e82f8 </span><br><span class="line">Â·Â·Â·</span><br><span class="line">Run <span class="string">&#x27;kubectl get nodes&#x27;</span> on the control-plane to see this node <span class="built_in">join</span> the cluster.</span><br></pre></td></tr></table></figure><p><strong>5.æŸ¥çœ‹k8sé›†ç¾¤</strong></p><blockquote><p>å»masterèŠ‚ç‚¹çœ‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS     ROLES    AGE     VERSION</span><br><span class="line">master   NotReady   master   17m     v1.19.3</span><br><span class="line">node01   NotReady   &lt;none&gt;   3m12s   v1.19.3</span><br><span class="line">node02   NotReady   &lt;none&gt;   3m32s   v1.19.3</span><br><span class="line">node03   NotReady   &lt;none&gt;   3m27s   v1.19.3</span><br><span class="line">`çœ‹åˆ°å››ä¸ªèŠ‚ç‚¹NotReadyå³OKï¼Œå› ä¸ºè¿˜æœªé…ç½®ç½‘ç»œï¼Œä¸èƒ½è·¨ä¸»æœºé€šä¿¡`</span><br></pre></td></tr></table></figure><p><strong>6.è®¾ç½®Kube-proxyä½¿ç”¨ipvsæ¨¡å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">`k8sé»˜è®¤ä½¿ç”¨çš„æ˜¯iptablesé˜²ç«å¢™ï¼Œå¯ä»¥ä¿®æ”¹æˆæ€§èƒ½æ›´é«˜çš„ipvsæ¨¡å¼ï¼Œè¯¥æ¨¡å¼LVSä¹Ÿåœ¨ä½¿ç”¨`</span><br><span class="line">[root@master01 ~]# kubectl edit cm kube-proxy -n kube-system</span><br><span class="line">mode: <span class="string">&quot;&quot;</span> --&gt;  mode: <span class="string">&quot;ipvs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœmodeï¼Œæ·»ä¸Šipvså³å¯</span></span><br></pre></td></tr></table></figure><p><strong>7.æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´ä¸­podç›¸ä¿¡ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod -n kube-system</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6d56c8448f-spslt         0/1     Pending   0          26m</span><br><span class="line">coredns-6d56c8448f-x5lqj         0/1     Pending   0          26m</span><br><span class="line">etcd-master                      1/1     Running   0          26m</span><br><span class="line">kube-apiserver-master            1/1     Running   0          26m</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          26m</span><br><span class="line">kube-proxy-qmbtd                 1/1     Running   0          26m</span><br><span class="line">kube-proxy-sqnbb                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-t7hcw                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-xzv7f                 1/1     Running   0          12m</span><br><span class="line">kube-scheduler-master            1/1     Running   0          26m</span><br><span class="line"></span><br><span class="line">`çŠ¶æ€æ²¡å¼‚å¸¸å³å¯ï¼Œé™¤Pendingå’ŒRunningä¹‹å¤–çš„çŠ¶æ€éƒ½æ˜¯ä¸æ­£å¸¸çš„ï¼Œæ£€æŸ¥æ˜¯å¦æ­¥éª¤å‡ºé”™`</span><br><span class="line"></span><br><span class="line">`coredns-6d56c8448f-spslt`<span class="comment">#dnsæœåŠ¡å™¨</span></span><br><span class="line">`coredns-6d56c8448f-x5lqj`<span class="comment">#dnsæœåŠ¡å™¨</span></span><br><span class="line">`etcd-master` <span class="comment">#æ•°æ®åº“æ‰€æœ‰èŠ‚ç‚¹çš„å­˜å‚¨</span></span><br><span class="line">`kube-apiserver-master`<span class="comment">#é›†ç¾¤çš„æ§åˆ¶ä¸­å¿ƒ--&#x27;å¸ä»¤éƒ¨&#x27;</span></span><br><span class="line">`kube-controller-manager-master` <span class="comment">#ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€--&#x27;æ§åˆ¶å™¨&#x27;</span></span><br><span class="line">`kube-proxy-qmbtd`<span class="comment">#è´Ÿè´£å°†ç½‘ç»œæµé‡è½¬å‘åˆ°æ­£ç¡®çš„Podã€ç«¯å£æ˜ å°„</span></span><br><span class="line">`kube-proxy-sqnbb`</span><br><span class="line">`kube-proxy-t7hcw`</span><br><span class="line">`kube-proxy-xzv7f`</span><br><span class="line">`kube-scheduler-master`<span class="comment">#è°ƒåº¦å™¨</span></span><br></pre></td></tr></table></figure><p><strong>8.æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´ä¸­podè¯¦ç»†ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod -n kube-system -o wide</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE   IP        </span><br><span class="line">coredns-6d56c8448f-spslt         0/1     Pending   0          42m   &lt;none&gt;    </span><br><span class="line">coredns-6d56c8448f-x5lqj         0/1     Pending   0          42m   &lt;none&gt;    </span><br><span class="line">etcd-master                      1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-apiserver-master            1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-proxy-qmbtd                 1/1     Running   0          42m   10.0.0.200</span><br><span class="line">kube-proxy-sqnbb                 1/1     Running   0          28m   10.0.0.203</span><br><span class="line">kube-proxy-t7hcw                 1/1     Running   0          28m   10.0.0.201</span><br><span class="line">kube-proxy-xzv7f                 1/1     Running   0          28m   10.0.0.202</span><br><span class="line">kube-scheduler-master            1/1     Running   0          42m   10.0.0.200</span><br><span class="line"></span><br><span class="line">`æ£€æŸ¥çŠ¶æ€æ˜¯å¦éƒ½æ˜¯Runningï¼Œæ¯”å¯¹ä¸‹æ˜¯å¦æ­¥éª¤æœ‰å‡ºå…¥`</span><br></pre></td></tr></table></figure><p><strong>9.æŸ¥çœ‹åç§°ç©ºé—´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get namespace</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   45m</span><br><span class="line">kube-node-lease   Active   45m</span><br><span class="line">kube-public       Active   45m</span><br><span class="line">kube-system       Active   45m</span><br><span class="line"></span><br><span class="line">`namespace å¯ä»¥ç®€å†™ä¸º ns`</span><br><span class="line">[root@master ~]# kubectl get ns</span><br></pre></td></tr></table></figure><p><strong>10.é‡å¯kube-proxy</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">`åˆ é™¤æ‰€æœ‰proxy`</span><br><span class="line">kubectl get pod -n kube-system|grep <span class="string">&#x27;kube-proxy&#x27;</span>|awk <span class="string">&#x27;&#123;print &quot;kubectl delete pod -n kube-system &quot;$1&#125;&#x27;</span>|bash</span><br><span class="line"></span><br><span class="line">`#åˆ é™¤å•ä¸ªproxy`</span><br><span class="line">kubectl delete pod -n kube-system kube-proxyåå­— `ä¾‹å¦‚kube-proxy-qmbtd`</span><br><span class="line"></span><br><span class="line">`#å› ä¸ºk8ä¼šè‡ªåŠ¨æ‹‰èµ·åœæ‰çš„podï¼Œæ‰€ä»¥åˆ é™¤å³å¯é‡å¯`</span><br></pre></td></tr></table></figure><p><strong>11.å†æ¬¡æ£€æŸ¥çŠ¶æ€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod -n kube-system -o wide</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE   IP        </span><br><span class="line">coredns-6d56c8448f-spslt         0/1     Pending   0          52m   &lt;none&gt;    </span><br><span class="line">coredns-6d56c8448f-x5lqj         0/1     Pending   0          52m   &lt;none&gt;    </span><br><span class="line">etcd-master                      1/1     Running   0          52m   10.0.0.200</span><br><span class="line">kube-apiserver-master            1/1     Running   0          52m   10.0.0.200</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          52m   10.0.0.200</span><br><span class="line">kube-proxy-62xz4                 1/1     Running   0          47s   10.0.0.203</span><br><span class="line">kube-proxy-gxz9p                 1/1     Running   0          35s   10.0.0.202</span><br><span class="line">kube-proxy-sfzzf                 1/1     Running   0          37s   10.0.0.201</span><br><span class="line">kube-proxy-vjgc5                 1/1     Running   0          49s   10.0.0.200</span><br><span class="line">kube-scheduler-master            1/1     Running   0          52m   10.0.0.200</span><br><span class="line"></span><br><span class="line">`æ£€æŸ¥çŠ¶æ€æ˜¯å¦å¼‚å¸¸ï¼Œå¦‚æœ‰å¼‚å¸¸ï¼Œæ¯”å¯¹ä¹‹å‰æ­¥éª¤ï¼Œä¹Ÿå¯æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—æŠ¥é”™`</span><br></pre></td></tr></table></figure><h2 id="é…ç½®flannel">é…ç½®flannel</h2><p><strong>1.ä¿®æ”¹flannelèµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">`kube-flannel.yml`</span><br><span class="line"><span class="comment">#ä¸‹è½½é“¾æ¥ https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml</span></span><br><span class="line"></span><br><span class="line">[root@master ~]# vim kube-flannel.yml</span><br><span class="line"><span class="comment">#1.å°†Networkç½‘æ®µæ”¹ä¸º10.2.0.0/16</span></span><br><span class="line">  net-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;10.2.0.0/16&quot;</span>,</span><br><span class="line">      <span class="string">&quot;EnableNFTables&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;Backend&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;vxlan&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.å°†å®¹å™¨ç»‘å®šç½‘å¡eth0   åœ¨`- --kube-subnet-mgr`  åé¢åŠ ä¸Š`- --iface=eth0` å¦‚ä¸‹</span></span><br><span class="line">containers:</span><br><span class="line">- args:</span><br><span class="line">- --ip-masq</span><br><span class="line">- --kube-subnet-mgr</span><br><span class="line">- --iface=eth0</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.åˆ é™¤å¦‚ä¸‹ä¸‰è¡Œï¼ˆæ„æ€æ˜¯ï¼Œåªæœ‰æ ‡ç­¾æ˜¯appçš„èŠ‚ç‚¹æ‰èƒ½ä¸‹è½½flannelï¼‰</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: flannel</span><br></pre></td></tr></table></figure><p><strong>2.åº”ç”¨flannelèµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨flannelèµ„æºæ¸…å•</span></span><br><span class="line">[root@master ~]# kubectl apply -f kube-flannel.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥flannelçš„podæ˜¯å¦æˆåŠŸå¯åŠ¨</span></span><br><span class="line">[root@master ~]# kubectl get pod -n kube-flannel</span><br><span class="line">NAME                    READY   STATUS                  RESTARTS   AGE</span><br><span class="line">kube-flannel-ds-g9drp   0/1     Running                 0          6m9s</span><br><span class="line">kube-flannel-ds-rcwkv   1/1     Running                 0          6m9s</span><br><span class="line">kube-flannel-ds-txcn2   1/1     Running                 0          6m9s</span><br><span class="line">kube-flannel-ds-whd7p   1/1     Running                 0          6m9s</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥k8sé›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">master   Ready    master   17m   v1.19.3</span><br><span class="line">node01   Ready    &lt;none&gt;   14m   v1.19.3</span><br><span class="line">node02   Ready    &lt;none&gt;   14m   v1.19.3</span><br><span class="line">node03   Ready    &lt;none&gt;   14m   v1.19.3</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ£€æŸ¥corednsæ˜¯å¦æ­£å¸¸è¿è¡Œ</span></span><br><span class="line">[root@master ~]# kubectl get pod -n kube-system</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6d56c8448f-hxpjc         1/1     Running   0          17m</span><br><span class="line">coredns-6d56c8448f-lb5m4         1/1     Running   0          17m</span><br><span class="line">etcd-master                      1/1     Running   0          17m</span><br><span class="line">kube-apiserver-master            1/1     Running   0          17m</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          17m</span><br><span class="line">kube-proxy-46jqn                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-4bnmp                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-5lc7l                 1/1     Running   0          12m</span><br><span class="line">kube-proxy-r8cll                 1/1     Running   0          12m</span><br><span class="line">kube-scheduler-master            1/1     Running   0          17m</span><br></pre></td></tr></table></figure><p><strong>k8så‘½ä»¤è¡¥å…¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bash-completion</span><br><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)</span><br><span class="line">kubectl completion bash &gt; /etc/bash_completion.d/kubectl</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨kubeadminéƒ¨ç½²k8sé›†ç¾¤</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>01-k8sä»‹ç»</title>
    <link href="https://lukme.top/posts/5b9896c9.html"/>
    <id>https://lukme.top/posts/5b9896c9.html</id>
    <published>2024-10-02T16:34:28.000Z</published>
    <updated>2024-10-06T14:13:36.405Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å®¹å™¨">ä»€ä¹ˆæ˜¯å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®¹å™¨çš„æœ¬è´¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ã€‚</span><br></pre></td></tr></table></figure><p><strong>å®¹å™¨çš„ä¸‰è¦ç´ </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Namespace<span class="comment">#åšéš”ç¦»ï¼Œè®©è¿›ç¨‹åªèƒ½çœ‹åˆ°Namespaceä¸­çš„ä¸–ç•Œï¼›</span></span><br><span class="line">Cgroups<span class="comment">#åšé™åˆ¶ï¼Œè®©è¿™ä¸ªâ€œä¸–ç•Œâ€å›´ç€ä¸€ä¸ªçœ‹ä¸è§çš„å¢™ã€‚</span></span><br><span class="line">rootfs<span class="comment">#åšæ–‡ä»¶ç³»ç»Ÿï¼Œrootfs åªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ‰€åŒ…å«çš„æ–‡ä»¶ã€é…ç½®å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</span></span><br><span class="line"></span><br><span class="line">Namespaceå°†é›†ç¾¤å†…éƒ¨çš„èµ„æºè¿›è¡Œéš”ç¦»åˆ’åˆ†ã€‚åœ¨Namespaceä¸­ï¼Œå½¢æˆé€»è¾‘ä¸Šçš„ä¸åŒé¡¹ç›®ç»„æˆ–ç”¨æˆ·ç»„ã€‚</span><br></pre></td></tr></table></figure><p><strong>rootfs</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æŒ‚è½½åœ¨å®¹å™¨æ ¹ç›®å½•ä¸Šã€ç”¨æ¥ä¸ºå®¹å™¨è¿›ç¨‹æä¾›éš”ç¦»åæ‰§è¡Œç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå°±æ˜¯æ‰€è°“çš„â€œå®¹å™¨é•œåƒâ€ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„åå­—ï¼Œ</span><br><span class="line">å«ä½œï¼šrootfsï¼ˆæ ¹æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">å®¹å™¨çš„rootfsç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œ1ï¼šåªè¯»å±‚ã€2ï¼šå¯è¯»å†™å±‚ã€3ï¼šinitå±‚</span><br><span class="line">1.åªè¯»å±‚:éƒ½ä»¥å¢é‡çš„æ–¹å¼åˆ†åˆ«åŒ…å«äº†  æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</span><br><span class="line"></span><br><span class="line">2.å¯è¯»å†™ï¼šå°±æ˜¯ä¸“é—¨ç”¨æ¥å­˜æ”¾ä½ ä¿®æ”¹ rootfs åäº§ç”Ÿçš„å¢é‡ï¼Œæ— è®ºæ˜¯å¢ã€åˆ ã€æ”¹ï¼Œéƒ½å‘ç”Ÿåœ¨è¿™é‡Œã€‚è€Œå½“æˆ‘ä»¬ä½¿ç”¨å®Œäº†è¿™ä¸ªè¢«ä¿®æ”¹è¿‡çš„å®¹å™¨ä¹‹åï¼Œ</span><br><span class="line">è¿˜å¯ä»¥ä½¿ç”¨ docker commit å’Œ push æŒ‡ä»¤ï¼Œä¿å­˜è¿™ä¸ªè¢«ä¿®æ”¹è¿‡çš„å¯è¯»å†™å±‚ï¼Œå¹¶ä¸Šä¼ åˆ° Docker Hub ä¸Šï¼Œä¾›å…¶ä»–äººä½¿ç”¨ï¼›è€Œä¸æ­¤åŒæ—¶ï¼ŒåŸå…ˆçš„</span><br><span class="line">åªè¯»å±‚é‡Œçš„å†…å®¹åˆ™ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ã€‚è¿™å°±æ˜¯å¢é‡ rootfs çš„å¥½å¤„ã€‚</span><br><span class="line"></span><br><span class="line">3.Init å±‚ï¼šæ˜¯ Docker é¡¹ç›®å•ç‹¬ç”Ÿæˆçš„ä¸€ä¸ªå†…éƒ¨å±‚ï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾ /etc/hostsã€/etc/resolv.conf ç­‰ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="è®¤è¯†kubernetes">è®¤è¯†kubernetes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Kubernetes æ˜¯ä¸€ä¸ªå¯ç§»æ¤ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œç”¨äºç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œæ–¹ä¾¿è¿›è¡Œå£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–ã€‚å¯ä»¥è‡ªåŠ¨éƒ¨ç½²</span><br><span class="line">(automating deployments)ï¼Œä¼¸ç¼©(scaling)å’Œè¿ç»´å®¹å™¨åŒ–åº”ç”¨(operations of application containers)çš„å¼€æºå¹³å°ã€‚ä»¥ä¸‹</span><br><span class="line">ç®€ç§°k8s</span><br><span class="line">  </span><br><span class="line">k8så‚è€ƒç½‘ç«™</span><br><span class="line">`k8så®˜æ–¹`: https://kubernetes.io/zh-cn/docs/home/</span><br><span class="line">`é˜¿é‡Œäº‘k8s-ACK`ï¼šhttps://www.aliyun.com/product/kubernetes</span><br><span class="line">`äºšé©¬é€Šk8s-EKS`ï¼šhttps://aws.amazon.com/cn/eks/?nc2=h_ql_prod_ct_eks</span><br><span class="line">`ä½¿ç”¨ansibleä¸€é”®éƒ¨ç½²k8s`ï¼šhttps://github.com/easzlab/kubeasz</span><br></pre></td></tr></table></figure><h2 id="k8sç»„ä»¶">k8sç»„ä»¶</h2><p><img src="https://cos.lukme.top/Pic/components-of-kubernetes-1726291732343-3.svg" alt="components-of-kubernetes"></p><p><strong>æ ¸å¿ƒç»„ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰  masterèŠ‚ç‚¹</span><br><span class="line">2.æ§åˆ¶å®¹å™¨è¿è¡Œæ—¶ï¼ˆdockerï¼‰å¯åŠ¨æŒ‡å®šçš„å®¹å™¨      nodeèŠ‚ç‚¹</span><br></pre></td></tr></table></figure><p><strong>k8så„ä¸ªç»„ä»¶åŠŸèƒ½è¯´æ˜</strong></p><h3 id="1-UI-CLI">(1)UI,CLI</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç»Ÿç§°APIç”¨äºå‘é€è¯·æ±‚ç»™Kubernetesï¼ˆK8Sï¼‰é›†ç¾¤ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">## K8Sä¸‰å¤§æ¥å£APIäºŒæ¬¡å¼€å‘ï¼Œè°ƒç”¨æ¥å£</span></span><br><span class="line">CRIï¼šruntimeï¼Œå®¹å™¨æ“ä½œæ¥å£</span><br><span class="line">CNIï¼šnetworkï¼Œç½‘ç»œæ“ä½œæ¥å£</span><br><span class="line">CSIï¼šstorageï¼Œå­˜å‚¨æ“ä½œæ¥å£</span><br></pre></td></tr></table></figure><h3 id="2-Kubernetes-Master">(2)Kubernetes Master</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„å‘æ¥çš„è¯·æ±‚ï¼Œæ ¹æ®éœ€æ±‚è°ƒåº¦åç«¯èŠ‚ç‚¹è¿è¡Œä»»åŠ¡,å°±æ˜¯<span class="string">&#x27;è€æ¿&#x27;</span>å­˜åœ¨ã€‚å…¶å†…éƒ¨æ ¸å¿ƒç»„ä»¶åˆ†ä¸ºï¼š</span><br><span class="line">1.`API Server`(K8Så†…ç½®ç»„ä»¶) <span class="string">&#x27;ç§˜ä¹¦&#x27;</span></span><br><span class="line">      æä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶;</span><br><span class="line">      æä¾›APIæœåŠ¡çš„ç»„ä»¶ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œæ˜¯Kubernetesé›†ç¾¤çš„å”¯ä¸€å…¥å£ï¼ˆæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯å†…éƒ¨ç»„ä»¶éƒ½å¿…é¡»é€šè¿‡å®ƒæ¥è®¿</span><br><span class="line">      é—®);å®ƒæä¾›åŸºäºhttps(RESTfulé£æ ¼)å’Œrpcåè®®(grpcæ˜¯æ®è¯´æ˜¯å°†æ¥è¦å–ä»£Httpsçš„RESTfulé£æ ¼)æ¥æä¾›æœåŠ¡çš„ã€‚å®ƒç”¨æ¥å¤„ç†</span><br><span class="line">      å®¢æˆ·ç«¯ä¼ æ¥çš„JSONæ ¼å¼çš„è¯·æ±‚æ•°æ®è€ŒéHTMLæ ¼å¼å“Ÿã€‚å®ƒä¹Ÿæ˜¯K8Sé›†ç¾¤å”¯ä¸€èƒ½æ“ä½œetcdçš„ç»„ä»¶</span><br><span class="line">     </span><br><span class="line">  2.`Scheduler`ï¼ˆK8Så†…ç½®ç»„ä»¶ï¼‰  <span class="string">&#x27;äººäº‹&#x27;</span></span><br><span class="line">      è´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Š;</span><br><span class="line">      æ¯”å¦‚å®¢æˆ·ç«¯é€šè¿‡API Serveræäº¤äº†ä¸€ä¸ªæ–°å¢å®¹å™¨çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¿å­˜åœ¨etcdä¸­ï¼Œetcdé€šè¿‡API Serveré€šçŸ¥Schedulerï¼Œ</span><br><span class="line">      Scheduleræ¥æ”¶åˆ°é€šçŸ¥åä¼šåœ¨ç®¡ç†çš„èµ„æºä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä½³è¿è¡Œçš„èŠ‚ç‚¹å»åˆ›å»ºå®¹å™¨;è¯¥æŒ‡ä»¤ä¾æ—§å­˜æ”¾åœ¨etcdä¸­ï¼ˆSchedulerä¸èƒ½ç›´</span><br><span class="line">      æ¥è®¿é—®etcdï¼Œè€Œæ˜¯é€šè¿‡API Serveré—´æ¥è®¿é—®etcdï¼‰ã€‚</span><br><span class="line">      </span><br><span class="line">   3.`Controller manager`(K8Så†…ç½®ç»„ä»¶)</span><br><span class="line">       è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼›</span><br><span class="line">       è¯¥ç»„ä»¶ä¼šwatch Api Serverç»„ä»¶ç”¨äºç®¡ç†K8Sé›†ç¾¤çš„ç»„ä»¶ï¼Œç¡®ä¿æˆ‘ä»¬æ‰€åˆ›å»ºçš„å®¹å™¨èƒ½å¤ŸæŒ‰ç…§æœŸæœ›çš„çŠ¶æ€è¿è¡Œçš„æ ¸å¿ƒç»„ä»¶</span><br><span class="line">       (æ¯”å¦‚ï¼šç›‘æ§é›†ç¾¤çš„æ‰€æœ‰å®¹å™¨è¿è¡Œï¼Œå½“æŸä¸ªå®¹å™¨æŒ‚æ‰åå®ƒå¯ä»¥è¿…é€Ÿåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹å¯åŠ¨)ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥è¯´</span><br><span class="line">       Controller manageræ˜¯K8sçš„å¤§è„‘ã€‚</span><br><span class="line">       </span><br><span class="line">    4.`etcd`(å¹¶ä¸æ˜¯K8Så†…ç½®ç»„ä»¶,ç”±CoreOSç ”å‘,è¢«RedHatæ”¶è´­ï¼Œæœ€ç»ˆåˆè¢«IBMå…¬å¸æ”¶è´­)</span><br><span class="line">      etcdåªèƒ½è¢«API Serverç›´æ¥è®¿é—®ã€‚æ˜¯æ•´ä¸ªé›†ç¾¤çš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨K8Sè¯·æ±‚æ•°æ®æ‰€æœ‰çš„æ•°æ®ã€‚ä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼›</span><br><span class="line">    etcdåŸºäºraftåè®®ä½¿ç”¨Golangè¯­è¨€å¼€å‘çš„åˆ†å¸ƒå¼å¼ºä¸€è‡´çš„é”®å€¼å¯¹ï¼ˆkey/valueï¼‰æ•°æ®åº“å­˜å‚¨ç³»ç»Ÿã€‚å­˜å‚¨æ–¹å¼å’Œrediså¾ˆåƒï¼Œ</span><br><span class="line">    ä½†æ˜¯åŠŸèƒ½å´æ¯”redisè¦å¼ºå¤§ï¼Œå› ä¸ºå®ƒæ”¯æŒæ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œä¹Ÿæ”¯æŒleaderé€‰ä¸¾ç­‰å„ç§åˆ†å¸ƒå¼ååŒåŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kube-apiserver(apiserver)ï¼š#æ‰€æœ‰Masterä¸Šçš„ç»„ä»¶å·¥ä½œéƒ½è¦ç»è¿‡apiserver</span><br><span class="line">etcdï¼š                     <span class="comment">#å­˜å‚¨æ‰€æœ‰å‘½ä»¤ã€èµ„æºæ¸…å•ã€webUIæ“ä½œåŠå…¶ä»–ç»„ä»¶æ•°æ®</span></span><br><span class="line">kube-scheduler(scheduler)ï¼š#èµ„æºè®¡ç®—ã€èµ„æºè°ƒåº¦</span><br><span class="line">kube-controller-manager(controller)ï¼š#ç»´æŠ¤é›†ç¾¤çŠ¶æ€</span><br><span class="line"></span><br><span class="line">`å½“æŸä¸ªNodeæ„å¤–å®•æœºæ—¶ï¼ŒController Managerä¼šåŠæ—¶å‘ç°å¹¶æ‰§è¡Œè‡ªåŠ¨åŒ–ä¿®å¤æµç¨‹ï¼Œç¡®ä¿é›†ç¾¤å§‹ç»ˆå¤„äºé¢„æœŸçš„å·¥ä½œçŠ¶æ€`</span><br></pre></td></tr></table></figure><h3 id="3-Kubernetes-Node">(3)Kubernetes Node</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">åŠŸèƒ½ä¸Šæœ‰ç‚¹ç±»ä¼¼äºHadoopä¸­çš„DataNodeèŠ‚ç‚¹,è¢«Kubernetesè°ƒåº¦çš„ï¼Œå³è´Ÿè´£çœŸæ­£å¹²æ´»çš„èŠ‚ç‚¹ï¼ˆè¿è¡Œå®¹å™¨ï¼‰ã€‚å…¶å†…éƒ¨æ ¸å¿ƒç»„ä»¶åˆ†ä¸ºï¼š</span><br><span class="line">1.`kubelet`</span><br><span class="line">    è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†;</span><br><span class="line">    è¯¥ç»„ä»¶ä¹Ÿä¼šwatch Api Serverç»„ä»¶ï¼Œå³å®æ—¶æŸ¥çœ‹å…³äºå½“å‰èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œä»è€Œå»æ‰§è¡Œåˆ›å»ºæˆ–åˆ é™¤å®¹å™¨çš„ä»»åŠ¡</span><br><span class="line">    (ä»¥Dockerä¸ºä¾‹ï¼Œåˆ›å»ºå®¹å™¨æ—¶å°±ä¼šè°ƒç”¨dockerçš„APIå»Image Registryå»ä¸‹è½½ç›¸åº”çš„å®¹å™¨å¹¶å¯åŠ¨)ã€‚</span><br><span class="line">2.`Container runtime `</span><br><span class="line">    è´Ÿè´£é•œåƒç®¡ç†ä»¥åŠPodå’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰ï¼›</span><br><span class="line">3.`kube-proxy`   <span class="string">&#x27;ç›‘å·¥&#x27;</span></span><br><span class="line">    è´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼›</span><br><span class="line">    kube-proxyè¯´ç™½äº†ä¹Ÿæ˜¯API Serverçš„å®¢æˆ·ç«¯,å®ƒå®æ—¶ç›‘è§†(watch)ç€API Serverä¸Šçš„èµ„æºå˜åŠ¨(å°¤å…¶æ˜¯serviceèµ„æºå˜åŠ¨),</span><br><span class="line">    å®ƒä¼šæŠŠæ¯ä¸ªserviceèµ„æºå˜åŠ¨åœ¨ç›¸åº”èŠ‚ç‚¹ä¸Šå®šä¹‰ä¸ºå¯¹å¤–æš´éœ²ç›¸å…³è§„åˆ™(iptableæˆ–è€…ipvs)ï¼Œæ¯”å¦‚å¯¹å¤–æš´éœ²å¤–ç½‘æ˜ å°„ä¹‹ç±»çš„ã€‚</span><br><span class="line"></span><br><span class="line">4.Pod   <span class="string">&#x27;Podæ˜¯K8Sçš„æœ€å°å•ä½&#x27;</span></span><br><span class="line">è™½ç„¶æˆ‘ä»¬è¯´Kubernetesæ˜¯å®¹å™¨ç¼–æ’ç³»ç»Ÿ,ä½†æ˜¯ä¸å¾—ä¸è¯´åœ¨K8Sä¹‹ä¸Šå¹¶ä¸ä¼šç›´æ¥è¿è¡Œå®¹å™¨,æ¯ä¸ªå®¹å™¨åœ¨K8Sä¸­éƒ½è¢«é‡æ–°å°è£…æˆpod,è¯´</span><br><span class="line">ç™½äº†podå°±æ˜¯å®¹å™¨çš„å¤–å£³,ä½†éœ€è¦æ³¨æ„çš„æ˜¯ä¸€ä¸ªpodæ˜¯å¯ä»¥å­˜åœ¨å¤šä¸ªå®¹å™¨çš„ã€‚æ¯ä¸ªpodè¢«K8Så½“ä½œä¸€ä¸ªåŸå­å•å…ƒè¿›è¡Œç®¡ç†;ä¸€ä¸ªpodä¸­</span><br><span class="line">æœ‰å¤šä¸ªå®¹å™¨ï¼Œè¿™ä¸ªpodé‡Œé¢çš„æ‰€æœ‰å®¹å™¨åªèƒ½è¢«è°ƒåº¦åˆ°ä¸€å°èŠ‚ç‚¹å»æ‰§è¡Œï¼Œä¸èƒ½å°†åŒä¸€ä¸ªpodé‡Œé¢çš„å¤šä¸ªå®¹å™¨æ‹†åˆ†åˆ°ä¸åŒçš„Nodeè¿è¡Œ;</span><br><span class="line"></span><br><span class="line">1ã€Podæ˜¯K8Sçš„æœ€å°å•ä½</span><br><span class="line">2ã€Podçš„IPåœ°å€æ˜¯éšæœºçš„ï¼Œåˆ é™¤Podä¼šæ”¹å˜IP</span><br><span class="line">3ã€Podéƒ½æœ‰ä¸€ä¸ªæ ¹å®¹å™¨ï¼ˆä¸€ä¸ªpodè‡³å°‘æœ‰ä¸€ä¸ªæ ¹å®¹å™¨ï¼‰</span><br><span class="line">4ã€ä¸€ä¸ªPodå†…å¯ä»¥ç”±ä¸€ä¸ªå®¹å™¨æˆ–å¤šä¸ªå®¹å™¨ç»„æˆ</span><br><span class="line">5ã€ä¸€ä¸ªPodå†…çš„å®¹å™¨å…±äº«æ ¹å®¹å™¨çš„ç½‘ç»œã€åç§°ç©ºé—´ã€å’Œæ–‡ä»¶ç³»ç»Ÿå·</span><br><span class="line">6ã€ä¸€ä¸ªPodå†…çš„ç½‘ç»œåœ°å€ç”±æ ¹å®¹å™¨æä¾›</span><br><span class="line"></span><br><span class="line">5.`Fluentd`</span><br><span class="line">    å¦‚Fluentd-elasticsearchæä¾›é›†ç¾¤æ—¥å¿—é‡‡é›†ã€å­˜å‚¨ä¸æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">6.`Image Registry`</span><br><span class="line">    å­˜æ”¾é•œåƒæ–‡ä»¶çš„ä»“åº“ï¼Œå¹¶ä¸ç›´æ¥è¢«Kubernetesé›†ç¾¤ç®¡ç†ï¼Œå³å¹¶ä¸ç®—k8såŸç”Ÿç»„æˆéƒ¨åˆ†ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šè‡ªå»ºç§æœ‰çš„é•œåƒä»“åº“ï¼Œ</span><br><span class="line">    æ¯”å¦‚ä½¿ç”¨Harboréƒ¨ç½²httpsé«˜å¯ç”¨çš„é•œåƒä»“åº“</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubeletï¼šæ§åˆ¶å®¹å™¨è¿è¡Œæ—¶ï¼ˆdockerï¼‰å¯åŠ¨æŒ‡å®šçš„å®¹å™¨</span><br><span class="line">å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer runtimeï¼‰ï¼šdocker</span><br><span class="line">  - containerd</span><br><span class="line">  - CRI-O</span><br><span class="line">  - Docker Engine</span><br><span class="line">  - Mirantis Container Runtime</span><br><span class="line">kube-proxyï¼šPODç«¯å£æ˜ å°„ï¼Œç½‘ç»œç›¸å…³</span><br></pre></td></tr></table></figure><h3 id="PODè¿è¡ŒçŠ¶æ€">PODè¿è¡ŒçŠ¶æ€</h3><table><thead><tr><th>çŠ¶æ€</th><th>æè¿°</th></tr></thead><tbody><tr><td>Pendingï¼ˆç­‰å¾…ï¼‰</td><td>Podå·²ç»è¢«K8Sç³»ç»Ÿæ¥å—ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œå°šæœªåˆ›å»ºï¼Œäº¦æœªè¿è¡Œã€‚æ­¤é˜¶æ®µåŒ…æ‹¬ç­‰å¾…Podè¢«è°ƒåº¦çš„æ—¶é—´å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒçš„æ—¶é—´</td></tr><tr><td>Runningï¼ˆè¿è¡Œï¼‰</td><td>Podå·²ç»ç»‘å®šåˆ°æŸä¸ªèŠ‚ç‚¹(node)ï¼ŒPodä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²è¢«åˆ›å»ºï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»åœ¨è¿è¡Œï¼Œæˆ–è€…å¤„äºå¯åŠ¨æˆ–é‡å¯çŠ¶æ€</td></tr><tr><td>Succeededï¼ˆæˆåŠŸï¼‰</td><td>Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†é‡å¯</td></tr><tr><td>Failedï¼ˆå¤±è´¥ï¼‰</td><td>Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯å› ä¸ºå¤±è´¥è€Œç»ˆæ­¢</td></tr><tr><td>Unknownï¼ˆæœªçŸ¥ï¼‰</td><td>å› ä¸ºæŸäº›åŸå› æ— æ³•è·å–PodçŠ¶æ€ï¼Œè¿™ç§æƒ…å†µï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸Podæ‰€åœ¨ä¸»æœºé€šä¿¡å¤±è´¥</td></tr></tbody></table><h2 id="k8sç½‘ç»œ">k8sç½‘ç»œ</h2><blockquote><p>Serviceä¹Ÿæ˜¯K8Sæ ¸å¿ƒèµ„æºä¹‹ä¸€ï¼ŒServiceå®šä¹‰äº†æœåŠ¡çš„å…¥å£åœ°å€ï¼Œç”¨æ¥å°†åç«¯çš„PodæœåŠ¡æš´éœ²ç»™å¤–éƒ¨çš„ç”¨æˆ· è®¿é—®ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kubernetesçš„ç½‘ç»œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»:</span><br><span class="line">  1.èŠ‚ç‚¹ç½‘ç»œ:</span><br><span class="line">      ä¸»è¦æ˜¯æŒ‡`Master`å’Œå„ä¸ª`Node`ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ç½‘ç»œåœ°å€æ®µã€‚</span><br><span class="line">ã€€2.podç½‘ç»œ:</span><br><span class="line">ã€€ã€€ã€€ã€€å› ä¸ºæ¯ä¸ªpodçš„<span class="string">&#x27;åŠ¨æ€IPåœ°å€&#x27;</span>ï¼Œæ‰€ä»¥æ¯ä¸ªpodå¹¶ä¸çŸ¥é“æƒ³è¦è®¿é—®çš„ç›®çš„podçš„IPåœ°å€ï¼Œå®ƒä»¬å¦‚æœæƒ³è¦è®¿é—®ç›®çš„podéœ€è¦ç»è¿‡ä¸€</span><br><span class="line">ã€€ã€€ã€€ã€€ä¸ª<span class="string">&#x27;service&#x27;</span>å±‚ã€‚è¿™ä¸ªserviceæœ‰å¯¹æ¯ä¸ªpodçš„æ‰“äº†<span class="string">&#x27;æ ‡ç­¾&#x27;</span>ï¼Œå½“ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„podæƒ³è¦è®¿é—®å¦å¤–ä¸€ä¸ªpodå¿…é¡»å¾—è¿‡</span><br><span class="line">ã€€ã€€ã€€ã€€<span class="string">&#x27;serviceç½‘ç»œ&#x27;</span>ï¼Œserviceç½‘ç»œä¿å­˜ç€<span class="string">&#x27;æ ‡ç­¾é€‰æ‹©å™¨&#x27;</span>ï¼Œå¯ä»¥è¿…é€ŸåŒ¹é…åˆ°podæƒ³è¦èŒƒå›´å¦ä¸€ä¸ªpodçš„çœŸå®IPåœ°å€ï¼Œå½“podæ‹¿åˆ°</span><br><span class="line">ã€€ã€€ã€€ã€€IPåœ°å€åå°±å¯ä»¥è‡ªè¡Œè¿›è¡Œé€šä¿¡è¯·æ±‚äº†ã€‚</span><br><span class="line">  3.serviceç½‘ç»œ:</span><br><span class="line">ã€€ã€€ã€€ä¸»è¦æ˜¯ä¸ºpodæä¾›ä¸€ä¸ª<span class="string">&#x27;æ ‡ç­¾é€‰æ‹©å™¨&#x27;</span>çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¸®åŠ©ä¸€ä¸ªpodå»æŸ¥è¯¢è®¿é—®å¦å¤–ä¸€ä¸ªpodçš„labelå¯¹åº”çš„çœŸå®IPåœ°å€ã€‚è€Œ</span><br><span class="line">ã€€ã€€ã€€seviceç½‘ç»œåœ¨kubernetes1.11.xç‰ˆæœ¬ä¹‹å‰é»˜è®¤ä½¿ç”¨iptableå®ç°çš„ï¼Œåœ¨kubernetes 1.11.xç‰ˆæœ¬ä¹‹åå¼•å…¥äº†ipvså®ç°ã€‚</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;å„ä¸ªpodä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹æ¦‚è¦&#x27;</span>:</span><br><span class="line">      æ¯ä¸ªpodéƒ½æœ‰è¢«åŠ¨æ€åˆ†é…çš„IPåœ°å€ï¼Œå¦‚æœæƒ³è¦å’Œå¦å¤–ä¸€ä¸ªpodè¿›è¡Œé€šä¿¡ï¼Œå„ä¸ªpodéœ€è¦å…ˆå’Œserviceç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œæœ€ç»ˆæ‹¿åˆ°</span><br><span class="line">      å¦ä¸€ä¸ªæƒ³è¦è®¿é—®podçš„åŠ¨æ€IPåœ°å€è¿›è¡Œé€šä¿¡ã€‚</span><br></pre></td></tr></table></figure><h3 id="Serviceæä¾›äº†ä¸¤ç§ç½‘ç»œèµ„æº">Serviceæä¾›äº†ä¸¤ç§ç½‘ç»œèµ„æº</h3><p><img src="https://cos.lukme.top/Pic/image-20240916151114679.png" alt="image-20240916151114679"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NodePortï¼šå®¿ä¸»æœºç«¯å£æ˜ å°„ClusterIPç«¯å£å¯¹å¤–æä¾›æœåŠ¡</span><br><span class="line"></span><br><span class="line">ClusterIPï¼šPODçš„è´Ÿè½½å‡è¡¡</span><br><span class="line">é—®é¢˜ï¼šPODçš„IPæ˜¯éšæœºçš„ï¼Œå¦‚æœä¸€ä¸ªPODå®•æœºäº†ï¼ŒK8Sä¼šè‡ªåŠ¨æ‹‰èµ·ä¸€ä¸ªæ–°çš„PODï¼ŒIPå˜åŒ–äº†å¦‚ä½•åŠ å…¥åˆ°</span><br><span class="line">ClusterIPè¿™ä¸ªè´Ÿè½½å‡è¡¡é›†ç¾¤ä¸­ï¼Ÿ</span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨DNSè§£æPODçš„IPåˆ°ä¸€ä¸ª<span class="string">&quot;å­—ç¬¦ä¸²ä¸Š&quot;</span>ï¼ˆæ ‡ç­¾ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DNSï¼š</span><br><span class="line">- coreDNS</span><br><span class="line">- bind9</span><br><span class="line">- dnsmsq</span><br></pre></td></tr></table></figure><h2 id="Labelæ ‡ç­¾">Labelæ ‡ç­¾</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`Labelæ ‡ç­¾`æ˜¯K8Sä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªå±æ€§ï¼ŒLabelæ ‡ç­¾å°±åƒèº«ä»½è¯ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥è¯†åˆ«K8Sçš„å¯¹è±¡ã€‚</span><br><span class="line">ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œä¸åŒçš„æœåŠ¡åº”ç”¨ä¹‹é—´é€šè®¯ï¼Œéƒ½æ˜¯é€šè¿‡IPå’Œç«¯å£ï¼Œä½†æ˜¯åœ¨K8Sä¸­å¾ˆå¤šåŒ¹é…å…³ç³»éƒ½æ˜¯é€šè¿‡æ ‡ç­¾æ¥æ‰¾ã€‚</span><br></pre></td></tr></table></figure><p><strong>Controllerèµ„æºï¼ˆæ§åˆ¶å™¨èµ„æºï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Controllerç”¨æ¥ç®¡ç†Podã€‚</span></span><br><span class="line"><span class="comment">## Podæ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼š</span></span><br><span class="line">- RC Replication Controller æ§åˆ¶Podæœ‰å¤šä¸ªå‰¯æœ¬</span><br><span class="line">- RS ReplicaSet RCæ§åˆ¶å™¨çš„å‡çº§ç‰ˆï¼Œå¯ä»¥è‡ªåŠ¨æ‹‰èµ·å®•æœºçš„POD</span><br><span class="line">- Deployment æ¨èä½¿ç”¨ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ŒåŒ…å«äº†RSæ§åˆ¶å™¨ï¼Œå¯¹é•œåƒåšç‰ˆæœ¬ç®¡ç†</span><br><span class="line">- DaemonSet ä¿è¯æ‰€æœ‰çš„NodeèŠ‚ç‚¹ä¸Šï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªPodè¿è¡Œ</span><br><span class="line">- StatefulSet æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œä¸ºPodæä¾›å”¯ä¸€æ ‡è¯†ï¼Œå®ƒå¯ä»¥ä¿è¯éƒ¨ç½²å’Œscaleçš„é¡ºåº</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºä¸€ä¸ªpodæµç¨‹">åˆ›å»ºä¸€ä¸ªpodæµç¨‹</h2><p><img src="https://cos.lukme.top/Pic/create-pod.png" alt="create-pod"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">`ç¬¬ä¸€æ­¥ï¼š`</span><br><span class="line">    ç”¨æˆ·é€šè¿‡kubectlç­‰æ¥å£æäº¤åˆ›å»ºPodçš„yamlæ–‡ä»¶ï¼Œå‘Kubernetesç³»ç»Ÿå‘èµ·èµ„æºè¯·æ±‚</span><br><span class="line">`ç¬¬äºŒæ­¥ï¼š`</span><br><span class="line">    Api-serveræ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚ä¹‹åï¼Œä¼šåšå‡ºç›¸åº”çš„è®¤è¯ï¼Œç„¶åæ£€æŸ¥ä¿¡æ¯å¹¶ä¸”å°†å…ƒæ•°æ®ä¿¡æ¯å­˜å‚¨åˆ°etcdä¸­ï¼Œåˆ›å»ºPodèµ„æºåˆå§‹åŒ–ï¼Œ</span><br><span class="line">    è¿™æ˜¯ç¬¬ä¸€æ¬¡å†™etcdåŠ¨ä½œ</span><br><span class="line">`ç¬¬ä¸‰æ­¥ï¼š`</span><br><span class="line">    Scheduleré€šè¿‡list-watchçš„ç›‘å¬æœºåˆ¶ï¼ŒæŸ¥çœ‹è¦åˆ›å»ºPodèµ„æºï¼ŒAPIServerä¼šç«‹å³æŠŠåˆ›å»ºPodçš„æ¶ˆæ¯é€šçŸ¥Schedulerï¼Œ</span><br><span class="line">    Schedulerå‘ç°Podçš„å±æ€§ä¸­Dest Nodeä¸ºç©ºæ—¶ï¼ˆDest Node=â€â€ï¼‰ï¼Œä¾¿ä¼šç«‹å³è§¦å‘è°ƒåº¦æµç¨‹è¿›è¡Œè°ƒåº¦,è€Œè°ƒåº¦æµç¨‹åˆ†ä¸º</span><br><span class="line">    ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œå¦‚ä¸‹å›¾</span><br></pre></td></tr></table></figure><blockquote><p>â€Œ<strong>kube-controller-manager</strong>â€Œï¼šè™½ç„¶ä¸ç›´æ¥å‚ä¸Podçš„åˆ›å»ºï¼Œä½†å…¶å†…éƒ¨çš„æ§åˆ¶å™¨ï¼ˆå¦‚ReplicaSet Controllerï¼‰è´Ÿè´£ç¡®ä¿Podçš„æ•°é‡ä¸é¢„æœŸä¸€è‡´ï¼Œç»´æŠ¤é›†ç¾¤çŠ¶æ€</p></blockquote><p><img src="https://cos.lukme.top/Pic/scheduler.jpeg" alt="scheduler"></p><blockquote><p>â€‹    é¦–å…ˆæ˜¯kube-schedulerè°ƒåº¦å™¨ç”¨ä¸€ç»„è§„åˆ™è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºpredicateï¼Œæ¯”å¦‚æ˜ç¡®æŒ‡å®šæ‰€éœ€è¦çš„èµ„æºç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„ä¸»æœº</p></blockquote><blockquote><p>â€‹    å…¶æ¬¡ï¼Œå¯¹ç¬¬ä¸€æ­¥ç­›é€‰å‡ºçš„ç¬¦åˆè¦æ±‚çš„ä¸»æœºè¿›è¡Œæ‰“åˆ†ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º priorityï¼Œåœ¨æ­¤é˜¶æ®µï¼Œå¦‚æœåœ¨ predicateè¿‡ç¨‹ä¸­æ²¡æœ‰åˆé€‚çš„èŠ‚ç‚¹ï¼ŒPod ä¼šä¸€ç›´å¤„äºpendingçŠ¶æ€ï¼Œä¸æ–­é‡è¯•è°ƒåº¦ï¼Œç›´åˆ°æœ‰èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶ã€‚</p></blockquote><blockquote><p><strong>é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹</strong>ï¼šé€‰æ‹©å¾—åˆ†æœ€é«˜çš„ä¸»æœºï¼Œè¿›è¡Œbindingæ“ä½œï¼Œç»“æœå­˜å‚¨åˆ°Etcdä¸­</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬å››æ­¥ï¼š</span><br><span class="line">    kubeletæ ¹æ®è°ƒåº¦ç»“æœæ‰§è¡ŒPodåˆ›å»ºæ“ä½œï¼Œç»‘å®šæˆåŠŸåï¼Œä¼šå¯åŠ¨å®¹å™¨è¿è¡Œæ—¶ï¼Œcontainer, docker run, schedulerä¼šè°ƒç”¨API</span><br><span class="line">    Serverçš„APIåœ¨etcdä¸­åˆ›å»ºä¸€ä¸ªbound Podå¯¹è±¡ï¼Œå®ƒæè¿°åœ¨ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šç»‘å®šè¿è¡Œçš„æ‰€æœ‰podä¿¡æ¯ï¼›</span><br><span class="line">    è¿è¡Œåœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šçš„kubeletä¹Ÿä¼šå®šæœŸä¸api-serveråŒæ­¥bound Podçš„ä¿¡æ¯ï¼Œä¸€æ—¦å‘ç°åœ¨è¯¥å·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œçš„bound Podå¯¹</span><br><span class="line">    è±¡æ²¡æœ‰æ›´æ–°ï¼Œåˆ™è°ƒç”¨Docker APIåˆ›å»ºå¹¶å¯åŠ¨podå†…çš„å®¹å™¨.</span><br><span class="line">    </span><br><span class="line">ç¬¬äº”æ­¥ï¼š</span><br><span class="line">  kube-proxyä¸ºæ–°åˆ›å»ºçš„podæ³¨å†ŒåŠ¨æ€DNSåˆ°CoreOSï¼Œç„¶åç»™podçš„serviceæ·»åŠ å¯¹åº”çš„iptablesè§„åˆ™ï¼Œç”¨äºæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ç®€å•ä»‹ç»å®¹å™¨ä»¥åŠk8sç»„ä»¶</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>æµ‹è¯•</title>
    <link href="https://lukme.top/posts/f007732d.html"/>
    <id>https://lukme.top/posts/f007732d.html</id>
    <published>2024-08-31T07:14:31.000Z</published>
    <updated>2024-10-06T14:12:50.136Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="ecc3b8954083c1c4265f5015a12da6fbb721d2f64e54cb4de0c849c9e0fa5522">410fa1838f124ea5ac656ff0dc0984fe803b0ea256dee1747636e7202b54e50bc0f348c1ccb15117cfff7489ca9aa16b9c8851a676b3b1774a5bbf06642da29ab4b9b3e3e1d1fd4fb9549f78a57d96664c778fdf004120aa7b399f87f7747df41970b977717da4c4f44d231a4e2d8d879f59f597df7ffcd69a79fab9d415114c69101e69ffed2d1d477cf3a510e54c169bfc0a2ac8338cf3f73f80f748c2e675fb763e7a8195374937a79224937b91e735d9db3124fc2ff3d1678b79b65425f5c1184fc8ae257b540b3b5b194d64f244e7901755e3d5425cd53f8fce7f44b149d4e912e50e15cce9cc32c8e2738da301dd3b40b37bdb67090cae58b844a1244610d9231fc73a206658d0a11232753e0466b02b9e7e8ed714cb8e1b925b0c54b3a4e430b2673c8aa7b7881e2c556dcf2dfbface77f1ac51bdc0d1a646b025df8373cced878d78fc8b7352f9efc5e735912e8cf403ff976c71c7a2f65e550f4014afe4a444f2d8fd245cf60963d8c5b4527feeef123ab493056c08fef3824e798846bddbc94296c8161034c6c3ab3c2b12bb608cd6a383266e306f3bb5a12878bf6a75b91d1505d953f2dcff4b7186ae01d67a80836d50f4ae7fd2dc7b9ab6fba984d67a680b53e5f22c1515330f5cde135cee6ba8b924d5bb7e38811943f50eeabea59d97c6249467717d5de787a06f3b70eaa5d787caad14b3007b35f0dfc2de931f53f3da05faa946876d490dcb9122251383adaeae10f7117ff3aaecaf6517a099f802bfb13250095c2f9247108c20d7456ff054f3e596dee7985fc2cf7e5f18fcf015f985e732386866a6b6af55d34a9580b4df3fba34daa71df61d645da140410131b4c1b46fb5735be55533e948adc6a5a402f59ab16e60f4f7b3d0c91daf129c9c483152db8894ddcf399d30698036754d93617997687790214d901e1fe12f7718093fe77c230fdbc3d18ff105f07b7f3f1c4f50d285c627eefe1a7e680b3abdd6cde4b1c9f1312d27615d90a1f0a107db176d7260a851f887c20ca2bf637e7b0c4a6d6cce03e706021df4e39691bfbb1fc3d97c2eddbfc97307f3c17ace3c3ec16eaf49baf00cbc36d071c8cbf3b5876d438667fd3067f4b8920a208ee2cf977070a7b1d3a6d4a33c7f2f192d9a241cf546f95681eae0be4fd78c9ea0752923bc6ff193cfbd6c2675c87d1520ea9e25bc10c6ce0c9a3066d42c23f3e2c3c382b873f200e897b9d29ff569db95d76f01376bf3f9f429dc2ec0172452bff1e7729fc00cbd5eedac742eae782519e3518a05125a1a9f8ffee03bcca5c0988c5afbb3595ce9ad2a205b6db654c39f9eae639bd6c4074a5f40b507ea2c312fc4830d96c9079a8ff07033872e8b0f8a690d86dfc72d787d32919c70a9c76156ec6477a6e64271c2e0d18b45a010c4af01f468959f99dab2049e1044bca8c75bac6e78876d87161d7f83023e8659b9dfb4a6f636c558563ca28fdb4229396c2fda75749a7016379a254be076ca7d4e1399280744f67e0fd476ea8d98c77b4f34bf18c499baf72f2a1f3b59918af8eb44583ea2b50d9ced14adf2b6aeab76b793b166c91276f26b7b3fe5ea9b770a8ab649658f4e3b2a5490095ba3b805323a8ed13634277676eaf499c6700c3ee719ee3ba314ac29c78c8c67f52013def0b3d5b76bd77bd3311f0bd53e4de7d6fbf22889333c11d91f71f1f5822be201d72f6e0986dd50c231fad0f22ea9e28e3bb4273445a9bbfdc6875ce34b9218c19e1c5fa3c93a96d5054c5f3fa1e1f9f13db273bd2092f453202b7c87d6369b59394ceb9f41df00d076bce9dd321b7aa45a9c35e6ea71c5af5bb5332b1469c258f4f7d48a756a785c6670b55b5115bbf52364b4ff77b361c5148ba64c10bf8d4488d945d9c6609650bcb4fdfb35ebacc080019fe52a68c9b2fb423925dfe61d652b2093ef8b3734f39b13101db3e3eabb97e4369c004d3aeb8ee36217e37b22453b67e2bccc4041d6ba80fc2fe0d2c5304cb697601658ae606b1a5fcc590d7935177478172338c7705b287cb57a0f6fda747cc49a05023a058eb4b4665e88a4753fb722f8b5f93110cc3716f6b677a95779c7a21732079bbdb179d43b066b52965384b4bb9e3ae858d253487826f2aa2dc00aed14133f5103c95741e77b911db3dc5912b5db5e7fcc1aaf9b67a96ced31100832e5afeca1b04dd9ae98086a8e6d50ecfc5398eab0ec75019157f546b3c9d7c81aba80c040ff3b38221fec370e3110eff18c093e437bbc80e7376333953b8ef82a6811d1e6f3a740674ba0e2c46b173fdfd55dc7705ec219fa88b6297afafb735813dc893419a87c95020c30529ad1a4b0de14f33fd7e9c1381f14ec25483d3c88dffa7d4b173c0d901b753b2ab34ca1fc18122102426e5252c1d616b9b220fb00934c83443d332d13a4dd43b998c0425a44bbfde6e5d8720301f005c527f0361924c26b0aec9ba6c32ba30229e60c35d649ba88b98970f83983b8e3f573c25315d32e5c33741044c9ed89ecacd7d03dc3a1ebe5862114bf286bbca404e827ea962a38ba7464811efcf74c08965905dc1b035c71a8798df3c18861ca8b93bfd08cf7afe4efe1c759d93c5188069ac4a71db55d207d267b3c61d9da5565e06f069fd6daec781b701aee904d2eb270e233fe44f4303416d58d10fcd8e9a06196a59d50e90a1a339bdeace264776e0315c1991f42a99e2184910309fcf5beb94563f9d42599ab2c7166d21d7305b93a158a0dee5838fe03165803b70463b99139ee3a6908d23735293df244a62d19322d70b333ae1c0bc3beeb51a98047241792813191270fce6fd2081588bb9df24b0d434ca37ae06b277cedc687c7691f0ff10ad567b486f3d974120fdf9e8bdcab45bd5f0f997266fa2636bbd88ee03f92df3ca4a09ac412e867e43a43ea500c4c745de84e556db03fe868b590f7e152f20de48bc63462c2879c0447ef9b63f7b013aaafe8f3a65efecd2377821545d2a4b2d5cee1351438b70d13fac03cdc70f2a675de7dc66f881d03867914ece78936c59ecad71ffb40e8a38b992506413220efece486005bacb7bf9217f076339b78b167c312a997927fbdcd02b90d94978f6b1d9f717829a486f3414eafa56485142fb31775c5207c353aa22e901d8e93a780ce930e69a51e6858a7ad97be97f76861c6a713ece6f12e1dbfda25636a416c2059724da406d767ea5f5cbf10d671cfe13788da2e8554f4de527947ede9bce0d3aff37a8bd0467f7698691ef01be47a21b2b896cfd8e81f3209b1ca64662e09dea68a6ba7c9b615b16d7cdb5a128aeffb77723a63006179d3245c6c315f22c0905dd286c2f639cc79a42f31c009f11d686ca3fcfb1d7053e042d0f306492ef241ce4a2c63f7e4b7f6f3e21faea3315599058a4d0eb475373156aade1d240078d76ec526a1fad466d2bec12161f45cda939bb55c8cc5b9b94d030ffe00e21830b5aa63eb2273ca92cf5729741ec21482205adfa6d8a3642c6cb680c7606c8b2b7cf746021c04a8afc890986fc78605b9b118a0b7552a0ca673e73a114fd2909bdac09ae0b23807b2e12e67f10d23dcd5979f95ddba0ab2e864e901866690ef53bac63de3cbac2ca3a328650e652e4878e3621332c27c53a6e067e7d5280d6c1f17b927c7d2667467f377f030462d2b78e3bd09844d17eb517281fa57c6714b58538570cbd17c39f37276fad589b934d11581bbffde9fd10112e1cd20bc0fc428b33abbe17c76876ebe18c2a8447f4a443d79c2ff5f6360acf1379adc522090d0c7fe22a8ba37d266b6daf1dd7b05c50fdddd0be5c66807bfa5b888547eb993011370611bbe89bc14525135f8c40cbc37bb61c0e83754797408cff04d84f8b44b854e2ed2c265291b1c64bb77e033cf1f68ec878d994acc015a445ea3041e8211a08908087670cd3c5f090b3d0d8dd06cdf82275e19d10c6e3a4f8ae51466a226c879e91b3805ad91c23bf9fec82bf676b26e3e554fcad72e07b9c044fd8ef2eec6d634c0f0cb67a5e037e37580470c8f043e0516471dc046d50627187f695b6fc398c2a5db4de7c669feedec0b2a420b555c55c9f4ab43b41a946f07511d85946e45336c88a5b2deacae65c38009faf3f1c865b84fea7cfb92305dc16d5713bacdd7551b395c43b6cb10575b29663d8bf24ecfff72e80b5b333c11d1ff0ab39f7b18e48f3efe702b7ad4079df6e665b5553fc3b234fdfc0c0a0cad184a8c7ebed98907e7356b5ecbd4c3ca020d3088a4c9c27a5798ba7fccf1ae3b2cd1da94df32fb6d5901eec93c26974c910a44d64b70f24eed06b3d2c8d83b854d38ec4d1864971f09b728c99439616e181dd64e3ad337d0e243520599f1bfecb20fbdaab93a1b1c7844448d0e3b70138d2b9805464ae3b613b8b9127c52b88abb925756c3d01217a5cef09e606ac6da427b07e9ac57152a916d51da9a0eee838acecc9d85c39d9585841caced81a092f9fad81345ee8081f2e50b3420f74a42ff220fc25ea931e0855ac2477174adb552b22f5b9279c0bebda036784ebed11ba49b4c13dede5eb9eb9dc2a6bbb62bda4d30db5dba806fd0aeea1f81b7659c9dbccd83f99d4d03e59610f9cb3548b9ac10c0d389a3e79b96508b4dc19057f33f78ca46376ccb5ad920e10de03811f1161ad1013b684b4ddddc37e42aa0cfe44a285a9151d5f8067e6a9ddbf715d120b0bb3e96383b9e63fca4f38534baefa674fd3963fe6e194a4c79f445a427cd232dec2791cfead71995740224f5399396ab2f470a4647f3c2ce79e78484c0b28d539c4bb7d6a9a539bb64b45b2d238b7d9805330add218ababd03ae92134b441418490bac9b584a2194b9c337a1509396ed2deff640077281bf5f54808e7cf897008b635483a93e2b425b362c9c06fdabecd95eb4e66f9764720714a4a6b5656525ef2442e351ee4ad08e77deb17fc4d6aab9860ccd30a1c2d1ee08f60763a450da93e95e5d7fbd60170410e36e67b2362ed801d8560b0b7617362c7c12083585146225f17c09a7b21382e59285a63900616600b3ccaf4f730e438fc14300f04a39876441ac1f33d6165e9c0eac49789d64f137080f9f1f2f003acb155b3f8ef493192e7eab2957e5882e68fff08a50296ca788257a6c0ba4cbb7ebc76857b1d0924b7987bb398a3265e27a932140eba74aed54e0b5818e5cb056087c9332bf7e20feb348490c17fc8064a1d86f4333c8fe4a1aea9e8e4ba7ba6c3fb150130c10ec7d0d557b20719d6c2e2f7671c6ea1864644f64d67a9c183f523bb148b97320f5d342e4f39d779c69f4d08d041606d123bc476a913980addd4a15bcee0b83f3d4121883ef129b232c56c47c9e1562ae663642126ee0c9f3c3605e647ea04068e4ae3957a2c4b5e60f1fd7ddafb4a3cd647250ab045aef827d06574378da4c76b1533445cf3f479fe8d29bde4201e53079df7dcb8dcf6686168a4f0f483242468768aa2038b0f2d422ee7a3df08274d3438f515a535c085bec67bb3f7f24446b6d2593c6e47d765cc64ed7b36789b312ed90474cee89dab7e289ef86b68e46663fc285d0449216b5c1dc12ab8319ca16360d9ec009e266d041a52b03091abee57cb3c641368c1d5b1bf98d8d8c99899ab4b4e6cc6e72497dd30203e541731f9285900e37121123f9c4b86425c1512c341cd63eeada94c499cbe055de7fdb93e6c5d90bad84557f81ac4a1a1f903dd4918a88dd061b89fb69aeb7db793297d8fd26d7c22de9f895d0100ec1dc3866ac98b82ee1660e76df98ea68334c3dc149a49f813ad4f631ae3a8f3fb243926ae03067f3e4ae6a101134d7b313b0d66729df15115bd1633d5e51c0389804675661e9504d25dfcff1afb9d4105a01136433083553f2d874c48b323b38504c165cacff4cdaa5babdb37dbd68c5a8eaa6621df36547b5b8de0282ee5c067414d54e5c5665eeb310c0a80404b9ff927f8c3774a8396f426b606c4692f1bb2a7a521d4e9131fd436893d00837e9a18fbfc8263aa370f5b4c176d578109669b1fad6962eca06302e8a1521d1d21aa9ac3c9b05b4b19ee15df976af760c5eb0bed2ca1d80bd90e1e6050c67d4d23669d1f2eb06ee7a9ff4a8e8412df8673b3645bfd4a73e0edcc395e3b6e06fdbcd467c07b91128e8a67baf12557038eef296fabedd6f358074883f3147cd3efa184e787937012daa190ee7fe2767cf4be76216584999f806dc4215c41208c1fcad35e1e03f52f651542bb3397d10e45ffe22be0b45d1ab44f82135c77578acd18ff57ef5ff1911786137e5d3142a978d80c4bc247cda2a018cd5d1af574c34b1bd8ef8aeec4a7634fd6b0eb43aa5cc03fb9015513111f61e15380f3d7e45e86af0e6a7597fa30834f59b727cc414c62fdc673241594db31b898747b3680865febd5affa0e9c649551a370dae84afd81bec3dfe374a00eaf1328635c267d10ab1fb801796acc5a45987bc902d3f0293b7341b11de851a64c5f1b6aa70d5355e5d0c5757bac9272310c51f9a8fe5e3670ab253ae2939cdb43924ff1e817443d370888439e5f5006d7be1cc96a54bb31cb7a15e8005cfe6fa001f9580bc794a056559a0667e599fcc0a4f1add41368606831e956fdef837761f05986656dd1ed17d85558b95ff85a0e45d3e54ebcfa8fbdb65e924ce8dbd408d834c1bcd8ce9a4a02dd5adcb924198cd06c1fdc5c88a4713b1f4f787b4d3f4ef8ce2d30f04b64573179a1628004edd71e7236eed62b00537729ed7a0709024b2f68504a2058edc4d4cfa4be55ad005abe3c961304f901fd31ee718dbc8d8412f1e2b0be392bdd36247e0cd71d8e8b7bed4e8e6592529f2302ecab12554b79201526e0e610990e3fb27c4d63c864fc23a8fb376673de46ac6deda65e81fe701a1fccfe0ca0e905dfcc7891ef2708f522e33b5b36d253f8309047ce052e3839b3d06ae89de818ea15e8c70c68d47e403ff8c7aa67d93cc9117bbb2816da69ad990cf2a4802f97d3566eb296a3ecbacb5a9c3887949f6bba3be36c189739ed1c1d95143335dbb87fade0165734a149c138aa4e97edfa0496b5435e19cf7dbe741b99f512bfcc823960a0908a43ea2a2f740decf9488c25bc8bdf8729b7e7bd80c4c8ab61c924a24c4c62acc5841aa362c0dddd7c1008859cbbaf967c6e0f4baecfc0d72849d58499b9c4d400c5851d002db03a25fbda5dce1fb79a7566f427d0cf2270daea1254c6ac8d0d8dab70187949762be2fcaaecb624e6df9bc069c06a2011dd31092b4b5feda0b9460659b7a05596cf710f653772f80a3ebda4e3bba5366a396c5f3a0de02455483536766f59cbe6c88645ec92ec64e16c0cbc377067787dee163de6eb006c22ffb5c0e5cbccbc9dffe847fa1993de1235b41e2808f33379df6c77159f9a538cf33b02fdf9ab033005b5ef1faa85b22ca5930de52a4208cb091c766f6b4f6559ca4aa05ffc15182d91232fe9300a2789c270306c34755b91997dd5edd07beb409e4974364107816b792ada4bea6c22de478da659f23791737a558bb5e4b5029a03cb6230534e0931e0ab7daccdf8ac4bebfdc83195e4e01fa0cec94b657064d57ceae6258a4be0b3ba58927710723b0f1630f76d54376be086232f68bc79dd5d676384ccbc5186683a974a7446bce09f08441c1223b291c8c7ede0e8fa52a92c0eb3edb3642a40527e4f1b710ac9ea6d4b0427027f4a33c360ec2f21382c31adb4b32783ce10c285716b28b91cfeaaca8328eda1730a040aa1e077a5f75b734798f0651c5569657a053382be16a9017646c64ae9e08f81456f7c0bc37d56a7d4dae502f27498801ee1d223bea85abfcf8137a17237ab97aa61929aac19c1b27fa32ca9f5291e9683c6ca5905f76d3c447bd0cfc6954a5e5b2067a79712a47e74d55b8b579ecb54fcb7b861dd26f0bd9de58f24eec6038ec9d9ab8523f743b34a40f05d8e4f95cae5139809dfef45495e6a5229d20a35031530f50d38612f427801fcbd711b7a24904b86f4335e019705cec33730d16528ae05e1f236666dfa8222dfd185362cb5931e399dfe5c4320fe5e18f97734a235e13b8dcbc15b571a1ef8b7702a56fd41e127d37a6437722d806f0f5b7fa367b324bc0a0989f39f1bd223bd9b384e60af26361781d762f15db8b11248d5f4f822f56c2bf1af72c15546e2282d77bbd4e01981392a91f0272a59034fcc29fbdda4a06388fedcaf71495cdfc63d6004e541d6a5143b9714761711220e5c36b4c2f4bdce83317e6d7e4d0a7f12f056f6cfbfaf7f3ec8612d2cad75744468e6127a1ffcba36776078e10ec01ac833a284e61af02898fbfa2cea27114569ee26400d5d500fc90bbece9f2e994268127d807558859a935a52a2007123c1e40a2582884626368292d5bc6c33736cb36a5f2f5d1cecf23145ca5521257f01e519bda467fca325463eb10e5b52c88ebcc675f1057292d354dc9d6e3602461d6cb1fc3c3da7336631f687aa78c777364828d66496451f41daae72ac38e4f641da7d26ae7f5bd7e12ae081f2b3ae6417c2373050914a3f7cf8716c224e3d8e67e06791c48d1096f0f3b46c28b14a41b1643a73f8a20df81021c91fd97406de71c57e28437e8f9a36f38f74c23b5e789150f0fab581f2c6a76277161ae644b62abaaa93e7e2aaedcbc1ca17b3f4db274c339408cefbe7bd5d9c169a7ba8ba4766dc3a4e8ffe0f94a99104bc8651bc949be1ba7734561b40140dbe8bc5c19d3a09a39636fa4f3c2f0216e85908330ce974dbcbf49b6b3fbef73b6b849b20f3e8718c4e42fc5886ade010095d628562024b70343c09d5cc5135ab74d49e9ddea747a9fefce0e6d2e128eba7a3a09ead67426cdb0c0dc27193ba118409563ca5f0b782614a61675d4b82fafb8cf3b66e71ceab757b472e6f487ec1108c0ceca1f2bfa4673141943d31ecb79f3811c1f9282c8c9f98cc48feab0949151b736c34a56045a9aba9505d6e1ba64fcd5e59ca386a25614f9a03824ef96e852e82f803d586a817626338c4f7f8296d1e4aacfce865fce6c8230618d6ae505d1fc3d08bbffc9998c748ecb8c58f3debe5282f8300e85061ba5e4a2117f266972370a8fa2c5059bca4ab90595332cff147915b661d39022d1c25b9b51d16b0c98addef8b4daae40d66c4f76ebe4e6352f58720137088374a1c07440a98acfcd2539a1c7b085fb95901a6e21d5b19a00dd6097b0a5f3bd9af82b4827b616a8750e159c4bca15b5a1a47a52a6ac493b292aed57873d31d1a808a923f8b8c0350898fe67bf7300</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">ä»…ä¸ºæµ‹è¯•æ–‡ç« </summary>
    
    
    
    
    <category term="markdown" scheme="https://lukme.top/tags/markdown/"/>
    
  </entry>
  
  <entry>
    <title>zabbixç›‘æ§phpå’Œjvm</title>
    <link href="https://lukme.top/posts/c6bfcf84.html"/>
    <id>https://lukme.top/posts/c6bfcf84.html</id>
    <published>2024-08-28T14:05:23.000Z</published>
    <updated>2024-10-06T14:26:50.820Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›‘æ§PHP">ç›‘æ§PHP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¿®æ”¹phpé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@web01 ~]# vim /etc/php-fpm.d/www.conf</span><br><span class="line">pm.status_path = /php_status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@web01 conf.d]# vim webapp.conf</span><br><span class="line">server&#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name _;</span><br><span class="line">location / &#123;</span><br><span class="line">root /code/webapp;</span><br><span class="line">index index.html;</span><br><span class="line">&#125;</span><br><span class="line">location /status &#123;</span><br><span class="line">stub_status on;</span><br><span class="line">&#125;</span><br><span class="line">location ~ ^/(php_status)$ &#123;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME</span><br><span class="line">$document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 3.é‡å¯nginxå’Œphp</span></span><br><span class="line">[root@web01 conf.d]# systemctl restart nginx php-fpm</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20240807085016358.png" alt="image-20240807085016358"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">pool: www</span><br><span class="line">process manager: dynamic</span><br><span class="line">start time: 02/Aug/2024:10:44:26 +0800</span><br><span class="line">start since: 44</span><br><span class="line">accepted conn: 1</span><br><span class="line">listen queue: 0</span><br><span class="line">max listen queue: 0</span><br><span class="line">listen queue len: 128</span><br><span class="line">idle processes: 4</span><br><span class="line">active processes: 1</span><br><span class="line">total processes: 5</span><br><span class="line">max active processes: 1</span><br><span class="line">max children reached: 0</span><br><span class="line">slow requests: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#PHP-FPMçŠ¶æ€è§£é‡Šï¼š</span></span><br><span class="line">pool <span class="comment">#fpmæ± åç§°,å¤§å¤šæ•°ä¸ºwww</span></span><br><span class="line">process manager <span class="comment">#è¿›ç¨‹ç®¡ç†æ–¹å¼dynamicæˆ–è€…static</span></span><br><span class="line">start time <span class="comment">#å¯åŠ¨æ—¥å¿—,å¦‚æœreloadäº†fpmï¼Œæ—¶é—´ä¼šæ›´æ–°</span></span><br><span class="line">start since <span class="comment">#è¿è¡Œæ—¶é—´</span></span><br><span class="line">accepted conn <span class="comment">#å½“å‰æ± æ¥å—çš„è¯·æ±‚æ•°</span></span><br><span class="line">listen queue <span class="comment">#è¯·æ±‚ç­‰å¾…é˜Ÿåˆ—,å¦‚æœè¿™ä¸ªå€¼ä¸ä¸º0,é‚£ä¹ˆéœ€è¦å¢åŠ FPMçš„è¿›ç¨‹æ•°é‡</span></span><br><span class="line">max listen queue <span class="comment">#è¯·æ±‚ç­‰å¾…é˜Ÿåˆ—æœ€é«˜çš„æ•°é‡</span></span><br><span class="line">listen queue len <span class="comment">#socketç­‰å¾…é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">idle processes <span class="comment">#ç©ºé—²è¿›ç¨‹æ•°é‡</span></span><br><span class="line">active processes <span class="comment">#æ´»è·ƒè¿›ç¨‹æ•°é‡</span></span><br><span class="line">total processes <span class="comment">#æ€»è¿›ç¨‹æ•°é‡</span></span><br><span class="line">max active processes <span class="comment">#æœ€å¤§çš„æ´»è·ƒè¿›ç¨‹æ•°é‡ï¼ˆFPMå¯åŠ¨å¼€å§‹è®¡ç®—ï¼‰</span></span><br><span class="line">max children reached <span class="comment">#ç¨‹æœ€å¤§æ•°é‡é™åˆ¶çš„æ¬¡æ•°ï¼Œå¦‚æœè¿™ä¸ªæ•°é‡ä¸ä¸º0ï¼Œé‚£è¯´æ˜ä½ çš„æœ€å¤§è¿›ç¨‹æ•°é‡è¿‡å°,å¯ä»¥é€‚å½“è°ƒæ•´ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ç›‘æ§è„šæœ¬</span></span><br><span class="line">[root@web01 scripts]# <span class="built_in">cat</span> php_status.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">PHPFPM_COMMAND=<span class="variable">$1</span></span><br><span class="line">PHPFPM_URL=<span class="string">&quot;http://172.16.1.7/php_status&quot;</span></span><br><span class="line"><span class="function"><span class="title">start_since</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^start since:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">accepted_conn</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^accepted conn:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">listen_queue</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^listen queue:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">max_listen_queue</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^max listen queue:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">listen_queue_len</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^listen queue len:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">idle_processes</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^idle processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">active_processes</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^active processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">total_processes</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^total processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">max_active_processes</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^max active processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">max_children_reached</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^max children reached:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">slow_requests</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;PHPFPM_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/^slow requests:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$PHPFPM_COMMAND</span> <span class="keyword">in</span></span><br><span class="line">start_since)</span><br><span class="line">start_since;</span><br><span class="line">;;</span><br><span class="line">accepted_conn)</span><br><span class="line">accepted_conn;</span><br><span class="line">;;</span><br><span class="line">listen_queue)</span><br><span class="line">listen_queue;</span><br><span class="line">;;</span><br><span class="line">max_listen_queue)</span><br><span class="line">max_listen_queue;</span><br><span class="line">;;</span><br><span class="line">listen_queue_len)</span><br><span class="line">listen_queue_len;</span><br><span class="line">;;</span><br><span class="line">idle_processes)</span><br><span class="line">idle_processes;</span><br><span class="line">;;</span><br><span class="line">active_processes)</span><br><span class="line">active_processes;</span><br><span class="line">;;</span><br><span class="line">total_processes)</span><br><span class="line">total_processes;</span><br><span class="line">;;</span><br><span class="line">max_active_processes)</span><br><span class="line">max_active_processes;</span><br><span class="line">;;</span><br><span class="line">max_children_reached)</span><br><span class="line">max_children_reached;</span><br><span class="line">;;</span><br><span class="line">slow_requests)</span><br><span class="line">slow_requests;</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> $<span class="string">&quot;USAGE:<span class="variable">$0</span></span></span><br><span class="line"><span class="string">&#123;start_since|accepted_conn|listen_queue|max_listen_queue|listen_queue_len|idle_p</span></span><br><span class="line"><span class="string">rocesses|active_processes|total_processes|max_active_processes|max_children_reac</span></span><br><span class="line"><span class="string">hed&#125;&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆæƒæ‰§è¡Œæƒé™</span></span><br><span class="line">[root@web01 scripts]# <span class="built_in">chmod</span> +x php_status.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@web01 zabbix_agentd.d]# vim php_status.conf</span><br><span class="line">UserParameter=php.status[*],/etc/zabbix/zabbix_agentd.d/scripts/php_status.sh <span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯</span></span><br><span class="line">[root@web01 zabbix_agentd.d]# systemctl restart zabbix-agent</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§JAVAè¿›ç¨‹JVM">ç›‘æ§JAVAè¿›ç¨‹JVM</h2><p>åœ¨Zabbixä¸­ï¼ŒJMXç›‘æ§æ•°æ®çš„è·å–ç”±ä¸“é—¨çš„ä»£ç†ç¨‹åºæ¥å®ç°,å³Zabbix-Java-Gatewayæ¥è´Ÿè´£æ•°æ®çš„é‡‡ é›†ï¼ŒZabbix-Java-Gatewayå’ŒJMXçš„Javaç¨‹åºä¹‹é—´é€šä¿¡è·å–æ•°æ®</p><p><strong>JMXåœ¨Zabbixä¸­çš„è¿è¡Œæµç¨‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Zabbix-Serveræ‰¾Zabbix-Java-Gatewayè·å–Javaæ•°æ®</span><br><span class="line">2.Zabbix-Java-Gatewayæ‰¾Javaç¨‹åº(zabbix-agent)è·å–æ•°æ®</span><br><span class="line">3.Javaç¨‹åºè¿”å›æ•°æ®ç»™Zabbix-Java-Gateway</span><br><span class="line">4.Zabbix-Java-Gatewayè¿”å›æ•°æ®ç»™Zabbix-Server</span><br><span class="line">5.Zabbix-Serverè¿›è¡Œæ•°æ®å±•ç¤º</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…JAVA-gateway">å®‰è£…JAVA-gateway</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/7/x86_64/</span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">[root@web02 ~]# rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-java-gateway-5.0.42-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨java-gateway</span></span><br><span class="line">[root@web02 ~]# systemctl start zabbix-java-gateway</span><br><span class="line"></span><br><span class="line"><span class="comment">#zabbixæœåŠ¡ç«¯</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹zabbix_serveré…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@zabbix5-server ~]# vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">JavaGateway=172.16.1.8</span><br><span class="line">JavaGatewayPort=10052</span><br><span class="line">StartJavaPollers=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯zabbix-server</span></span><br><span class="line">[root@zabbix5-server ~]# systemctl restart zabbix-server</span><br></pre></td></tr></table></figure><h3 id="tomcatå¼€å¯JMX">tomcatå¼€å¯JMX</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹tomcatå¯åŠ¨è„šæœ¬</span></span><br><span class="line">[root@web02 ~]# vim /usr/libexec/tomcat/server</span><br><span class="line">CATALINA_OPTS=<span class="string">&quot;<span class="variable">$CATALINA_OPTS</span></span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.port=12345</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.authenticate=false</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.ssl=false</span></span><br><span class="line"><span class="string">-Djava.rmi.server.hostname=172.16.1.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## å®Œæ•´è„šæœ¬</span></span><br><span class="line">[root@web02 ~]# <span class="built_in">cat</span> /usr/libexec/tomcat/server</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">. /usr/libexec/tomcat/preamble</span><br><span class="line"></span><br><span class="line">MAIN_CLASS=org.apache.catalina.startup.Bootstrap</span><br><span class="line"></span><br><span class="line">FLAGS=<span class="string">&quot;<span class="variable">$JAVA_OPTS</span>&quot;</span></span><br><span class="line">OPTIONS=<span class="string">&quot;-Dcatalina.base=<span class="variable">$CATALINA_BASE</span> \</span></span><br><span class="line"><span class="string">-Dcatalina.home=<span class="variable">$CATALINA_HOME</span> \</span></span><br><span class="line"><span class="string">-Djava.endorsed.dirs=<span class="variable">$JAVA_ENDORSED_DIRS</span> \</span></span><br><span class="line"><span class="string">-Djava.io.tmpdir=<span class="variable">$CATALINA_TMPDIR</span> \</span></span><br><span class="line"><span class="string">-Djava.util.logging.config.file=<span class="variable">$&#123;LOGGING_PROPERTIES&#125;</span> \</span></span><br><span class="line"><span class="string">-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager&quot;</span></span><br><span class="line"></span><br><span class="line">CATALINA_OPTS=<span class="string">&quot;<span class="variable">$CATALINA_OPTS</span></span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.port=12345</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.authenticate=false</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.ssl=false</span></span><br><span class="line"><span class="string">-Djava.rmi.server.hostname=172.16.1.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;start&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  FLAGS=<span class="string">&quot;<span class="variable">$&#123;FLAGS&#125;</span> <span class="variable">$CATALINA_OPTS</span>&quot;</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;SECURITY_MANAGER&#125;</span>&quot;</span> = <span class="string">&quot;true&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    OPTIONS=<span class="string">&quot;<span class="variable">$&#123;OPTIONS&#125;</span> \</span></span><br><span class="line"><span class="string">    -Djava.security.manager \</span></span><br><span class="line"><span class="string">    -Djava.security.policy==<span class="variable">$&#123;CATALINA_BASE&#125;</span>/conf/catalina.policy&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  run start</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;stop&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  run stop</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯tomcat</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart tomcat</span><br></pre></td></tr></table></figure><p><strong>webç•Œé¢è®¾ç½®-æ–°å»ºä¸»æœº</strong></p><p><img src="https://cos.lukme.top/Pic/image-20240807103619686.png" alt="image-20240807103619686"></p><p><strong>é“¾æ¥æ¨¡æ¿</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœjmxé€‰æ‹©ä¸¤ä¸ªæ¨¡æ¿--æ·»åŠ </span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20240807102022640.png" alt="image-20240807102022640"></p><p><img src="https://cos.lukme.top/Pic/image-20240807104224895.png" alt="image-20240807104224895"></p>]]></content>
    
    
    <summary type="html">å¸¦ä½ äº†è§£å¦‚ä½•ç›‘æ§phpå’Œjvm</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>zabbixè‡ªåŠ¨å‘ç°</title>
    <link href="https://lukme.top/posts/4b865a3.html"/>
    <id>https://lukme.top/posts/4b865a3.html</id>
    <published>2024-08-27T14:01:39.000Z</published>
    <updated>2024-10-06T14:26:41.593Z</updated>
    
    <content type="html"><![CDATA[<p><strong>ä¸»åŠ¨æ¨¡å¼ä¸è¢«åŠ¨æ¨¡å¼åŒºåˆ«</strong></p><p>â€‹1.è¢«åŠ¨æ¨¡å¼ (Zabbix-serverè½®è¯¢æ£€æµ‹zabbix-agent)</p><p>â€‹2.ä¸»åŠ¨æ¨¡å¼ (Zabbix-agentä¸»åŠ¨ä¸ŠæŠ¥ç»™Zabbix-server)</p><p><strong>ä¸»åŠ¨æ¨¡å¼ä¸è¢«è¢«åŠ¨æ¨¡å¼é€‰æ‹©å¦‚ä½•é€‰æ‹©</strong></p><p>â€‹1.å½“Queueé‡Œæœ‰å¤§é‡å»¶è¿Ÿçš„ç›‘æ§é¡¹</p><p>â€‹2.å½“ç›‘æ§ä¸»æœºè¶…è¿‡300+, å»ºè®®ä½¿ç”¨ä¸»åŠ¨æ¨¡å¼ã€‚</p><p><img src="https://cos.lukme.top/Pic/QQ_1723279232118.png" alt="QQ_1723279232118"></p><p><strong>zabbixå·¥ä½œæ¨¡å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">agentä¸»åŠ¨æ¨¡å¼ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰</span><br><span class="line">agentå¯åŠ¨åè‡ªåŠ¨å°†ä¸»æœºä¿¡æ¯æ³¨å†Œåˆ°zabbix-serverä¸­</span><br><span class="line"></span><br><span class="line">agentè¢«åŠ¨æ¨¡å¼ï¼ˆè‡ªåŠ¨å‘ç°ï¼‰</span><br><span class="line">agentå¯åŠ¨åç”±zabbix-serveræ‰«æï¼Œå°†ä¿¡æ¯ä¿å­˜åœ¨zabbix-serverä¸­</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="zabbixè‡ªåŠ¨å‘ç°">zabbixè‡ªåŠ¨å‘ç°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Zabbix-serverå¼€å¯è‡ªåŠ¨å‘ç°åŠŸèƒ½ï¼š</span></span><br><span class="line">[root@zabbix5-server ~]# vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">StartDiscoverers=20</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯å®¢æˆ·ç«¯</span></span><br><span class="line">systemctl restart zabbix-agent</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºè‡ªåŠ¨å‘ç°è§„åˆ™</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723276932546.png" alt="QQ_1723276932546"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æµ‹è¯•æ—¶å€™ï¼Œ</span><br><span class="line">æ›´æ–°é—´éš”  10s æ˜¯æ‰«æä¸€è½®ä¹‹åç»è¿‡10så¼€å¯ä¸‹æ¬¡æ‰«æ</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1723277097140.png" alt="QQ_1723277097140"></p><p><strong>åˆ›å»ºè‡ªåŠ¨å‘ç°åŠ¨ä½œï¼ˆå…³è”è‡ªåŠ¨å‘ç°è§„åˆ™ï¼‰</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723277868304.png" alt="QQ_1723277868304"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723277947268.png" alt="QQ_1723277947268"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723278202906.png" alt="QQ_1723278202906"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723278289428.png" alt="QQ_1723278289428"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723278495118.png" alt="QQ_1723278495118"></p><p><strong>è‡ªåŠ¨å‘ç°ç¼ºé™·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.ç½‘ç»œå‘ç°é€Ÿåº¦å¤ªæ…¢</span><br><span class="line">2.è½®è¯¢æ‰«æç½‘æ®µ</span><br><span class="line">3.å¦‚æœç½‘æ®µä¸­å­˜åœ¨ä¸é€šçš„ä¸»æœºï¼Œä¼šå‡ºç°å¡é¡¿å¹¶ä¸”é€ æˆå“¦åç»­æ–°å¢çš„æœåŠ¡å™¨æ— æ³•åŠ å…¥èŠ‚ç‚¹</span><br><span class="line">4.ä¼šå¯¼è‡´serveræ€§èƒ½å˜ç¼“æ…¢ï¼Œå½±å“serveræ€§èƒ½</span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨æ³¨å†Œ">è‡ªåŠ¨æ³¨å†Œ</h3><p><strong>ä¿®æ”¹æ¯å°å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¿®æ”¹agenté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@lb01 ~]# vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">Server=172.16.1.71  <span class="comment">#è¢«åŠ¨æ¨¡å¼</span></span><br><span class="line">ServerActive=172.16.1.71  <span class="comment">#ä¸»åŠ¨æ¨¡å¼</span></span><br><span class="line">Hostname=web03 <span class="comment">#æŒ‡å®šä¸»æœºå</span></span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# systemctl restart zabbix-agent</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºåŠ¨ä½œ</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723278758673.png" alt="QQ_1723278758673"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723278911425.png" alt="QQ_1723278911425"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723278968991.png" alt="QQ_1723278968991"></p>]]></content>
    
    
    <summary type="html">å¦‚ä½•è‡ªåŠ¨æ·»åŠ éœ€è¦ç›‘æ§çš„ä¸»æœºï¼Ÿåœ¨è¿™é‡Œèƒ½æ‰¾åˆ°ç­”æ¡ˆ</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>å°ç±³ç›‘æ§open-falcon</title>
    <link href="https://lukme.top/posts/459a9148.html"/>
    <id>https://lukme.top/posts/459a9148.html</id>
    <published>2024-08-25T12:10:00.000Z</published>
    <updated>2024-08-25T12:30:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-open-falconåŸºæœ¬ä»‹ç»">1. open-falconåŸºæœ¬ä»‹ç»</h2><blockquote><p>Open-Falconä½œä¸ºä¸€æ¬¾å¼€æºçš„äº’è”ç½‘ä¼ä¸šçº§ç›‘æ§ç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼Œä»¥å…¶é«˜æ€§èƒ½ã€æ˜“æ‰©å±•ã€çµæ´»é…ç½®ç­‰ç‰¹ç‚¹ï¼Œåœ¨äº’è”ç½‘å…¬å¸å’Œå¤§è§„æ¨¡ITåŸºç¡€è®¾æ–½ä¸­å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚æ— è®ºæ˜¯ä¼ä¸šITè¿ç»´ã€å¼€å‘å›¢é˜Ÿè¿˜æ˜¯DevOpsï¼Œéƒ½å¯ä»¥é€šè¿‡Open-Falconæå‡è¿ç»´æ•ˆç‡å’Œæ•…éšœæ’é™¤èƒ½åŠ›</p><h3 id="è®¾è®¡åŸç†">è®¾è®¡åŸç†</h3><p>Open-Falconçš„è®¾è®¡åŸç†ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><strong>æ¨¡å—æ¶æ„</strong>ï¼š<ul><li><strong>æ•°æ®é‡‡é›†ä¸ä¸ŠæŠ¥</strong>ï¼šé€šè¿‡falcon-agentç»„ä»¶è‡ªåŠ¨å‘ç°å¹¶é‡‡é›†æœåŠ¡å™¨çš„å„ç§æ•°æ®å’ŒæŒ‡æ ‡ï¼Œæ”¯æŒç”¨æˆ·ä¸»åŠ¨pushå’Œç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶ã€‚</li><li><strong>å‘Šè­¦</strong>ï¼šJudgeç»„ä»¶è´Ÿè´£åˆ¤æ–­é‡‡é›†åˆ°çš„æ•°æ®æ˜¯å¦è§¦å‘å‘Šè­¦è§„åˆ™ï¼Œå¹¶ç”Ÿæˆå‘Šè­¦äº‹ä»¶ã€‚</li><li><strong>å½’æ¡£ä¸ç»˜å›¾</strong>ï¼šGraphç»„ä»¶è´Ÿè´£å­˜å‚¨ç›‘æ§æ•°æ®ï¼Œå¹¶æä¾›ç»˜å›¾æ‰€éœ€çš„æ¥å£ã€‚</li><li><strong>æŠ¥è­¦ç­–ç•¥é…ç½®</strong>ï¼šç”¨æˆ·å¯ä»¥åœ¨ç³»ç»Ÿä¸­é…ç½®å¤šç§æŠ¥è­¦ç­–ç•¥ï¼Œä»¥æ»¡è¶³ä¸åŒçš„ç›‘æ§éœ€æ±‚ã€‚</li></ul></li><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li>falcon-agenté‡‡é›†åˆ°æ•°æ®åï¼Œé€šè¿‡é•¿è¿æ¥è¿…é€Ÿè½¬å‘ç»™Transferç»„ä»¶ã€‚</li><li>Transferç»„ä»¶è´Ÿè´£åˆ†å‘æ•°æ®ç»™Judgeå’ŒGraphç»„ä»¶ï¼Œåˆ†åˆ«ç”¨äºå‘Šè­¦åˆ¤å®šå’Œç»˜å›¾ã€‚</li><li>Judgeç»„ä»¶æ ¹æ®æŠ¥è­¦ç­–ç•¥åˆ¤æ–­æ•°æ®æ˜¯å¦è§¦å‘å‘Šè­¦ï¼Œå¹¶å°†å‘Šè­¦äº‹ä»¶å†™å…¥Redisæ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>Alarmç»„ä»¶ç›‘å¬Redisä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°†å‘Šè­¦äº‹ä»¶è½¬å‘ç»™å¾®ä¿¡ã€çŸ­ä¿¡æˆ–é‚®ä»¶ç­‰é€šçŸ¥æ–¹å¼ã€‚</li></ul></li></ol><h3 id="ä¸»è¦åŠŸèƒ½">ä¸»è¦åŠŸèƒ½</h3><ol><li><strong>æ•°æ®é‡‡é›†</strong>ï¼š<ul><li>æ”¯æŒå¤šç§æ•°æ®é‡‡é›†æ–¹å¼ï¼ŒåŒ…æ‹¬Agenté‡‡é›†ã€APIé‡‡é›†ã€è„šæœ¬é‡‡é›†ç­‰ã€‚</li><li>falcon-agentèƒ½å¤Ÿé«˜æ•ˆé‡‡é›†ç³»ç»ŸæŒ‡æ ‡ã€åº”ç”¨æŒ‡æ ‡å’Œè‡ªå®šä¹‰æŒ‡æ ‡ã€‚</li></ul></li><li><strong>æ•°æ®å­˜å‚¨ä¸åˆ†æ</strong>ï¼š<ul><li>æ”¯æŒå¤šç§æ•°æ®å­˜å‚¨åç«¯ï¼Œå¦‚Graphiteã€OpenTSDBã€InfluxDBç­‰ã€‚</li><li>æä¾›é«˜æ•ˆçš„æ•°æ®å­˜å‚¨å’Œå‹ç¼©ç®—æ³•ï¼Œç¡®ä¿å¤§è§„æ¨¡æ•°æ®çš„é«˜æ•ˆå­˜å‚¨ã€‚</li></ul></li><li><strong>å‘Šè­¦ç®¡ç†</strong>ï¼š<ul><li>æä¾›çµæ´»çš„å‘Šè­¦è§„åˆ™é…ç½®ï¼Œæ”¯æŒå¤šç§å‘Šè­¦è§¦å‘æ¡ä»¶å’Œé€šçŸ¥æ–¹å¼ã€‚</li><li>å†…ç½®æ™ºèƒ½çš„å‘Šè­¦ç­–ç•¥å¼•æ“ï¼Œæ”¯æŒè‡ªåŠ¨æ”¶æ•›ï¼Œé¿å…è¯¯æŠ¥å’Œæ¼æŠ¥ã€‚</li></ul></li><li><strong>æ•°æ®å¯è§†åŒ–</strong>ï¼š<ul><li>æä¾›Webç®¡ç†ç•Œé¢ï¼ˆDashboardï¼‰ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹ç›‘æ§å›¾è¡¨å’Œé…ç½®å‘Šè­¦è§„åˆ™23ã€‚</li><li>æ”¯æŒè‡ªå®šä¹‰ä»ªè¡¨ç›˜å’ŒæŠ¥å‘Šï¼Œä¾¿äºæ•°æ®å±•ç¤ºå’Œåˆ†äº«ã€‚</li></ul></li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼š<ul><li>è®¾è®¡ä¸ºåˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒé«˜å¯ç”¨æ€§å’Œæ¨ªå‘æ‰©å±•ã€‚</li><li>æä¾›ä¸°å¯Œçš„æ‰©å±•æ¥å£ï¼Œæ”¯æŒè‡ªå®šä¹‰æ•°æ®æºå’Œæ’ä»¶ã€‚</li></ul></li></ol><h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><p>Open-Falconå¯ä»¥åº”ç”¨äºå¤šç§åœºæ™¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>ä¼ä¸šITè¿ç»´</strong>ï¼šå¯¹æ•°æ®ä¸­å¿ƒã€äº‘æœåŠ¡å™¨ã€ç½‘ç»œè®¾å¤‡è¿›è¡Œå®æ—¶ç›‘æ§ï¼ŒåŠæ—¶å‘ç°å¹¶è§£å†³é—®é¢˜ã€‚</li><li><strong>å¼€å‘å›¢é˜Ÿ</strong>ï¼šç›‘æ§åº”ç”¨å’ŒæœåŠ¡çš„æ€§èƒ½ï¼Œä¸ºæŒç»­é›†æˆä¸äº¤ä»˜æä¾›å†³ç­–ä¾æ®ã€‚</li><li><strong>DevOps</strong>ï¼šè‡ªåŠ¨åŒ–è¿ç»´æµç¨‹ï¼Œé€šè¿‡å‘Šè­¦å¿«é€Ÿå®šä½é—®é¢˜ï¼Œç¼©çŸ­æ•…éšœæ¢å¤æ—¶é—´ã€‚</li></ul><p>ç›‘æ§é¡¹ç›®åˆ†ä¸ºCPUã€Loadã€å†…å­˜ã€ç£ç›˜ã€IOã€ç½‘ç»œç›¸å…³ã€å†…æ ¸å‚æ•°ã€ss ç»Ÿè®¡è¾“å‡ºã€ç«¯å£é‡‡é›†ã€æ ¸å¿ƒæœåŠ¡çš„è¿›ç¨‹å­˜æ´»ä¿¡æ¯é‡‡é›†ã€å…³é”®ä¸šåŠ¡è¿›ç¨‹èµ„æºæ¶ˆè€—ã€NTP offseté‡‡é›†ã€DNSè§£æé‡‡é›†ï¼Œè¿™äº›æŒ‡æ ‡ï¼Œéƒ½æ˜¯open-falconçš„agentç»„ä»¶ç›´æ¥æ”¯æŒçš„ã€‚</p></blockquote><h2 id="2-open-falconä¸å…¶ä»–ç›‘æ§å·¥å…·çš„åŒºåˆ«">2. open-falconä¸å…¶ä»–ç›‘æ§å·¥å…·çš„åŒºåˆ«</h2><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722697497676.png" alt="img"></p><h2 id="3-ç¯å¢ƒéƒ¨ç½²">3. ç¯å¢ƒéƒ¨ç½²</h2><table><thead><tr><th><strong>ä¸»æœºå</strong></th><th><strong>WanIP</strong></th><th><strong>LanIP</strong></th><th><strong>è§’è‰²</strong></th><th><strong>åº”ç”¨</strong></th></tr></thead><tbody><tr><td>open-falcon</td><td>10.0.0.200</td><td>172.16.1.200</td><td>open-falconæœåŠ¡ç«¯</td><td>open-falcon-serverã€MySQL</td></tr><tr><td>open-falcon-agent</td><td>10.0.0.201</td><td>172.16.1.201</td><td>open-falconçš„å®¢æˆ·ç«¯</td><td>open-falcon-agent</td></tr></tbody></table><blockquote><ul><li>CentOs7.9</li><li>2æ ¸4G</li><li>å†…å­˜åˆ†é…20G</li><li>é•œåƒæºï¼šé˜¿é‡Œæº</li></ul></blockquote><h2 id="4-æœåŠ¡ç«¯éƒ¨ç½²">4. æœåŠ¡ç«¯éƒ¨ç½²</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## æ›´æ¢é˜¿é‡Œæºå’Œepelæº</span></span><br><span class="line">[root@falcon ~]# <span class="built_in">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line">[root@falcon ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">--2024-08-03 23:17:34--  http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">Resolving mirrors.aliyun.com (mirrors.aliyun.com)... 180.178.233.232, 180.178.233.233, 180.178.245.235, ...</span><br><span class="line">Connecting to mirrors.aliyun.com (mirrors.aliyun.com)|180.178.233.232|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 2523 (2.5K) [application/octet-stream]</span><br><span class="line">Saving to: â€˜/etc/yum.repos.d/CentOS-Base.repoâ€™</span><br><span class="line"></span><br><span class="line">100%[=============================================================================&gt;] 2,523       --.-K/s   <span class="keyword">in</span> 0.001s  </span><br><span class="line"></span><br><span class="line">2024-08-03 23:17:34 (2.84 MB/s) - â€˜/etc/yum.repos.d/CentOS-Base.repoâ€™ saved [2523/2523]</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¸‹è½½å¸¸ç”¨è½¯ä»¶</span></span><br><span class="line">[root@falcon ~]# yum install git telnet net-tools tree nmap sysstat lrzsz dos2unix tcpdump ntpdate  wget <span class="comment">## -y</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## é…ç½®æ—¶é—´åŒæ­¥</span></span><br><span class="line">[root@falcon ~]# ntpdate cn.pool.ntp.org</span><br><span class="line"> 3 Aug 23:24:22 ntpdate[20532]: adjust time server 119.28.183.184 offset -0.435286 sec</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¼€å¯ç¼“å­˜</span></span><br><span class="line">[root@falcon ~]# sed -i <span class="string">&#x27;s#keepcache=0#keepcache=1#g&#x27;</span> /etc/yum.conf </span><br><span class="line">[root@falcon ~]# grep keepcache /etc/yum.conf</span><br><span class="line">keepcache=1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…³é—­selinux</span></span><br><span class="line">sed -i <span class="string">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/selinux/config</span><br><span class="line">setenforce 0</span><br><span class="line"> </span><br><span class="line"><span class="comment">#å…³é—­é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å®‰è£… redis</span></span><br><span class="line">[root@falcon ~]# yum install redis -y</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å¯åŠ¨redis</span></span><br><span class="line">[root@falcon ~]# redis-server &amp;</span><br><span class="line">[1] 20863</span><br><span class="line">[root@falcon ~]# 20863:C 03 Aug 23:27:25.244 <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span></span><br><span class="line">20863:M 03 Aug 23:27:25.244 * Increased maximum number of open files to 10032 (it was originally <span class="built_in">set</span> to 1024).</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ <span class="string">&#x27;&#x27;</span>-._                                             </span><br><span class="line">      _.-``    `.  `_.  <span class="string">&#x27;&#x27;</span>-._           Redis 3.2.12 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">&#x27;&#x27;</span>-._                                   </span><br><span class="line"> (    <span class="string">&#x27;      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="string">&#x27;|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 20863</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |           http://redis.io        </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |                                  </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line">      `-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>                                       </span><br><span class="line">          `-._        _.-<span class="string">&#x27;                                           </span></span><br><span class="line"><span class="string">              `-.__.-&#x27;</span>                                               </span><br><span class="line"></span><br><span class="line">20863:M 03 Aug 23:27:25.244 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">20863:M 03 Aug 23:27:25.244 <span class="comment"># Server started, Redis version 3.2.12</span></span><br><span class="line">20863:M 03 Aug 23:27:25.244 <span class="comment"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span></span><br><span class="line">20863:M 03 Aug 23:27:25.244 <span class="comment"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#x27;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#x27; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span></span><br><span class="line">20863:M 03 Aug 23:27:25.244 * The server is now ready to accept connections on port 6379</span><br><span class="line">^C</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å®‰è£…mysqlå¹¶è®¾ç½®å¼€æœºè‡ªå¯</span></span><br><span class="line"></span><br><span class="line">[root@falcon ~]# wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">--2024-08-03 23:41:44--  http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">Resolving repo.mysql.com (repo.mysql.com)... 96.7.105.231, 2600:1417:8400:ab8::1d68, 2600:1417:8400:a87::1d68</span><br><span class="line">Connecting to repo.mysql.com (repo.mysql.com)|96.7.105.231|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 6140 (6.0K) [application/x-redhat-package-manager]</span><br><span class="line">Saving to: â€˜mysql-community-release-el7-5.noarch.rpmâ€™</span><br><span class="line"></span><br><span class="line">100%[=============================================================================&gt;] 6,140       --.-K/s   <span class="keyword">in</span> 0s      </span><br><span class="line"></span><br><span class="line">2024-08-03 23:41:44 (783 MB/s) - â€˜mysql-community-release-el7-5.noarch.rpmâ€™ saved [6140/6140]</span><br><span class="line"></span><br><span class="line">[root@falcon ~]# ll</span><br><span class="line">total 200</span><br><span class="line">-rw-------. 1 root root   1413 May 13 15:22 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root 188754 Apr 23 11:13 main.sh</span><br><span class="line">-rw-r--r--  1 root root   6140 Nov 12  2015 mysql-community-release-el7-5.noarch.rpm</span><br><span class="line"></span><br><span class="line">[root@falcon ~]# rpm -ivh mysql-community-release-el7-5.noarch.rpm </span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:mysql-community-release-el7-5    <span class="comment">################################# [100%]</span></span><br><span class="line">   </span><br><span class="line">[root@falcon ~]# ll /etc/yum.repos.d/</span><br><span class="line">total 44</span><br><span class="line">-rw-r--r--  1 root root 2523 Aug  4  2022 CentOS-Base.repo</span><br><span class="line">-rw-r--r--. 1 root root 1675 May 13 16:46 CentOS-Base.repo.backup</span><br><span class="line">-rw-r--r--. 1 root root 1312 May 13 16:46 CentOS-CR.repo</span><br><span class="line">-rw-r--r--. 1 root root  649 May 13 16:46 CentOS-Debuginfo.repo</span><br><span class="line">-rw-r--r--. 1 root root  292 May 13 16:46 CentOS-fasttrack.repo</span><br><span class="line">-rw-r--r--. 1 root root  629 May 13 16:46 CentOS-Media.repo</span><br><span class="line">-rw-r--r--. 1 root root 1347 May 13 16:46 CentOS-Sources.repo</span><br><span class="line">-rw-r--r--. 1 root root  921 May 13 16:46 epel.repo</span><br><span class="line">-rw-r--r--. 1 root root 1020 May 13 16:46 epel-testing.repo</span><br><span class="line">-rw-r--r--  1 root root 1209 Jan 29  2014 mysql-community.repo</span><br><span class="line">-rw-r--r--  1 root root 1060 Jan 29  2014 mysql-community-source.repo</span><br><span class="line"></span><br><span class="line">[root@falcon ~]# yum install -y mysql-server</span><br><span class="line"></span><br><span class="line">[root@falcon ~]# systemctl start mysqld.service</span><br><span class="line">[root@falcon ~]# systemctl <span class="built_in">enable</span> mysqld.service</span><br><span class="line"></span><br><span class="line">[root@falcon ~]# netstat -lntup</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:6379            0.0.0.0:*               LISTEN      20863/redis-server  </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      8960/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      9190/master         </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      22084/mysqld        </span><br><span class="line">tcp6       0      0 :::6379                 :::*                    LISTEN      20863/redis-server  </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      8960/sshd           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      9190/master </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åˆå§‹åŒ–MySQLè¡¨ç»“æ„ï¼Œç»™ç”¨æˆ·è®¾ç½®å¯†ç ï¼Œå¯¼å…¥æ•°æ®åº“è¡¨</span></span><br><span class="line"></span><br><span class="line">[root@falcon ~]# <span class="built_in">cd</span> /tmp/ &amp;&amp; git <span class="built_in">clone</span> https://github.com/open-falcon/falcon-plus.git </span><br><span class="line">Cloning into <span class="string">&#x27;falcon-plus&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 10196, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (279/279), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (229/229), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 10196 (delta 60), reused 229 (delta 36), pack-reused 9917</span><br><span class="line">Receiving objects: 100% (10196/10196), 16.95 MiB | 2.43 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (5352/5352), <span class="keyword">done</span>.</span><br><span class="line">[root@falcon tmp]# <span class="built_in">cd</span> /tmp/falcon-plus/scripts/mysql/db_schema/</span><br><span class="line">[root@falcon db_schema]# ll</span><br><span class="line">total 24</span><br><span class="line">-rw-r--r-- 1 root root 1952 Aug  4 00:08 1_uic-db-schema.sql</span><br><span class="line">-rw-r--r-- 1 root root 7573 Aug  4 00:08 2_portal-db-schema.sql</span><br><span class="line">-rw-r--r-- 1 root root 3391 Aug  4 00:08 3_dashboard-db-schema.sql</span><br><span class="line">-rw-r--r-- 1 root root 1807 Aug  4 00:08 4_graph-db-schema.sql</span><br><span class="line">-rw-r--r-- 1 root root 2558 Aug  4 00:08 5_alarms-db-schema.sql</span><br><span class="line">[root@falcon db_schema]# mysqladmin -uroot password <span class="string">&quot;password&quot;</span></span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">[root@falcon db_schema]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 9</span><br><span class="line">Server version: 5.6.51 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@falcon db_schema]# mysql -h 127.0.0.1 -u root -p &lt; 1_uic-db-schema.sql</span><br><span class="line">Enter password: </span><br><span class="line">[root@falcon db_schema]# mysql -h 127.0.0.1 -u root -p &lt; 2_portal-db-schema.sql</span><br><span class="line">Enter password: </span><br><span class="line">[root@falcon db_schema]# mysql -h 127.0.0.1 -u root -p &lt; 3_dashboard-db-schema.sql</span><br><span class="line">Enter password: </span><br><span class="line">[root@falcon db_schema]# mysql -h 127.0.0.1 -u root -p &lt; 4_graph-db-schema.sql</span><br><span class="line">Enter password: </span><br><span class="line">[root@falcon db_schema]# mysql -h 127.0.0.1 -u root -p &lt; 5_alarms-db-schema.sql</span><br><span class="line">Enter password: </span><br><span class="line"></span><br><span class="line">[root@falcon db_schema]# mysql -uroot -ppassword</span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 15</span><br><span class="line">Server version: 5.6.51 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| alarms             |</span><br><span class="line">| dashboard          |</span><br><span class="line">| falcon_portal      |</span><br><span class="line">| graph              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| uic                |</span><br><span class="line">+--------------------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; \q</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å®‰è£…goè¯­è¨€å¼€å‘ç¯å¢ƒï¼Œé…ç½®å¥½ç¯å¢ƒå˜é‡</span></span><br><span class="line"></span><br><span class="line">[root@falcon db_schema]# yum install golang -y</span><br><span class="line"></span><br><span class="line">[root@falcon db_schema]# [root@falcon db_schema]# go version</span><br><span class="line">go version go1.20.12 linux/amd64</span><br><span class="line"></span><br><span class="line">[root@falcon db_schema]# find / -name go</span><br><span class="line">/usr/bin/go</span><br><span class="line">/usr/lib/golang/src/cmd/go</span><br><span class="line">/usr/lib/golang/src/cmd/vendor/golang.org/x/tools/go</span><br><span class="line">/usr/lib/golang/src/go</span><br><span class="line">/usr/lib/golang/bin/go</span><br><span class="line"></span><br><span class="line">[root@falcon db_schema]# <span class="built_in">export</span> GOROOT=/usr/lib/golang</span><br><span class="line">[root@falcon db_schema]# <span class="built_in">export</span> GOPATH=/home</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å®‰è£…open-falcon</span></span><br><span class="line"></span><br><span class="line">[root@falcon profile.d]# <span class="built_in">export</span> FALCON_HOME=/home/work</span><br><span class="line">[root@falcon profile.d]# <span class="built_in">export</span> WORKSPACE=<span class="variable">$FALCON_HOME</span>/open-falcon</span><br><span class="line">[root@falcon profile.d]# <span class="built_in">mkdir</span> -p <span class="variable">$WORKSPACE</span></span><br><span class="line">[root@falcon profile.d]# ll</span><br><span class="line">total 68</span><br><span class="line">-rw-r--r--. 1 root root  771 Oct 31  2018 256term.csh</span><br><span class="line">-rw-r--r--. 1 root root  841 Oct 31  2018 256term.sh</span><br><span class="line">-rw-r--r--. 1 root root  196 Mar 25  2017 colorgrep.csh</span><br><span class="line">-rw-r--r--. 1 root root  201 Mar 25  2017 colorgrep.sh</span><br><span class="line">-rw-r--r--. 1 root root 1741 Oct 30  2018 colorls.csh</span><br><span class="line">-rw-r--r--. 1 root root 1606 Oct 30  2018 colorls.sh</span><br><span class="line">-rw-r--r--. 1 root root   80 Oct 31  2018 csh.local</span><br><span class="line">-rw-r--r--  1 root root   50 Aug  4 00:29 go_env.sh</span><br><span class="line">-rw-r--r--. 1 root root 1706 Oct 31  2018 lang.csh</span><br><span class="line">-rw-r--r--. 1 root root 2703 Oct 31  2018 lang.sh</span><br><span class="line">-rw-r--r--. 1 root root  123 Jul 31  2015 less.csh</span><br><span class="line">-rw-r--r--. 1 root root  121 Jul 31  2015 less.sh</span><br><span class="line">-rw-r--r--. 1 root root   81 Oct 31  2018 sh.local</span><br><span class="line">-rw-r--r--. 1 root root  105 Dec 16  2020 vim.csh</span><br><span class="line">-rw-r--r--. 1 root root  269 Dec 16  2020 vim.sh</span><br><span class="line">-rw-r--r--. 1 root root  164 Jan 28  2014 which2.csh</span><br><span class="line">-rw-r--r--. 1 root root  169 Jan 28  2014 which2.sh</span><br><span class="line">[root@falcon profile.d]# <span class="built_in">cd</span></span><br><span class="line">[root@falcon ~]# ll</span><br><span class="line">total 200</span><br><span class="line">-rw-------. 1 root root   1413 May 13 15:22 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root 188754 Apr 23 11:13 main.sh</span><br><span class="line">-rw-r--r--  1 root root   6140 Nov 12  2015 mysql-community-release-el7-5.noarch.rpm</span><br><span class="line"></span><br><span class="line">[root@falcon ~]# rz</span><br><span class="line">rz waiting to receive.**[root@falcon ~]# ll</span><br><span class="line">total 67276</span><br><span class="line">-rw-------. 1 root root     1413 May 13 15:22 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root   188754 Apr 23 11:13 main.sh</span><br><span class="line">-rw-r--r--  1 root root     6140 Nov 12  2015 mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">-r--r--r--  1 root root 68685265 Jul 31 21:23 open-falcon-v0.3.tar.gz</span><br><span class="line">[root@falcon ~]# tar xf open-falcon-v0.3.tar.gz -C <span class="variable">$WORKSPACE</span></span><br><span class="line">[root@falcon ~]# <span class="built_in">cd</span> <span class="variable">$WORKSPACE</span>/</span><br><span class="line">[root@falcon open-falcon]# ll</span><br><span class="line">total 4272</span><br><span class="line">drwxr-xr-x 7 czm_core czm_core      71 May 30  2019 agent</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 aggregator</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 alarm</span><br><span class="line">drwxr-xr-x 6 czm_core czm_core      55 May 30  2019 api</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 gateway</span><br><span class="line">drwxr-xr-x 6 czm_core czm_core      55 May 30  2019 graph</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 hbs</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 judge</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 nodata</span><br><span class="line">-rwxr-xr-x 1 czm_core czm_core 4370880 May 30  2019 open-falcon</span><br><span class="line">lrwxrwxrwx 1 czm_core czm_core      15 May 30  2019 plugin -&gt; ./agent/plugin/</span><br><span class="line">lrwxrwxrwx 1 czm_core czm_core      15 May 30  2019 public -&gt; ./agent/public/</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 transfer</span><br><span class="line">[root@falcon open-falcon]# <span class="built_in">cd</span> /home/work</span><br><span class="line">[root@falcon work]# ll</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 12 czm_core czm_core 190 May 30  2019 open-falcon</span><br><span class="line">[root@falcon work]# <span class="built_in">cd</span> open-falcon/</span><br><span class="line">[root@falcon open-falcon]# ll</span><br><span class="line">total 4272</span><br><span class="line">drwxr-xr-x 7 czm_core czm_core      71 May 30  2019 agent</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 aggregator</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 alarm</span><br><span class="line">drwxr-xr-x 6 czm_core czm_core      55 May 30  2019 api</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 gateway</span><br><span class="line">drwxr-xr-x 6 czm_core czm_core      55 May 30  2019 graph</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 hbs</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 judge</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 nodata</span><br><span class="line">-rwxr-xr-x 1 czm_core czm_core 4370880 May 30  2019 open-falcon</span><br><span class="line">lrwxrwxrwx 1 czm_core czm_core      15 May 30  2019 plugin -&gt; ./agent/plugin/</span><br><span class="line">lrwxrwxrwx 1 czm_core czm_core      15 May 30  2019 public -&gt; ./agent/public/</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 transfer</span><br><span class="line">[root@falcon open-falcon]# <span class="built_in">pwd</span></span><br><span class="line">/home/work/open-falcon</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶cfg.json(ç”±äºä¹‹å‰è®¾ç½®çš„rootå¯†ç ä¸ºpasswordï¼Œåº•ä¸‹é…ç½®æ–‡ä»¶è¦æ”¹)</strong></p><table><thead><tr><th>ä¿®æ”¹çš„æ–‡ä»¶</th><th>è·¯å¾„</th></tr></thead><tbody><tr><td>aggregator</td><td>/home/work/open-falcon/aggregator/config/cfg.json</td></tr><tr><td>graph</td><td>/home/work/open-falcon/graph/config/cfg.json</td></tr><tr><td>hbs</td><td>/home/work/open-falcon/hbs/config/cfg.json</td></tr><tr><td>nodata</td><td>/home/work/open-falcon/nodata/config/cfg.json</td></tr><tr><td>api</td><td>/home/work/open-falcon/api/config/cfg.json</td></tr><tr><td>alarm</td><td>/home/work/open-falcon/alarm/config/cfg.json</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¿®æ”¹aggregatorçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">[root@falcon open-falcon]# <span class="built_in">cd</span> aggregator/</span><br><span class="line">[root@falcon aggregator]# ll</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 czm_core czm_core 31 May 30  2019 bin</span><br><span class="line">drwxr-xr-x 2 czm_core czm_core 22 May 30  2019 config</span><br><span class="line">drwxr-xr-x 2 czm_core czm_core  6 May 30  2019 logs</span><br><span class="line">[root@falcon aggregator]# <span class="built_in">cd</span> config/</span><br><span class="line">[root@falcon config]# ll</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 czm_core czm_core 522 May 30  2019 cfg.json</span><br><span class="line">[root@falcon config]# <span class="built_in">pwd</span></span><br><span class="line">/home/work/open-falcon/aggregator/config</span><br><span class="line">[root@falcon config]# vim cfg.json</span><br></pre></td></tr></table></figure><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722703517483.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¿®æ”¹graphçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">[root@falcon open-falcon]# ll</span><br><span class="line">total 4272</span><br><span class="line">drwxr-xr-x 7 czm_core czm_core      71 May 30  2019 agent</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 aggregator</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 alarm</span><br><span class="line">drwxr-xr-x 6 czm_core czm_core      55 May 30  2019 api</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 gateway</span><br><span class="line">drwxr-xr-x 6 czm_core czm_core      55 May 30  2019 graph</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 hbs</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 judge</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 nodata</span><br><span class="line">-rwxr-xr-x 1 czm_core czm_core 4370880 May 30  2019 open-falcon</span><br><span class="line">lrwxrwxrwx 1 czm_core czm_core      15 May 30  2019 plugin -&gt; ./agent/plugin/</span><br><span class="line">lrwxrwxrwx 1 czm_core czm_core      15 May 30  2019 public -&gt; ./agent/public/</span><br><span class="line">drwxr-xr-x 5 czm_core czm_core      43 May 30  2019 transfer</span><br><span class="line">[root@falcon open-falcon]# <span class="built_in">pwd</span></span><br><span class="line">/home/work/open-falcon</span><br><span class="line">[root@falcon open-falcon]# <span class="built_in">cd</span> graph/</span><br><span class="line">[root@falcon graph]# <span class="built_in">cd</span> config</span><br><span class="line">[root@falcon config]# vim cfg.json </span><br></pre></td></tr></table></figure><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722703737785.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¿®æ”¹hbsçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">[root@falcon config]# vim /home/work/open-falcon/hbs/config/cfg.json </span><br></pre></td></tr></table></figure><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722703871384.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¿®æ”¹nodataçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@falcon config]# vim /home/work/open-falcon/nodata/config/cfg.json</span><br></pre></td></tr></table></figure><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722703963223.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¿®æ”¹apiçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@falcon config]# vim /home/work/open-falcon/api/config/cfg.json</span><br></pre></td></tr></table></figure><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722704127654.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¿®æ”¹alarmçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@falcon config]# vim /home/work/open-falcon/alarm/config/cfg.json</span><br></pre></td></tr></table></figure><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722704273423.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å¯åŠ¨åç«¯æ¨¡å—ï¼Œæ£€æŸ¥å¯åŠ¨çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">[root@falcon work]# <span class="built_in">cd</span> /home/work/open-falcon/</span><br><span class="line">[root@falcon open-falcon]# ./open-falcon start</span><br><span class="line">[falcon-graph] 31555</span><br><span class="line">[falcon-hbs] 31567</span><br><span class="line">[falcon-judge] 31578</span><br><span class="line">[falcon-transfer] 31589</span><br><span class="line">[falcon-nodata] 31597</span><br><span class="line">[falcon-aggregator] 31616</span><br><span class="line">[falcon-agent] 31635</span><br><span class="line">[falcon-gateway] 31643</span><br><span class="line">[falcon-api] 31653</span><br><span class="line">[falcon-alarm] 31667</span><br><span class="line"></span><br><span class="line">[root@falcon open-falcon]# ./open-falcon check</span><br><span class="line">        falcon-graph         UP           31555 </span><br><span class="line">          falcon-hbs         UP           31567 </span><br><span class="line">        falcon-judge         UP           31578 </span><br><span class="line">     falcon-transfer         UP           31589 </span><br><span class="line">       falcon-nodata         UP           31597 </span><br><span class="line">   falcon-aggregator         UP           31616 </span><br><span class="line">        falcon-agent         UP           31635 </span><br><span class="line">      falcon-gateway         UP           31643 </span><br><span class="line">          falcon-api         UP           31653 </span><br><span class="line">        falcon-alarm         UP           31667 </span><br><span class="line">        </span><br><span class="line"><span class="comment">#æ›´å¤šçš„å‘½ä»¤è¡Œå·¥å…·ç”¨æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ./open-falcon [start|stop|restart|check|monitor|reload] module</span></span><br><span class="line">./open-falcon start agent</span><br><span class="line"> </span><br><span class="line">./open-falcon check</span><br><span class="line">        falcon-graph         UP           53007</span><br><span class="line">          falcon-hbs         UP           53014</span><br><span class="line">        falcon-judge         UP           53020</span><br><span class="line">     falcon-transfer         UP           53026</span><br><span class="line">       falcon-nodata         UP           53032</span><br><span class="line">   falcon-aggregator         UP           53038</span><br><span class="line">        falcon-agent         UP           53044</span><br><span class="line">      falcon-gateway         UP           53050</span><br><span class="line">          falcon-api         UP           53056</span><br><span class="line">        falcon-alarm         UP           53063</span><br><span class="line"> </span><br><span class="line"><span class="comment">#For debugging , You can check $WorkDir/$moduleName/log/logs/xxx.log      </span></span><br><span class="line"></span><br><span class="line">[root@falcon open-falcon]# netstat -lntup</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:6379            0.0.0.0:*               LISTEN      20863/redis-server  </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      8960/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      9190/master         </span><br><span class="line">tcp6       0      0 :::6055                 :::*                    LISTEN      31616/falcon-aggreg </span><br><span class="line">tcp6       0      0 :::6090                 :::*                    LISTEN      31597/falcon-nodata </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      22084/mysqld        </span><br><span class="line">tcp6       0      0 :::6379                 :::*                    LISTEN      20863/redis-server  </span><br><span class="line">tcp6       0      0 :::14444                :::*                    LISTEN      31643/falcon-gatewa </span><br><span class="line">tcp6       0      0 :::6060                 :::*                    LISTEN      31589/falcon-transf </span><br><span class="line">tcp6       0      0 :::6030                 :::*                    LISTEN      31567/falcon-hbs    </span><br><span class="line">tcp6       0      0 :::6031                 :::*                    LISTEN      31567/falcon-hbs    </span><br><span class="line">tcp6       0      0 :::8080                 :::*                    LISTEN      31653/falcon-api    </span><br><span class="line">tcp6       0      0 :::8433                 :::*                    LISTEN      31589/falcon-transf </span><br><span class="line">tcp6       0      0 :::6070                 :::*                    LISTEN      31555/falcon-graph  </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      8960/sshd           </span><br><span class="line">tcp6       0      0 :::6071                 :::*                    LISTEN      31555/falcon-graph  </span><br><span class="line">tcp6       0      0 :::9912                 :::*                    LISTEN      31667/falcon-alarm  </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      9190/master         </span><br><span class="line">tcp6       0      0 :::16060                :::*                    LISTEN      31643/falcon-gatewa </span><br><span class="line">tcp6       0      0 :::4444                 :::*                    LISTEN      31589/falcon-transf </span><br><span class="line">tcp6       0      0 :::6080                 :::*                    LISTEN      31578/falcon-judge  </span><br><span class="line">tcp6       0      0 :::18433                :::*                    LISTEN      31643/falcon-gatewa </span><br><span class="line">tcp6       0      0 :::6081                 :::*                    LISTEN      31578/falcon-judge  </span><br><span class="line">tcp6       0      0 :::1988                 :::*                    LISTEN      31635/falcon-agent  </span><br></pre></td></tr></table></figure><h2 id="5-å®¢æˆ·ç«¯">5. å®¢æˆ·ç«¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åˆ›å»ºç›®å½•ï¼Œå¯¼å…¥ç»„ä»¶ä»£ç </span></span><br><span class="line"></span><br><span class="line">[root@open-falcon-agent profile.d]# <span class="built_in">export</span> HOME=/home/work</span><br><span class="line">[root@open-falcon-agent profile.d]# <span class="built_in">export</span> WORKSPACE=<span class="variable">$HOME</span>/open-falcon</span><br><span class="line">[root@open-falcon-agent profile.d]# <span class="built_in">mkdir</span> -p <span class="variable">$WORKSPACE</span></span><br><span class="line">[root@open-falcon-agent profile.d]# <span class="built_in">cd</span> <span class="variable">$WORKSPACE</span></span><br><span class="line">[root@open-falcon-agent open-falcon]# ll</span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line">[root@open-falcon-agent open-falcon]# rz</span><br><span class="line">rz waiting to receive.**[root@open-falcon-agent open-falcon]# ll</span><br><span class="line">total 1516</span><br><span class="line">-r--r--r-- 1 root root 1550458 Jul 31 21:22 dashboard-master.zip</span><br><span class="line">[root@open-falcon-agent open-falcon]# unzip dashboard-master.zip </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@open-falcon-agent open-falcon]# ll</span><br><span class="line">total 1516</span><br><span class="line">drwxr-xr-x 5 root root     265 Jun 22  2020 dashboard-master</span><br><span class="line">-r--r--r-- 1 root root 1550458 Jul 31 21:22 dashboard-master.zip</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å®‰è£…ä¾èµ–åŒ…</span></span><br><span class="line"></span><br><span class="line">yum install -y python-virtualenv</span><br><span class="line">yum install -y python-devel</span><br><span class="line">yum install -y openldap-devel</span><br><span class="line">yum install -y mysql-devel</span><br><span class="line">yum groupinstall <span class="string">&quot;Development tools&quot;</span> -y</span><br><span class="line"></span><br><span class="line">[root@open-falcon-agent dashboard-master]# <span class="built_in">cd</span> <span class="variable">$WORKSPACE</span>/dashboard-master</span><br><span class="line">[root@open-falcon-agent dashboard-master]# ll</span><br><span class="line">total 56</span><br><span class="line">-rw-r--r--  1 root root    97 Jun 22  2020 babel.cfg</span><br><span class="line">-rwxr-xr-x  1 root root  2653 Jun 22  2020 control</span><br><span class="line">-rw-r--r--  1 root root   510 Jun 22  2020 Dockerfile</span><br><span class="line">-rw-r--r--  1 root root   319 Jun 22  2020 entrypoint.sh</span><br><span class="line">-rw-r--r--  1 root root   170 Jun 22  2020 gunicorn.conf</span><br><span class="line">-rw-r--r--  1 root root  1235 Jun 22  2020 i18n.md</span><br><span class="line">-rw-r--r--  1 root root 11358 Jun 22  2020 LICENSE</span><br><span class="line">-rw-r--r--  1 root root   462 Jun 22  2020 NOTICE</span><br><span class="line">-rw-r--r--  1 root root   139 Jun 22  2020 pip_requirements.txt</span><br><span class="line">-rw-r--r--  1 root root  5296 Jun 22  2020 README.md</span><br><span class="line">drwxr-xr-x 10 root root   194 Jun 22  2020 rrd</span><br><span class="line">drwxr-xr-x  2 root root   101 Jun 22  2020 screenshots</span><br><span class="line">drwxr-xr-x  2 root root    65 Jun 22  2020 scripts</span><br><span class="line">-rwxr-xr-x  1 root root   979 Jun 22  2020 wsgi.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@open-falcon-agent dashboard-master]# virtualenv ./env</span><br><span class="line">New python executable <span class="keyword">in</span> /home/work/open-falcon/dashboard-master/env/bin/python2</span><br><span class="line">Also creating executable <span class="keyword">in</span> /home/work/open-falcon/dashboard-master/env/bin/python</span><br><span class="line">Installing setuptools, pip, wheel...done.</span><br><span class="line"></span><br><span class="line">[root@open-falcon-agent dashboard-master]# <span class="built_in">source</span> <span class="built_in">env</span>/bin/activate</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# pip install -r pip_requirements.txt -i</span><br><span class="line"></span><br><span class="line">Usage:   </span><br><span class="line">  pip install [options] &lt;requirement specifier&gt; [package-index-options] ...</span><br><span class="line">  pip install [options] -r &lt;requirements file&gt; [package-index-options] ...</span><br><span class="line">  pip install [options] [-e] &lt;vcs project url&gt; ...</span><br><span class="line">  pip install [options] [-e] &lt;<span class="built_in">local</span> project path&gt; ...</span><br><span class="line">  pip install [options] &lt;archive url/path&gt; ...</span><br><span class="line"></span><br><span class="line">-i option requires an argument</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœå®‰è£…äº†é«˜ç‰ˆæœ¬pipï¼Œè¯·å…ˆå¸è½½pip uninstall pip   å†æŒ‰ä¸¤æ¬¡y</span></span><br><span class="line"><span class="comment">#æŒ‡å®šæºå®‰è£…åŒ…ï¼ˆå¤‡æ³¨ï¼šè¿™æ­¥å¦‚æœå®‰è£…ä¸æˆåŠŸï¼Œè¯·æ£€æŸ¥pipç‰ˆæœ¬æ˜¯å¦ä¸ºpip-9.0.1ï¼‰ </span></span><br><span class="line">pip install -r pip_requirements.txt -i</span><br><span class="line">è¿™é‡Œvirtualenv ./envä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„pythonç¯å¢ƒï¼Œè¯¦è§ï¼šhttps://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001432712108300322c61f256c74803b43bfd65c6f8d0d0000</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åˆ‡æ¢ç¯å¢ƒåï¼Œpipå®‰è£…</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# ./env/bin/pip install -r pip_requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line">Collecting Flask==1.0 (from -r pip_requirements.txt (line 1))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/55/b1/4365193655df97227ace49311365cc296e74b60c7f5c63d23cd30175e2f6/Flask-1.0-py2.py3-none-any.whl (97kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 102kB 1.6MB/s </span><br><span class="line">Collecting Flask-Babel==0.9 (from -r pip_requirements.txt (line 2))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/24/6b/dd9031c446e05600b740086274a9939799f26401b8b96e124ccf71e6a9b2/Flask-Babel-0.9.tar.gz</span><br><span class="line">Collecting Jinja2&gt;=2.10.1 (from -r pip_requirements.txt (line 3))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/7e/c2/1eece8c95ddbc9b1aeb64f5783a9e07a286de42191b7204d67b7496ddf35/Jinja2-2.11.3-py2.py3-none-any.whl (125kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 133kB 4.3MB/s </span><br><span class="line">Collecting Werkzeug==0.15.4 (from -r pip_requirements.txt (line 4))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/9f/57/92a497e38161ce40606c27a86759c6b92dd34fcdb33f64171ec559257c02/Werkzeug-0.15.4-py2.py3-none-any.whl (327kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 327kB 3.1MB/s </span><br><span class="line">Collecting gunicorn==19.9.0 (from -r pip_requirements.txt (line 5))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/8c/da/b8dd8deb741bff556db53902d4706774c8e1e67265f69528c14c003644e6/gunicorn-19.9.0-py2.py3-none-any.whl (112kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 122kB 4.6MB/s </span><br><span class="line">Collecting python-dateutil==2.2 (from -r pip_requirements.txt (line 6))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/75/c5/85d027471fa665f8c8b8eb0b925f9d84b4eee745a257b16de4957de99e81/python-dateutil-2.2.tar.gz (259kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 266kB 5.5MB/s </span><br><span class="line">Collecting requests==2.3.0 (from -r pip_requirements.txt (line 7))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/f7/51/7aa1e337862118bee783c0249debd64cb07b8fbdfef154b1e185754b02d5/requests-2.3.0-py2.py3-none-any.whl (452kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 460kB 2.8MB/s </span><br><span class="line">Collecting mysql-python (from -r pip_requirements.txt (line 8))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/a5/e9/51b544da85a36a68debe7a7091f068d802fc515a3a202652828c73453cad/MySQL-python-1.2.5.zip (108kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 112kB 9.3MB/s </span><br><span class="line">Collecting python-ldap (from -r pip_requirements.txt (line 9))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/9d/e2/deb47064d443344b708ffb5899ea269b201d7c22dcc653ebadcbb44c57d5/python-ldap-3.3.1.tar.gz (379kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 389kB 4.4MB/s </span><br><span class="line">Collecting itsdangerous&gt;=0.24 (from Flask==1.0-&gt;-r pip_requirements.txt (line 1))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl</span><br><span class="line">Collecting click&gt;=5.1 (from Flask==1.0-&gt;-r pip_requirements.txt (line 1))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/d2/3d/fa76db83bf75c4f8d338c2fd15c8d33fdd7ad23a9b5e57eb6c5de26b430e/click-7.1.2-py2.py3-none-any.whl (82kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 92kB 9.6MB/s </span><br><span class="line">Collecting Babel&gt;=1.0 (from Flask-Babel==0.9-&gt;-r pip_requirements.txt (line 2))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/aa/96/4ba93c5f40459dc850d25f9ba93f869a623e77aaecc7a9344e19c01942cf/Babel-2.9.1-py2.py3-none-any.whl (8.8MB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 8.8MB 138kB/s </span><br><span class="line">Collecting speaklater&gt;=1.2 (from Flask-Babel==0.9-&gt;-r pip_requirements.txt (line 2))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/11/92/5ae1effe0ccb8561c034a0111d53c8788660ddb7ed4992f0da1bb5c525e5/speaklater-1.3.tar.gz</span><br><span class="line">Collecting MarkupSafe&gt;=0.23 (from Jinja2&gt;=2.10.1-&gt;-r pip_requirements.txt (line 3))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/fb/40/f3adb7cf24a8012813c5edb20329eb22d5d8e2a0ecf73d21d6b85865da11/MarkupSafe-1.1.1-cp27-cp27mu-manylinux1_x86_64.whl</span><br><span class="line">Collecting six (from python-dateutil==2.2-&gt;-r pip_requirements.txt (line 6))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl</span><br><span class="line">Collecting pyasn1&gt;=0.3.7 (from python-ldap-&gt;-r pip_requirements.txt (line 9))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/d1/75/4686d2872bf2fc0b37917cbc8bbf0dd3a5cdb0990799be1b9cbf1e1eb733/pyasn1-0.5.1-py2.py3-none-any.whl (84kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 92kB 9.6MB/s </span><br><span class="line">Collecting pyasn1_modules&gt;=0.1.5 (from python-ldap-&gt;-r pip_requirements.txt (line 9))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/cd/8e/bea464350e1b8c6ed0da3a312659cb648804a08af6cacc6435867f74f8bd/pyasn1_modules-0.3.0-py2.py3-none-any.whl (181kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 184kB 4.0MB/s </span><br><span class="line">Collecting pytz&gt;=2015.7 (from Babel&gt;=1.0-&gt;Flask-Babel==0.9-&gt;-r pip_requirements.txt (line 2))</span><br><span class="line">  Downloading https://pypi.tuna.tsinghua.edu.cn/packages/9c/3d/a121f284241f08268b21359bd425f7d4825cffc5ac5cd0e1b3d82ffd2b10/pytz-2024.1-py2.py3-none-any.whl (505kB)</span><br><span class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 512kB 2.5MB/s </span><br><span class="line">Building wheels <span class="keyword">for</span> collected packages: Flask-Babel, python-dateutil, mysql-python, python-ldap, speaklater</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> Flask-Babel ... <span class="keyword">done</span></span><br><span class="line">  Stored <span class="keyword">in</span> directory: /home/work/.cache/pip/wheels/ef/39/53/91220f10958c5110d839b0a9fa7ffaa0adb686067089eda64a</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> python-dateutil ... <span class="keyword">done</span></span><br><span class="line">  Stored <span class="keyword">in</span> directory: /home/work/.cache/pip/wheels/03/2c/f1/9d772ba9eb2d4e0b583817de401202b1158140b8bd115e3f97</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> mysql-python ... <span class="keyword">done</span></span><br><span class="line">  Stored <span class="keyword">in</span> directory: /home/work/.cache/pip/wheels/34/db/d9/39a931d72d59ffb68de9f85fe9ac2f02f47eef3fe142589db4</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> python-ldap ... <span class="keyword">done</span></span><br><span class="line">  Stored <span class="keyword">in</span> directory: /home/work/.cache/pip/wheels/8c/9c/45/c563c2acb81523eae28c9e9a7cf4721b486829199c2278230b</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> speaklater ... <span class="keyword">done</span></span><br><span class="line">  Stored <span class="keyword">in</span> directory: /home/work/.cache/pip/wheels/74/c5/f5/62413af6c8e6dbc120b9d9f8ea93bd179f07d3c993a5e4df22</span><br><span class="line">Successfully built Flask-Babel python-dateutil mysql-python python-ldap speaklater</span><br><span class="line">Installing collected packages: MarkupSafe, Jinja2, itsdangerous, Werkzeug, click, Flask, pytz, Babel, speaklater, Flask-Babel, gunicorn, six, python-dateutil, requests, mysql-python, pyasn1, pyasn1-modules, python-ldap</span><br><span class="line">Successfully installed Babel-2.9.1 Flask-1.0 Flask-Babel-0.9 Jinja2-2.11.3 MarkupSafe-1.1.1 Werkzeug-0.15.4 click-7.1.2 gunicorn-19.9.0 itsdangerous-1.1.0 mysql-python-1.2.5 pyasn1-0.5.1 pyasn1-modules-0.3.0 python-dateutil-2.2 python-ldap-3.3.1 pytz-2024.1 requests-2.3.0 six-1.16.0 speaklater-1.3</span><br><span class="line">You are using pip version 9.0.1, however version 24.2 is available.</span><br><span class="line">You should consider upgrading via the <span class="string">&#x27;pip install --upgrade pip&#x27;</span> <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# wget --no-check-certificate https://bootstrap.pypa.io/ez_setup.py</span><br><span class="line">--2024-08-04 01:42:54--  https://bootstrap.pypa.io/ez_setup.py</span><br><span class="line">Resolving bootstrap.pypa.io (bootstrap.pypa.io)... 146.75.112.175, 2a04:4e42:8c::175</span><br><span class="line">Connecting to bootstrap.pypa.io (bootstrap.pypa.io)|146.75.112.175|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 12537 (12K) [text/x-python]</span><br><span class="line">Saving to: â€˜ez_setup.pyâ€™</span><br><span class="line"></span><br><span class="line">100%[=============================================================================&gt;] 12,537      --.-K/s   <span class="keyword">in</span> 0.03s   </span><br><span class="line"></span><br><span class="line">2024-08-04 01:42:57 (422 KB/s) - â€˜ez_setup.pyâ€™ saved [12537/12537]</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å…ˆå®‰è£…ez_setup.py,å†å®‰è£…pip</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# wget --no-check-certificate https://bootstrap.pypa.io/ez_setup.py</span><br><span class="line">--2024-08-04 01:42:54--  https://bootstrap.pypa.io/ez_setup.py</span><br><span class="line">Resolving bootstrap.pypa.io (bootstrap.pypa.io)... 146.75.112.175, 2a04:4e42:8c::175</span><br><span class="line">Connecting to bootstrap.pypa.io (bootstrap.pypa.io)|146.75.112.175|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 12537 (12K) [text/x-python]</span><br><span class="line">Saving to: â€˜ez_setup.pyâ€™</span><br><span class="line"></span><br><span class="line">100%[=============================================================================&gt;] 12,537      --.-K/s   <span class="keyword">in</span> 0.03s   </span><br><span class="line"></span><br><span class="line">2024-08-04 01:42:57 (422 KB/s) - â€˜ez_setup.pyâ€™ saved [12537/12537]</span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# python ez_setup.py --insecure</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¸‹è½½pip</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# wget https://pypi.python.org/packages/11/b6/abcb525026a4be042b486df43905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz#md5=35f01da33009719497f01a4ba69d63c905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz</span><br><span class="line"><span class="comment">#md5=35f01da33009719497f01a4ba69d63c9</span></span><br><span class="line">--2024-08-04 01:43:34--  https://pypi.python.org/packages/11/b6/abcb525026a4be042b486df43905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz</span><br><span class="line">Resolving pypi.python.org (pypi.python.org)... 151.101.76.223, 2a04:4e42:8c::223</span><br><span class="line">Connecting to pypi.python.org (pypi.python.org)|151.101.76.223|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 301 Redirect to Primary Domain</span><br><span class="line">Location: https://pypi.org/packages/11/b6/abcb525026a4be042b486df43905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz [following]</span><br><span class="line">--2024-08-04 01:43:34--  https://pypi.org/packages/11/b6/abcb525026a4be042b486df43905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz</span><br><span class="line">Resolving pypi.org (pypi.org)... 151.101.0.223, 151.101.64.223, 151.101.192.223, ...</span><br><span class="line">Connecting to pypi.org (pypi.org)|151.101.0.223|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 301 Moved Permanently</span><br><span class="line">Location: https://files.pythonhosted.org/packages/11/b6/abcb525026a4be042b486df43905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz [following]</span><br><span class="line">--2024-08-04 01:43:35--  https://files.pythonhosted.org/packages/11/b6/abcb525026a4be042b486df43905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz</span><br><span class="line">Resolving files.pythonhosted.org (files.pythonhosted.org)... 146.75.112.223, 2a04:4e42:8c::223</span><br><span class="line">Connecting to files.pythonhosted.org (files.pythonhosted.org)|146.75.112.223|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 1197370 (1.1M) [binary/octet-stream]</span><br><span class="line">Saving to: â€˜pip-9.0.1.tar.gzâ€™</span><br><span class="line"></span><br><span class="line">100%[=============================================================================&gt;] 1,197,370    836KB/s   <span class="keyword">in</span> 1.4s  </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## è§£å‹å¹¶å®‰è£…</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# tar xf pip-9.0.1.tar.gz </span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# <span class="built_in">cd</span> pip-9.0.1</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent pip-9.0.1]# python setup.py install</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent pip-9.0.1]# <span class="built_in">cd</span> ..</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# <span class="built_in">which</span> pip</span><br><span class="line">/home/work/open-falcon/dashboard-master/env/bin/pip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®pipç¯å¢ƒå˜é‡</span></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#pip path </span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/home/work/open-falcon/dashboard-master/env/bin/pip/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆsource /etc/profile</span></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•æ˜¯å¦å¯ç”¨</span></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# pip</span><br><span class="line">Usage:   </span><br><span class="line">  pip &lt;<span class="built_in">command</span>&gt; [options]</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  install                     Install packages.</span><br><span class="line">  download                    Download packages.</span><br><span class="line">  uninstall                   Uninstall packages.</span><br><span class="line">  freeze                      Output installed packages <span class="keyword">in</span> requirements format.</span><br><span class="line">  list                        List installed packages.</span><br><span class="line">  show                        Show information about installed packages.</span><br><span class="line">  check                       Verify installed packages have compatible dependencies.</span><br><span class="line">  search                      Search PyPI <span class="keyword">for</span> packages.</span><br><span class="line">  wheel                       Build wheels from your requirements.</span><br><span class="line">  <span class="built_in">hash</span>                        Compute hashes of package archives.</span><br><span class="line">  completion                  A helper <span class="built_in">command</span> used <span class="keyword">for</span> <span class="built_in">command</span> completion.</span><br><span class="line">  <span class="built_in">help</span>                        Show <span class="built_in">help</span> <span class="keyword">for</span> commands.</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹éœ€è¦å®‰è£…çš„è½¯ä»¶,å¹¶å®‰è£…</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# <span class="built_in">cat</span> pip_requirements.txt </span><br><span class="line">Flask==1.0</span><br><span class="line">Flask-Babel==0.9</span><br><span class="line">Jinja2&gt;=2.10.1</span><br><span class="line">Werkzeug==0.15.4</span><br><span class="line">gunicorn==19.9.0</span><br><span class="line">python-dateutil==2.2</span><br><span class="line">requests==2.3.0</span><br><span class="line">mysql-python</span><br><span class="line">python-ldap</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# <span class="built_in">cd</span> /home/work/open-falcon/dashboard-master</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# pip install -r pip_requirements.txt</span><br><span class="line">Requirement already satisfied: Flask==1.0 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 1))</span><br><span class="line">Requirement already satisfied: Flask-Babel==0.9 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 2))</span><br><span class="line">Requirement already satisfied: Jinja2&gt;=2.10.1 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 3))</span><br><span class="line">Requirement already satisfied: Werkzeug==0.15.4 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 4))</span><br><span class="line">Requirement already satisfied: gunicorn==19.9.0 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 5))</span><br><span class="line">Requirement already satisfied: python-dateutil==2.2 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 6))</span><br><span class="line">Requirement already satisfied: requests==2.3.0 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 7))</span><br><span class="line">Requirement already satisfied: mysql-python <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 8))</span><br><span class="line">Requirement already satisfied: python-ldap <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from -r pip_requirements.txt (line 9))</span><br><span class="line">Requirement already satisfied: itsdangerous&gt;=0.24 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from Flask==1.0-&gt;-r pip_requirements.txt (line 1))</span><br><span class="line">Requirement already satisfied: click&gt;=5.1 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from Flask==1.0-&gt;-r pip_requirements.txt (line 1))</span><br><span class="line">Requirement already satisfied: speaklater&gt;=1.2 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from Flask-Babel==0.9-&gt;-r pip_requirements.txt (line 2))</span><br><span class="line">Requirement already satisfied: Babel&gt;=1.0 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from Flask-Babel==0.9-&gt;-r pip_requirements.txt (line 2))</span><br><span class="line">Requirement already satisfied: MarkupSafe&gt;=0.23 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from Jinja2&gt;=2.10.1-&gt;-r pip_requirements.txt (line 3))</span><br><span class="line">Requirement already satisfied: six <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from python-dateutil==2.2-&gt;-r pip_requirements.txt (line 6))</span><br><span class="line">Requirement already satisfied: pyasn1-modules&gt;=0.1.5 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from python-ldap-&gt;-r pip_requirements.txt (line 9))</span><br><span class="line">Requirement already satisfied: pyasn1&gt;=0.3.7 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from python-ldap-&gt;-r pip_requirements.txt (line 9))</span><br><span class="line">Requirement already satisfied: pytz&gt;=2015.7 <span class="keyword">in</span> ./env/lib/python2.7/site-packages (from Babel&gt;=1.0-&gt;Flask-Babel==0.9-&gt;-r pip_requirements.txt (line 2))</span><br><span class="line">You are using pip version 9.0.1, however version 24.2 is available.</span><br><span class="line">You should consider upgrading via the <span class="string">&#x27;pip install --upgrade pip&#x27;</span> <span class="built_in">command</span>.</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å…ˆå¤‡ä»½ï¼Œåä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# ll</span><br><span class="line">total 1932</span><br><span class="line">-rw-r--r--  1 root root       97 Jun 22  2020 babel.cfg</span><br><span class="line">-rwxr-xr-x  1 root root     2653 Jun 22  2020 control</span><br><span class="line">-rw-r--r--  1 root root      510 Jun 22  2020 Dockerfile</span><br><span class="line">-rw-r--r--  1 root root      319 Jun 22  2020 entrypoint.sh</span><br><span class="line">drwxr-xr-x  5 root root       82 Aug  4 01:38 <span class="built_in">env</span></span><br><span class="line">-rw-r--r--  1 root root    12537 Jul 29 06:47 ez_setup.py</span><br><span class="line">-rw-r--r--  1 root root      170 Jun 22  2020 gunicorn.conf</span><br><span class="line">-rw-r--r--  1 root root     1235 Jun 22  2020 i18n.md</span><br><span class="line">-rw-r--r--  1 root root    11358 Jun 22  2020 LICENSE</span><br><span class="line">-rw-r--r--  1 root root      462 Jun 22  2020 NOTICE</span><br><span class="line">drwxr-xr-x  7  501 games     217 Aug  4 01:44 pip-9.0.1</span><br><span class="line">-rw-r--r--  1 root root  1197370 Apr 10  2023 pip-9.0.1.tar.gz</span><br><span class="line">-rw-r--r--  1 root root      139 Jun 22  2020 pip_requirements.txt</span><br><span class="line">-rw-r--r--  1 root root     5296 Jun 22  2020 README.md</span><br><span class="line">drwxr-xr-x 10 root root      194 Jun 22  2020 rrd</span><br><span class="line">drwxr-xr-x  2 root root      101 Jun 22  2020 screenshots</span><br><span class="line">drwxr-xr-x  2 root root       65 Jun 22  2020 scripts</span><br><span class="line">-rw-r--r--  1 root root   702770 Aug  4 01:43 setuptools-33.1.1.zip</span><br><span class="line">-rwxr-xr-x  1 root root      979 Jun 22  2020 wsgi.py</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# <span class="built_in">cd</span> rrd/</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent rrd]# ll</span><br><span class="line">total 16</span><br><span class="line">-rwxr-xr-x  1 root root 2764 Jun 22  2020 config.py</span><br><span class="line">-rw-r--r--  1 root root  737 Jun 22  2020 consts.py</span><br><span class="line">drwxr-xr-x  2 root root   25 Jun 22  2020 corelib</span><br><span class="line">-rw-r--r--  1 root root 1539 Jun 22  2020 __init__.py</span><br><span class="line">drwxr-xr-x  3 root root  156 Jun 22  2020 model</span><br><span class="line">drwxr-xr-x  2 root root   49 Jun 22  2020 service</span><br><span class="line">drwxr-xr-x 13 root root  231 Jun 22  2020 static</span><br><span class="line">-rw-r--r--  1 root root 3911 Jun 22  2020 store.py</span><br><span class="line">drwxr-xr-x  8 root root  157 Jun 22  2020 templates</span><br><span class="line">drwxr-xr-x  4 root root   26 Jun 22  2020 translations</span><br><span class="line">drwxr-xr-x  2 root root  132 Jun 22  2020 utils</span><br><span class="line">drwxr-xr-x  7 root root  124 Jun 22  2020 view</span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent rrd]# <span class="built_in">cp</span> config.py config.py.bak</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent rrd]# vim config.py</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent rrd]# <span class="built_in">cat</span> config.py</span><br><span class="line"><span class="comment">#-*-coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Copyright 2017 Xiaomi, Inc.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># app config</span></span><br><span class="line">import os</span><br><span class="line">LOG_LEVEL = os.environ.get(<span class="string">&quot;LOG_LEVEL&quot;</span>,<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line">SECRET_KEY = os.environ.get(<span class="string">&quot;SECRET_KEY&quot;</span>,<span class="string">&quot;secret-key&quot;</span>)</span><br><span class="line">PERMANENT_SESSION_LIFETIME = os.environ.get(<span class="string">&quot;PERMANENT_SESSION_LIFETIME&quot;</span>,3600 * 24 * 30)</span><br><span class="line">SITE_COOKIE = os.environ.get(<span class="string">&quot;SITE_COOKIE&quot;</span>,<span class="string">&quot;open-falcon-ck&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Falcon+ API</span></span><br><span class="line">API_ADDR = os.environ.get(<span class="string">&quot;API_ADDR&quot;</span>,<span class="string">&quot;http://172.16.1.200:18080/api/v1&quot;</span>)</span><br><span class="line">API_USER = os.environ.get(<span class="string">&quot;API_USER&quot;</span>,<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">API_PASS = os.environ.get(<span class="string">&quot;API_PASS&quot;</span>,<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># portal database</span></span><br><span class="line"><span class="comment"># TODO: read from api instead of db</span></span><br><span class="line">PORTAL_DB_HOST = os.environ.get(<span class="string">&quot;PORTAL_DB_HOST&quot;</span>,<span class="string">&quot;172.16.1.200&quot;</span>)</span><br><span class="line">PORTAL_DB_PORT = int(os.environ.get(<span class="string">&quot;PORTAL_DB_PORT&quot;</span>,3306))</span><br><span class="line">PORTAL_DB_USER = os.environ.get(<span class="string">&quot;PORTAL_DB_USER&quot;</span>,<span class="string">&quot;root&quot;</span>)</span><br><span class="line">PORTAL_DB_PASS = os.environ.get(<span class="string">&quot;PORTAL_DB_PASS&quot;</span>,<span class="string">&quot;password&quot;</span>)</span><br><span class="line">PORTAL_DB_NAME = os.environ.get(<span class="string">&quot;PORTAL_DB_NAME&quot;</span>,<span class="string">&quot;falcon_portal&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># alarm database</span></span><br><span class="line"><span class="comment"># TODO: read from api instead of db</span></span><br><span class="line">ALARM_DB_HOST = os.environ.get(<span class="string">&quot;ALARM_DB_HOST&quot;</span>,<span class="string">&quot;172.16.1.200&quot;</span>)</span><br><span class="line">ALARM_DB_PORT = int(os.environ.get(<span class="string">&quot;ALARM_DB_PORT&quot;</span>,3306))</span><br><span class="line">ALARM_DB_USER = os.environ.get(<span class="string">&quot;ALARM_DB_USER&quot;</span>,<span class="string">&quot;root&quot;</span>)</span><br><span class="line">ALARM_DB_PASS = os.environ.get(<span class="string">&quot;ALARM_DB_PASS&quot;</span>,<span class="string">&quot;password&quot;</span>)</span><br><span class="line">ALARM_DB_NAME = os.environ.get(<span class="string">&quot;ALARM_DB_NAME&quot;</span>,<span class="string">&quot;alarms&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ldap config</span></span><br><span class="line">LDAP_ENABLED = os.environ.get(<span class="string">&quot;LDAP_ENABLED&quot;</span>,False)</span><br><span class="line">LDAP_SERVER = os.environ.get(<span class="string">&quot;LDAP_SERVER&quot;</span>,<span class="string">&quot;ldap.forumsys.com:389&quot;</span>)</span><br><span class="line">LDAP_BASE_DN = os.environ.get(<span class="string">&quot;LDAP_BASE_DN&quot;</span>,<span class="string">&quot;dc=example,dc=com&quot;</span>)</span><br><span class="line">LDAP_BINDDN = os.environ.get(<span class="string">&quot;LDAP_BINDDN&quot;</span>,<span class="string">&quot;cn=manager,dc=example,dc=org&quot;</span>)</span><br><span class="line">LDAP_BIND_PASS = os.environ.get(<span class="string">&quot;LDAP_BIND_PASS&quot;</span>,<span class="string">&quot;password&quot;</span>)</span><br><span class="line">LDAP_SEARCH_FMT = os.environ.get(<span class="string">&quot;LDAP_SEARCH_FMT&quot;</span>,<span class="string">&quot;uid=%s&quot;</span>)</span><br><span class="line">LDAP_ATTRS = [<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;mail&quot;</span>,<span class="string">&quot;telephoneNumber&quot;</span>]</span><br><span class="line">LDAP_TLS_START_TLS = False</span><br><span class="line">LDAP_TLS_CACERTDIR = <span class="string">&quot;&quot;</span></span><br><span class="line">LDAP_TLS_CACERTFILE = <span class="string">&quot;/etc/openldap/certs/ca.crt&quot;</span></span><br><span class="line">LDAP_TLS_CERTFILE = <span class="string">&quot;&quot;</span></span><br><span class="line">LDAP_TLS_KEYFILE = <span class="string">&quot;&quot;</span></span><br><span class="line">LDAP_TLS_REQUIRE_CERT = True</span><br><span class="line">LDAP_TLS_CIPHER_SUITE = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># i18n</span></span><br><span class="line">BABEL_DEFAULT_LOCALE   = <span class="string">&#x27;zh_CN&#x27;</span></span><br><span class="line">BABEL_DEFAULT_TIMEZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="comment"># available translations</span></span><br><span class="line">LANGUAGES   = &#123;</span><br><span class="line">    <span class="string">&#x27;en&#x27;</span>:  <span class="string">&#x27;English&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;zh_CN&#x27;</span>:  <span class="string">&#x27;Chinese-Simplified&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># portal site config</span></span><br><span class="line">MAINTAINERS = [<span class="string">&#x27;root&#x27;</span>]</span><br><span class="line">CONTACT = <span class="string">&#x27;root@open-falcon.com&#x27;</span></span><br><span class="line"></span><br><span class="line">DEBUG = True</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    from rrd.local_config import *</span><br><span class="line">except:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[warning] no local config file&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å¯åŠ¨æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent rrd]# <span class="built_in">cd</span> ..</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# ./control start</span><br><span class="line">falcon-dashboard started..., pid=25575</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## æŸ¥çœ‹æ—¥å¿—å¹¶é€€å‡ºç¯å¢ƒ</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# ./control <span class="built_in">tail</span></span><br><span class="line">[2024-08-04 02:03:48 +0000] [25575] [INFO] Starting gunicorn 19.9.0</span><br><span class="line">[2024-08-04 02:03:48 +0000] [25575] [INFO] Listening at: http://0.0.0.0:8081 (25575)</span><br><span class="line">[2024-08-04 02:03:48 +0000] [25575] [INFO] Using worker: <span class="built_in">sync</span></span><br><span class="line">[2024-08-04 02:03:48 +0000] [25580] [INFO] Booting worker with pid: 25580</span><br><span class="line">[2024-08-04 02:03:48 +0000] [25585] [INFO] Booting worker with pid: 25585</span><br><span class="line">[2024-08-04 02:03:48 +0000] [25590] [INFO] Booting worker with pid: 25590</span><br><span class="line">[2024-08-04 02:03:48 +0000] [25591] [INFO] Booting worker with pid: 25591</span><br><span class="line">^C</span><br><span class="line">(<span class="built_in">env</span>) [root@open-falcon-agent dashboard-master]# deactivate</span><br><span class="line">[root@open-falcon-agent dashboard-master]# netstat -lntup</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:8081            0.0.0.0:*               LISTEN      25575/python2       </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      8951/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      9216/master         </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      8951/sshd           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      9216/master</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è®¿é—®ç½‘ç«™ 10.0.0.201ï¼š8081</p><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722708400816.png" alt="img"></p><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722708830296.png" alt="img"></p><p><img src="D:%5CTypora%5Cdevops%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%5C10.open-falcon.assets%5CQQ_1722708967167.png" alt="img"></p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†å°ç±³æ——ä¸‹çš„ä¸€æ¬¾ç›‘æ§è½¯ä»¶falconçš„éƒ¨ç½²</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="falcon" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/falcon/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>zabbixåˆ†å¸ƒå¼ç›‘æ§</title>
    <link href="https://lukme.top/posts/715aec45.html"/>
    <id>https://lukme.top/posts/715aec45.html</id>
    <published>2024-08-24T13:58:53.000Z</published>
    <updated>2024-10-06T14:27:20.468Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cos.lukme.top/Pic/QQ_1723279401909.png" alt="QQ_1723279401909"></p><p><strong>åº”ç”¨åœºæ™¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸€å°Serverç®¡ç†çš„agentè¿‡å¤š</span><br><span class="line">2.éœ€è¦ç®¡ç†çš„agentåœ¨ä¸åŒçš„å›½å®¶æˆ–è€…åœ°åŒºï¼Œæœ‰ç½‘ç»œæ³¢åŠ¨</span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½ç¼“å­˜</span></span><br><span class="line">[root@zabbix5-server ~]# zabbix_server -R config_cache_reload</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="zabbix-proxyç‰¹å¾">zabbix-proxyç‰¹å¾</h3><table><thead><tr><th>proxy</th><th></th></tr></thead><tbody><tr><td>è½»é‡çº§ï¼ˆLightweightï¼‰</td><td>yes</td></tr><tr><td>å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰</td><td>no</td></tr><tr><td>ç‹¬ç«‹å·¥ä½œï¼ˆWorks independentlyï¼‰</td><td>yes</td></tr><tr><td>æ˜“äºç»´æŠ¤ï¼ˆEasy maintenanceï¼‰</td><td>yes</td></tr><tr><td>è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“ï¼ˆAutomatic DB creationï¼‰1</td><td>yes</td></tr><tr><td>æœ¬åœ°ç®¡ç†ï¼ˆLocal administrationï¼‰</td><td>no</td></tr><tr><td>å‡†å¤‡åµŒå…¥å¼ç¡¬ä»¶ ï¼ˆReady for embedded hardwareï¼‰</td><td>yes</td></tr><tr><td>å•å‘TCPè¿æ¥ï¼ˆOne way TCP connectionsï¼‰</td><td>yes</td></tr><tr><td>é›†ä¸­é…ç½®ï¼ˆCentralised configurationï¼‰</td><td>yes</td></tr><tr><td>ç”Ÿæˆé€šçŸ¥ï¼ˆGenerates notificationsï¼‰</td><td>no</td></tr></tbody></table><blockquote><p>1.zabbix proxy æ•°æ®åº“å¿…é¡»å’Œ server åˆ†å¼€,å¦åˆ™æ•°æ®ä¼šè¢«ç ´åã€‚</p><p>2.ä»Zabbix serveræ•°æ®åº“ç›´æ¥æ›´æ–°æœ€æ–°é…ç½®çš„proxyå¯èƒ½ä¼šæ¯”Zabbix serveræ–°ï¼Œè€ŒZabbix serverçš„ é…ç½®ç”±äºCacheUpdateFrequency çš„åŸå› è€Œæ— æ³•å¿«é€Ÿæ›´æ–°ã€‚å› æ­¤ï¼Œproxyæ”¶é›†å‘é€Zabbix serveræ•° æ®å¯èƒ½ä¼šè¢«å¿½ç•¥ã€‚</p></blockquote><p>zabbix proxy æ˜¯ä¸€ä¸ªæ•°æ®æ”¶é›†å™¨,å®ƒä¸è®¡ç®—è§¦å‘å™¨ã€ä¸å¤„ç†äº‹ä»¶ã€ä¸å‘é€æŠ¥è­¦ã€‚</p><p>æœ‰å…³proxyåŠŸèƒ½çš„æ¦‚è¿°ï¼Œ å¦‚ä¸‹è¡¨ï¼š</p><p><img src="https://cos.lukme.top/Pic/QQ_1723280852820.png" alt="QQ_1723280852820"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.æ— æ³•è®¾ç½®è§¦å‘å™¨</span><br><span class="line">2.æ— æ³•å¤„ç†äº‹ä»¶</span><br><span class="line">3.æ— æ³•å‘é€å‘Šè­¦</span><br><span class="line">4.æ— æ³•ä½¿ç”¨è‡ªæ„ˆæ¨¡å¼</span><br></pre></td></tr></table></figure><p><strong>ä»£ç†åœºæ™¯</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723280897596.png" alt="QQ_1723280897596"></p><h3 id="éƒ¨ç½²zabbix-proxy">éƒ¨ç½²zabbix-proxy</h3><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>LanIP</th><th>è§’è‰²</th><th>åº”ç”¨</th></tr></thead><tbody><tr><td>Zabbix5-server</td><td>10.0.0.71</td><td>172.16.1.71</td><td>æœåŠ¡ç«¯</td><td>Zabbix-serverã€ Zabbix-agent</td></tr><tr><td>web01</td><td>10.0.0.7</td><td>172.16.1.7</td><td>zabbix5å®¢æˆ·ç«¯</td><td>Zabbix-agent</td></tr><tr><td>web02</td><td>10.0.0.8</td><td>172.16.1.8</td><td>zabbix5å®¢æˆ·ç«¯</td><td>Zabbix-agent</td></tr><tr><td></td><td>10.0.0.7,10.0.0.8</td><td>172.16.1.7,172.16.1.8</td><td>Zabbixå®¢æˆ·ç«¯ æ”¶é›† Javaç›‘æ§æ•°æ®</td><td>Zabbix-java-gateway</td></tr><tr><td>zabbix_proxy73</td><td>10.0.0.73</td><td>172.16.1.73</td><td>ä»£ç†web01</td><td>zabbix-proxy</td></tr><tr><td>zabbix_proxy74</td><td>10.0.0.74</td><td>172.16.1.74</td><td>ä»£ç†web02</td><td>zabbix-proxy</td></tr></tbody></table><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/7/x86_64/">https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/7/x86_64/</a></p><p><strong>é…ç½®proxy73å’Œweb01</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£…zabbix-proxy</span></span><br><span class="line">[root@zabbix-proxy ~]# yum install -y https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-proxy-mysql-5.0.42-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è¿æ¥æ•°æ®åº“   (zabbix -71æ‰§è¡Œ  æœ‰æ•°æ®åº“)</span></span><br><span class="line">[root@zabbix5-server ~]# mysql</span><br><span class="line">create database zabbix_proxy73 charset utf8;</span><br><span class="line">create database zabbix_proxy74 charset utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å¯¼å…¥æ•°æ®</span></span><br><span class="line">zcat /usr/share/doc/zabbix-proxy-mysql-5.0.42//schema.sql.gz |mysql -uzabbix -p123 -h172.16.1.71 zabbix_proxy73</span><br><span class="line"></span><br><span class="line">zcat /usr/share/doc/zabbix-proxy-mysql-5.0.42//schema.sql.gz |mysql -uzabbix -p123 -h172.16.1.71 zabbix_proxy74</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ä¿®æ”¹zabbix-proxyé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@zabbix-proxy ~]# vim /etc/zabbix/zabbix_proxy.conf</span><br><span class="line">Server=172.16.1.71</span><br><span class="line">Hostname=zabbix_proxy73</span><br><span class="line">DBHost=172.16.1.71</span><br><span class="line">DBName=zabbix_proxy73</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.é…ç½®agentæŒ‡å‘proxy</span></span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">Server=172.16.1.73</span><br><span class="line">ServerActive=172.16.1.73</span><br><span class="line">Hostname=web01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.é‡å¯agent</span></span><br><span class="line">[root@web01 ~]# systemctl restart zabbix-agent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯ä»£ç†</span></span><br><span class="line"><span class="comment">#7.æœ€åé‡å¯zabbix-proxy  ï¼ˆå¦‚æœæœ€åæ•°æ®æ²¡æœ‰æ˜¾ç¤ºï¼Œé‡å¯zabbix-proxyï¼‰</span></span><br><span class="line">systemctl start zabbix-proxy</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-proxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#zabbix-proxyä»£ç†è¦åœ¨  zabbixæœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯é‡å¯ä¹‹å   æœ€åé‡å¯</span></span><br></pre></td></tr></table></figure><p><strong>webç•Œé¢æ“ä½œ</strong></p><p><strong>åˆ›å»ºä»£ç†</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723338047556.png" alt="QQ_1723338047556"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723338284210.png" alt="QQ_1723338284210"></p><p><strong>åœç”¨è‡ªåŠ¨æ³¨å†ŒåŠ¨ä½œï¼Œæ²¡æœ‰åˆ™å¿½ç•¥</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723338342003.png" alt="QQ_1723338342003"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723338415805.png" alt="QQ_1723338415805"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723338495182.png" alt="QQ_1723338495182"></p><p><strong>å›åˆ°ä¸»æœºï¼Œåˆ·æ–°</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723338515005.png" alt="QQ_1723338515005"></p><p><strong>æŸ¥çœ‹ç›‘æ§æ¿é‡Œæ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723338699914.png" alt="QQ_1723338699914"></p><h3 id="è°ƒå–zabbixçš„API">è°ƒå–zabbixçš„API</h3><p>zabbixå®˜æ–¹ï¼š<a href="https://www.zabbix.com/documentation/5.0/zh/manual/api">API (zabbix.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å‡†å¤‡Postmanï¼Œæ³¨å†Œç™»å½•åç”¨äºè°ƒå–zabbixæ¥å£ä½¿ç”¨</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨curlè°ƒå–æ¥å£</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http<span class="punctuation">:</span><span class="comment">//10.0.0.71/api_jsonrpc.php -H &#x27;Content-Type: application/json-rpc&#x27; -d &#x27;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user.login&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zabbix&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span>&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#è¿”å›å€¼ï¼Œå…¶ä¸­resultå€¼æ˜¯token   æ¯æ¬¡tokenéƒ½ä¸ä¸€æ ·</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="string">&quot;17d3a8bddc03d4f6cdc752527e91d03b&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨postmanè°ƒå–æ¥å£</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1723340719798.png" alt="QQ_1723340719798"></p><p><img src="https://cos.lukme.top/Pic/QQ_1723340820336.png" alt="QQ_1723340820336"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.71/api_jsonrpc.php</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;jsonrpc&quot;</span>: <span class="string">&quot;2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;user.login&quot;</span>,</span><br><span class="line">    <span class="string">&quot;params&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;zabbix&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;auth&quot;</span>: null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e4b67c3d6c13c9470c9ec56350552c2d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å¾—tokenåï¼Œæ¯æ¬¡æŸ¥è¯¢å¸¦ä¸Štokenå³å¯</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1723340900158.png" alt="QQ_1723340900158"></p><p><strong>è·å¾—ä¸»æœºç»„ID</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨Postmané‡ŒæŸ¥è¯¢</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;host.get&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                   <span class="string">&quot;hostid&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="string">&quot;host&quot;</span></span><br><span class="line">               <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">               <span class="attr">&quot;selectInterfaces&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                   <span class="string">&quot;interfaceid&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="string">&quot;ip&quot;</span></span><br><span class="line">               <span class="punctuation">]</span></span><br><span class="line">           <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;e4b67c3d6c13c9470c9ec56350552c2d&quot;</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#è¿”å›å€¼</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;result&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;hostid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10460&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;web01&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;interfaces&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;interfaceid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;172.16.1.7&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>è·å–æ¨¡æ¿ID</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;template.get&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;extend&quot;</span><span class="punctuation">,</span></span><br><span class="line">               <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                   <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                      <span class="string">&quot;Template OS Linux by Zabbix agent&quot;</span></span><br><span class="line">                   <span class="punctuation">]</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">           <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;e4b67c3d6c13c9470c9ec56350552c2d&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">##è¿”å›å€¼</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;result&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;proxy_hostid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Template OS Linux by Zabbix agent&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;disable_until&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;available&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;errors_from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lastaccess&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_authtype&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_privilege&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_disable_until&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_available&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;snmp_disable_until&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;snmp_available&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;maintenanceid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;maintenance_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;maintenance_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;maintenance_from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_errors_from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;snmp_errors_from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ipmi_error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;snmp_error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;jmx_disable_until&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;jmx_available&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;jmx_errors_from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;jmx_error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Template OS Linux by Zabbix agent&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;flags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;templateid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Official Linux template. Requires agent of Zabbix 3.0.14, 3.4.5 and 4.0.0 or newer.\r\n\r\nKnown Issues:\r\n\r\n  Description: Network discovery. Zabbix agent as of 4.2 doesn&#x27;t support items such as net.if.status, net.if.speed.\r\n\r\nYou can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/387225-discussion-thread-for-official-zabbix-template-for-linux\r\n\r\nTemplate tooling version used: 0.39&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tls_connect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tls_accept&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tls_issuer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tls_subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tls_psk_identity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tls_psk&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;proxy_address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;auto_compress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ ä¸»æœº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ¨¡æ¿æœºIDï¼Œä¸»æœºç»„IDï¼ˆgroupidï¼‰ä¸Šé¢å·²è·å–</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://10.0.0.71/api_jsonrpc.php -H <span class="string">&#x27;Content-Type: application/json-rpc&#x27;</span> -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">           &quot;jsonrpc&quot;: &quot;2.0&quot;,</span></span><br><span class="line"><span class="string">           &quot;method&quot;: &quot;host.create&quot;,</span></span><br><span class="line"><span class="string">           &quot;params&quot;: &#123;</span></span><br><span class="line"><span class="string">               &quot;host&quot;: &quot;Linux server&quot;,</span></span><br><span class="line"><span class="string">               &quot;interfaces&quot;: [</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                       &quot;type&quot;: 1,</span></span><br><span class="line"><span class="string">                       &quot;main&quot;: 1,</span></span><br><span class="line"><span class="string">                       &quot;useip&quot;: 1,</span></span><br><span class="line"><span class="string">                       &quot;ip&quot;: &quot;10.0.0.9&quot;,</span></span><br><span class="line"><span class="string">                       &quot;dns&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">                       &quot;port&quot;: &quot;10050&quot;</span></span><br><span class="line"><span class="string">                   &#125;</span></span><br><span class="line"><span class="string">               ],</span></span><br><span class="line"><span class="string">               &quot;groups&quot;: [</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                       &quot;groupid&quot;: &quot;2&quot;</span></span><br><span class="line"><span class="string">                   &#125;</span></span><br><span class="line"><span class="string">               ],</span></span><br><span class="line"><span class="string">               &quot;tags&quot;: [</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                       &quot;tag&quot;: &quot;Host name&quot;,</span></span><br><span class="line"><span class="string">                       &quot;value&quot;: &quot;Linux server&quot;</span></span><br><span class="line"><span class="string">                   &#125;</span></span><br><span class="line"><span class="string">               ],</span></span><br><span class="line"><span class="string">               &quot;templates&quot;: [</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                       &quot;templateid&quot;: &quot;20045&quot;</span></span><br><span class="line"><span class="string">                   &#125;,</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                   &quot;templateid&quot;: &quot;10001&quot;</span></span><br><span class="line"><span class="string">                   &#125;</span></span><br><span class="line"><span class="string">               ],</span></span><br><span class="line"><span class="string">               &quot;macros&quot;: [</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                       &quot;macro&quot;: &quot;&#123;$USER_ID&#125;&quot;,</span></span><br><span class="line"><span class="string">                       &quot;value&quot;: &quot;123321&quot;</span></span><br><span class="line"><span class="string">                   &#125;,</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                       &quot;macro&quot;: &quot;&#123;$USER_LOCATION&#125;&quot;,</span></span><br><span class="line"><span class="string">                       &quot;value&quot;: &quot;0:0:0&quot;,</span></span><br><span class="line"><span class="string">                       &quot;description&quot;: &quot;latitude, longitude and altitude coordinates&quot;</span></span><br><span class="line"><span class="string">                   &#125;</span></span><br><span class="line"><span class="string">               ],</span></span><br><span class="line"><span class="string">               &quot;inventory_mode&quot;: 0,</span></span><br><span class="line"><span class="string">               &quot;inventory&quot;: &#123;</span></span><br><span class="line"><span class="string">                   &quot;macaddress_a&quot;: &quot;01234&quot;,</span></span><br><span class="line"><span class="string">                   &quot;macaddress_b&quot;: &quot;56768&quot;</span></span><br><span class="line"><span class="string">               &#125;</span></span><br><span class="line"><span class="string">           &#125;,</span></span><br><span class="line"><span class="string">           &quot;auth&quot;: &quot;e4b67c3d6c13c9470c9ec56350552c2d&quot;,</span></span><br><span class="line"><span class="string">           &quot;id&quot;: 1</span></span><br><span class="line"><span class="string">       &#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¸¦ä½ äº†è§£ä»€ä¹ˆæ˜¯zabbix-proxyåŠä½¿ç”¨</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>zabbixé‚®ä»¶å‘Šè­¦</title>
    <link href="https://lukme.top/posts/97b5f9b7.html"/>
    <id>https://lukme.top/posts/97b5f9b7.html</id>
    <published>2024-08-23T15:10:00.000Z</published>
    <updated>2024-08-23T15:30:10.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-æ·»åŠ æŠ¥è­¦åª’ä»‹">1.æ·»åŠ æŠ¥è­¦åª’ä»‹</h3><p><img src="https://cos.lukme.top/Pic/QQ_1722776498063.png" alt="QQ_1722776498063"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722776993991.png" alt="QQ_1722776993991"></p><p><strong>è·å–QQé‚®ç®±æˆæƒç </strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722776749588.png" alt="QQ_1722776749588"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722776784428.png" alt="QQ_1722776784428"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722776853820.png" alt="QQ_1722776853820"></p><p><strong>å¯ä»¥æµ‹è¯•èƒ½å¦æˆåŠŸå‘é‚®ä»¶</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722777067263.png" alt="QQ_1722777067263"></p><h3 id="2-æ·»åŠ åŠ¨ä½œ">2.æ·»åŠ åŠ¨ä½œ</h3><p><img src="https://cos.lukme.top/Pic/QQ_1722778117057.png" alt="QQ_1722778117057"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722777618840.png" alt="QQ_1722777618840"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722777179047.png" alt="QQ_1722777179047"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722777497942.png" alt="QQ_1722777497942"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722777580123.png" alt="QQ_1722777580123"></p><h3 id="3-æ·»åŠ æŠ¥è­¦æ”¶ä»¶äºº">3.æ·»åŠ æŠ¥è­¦æ”¶ä»¶äºº</h3><p><img src="https://cos.lukme.top/Pic/QQ_1722777689193.png" alt="QQ_1722777689193"></p><p><strong>æµ‹è¯•</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722777896537.png" alt="QQ_1722777896537"></p><h3 id="4-é‚®ä»¶å‘Šè­¦-htmlå‘Šè­¦">4.é‚®ä»¶å‘Šè­¦-htmlå‘Šè­¦</h3><p><img src="https://cos.lukme.top/Pic/QQ_1722841657383.png" alt="QQ_1722841657383"></p><p><strong>æ•…éšœ</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">æ•…éšœ</span><span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="language-xml">,æœåŠ¡å™¨:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="language-xml">å‘ç”Ÿ: </span><span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="language-xml">æ•…éšœ!</span></span><br><span class="line"><span class="language-xml">å‘Šè­¦åœ°å€:</span><span class="template-variable">&#123;HOST.IP&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">å‘Šè­¦ä¸»æœº:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">å‘Šè­¦æ—¶é—´:</span><span class="template-variable">&#123;EVENT.DATE&#125;</span><span class="language-xml"> </span><span class="template-variable">&#123;EVENT.TIME&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">å‘Šè­¦ç­‰çº§:</span><span class="template-variable">&#123;TRIGGER.SEVERITY&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">å‘Šè­¦ä¿¡æ¯: </span><span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">å‘Šè­¦é¡¹ç›®:</span><span class="template-variable">&#123;TRIGGER.KEY1&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">é—®é¢˜è¯¦æƒ…:</span><span class="template-variable">&#123;ITEM.NAME&#125;</span><span class="language-xml">:</span><span class="template-variable">&#123;ITEM.VALUE&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">å½“å‰çŠ¶æ€:</span><span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="language-xml">:</span><span class="template-variable">&#123;ITEM.VALUE1&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">äº‹ä»¶ID:</span><span class="template-variable">&#123;EVENT.ID&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">&#x27;https://seopic.699pic.com/photo/40007/7490.jpg_wh1200.jpg&#x27;</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://pic1.win4000.com/wallpaper/8/573acd203bc77.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">table</span> <span class="selector-class">.guzhang</span> &#123;<span class="attribute">color</span>: red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;3&quot;</span> <span class="attr">bordercolor</span>=<span class="string">&quot;black&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0px&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;4px&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;guzhang&quot;</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#0C1B3D&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">2</span>&gt;</span>&#123;TRIGGER.STATUS&#125; æ•…éšœï¼ï¼ï¼æ•…éšœï¼ï¼ï¼</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="symbol">&amp;#128514;</span> <span class="symbol">&amp;#128514;</span> <span class="symbol">&amp;#128514;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span> <span class="attr">width</span>=<span class="string">&quot;20%&quot;</span>&gt;</span>å‘Šè­¦ä¸»æœº<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;HOSTNAME1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>å‘Šè­¦åˆ«å<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;HOST.NAME&#125; <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>å‘Šè­¦åœ°å€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;HOST.IP&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>å‘Šè­¦æ—¶é—´<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>å‘Šè­¦ç­‰çº§<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;TRIGGER.SEVERITY&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>å‘Šè­¦ä¿¡æ¯<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;TRIGGER.NAME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>å‘Šè­¦é¡¹ç›®<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;TRIGGER.KEY1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&#x27;guzhang2&#x27;</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#FF3333&quot;</span>&gt;</span>é—®é¢˜è¯¦æƒ…<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&#x27;guzhang3&#x27;</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#FF3333&quot;</span>&gt;</span>&#123;ITEM.NAME&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE&#125; <span class="symbol">&amp;#128520;</span> <span class="symbol">&amp;#128520;</span> <span class="symbol">&amp;#128520;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>å½“å‰çŠ¶æ€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;TRIGGER.STATUS&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>äº‹ä»¶ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#F9B602&quot;</span>&gt;</span>&#123;EVENT.ID&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ¢å¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ¢å¤&#123;TRIGGER.STATUS&#125;, æœåŠ¡å™¨:&#123;HOSTNAME1&#125;: &#123;TRIGGER.NAME&#125;å·²æ¢å¤!</span><br><span class="line">å‘Šè­¦åœ°å€:&#123;HOST.IP&#125;</span><br><span class="line">å‘Šè­¦ä¸»æœº:&#123;HOSTNAME1&#125;</span><br><span class="line">å‘Šè­¦æ—¶é—´:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line">å‘Šè­¦ç­‰çº§:&#123;TRIGGER.SEVERITY&#125;</span><br><span class="line">å‘Šè­¦ä¿¡æ¯: &#123;TRIGGER.NAME&#125;</span><br><span class="line">å‘Šè­¦é¡¹ç›®:&#123;TRIGGER.KEY1&#125;</span><br><span class="line">é—®é¢˜è¯¦æƒ…:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</span><br><span class="line">å½“å‰çŠ¶æ€:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</span><br><span class="line">äº‹ä»¶ID:&#123;EVENT.ID&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">table</span> <span class="selector-class">.guzhang</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">&#x27;https://seopic.699pic.com/photo/40007/7490.jpg_wh1200.jpg&#x27;</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://pic1.win4000.com/wallpaper/8/573acd203bc77.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">bordercolor</span>=<span class="string">&quot;black&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0px&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;4px&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#49c208&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">2</span>&gt;</span></span><br><span class="line">    &#123;TRIGGER.STATUS&#125; å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ,å¥½äº†</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="symbol">&amp;#128512;</span> <span class="symbol">&amp;#128512;</span> <span class="symbol">&amp;#128512;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span> <span class="attr">width</span>=<span class="string">&quot;20%&quot;</span>&gt;</span>æ¢å¤ä¸»æœº<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;HOSTNAME1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>æ¢å¤åˆ«å<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;HOST.NAME&#125; <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>æ¢å¤åœ°å€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;HOST.IP&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>æ¢å¤æ—¶é—´<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;EVENT.DATE&#125; &#123;EVENT.RECOVERY.TIME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>æ¢å¤ç­‰çº§<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;TRIGGER.SEVERITY&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>æ¢å¤ä¿¡æ¯<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;TRIGGER.NAME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>æ¢å¤é¡¹ç›®<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;TRIGGER.KEY1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#49c208&quot;</span>&gt;</span>æ¢å¤è¯¦æƒ…<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#49c208&quot;</span>&gt;</span>&#123;ITEM.NAME&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE&#125; <span class="symbol">&amp;#9889;</span> <span class="symbol">&amp;#9889;</span><span class="symbol">&amp;#9889;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>å½“å‰çŠ¶æ€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;TRIGGER.STATUS&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;lightgreen&quot;</span>&gt;</span>äº‹ä»¶ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span>&#123;EVENT.ID&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†zabbixå¦‚ä½•å®ç°é‚®ä»¶å‘Šè­¦é€šçŸ¥</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>zabbixè‡ªå®šä¹‰ç›‘æ§é¡¹</title>
    <link href="https://lukme.top/posts/9ccde0e4.html"/>
    <id>https://lukme.top/posts/9ccde0e4.html</id>
    <published>2024-08-22T14:10:00.000Z</published>
    <updated>2024-10-06T13:47:24.307Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åˆ›å»ºæ¨¡æ¿">åˆ›å»ºæ¨¡æ¿</h3><p><img src="https://cos.lukme.top/Pic/QQ_1722762642396.png" alt="QQ_1722762642396"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722762853490.png" alt="QQ_1722762853490"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722766153284.png" alt="QQ_1722766153284"></p><p><strong>è‡ªå®šä¹‰ç›‘æ§å®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.ç›‘æ§ç”¨æˆ·ç™»å½•æ•°é‡</span><br><span class="line">2.ç›‘æ§æœåŠ¡æ˜¯å¦å­˜æ´»</span><br></pre></td></tr></table></figure><p><strong>1.ç›‘æ§ç”¨æˆ·ç™»å½•æ•°é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.äº†è§£ç›‘æ§éœ€æ±‚ï¼Œè·å–ç›‘æ§æ•°æ®</span></span><br><span class="line"><span class="comment">## é›¶å®½æ–­è¨€</span></span><br><span class="line">[root@web02 ~]# ifconfig eth0|grep -Po <span class="string">&#x27;[1-9][0-9]*\.\d+\.\d+\.\d+(?= netmask)&#x27;</span></span><br><span class="line">[root@web02 ~]# <span class="built_in">uptime</span>|grep -Po <span class="string">&#x27;\d+(?= user)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹zabbix-agentçš„é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨zabbix-agenté…ç½®æ–‡ä»¶ä¸­çš„ UserParameter= å®šä¹‰ç›‘æ§é¡¹ï¼‰</span></span><br><span class="line">è¯­æ³•ï¼š</span><br><span class="line">Format: UserParameter=&lt;key&gt;,&lt;shell <span class="built_in">command</span>&gt;</span><br><span class="line">Format: UserParameter=ç›‘æ§é¡¹åå­—,shellå‘½ä»¤</span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">UserParameter=user.count,<span class="built_in">uptime</span>|grep -Po <span class="string">&#x27;\d+(?= user)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##å»ºè®®ä»¥åç›´æ¥åˆ›å»ºconfæ–‡ä»¶ï¼ˆç±»ä¼¼nginxå­é…ç½®æ–‡ä»¶ï¼‰</span></span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.d/userlogin.conf</span><br><span class="line">UserParameter=user.count,<span class="built_in">uptime</span>|grep -Po <span class="string">&#x27;\d+(?= user)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.é‡å¯zabbix-agent</span></span><br><span class="line">[root@web01 ~]# systemctl restart zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åœ¨zabbix-serverä¸Šï¼ˆzabbix-getï¼‰æµ‹è¯•ï¼Œæ˜¯å¦å¯ä»¥æ¥æ”¶åˆ°zabbix-agentè·å–çš„æ•°æ®</span></span><br><span class="line">rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-get-5.0.0-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">[root@zabbix5 ~]# zabbix_get -s 172.16.1.7 -k user.count</span><br><span class="line">1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ ç›‘æ§é¡¹">æ·»åŠ ç›‘æ§é¡¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç»Ÿä¸€æ·»åŠ åˆ°åˆ›å»ºçš„æ¨¡æ¿é‡Œï¼Œæ¯æ¬¡ç›‘æ§éƒ½ä¸éœ€è¦å•ç‹¬åˆ›å»ºç›‘æ§é¡¹ï¼Œè€Œæ˜¯ç›´æ¥é€‰æ‹©è¿™ä¸ªæ¨¡æ¿å°±è¡Œ</span></span><br><span class="line">æ‰¾åˆ°åˆ›å»ºçš„è‡ªå®šä¹‰æ¨¡æ¿&gt;ç›‘æ§é¡¹&gt;åˆ›å»ºç›‘æ§é¡¹</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722766187140.png" alt="QQ_1722766187140"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722766273027.png" alt="QQ_1722766273027"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722771986050.png" alt="QQ_1722771986050"></p><h3 id="æ·»åŠ è§¦å‘å™¨">æ·»åŠ è§¦å‘å™¨</h3><p><strong>å¦‚ä½•åšåˆ°æŠ¥è­¦æé†’ï¼Ÿ</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722772037897.png" alt="QQ_1722772037897"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722772224830.png" alt="QQ_1722772224830"></p><p><strong>æ·»åŠ è¡¨è¾¾å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ’å…¥è¡¨è¾¾å¼åï¼Œæ·»åŠ æ•°æ®ï¼Œè¡¨è¾¾å¼é€‰æ‹©&gt;   å›¾1é”™äº†</span><br><span class="line"></span><br><span class="line">&#123;HOST.NAME&#125;:å¯è§çš„åç§°</span><br><span class="line">&#123;HOST.IP&#125;ï¼šIPåœ°å€</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722772470739.png" alt="QQ_1722772470739"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722772899528.png" alt="QQ_1722772899528"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å˜é‡</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722773526820.png" alt="QQ_1722773526820"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…³è”æ¨¡æ¿</span></span><br><span class="line">é…ç½®&gt;ä¸»æœº&gt;web01-10.0.0.7&gt;æ¨¡æ¿&gt;é€‰æ‹©è‡ªå®šä¹‰æ¨¡æ¿</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722772708350.png" alt="QQ_1722772708350"></p><p><strong>==æµ‹è¯•==</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722772812337.png" alt="QQ_1722772812337"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722773021302.png" alt="QQ_1722773021302"></p><h3 id="æ·»åŠ å›¾è¡¨">æ·»åŠ å›¾è¡¨</h3><p><img src="https://cos.lukme.top/Pic/QQ_1722773128565.png" alt="QQ_1722773128565"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºå›¾å½¢</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722773144333.png" alt="QQ_1722773144333"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722773217580.png" alt="QQ_1722773217580"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722773354712.png" alt="QQ_1722773354712"></p><h3 id="ç›‘æ§æœåŠ¡çŠ¶æ€">ç›‘æ§æœåŠ¡çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.è·å–æ•°æ®</span></span><br><span class="line">[root@web01 ~]# netstat -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line">1</span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.d/port.conf</span><br><span class="line">UserParameter=tcp.port.ssh,netstat -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;22&quot;</span></span><br><span class="line">UserParameter=tcp.port.http,netstat -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">UserParameter=tcp.port.tomcat,netstat -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3ï¼Œé‡å¯å®¢æˆ·ç«¯</span></span><br><span class="line">systemctl restart zabbix-agent.service </span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚æ•°åŒ–å®šä¹‰ç›‘æ§é¡¹</span></span><br><span class="line">[root@web01 ~]#vim /etc/zabbix/zabbix_agentd.d/port.conf</span><br><span class="line">UserParameter=tcp.port[*],ss -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">[root@web01 ~]# systemctl restart zabbix-agen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚ä½•è·å–å€¼ï¼Ÿ</span></span><br><span class="line">[root@zabbix5 fonts]# zabbix_get -s 172.16.1.7 -k tcp.port[80]</span><br><span class="line">0</span><br></pre></td></tr></table></figure><p><strong>ä¾æ¬¡æ·»åŠ ç›‘æ§é¡¹</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722774448589.png" alt="QQ_1722774448589"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722774470909.png" alt="QQ_1722774470909"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722774493661.png" alt="QQ_1722774493661"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722775398498.png" alt="QQ_1722775398498"></p><p><strong>æ’é”™</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722774829533.png" alt="QQ_1722774829533"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722774871851.png" alt="QQ_1722774871851"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix5 fonts]# zabbix_get -s 172.16.1.7 -k tcp.port.http</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">æŠ¥é”™åŸå› ï¼šå®šä¹‰ç›‘æ§é¡¹æ—¶ï¼Œå®šä¹‰çš„æ•°æ®ç±»å‹æ˜¯æ•°å­—ï¼Œç»“æœè·å–åˆ°çš„å€¼å«æœ‰å­—ç¬¦ä¸²</span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šå°†zabbixç”¨æˆ·ææƒ</span><br><span class="line">[root@web01 ~]# visudo</span><br><span class="line">zabbix ALL=(ALL) NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘æ§å‘½ä»¤ï¼š</span></span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.d/port.conf</span><br><span class="line">UserParameter=tcp.port.ssh,<span class="built_in">sudo</span> netstat -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;22&quot;</span></span><br><span class="line">UserParameter=tcp.port.http,<span class="built_in">sudo</span> netstat -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">UserParameter=tcp.port.tomcat,<span class="built_in">sudo</span> netstat -lntup|grep -<span class="built_in">wc</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">UserParameter=tcp.port.ssh,ss -ltnup|grep -<span class="built_in">wc</span> <span class="string">&#x27;sshd&#x27;</span></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">ç»™netstatå‘½ä»¤åŠ setuidæƒé™</span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ è§¦å‘å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¡¨è¾¾å¼æ·»åŠ ï¼Œé€‰æ‹©nginxçš„è§¦å‘å™¨ï¼Œé˜ˆå€¼ä¸º0</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722776310520.png" alt="QQ_1722776310520"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722776258077.png" alt="QQ_1722776258077"></p><h3 id="ç›‘æ§nginxçŠ¶æ€é¡µ">ç›‘æ§nginxçŠ¶æ€é¡µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/webapp.conf</span><br><span class="line">server&#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name _;</span><br><span class="line">location / &#123;</span><br><span class="line">root /code/webapp;</span><br><span class="line">index index.html;</span><br><span class="line">&#125;</span><br><span class="line">location /status &#123;</span><br><span class="line">stub_status on;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http://10.0.0.7/status</span><br><span class="line">http://webapp.com/status</span><br><span class="line"><span class="comment">#æ³¨ï¼šå¦‚æœä½¿ç”¨åŸŸåï¼Œç‰©ç†æœºå’Œè™šæ‹Ÿæœºéƒ½éœ€è¦hostsåŸŸåè§£æ</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722778620045.png" alt="QQ_1722778620045"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºå­˜æ”¾ç›‘æ§è„šæœ¬ç›®å½•</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">mkdir</span> /etc/zabbix/zabbix_agentd.d/scripts</span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.d/scripts/nginx_status.sh</span><br><span class="line"></span><br><span class="line">NGINX_PORT=80 <span class="comment">#å¦‚æœç«¯å£ä¸åŒä»…éœ€è¦ä¿®æ”¹è„šæœ¬å³å¯ï¼Œå¦åˆ™ä¿®æ”¹xmlå¾ˆéº»çƒ¦</span></span><br><span class="line">NGINX_URL=http://172.16.1.7/status</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_active</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;NGINX_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/Active/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">nginx_reading</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;NGINX_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/Reading/ &#123;print $2&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">nginx_writing</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;NGINX_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/Writing/ &#123;print $4&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">nginx_waiting</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;NGINX_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;/Waiting/ &#123;print $6&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">nginx_accepts</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;NGINX_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;NR==3 &#123;print $1&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">nginx_handled</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;NGINX_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;NR==3 &#123;print $2&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">nginx_requests</span></span>()&#123;</span><br><span class="line">/usr/bin/curl -s <span class="string">&quot;<span class="variable">$&#123;NGINX_URL&#125;</span>&quot;</span> |awk <span class="string">&#x27;NR==3 &#123;print $3&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">active)</span><br><span class="line">nginx_active;</span><br><span class="line">;;</span><br><span class="line">reading)</span><br><span class="line">nginx_reading;</span><br><span class="line">;;</span><br><span class="line">writing)</span><br><span class="line">nginx_writing;</span><br><span class="line">;;</span><br><span class="line">waiting)</span><br><span class="line">nginx_waiting;</span><br><span class="line">;;</span><br><span class="line">accepts)</span><br><span class="line">nginx_accepts;</span><br><span class="line">;;</span><br><span class="line">handled)</span><br><span class="line">nginx_handled;</span><br><span class="line">;;</span><br><span class="line">requests)</span><br><span class="line">nginx_requests;</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> $<span class="string">&quot;USAGE:<span class="variable">$0</span> &#123;active|reading|writing|waiting|accepts|handled|requests&#125;&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆæƒ</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">chmod</span> +x /etc/zabbix/zabbix_agentd.d/scripts/nginx_status.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹zabbix-agenté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.d/nginx_status.conf</span><br><span class="line">UserParameter=nginx.status[*],/etc/zabbix/zabbix_agentd.d/scripts/nginx_status.sh <span class="variable">$1</span></span><br><span class="line"><span class="comment">#é‡å¯å®¢æˆ·ç«¯</span></span><br><span class="line">[root@web01 ~]# systemctl restart zabbix-agent</span><br></pre></td></tr></table></figure><p><strong>ä¾æ¬¡æ·»åŠ ç›‘æ§é¡¹</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722780577877.png" alt="QQ_1722780577877"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722780778047.png" alt="QQ_1722780778047"></p><p><strong>æ·»åŠ å›¾å½¢</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722780847328.png" alt="QQ_1722780847328"></p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†zabbixå¦‚ä½•è‡ªå®šä¹‰åˆ›å»ºç›‘æ§é¡¹</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>zabbixéƒ¨ç½²</title>
    <link href="https://lukme.top/posts/42dcb23.html"/>
    <id>https://lukme.top/posts/42dcb23.html</id>
    <published>2024-08-21T14:10:12.000Z</published>
    <updated>2024-10-02T12:49:58.833Z</updated>
    
    <content type="html"><![CDATA[<h3 id="zabbix5éƒ¨ç½²">zabbix5éƒ¨ç½²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">zabbixç‰ˆæœ¬</span><br><span class="line">7.0ï¼šä¸æ”¯æŒC7</span><br><span class="line">6.4ï¼šä¸æ”¯æŒC7</span><br><span class="line">6.0ï¼šä¸æ”¯æŒC7</span><br><span class="line">5.0ï¼šæ”¯æŒC7</span><br><span class="line">4.xï¼šzabbixå‰åç«¯åˆ†ç¦»</span><br><span class="line">3.xï¼šzabbixå‰åç«¯ä¸åˆ†ç¦»</span><br><span class="line"></span><br><span class="line"><span class="comment">#éƒ¨ç½²zabbxi5å’Œzabbix3ï¼Œçœ‹çœ‹åŒºåˆ«</span></span><br></pre></td></tr></table></figure><p><strong>ç¯å¢ƒå‡†å¤‡</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>å†…ç½‘ip</th><th>ip</th><th>è§’è‰²</th><th style="text-align:left">åº”ç”¨</th></tr></thead><tbody><tr><td>zabbix5</td><td>172.16.1.71</td><td>10.0.0.71</td><td>zabbixæœåŠ¡ç«¯</td><td style="text-align:left">zabbix-serverã€MySQL</td></tr><tr><td>zabbix3</td><td>172.16.1.72</td><td>10.0.0.72</td><td>zabbixæœåŠ¡ç«¯</td><td style="text-align:left">zabbix-serverã€MySQL</td></tr><tr><td>web01</td><td>172.16.1.7</td><td>10.0.0.7</td><td>zabbix5çš„å®¢æˆ·ç«¯</td><td style="text-align:left">zabbix-agent</td></tr><tr><td>web02</td><td>172.16.1.8</td><td>10.0.0.8</td><td>zabbix3çš„å®¢æˆ·ç«¯</td><td style="text-align:left">zabbix-agent</td></tr></tbody></table><p>å®˜ç½‘ï¼š<a href="https://www.zabbix.com/">https://www.zabbix.com/</a>   ç‚¹å‡»download</p><h4 id="å®‰è£…æœåŠ¡ç«¯">å®‰è£…æœåŠ¡ç«¯</h4><p><strong>éƒ¨ç½²zabbix5</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722752866743.png" alt="QQ_1722752866743"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#zabbix5æœåŠ¡ç«¯10.0.0.71æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#1.æ›´æ¢zabbixå®˜æ–¹æº</span></span><br><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.å®‰è£…éƒ¨ç½²åç«¯ä»£ç å’Œå®¢æˆ·ç«¯</span></span><br><span class="line">yum install -y zabbix-server-mysql zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æ·»åŠ zabbixå‰ç«¯ä»£ç æº</span></span><br><span class="line">yum install centos-release-scl -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æ‰“å¼€yumä»“åº“ä½¿ç”¨</span></span><br><span class="line">[root@zabbix5-server ~]# vim /etc/yum.repos.d/zabbix.repo</span><br><span class="line">[zabbix-frontend]</span><br><span class="line">...</span><br><span class="line">enabled=1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.å®‰è£…zabbixå‰ç«¯ä»£ç </span></span><br><span class="line">yum -y install zabbix-web-mysql-scl zabbix-nginx-conf-scl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŠ¥é”™</span></span><br><span class="line">Cannot find a valid baseurl <span class="keyword">for</span> repo: centos-sclo-rh/x86_64</span><br><span class="line">åŸå› ï¼šCentOS7çš„SCLæºåœ¨2024å¹´6æœˆ30æ—¥åœæ­¢ç»´æŠ¤äº†ã€‚ å½“sclæºé‡Œé¢é»˜è®¤ä½¿ç”¨äº†centoså®˜æ–¹çš„åœ°å€ï¼Œæ— æ³•è¿æ¥ï¼Œéœ€è¦æ›¿æ¢ä¸ºé˜¿é‡Œäº‘ã€‚</span><br><span class="line">è§£å†³ï¼š</span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line"><span class="built_in">mv</span> CentOS-SCLo-scl.repo CentOS-SCLo-scl.repo.bak</span><br><span class="line"><span class="built_in">mv</span> CentOS-SCLo-scl-rh.repo CentOS-SCLo-scl-rh.repo.bak</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ¢é˜¿é‡Œäº‘</span></span><br><span class="line">vim CentOS-SCLo-rh.repo</span><br><span class="line">[centos-sclo-rh]</span><br><span class="line">name=CentOS-7 - SCLo rh</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/7/sclo/x86_64/rh/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.è§£å†³æŠ¥é”™ä¹‹åé‡æ–°å®‰è£…</span></span><br><span class="line">yum -y install zabbix-web-mysql-scl zabbix-nginx-conf-scl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.å®‰è£…MySQL</span></span><br><span class="line">yum install -y mariadb-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.å¯åŠ¨MySQLå¹¶åŠ å…¥å¼€æœºè‡ªå¯</span></span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.è¿›å…¥mysqlå¹¶åˆ›å»ºæ•°æ®åº“</span></span><br><span class="line">mysql</span><br><span class="line">MariaDB [(none)]&gt; create database zabbix5 character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">MariaDB [(none)]&gt; grant all on *.* to zabbix@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">é€€å‡º</span><br><span class="line">\q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.å¯¼å…¥æ•°æ®</span></span><br><span class="line">[root@zabbix5 ~]#zcat /usr/share/doc/zabbix-server-mysql-5.0.42/create.sql.gz | mysql-uzabbix -p123 -h172.16.1.71 zabbix5</span><br><span class="line">ERROR 1045 (28000):Access denied <span class="keyword">for</span> user <span class="string">&#x27;zabbix&#x27;</span>@<span class="string">&#x27;zabbix5&#x27;</span>(using password:YES)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŠ¥é”™åŸå› ï¼šæ•°æ®åº“å°†ä¸»æœºIPåå‘è§£ææˆä¸»æœºå</span></span><br><span class="line">è§£å†³ï¼šå…³é—­åå‘è§£æï¼Œ[mysqld]ä¸‹æ·»åŠ   skip_name_resolve</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">skip_name_resolve</span><br><span class="line"><span class="comment">#ä¿®æ”¹å®Œæ¯•ä¹‹åé‡å¯æ•°æ®åº“</span></span><br><span class="line">systemctl restart mariadb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#10.é‡æ–°å¯¼å…¥æ•°æ®</span></span><br><span class="line">zcat /usr/share/doc/zabbix-server-mysql-5.0.42/create.sql.gz  |mysql -uzabbix -p123 -h172.16.1.71 zabbix5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.ä¿®æ”¹zabbix-serveré…ç½®æ–‡ä»¶</span></span><br><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">DBHost=172.16.1.71</span><br><span class="line">DBName=zabbix5<span class="comment">#æ•°æ®åº“å</span></span><br><span class="line">DBUser=zabbix<span class="comment">#åˆ›å»ºçš„æ•°æ®åº“ç”¨æˆ·</span></span><br><span class="line">DBPassword=123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@zabbix5-server ~]# vim /etc/opt/rh/rh-nginx116/nginx/conf.d/zabbix.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name zabbix.web.com;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 13.ä¿®æ”¹phpé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@zabbix5-server ~]# vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf</span><br><span class="line">listen.acl_users = apache,nginx</span><br><span class="line">php_value[date.timezone] = Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># 14.å¯åŠ¨æœåŠ¡å¹¶åŠ å…¥å¼€æœºè‡ªå¯</span></span><br><span class="line">systemctl restart zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 15.ç‰©ç†æœºåšåŸŸåè§£æ</span></span><br><span class="line">æ‰“å¼€cmd -&gt; è¾“å…¥drivers -&gt; æ‰“å¼€hostsæ–‡ä»¶</span><br><span class="line">10.0.0.71 zabbix.web.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#16.æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">zabbix.web.com</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæƒ³ä½¿ç”¨10.0.0.71è®¿é—®zabbixæ—¶å€™æŠ¥é”™å¦‚ä¸‹</li></ul><p><img src="https://cos.lukme.top/Pic/QQ_1722756226179.png" alt="QQ_1722756226179"></p><ul><li><p>åŸå› ï¼šä½¿ç”¨ipè®¿é—®é»˜è®¤ä¼šå»æ‰¾<code>/opt/rh/rh-nginx116/root/usr/share/nginx/html</code>.</p></li><li><p><code>/etc/opt/rh/rh-nginx116/nginx/nginx.conf</code>.é‡ŒæŒ‡å‘äº†è·¯å¾„</p></li><li><p>è§£å†³ï¼šåˆ é™¤é»˜è®¤nginxé…ç½®æ–‡ä»¶é‡Œserverå±‚ï¼Œhttpå±‚ä¸‹çš„serverå±‚ï¼Œåˆ æ‰ä¿ç•™å¦‚ä¸‹</p></li><li><p>é‡å¯nginx   <code>systemctl restart rh-nginx116-nginx</code></p></li></ul><p><img src="https://cos.lukme.top/Pic/QQ_1722756503836.png" alt="QQ_1722756503836"></p><p><strong>æµè§ˆå™¨è®¿é—®10.0.0.71</strong></p><p>è¾“å…¥è¿æ¥çš„æ•°æ®åº“hostï¼Œåº“åï¼Œç”¨æˆ·åŠå¯†ç </p><p><img src="https://cos.lukme.top/Pic/QQ_1722756894033.png" alt="QQ_1722756894033"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722757040903.png" alt="QQ_1722757040903"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Usernameï¼šAdmin</span><br><span class="line">Passwordï¼šzabbix</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722757104745.png" alt="QQ_1722757104745"></p><h4 id="æ±‰åŒ–">æ±‰åŒ–</h4><p><img src="https://cos.lukme.top/Pic/QQ_1722757339488.png" alt="QQ_1722757339488"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722757366149.png" alt="QQ_1722757366149"></p><p><strong>zabbixå›¾å½¢å­—ä½“æ˜¾ç¤ºå¼‚å¸¸è§£å†³</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722757866125.png" alt="QQ_1722757866125"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## zabbixå­˜æ”¾å­—ä½“çš„ç›®å½•</span></span><br><span class="line">[root@zabbix5-server ~]# rpm -ql zabbix-web|grep font</span><br><span class="line">/usr/share/zabbix/assets/fonts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">windowsæ‰“å¼€CMD è¾“å…¥ fonts</span><br><span class="line"><span class="comment"># è¿›å…¥å­—ä½“ç›®å½•,å°†ä¸­æ–‡ç³»ç»Ÿå­—ä½“æ‹–åˆ°zabbixå­—ä½“ç›®å½•</span></span><br><span class="line">[root@zabbix5-server ~]# <span class="built_in">cd</span> /usr/share/zabbix/assets/fonts</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å­—ä½“ç›®å½•ä¸­çš„é»˜è®¤è½¯é“¾æ¥å­—ä½“æ–‡ä»¶</span></span><br><span class="line">[root@zabbix5-server fonts]# <span class="built_in">rm</span> -f graphfont.ttf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å­—ä½“æ–‡ä»¶å</span></span><br><span class="line">[root@zabbix5-server fonts]# <span class="built_in">mv</span> YGYXSZITI2.0.TTF graphfont.ttf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722757894487.png" alt="QQ_1722757894487"></p><h4 id="å®‰è£…å®¢æˆ·ç«¯">å®‰è£…å®¢æˆ·ç«¯</h4><p><strong>10.0.0.7</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ›´æ¢zabbixå®˜æ–¹æº</span></span><br><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£…zabbix-agent</span></span><br><span class="line">yum install -y zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ä¿®æ”¹zabbix-agenté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@web01 ~]# vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">Server=172.16.1.71</span><br><span class="line">Hostname=web01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å¯åŠ¨zabbix-agent</span></span><br><span class="line">systemctl start zabbix-agent</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-agent</span><br><span class="line"></span><br><span class="line">ç«¯å£ï¼š</span><br><span class="line">zabbix-serverï¼š10051</span><br><span class="line">zabbix-agentï¼š10050</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ ç›‘æ§ä¸»æœº">æ·»åŠ ç›‘æ§ä¸»æœº</h4><p><img src="https://cos.lukme.top/Pic/QQ_1722758479060.png" alt="QQ_1722758479060"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722758820075.png" alt="QQ_1722758820075"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç±»å‹ï¼š</span></span><br><span class="line">å®¢æˆ·ç«¯ï¼šzabbix-serverè·å–zabbix-agentçš„æ•°æ®</span><br><span class="line">SNMPï¼šç›‘æ§ç½‘ç»œè®¾å¤‡çš„æ¥å£(äº¤æ¢æœº)</span><br><span class="line">JMXï¼šç›‘æ§JAVAç¨‹åº</span><br><span class="line">IPMIï¼šç›‘æ§ç¡¬ä»¶è®¾å¤‡(ç¡¬ä»¶è´Ÿè½½å‡è¡¡ F5 ç¡¬ä»¶é˜²ç«å¢™)</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722758979163.png" alt="QQ_1722758979163"></p><p><strong>æ¨¡æ¿é€‰å¥½å°±æ·»åŠ </strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722759100045.png" alt="QQ_1722759100045"></p><p><strong>è¿”å›ä¸»æœºï¼Œç­‰å¾…åˆ·æ–°å˜ç»¿</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722759174786.png" alt="QQ_1722759174786"></p><h3 id="zabbix3-4éƒ¨ç½²">zabbix3.4éƒ¨ç½²</h3><h4 id="éƒ¨ç½²æœåŠ¡ç«¯">éƒ¨ç½²æœåŠ¡ç«¯</h4><p>æ¸…åæºï¼š<a href="https://mirrors.tuna.tsinghua.edu.cn/">https://mirrors.tuna.tsinghua.edu.cn/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ›´æ¢zabbix3.4æº</span></span><br><span class="line">rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.centos.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£…zabbix-server zabbix-webï¼ˆapacheï¼‰ zabbix-agent</span></span><br><span class="line">yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.è¿›å…¥å¹¶åˆ›å»ºæ•°æ®åº“ï¼ˆä½¿ç”¨è¿œç¨‹æ•°æ®åº“ï¼Œ172.16.1.71ï¼Œå®‰è£…æ•°æ®åº“è§zabbix5éƒ¨ç½²ï¼‰</span></span><br><span class="line">mysql</span><br><span class="line">MariaDB [(none)]&gt; create database zabbix3 character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ›å»ºç”¨æˆ·ï¼ˆä½¿ç”¨zabbix5åˆ›å»ºçš„ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼‰</span></span><br><span class="line">MariaDB [(none)]&gt; grant all on *.* to zabbix@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.å¯¼å…¥æ•°æ®</span></span><br><span class="line">zcat /usr/share/doc/zabbix-server-mysql-3.4.15/create.sql.gz |mysql -uzabbix -p123 -h172.16.1.71 zabbix3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.ä¿®æ”¹zabbix-serveré…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@zabbix3-server ~]# vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">DBHost=172.16.1.71</span><br><span class="line">DBName=zabbix3</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.ä¿®æ”¹apacheé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@zabbix3-server ~]# vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">php_value date.timezone Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.å¯åŠ¨zabbix</span></span><br><span class="line">systemctl start zabbix-server zabbix-agent httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-server zabbix-agent httpd</span><br><span class="line"></span><br><span class="line"><span class="comment">#9.æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">http://10.0.0.72/zabbix/</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœå¯åŠ¨æŠ¥é”™</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ£€æŸ¥æ—¥å¿—</span><br><span class="line"><span class="built_in">cat</span> /var/log/zabbix/zabbix_server.log</span><br><span class="line">å¦‚æœæ˜¯å¦‚ä¸‹</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722761828372.png" alt="QQ_1722761828372"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">åŸå› ï¼š</span><br><span class="line">kernel.semå‚æ•°è®¾ç½®è¿‡å°ï¼Œå…±äº«å†…å­˜ä¿¡å·é‡è®¾ç½®å…±äº«å†…å­˜ï¼š</span><br><span class="line">å¯ä»¥é€šè¿‡ipcs -lmå‘½ä»¤æŸ¥çœ‹ç›®å‰ç³»ç»Ÿå…±äº«å†…å­˜çš„å‚æ•°é™åˆ¶</span><br><span class="line"></span><br><span class="line">è§£å†³ï¼š</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;kernel.sem = 500 64000 64 256&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line">systemctl start zabbix-server <span class="comment"># æˆåŠŸ</span></span><br></pre></td></tr></table></figure><p><strong>ç™»å½•æµè§ˆå™¨è®¿é—®</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722760000155.png" alt="QQ_1722760000155"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•ç”¨æˆ·ååŠå¯†ç åŒzabbix5</span><br><span class="line">Usernameï¼šAdmin</span><br><span class="line">Passwordï¼šzabbix</span><br><span class="line"></span><br><span class="line">æ±‰åŒ–åŠå­—ä½“å¼‚å¸¸åŒzabbix5</span><br><span class="line"><span class="comment"># 1.æŸ¥æ‰¾zabbixå­˜æ”¾å­—ä½“ç›®å½•</span></span><br><span class="line">[root@zabbix3-server ~]# rpm -ql zabbix-web|grep font</span><br><span class="line">/usr/share/zabbix/fonts</span><br><span class="line"><span class="comment"># 2.è¿›å…¥ç›®å½•</span></span><br><span class="line">[root@zabbix3-server ~]# <span class="built_in">cd</span> /usr/share/zabbix/fonts</span><br><span class="line"><span class="comment"># 3.ä¿®æ”¹å­—ä½“</span></span><br><span class="line">[root@zabbix3-server fonts]# <span class="built_in">rm</span> -f graphfont.ttf</span><br><span class="line">[root@zabbix3-server fonts]# <span class="built_in">mv</span> YGYXSZITI2.0.TTF graphfont.ttf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722760127865.png" alt="QQ_1722760127865"></p><h4 id="éƒ¨ç½²å®¢æˆ·ç«¯">éƒ¨ç½²å®¢æˆ·ç«¯</h4><p><strong>10.0.0.8</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/3.4/rhel/7/x86_64/</span><br><span class="line"><span class="comment"># 0.å®‰è£…zabbix-agentæº</span></span><br><span class="line">rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/3.4/rhel/7/x86_64/zabbix-agent-3.4.15-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.å®‰è£…zabbix-agent</span></span><br><span class="line">yum -y install zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹agenté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@web02 ~]# vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">Server=172.16.1.72</span><br><span class="line">Hostname=web02</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å¯åŠ¨zabbix-agent</span></span><br><span class="line">systemctl start zabbix-agent</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-agent</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1722760672992.png" alt="QQ_1722760672992"></p><p><strong>æœç´¢linuxï¼Œæ·»åŠ Template OS Linux</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1722760735288.png" alt="QQ_1722760735288"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722761703199.png" alt="QQ_1722761703199"></p><p><img src="https://cos.lukme.top/Pic/QQ_1722761797069.png" alt="QQ_1722761797069"></p><hr>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†zabbixä¸¤ç§ç‰ˆæœ¬çš„éƒ¨ç½²ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œé€‰å…¶ä¸€å³å¯</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>zabbixç›‘æ§æ¦‚è¿°</title>
    <link href="https://lukme.top/posts/ccb410e2.html"/>
    <id>https://lukme.top/posts/ccb410e2.html</id>
    <published>2024-08-20T12:18:10.000Z</published>
    <updated>2024-10-02T11:07:04.991Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç›‘æ§ä»‹ç»">ç›‘æ§ä»‹ç»</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.ç³»ç»Ÿçš„ç›‘æ§:å®é™…ä¸Šæ˜¯å¯¹ç³»ç»Ÿä¸é—´æ–­çš„å®æ—¶ç›‘æ§</span><br><span class="line">2.å®æ—¶åé¦ˆç³»ç»Ÿå½“å‰çŠ¶æ€:æˆ‘ä»¬ç›‘æ§æŸä¸ªç¡¬ä»¶ã€æˆ–è€…æŸä¸ªç³»ç»Ÿï¼Œéƒ½æ˜¯éœ€è¦èƒ½å®æ—¶çœ‹åˆ°å½“å‰ç³»ç»Ÿçš„çŠ¶æ€æ˜¯æ­£å¸¸ã€å¼‚å¸¸ã€æˆ–è€…æ•…éšœã€‚</span><br><span class="line">3.ä¿è¯æœåŠ¡å¯é æ€§å®‰å…¨æ€§:æˆ‘ä»¬ç›‘æ§çš„ç›®çš„å°±æ˜¯è¦ä¿è¯ç³»ç»Ÿã€æœåŠ¡ã€ä¸šåŠ¡æ­£å¸¸è¿è¡Œ</span><br><span class="line">4.ä¿è¯ä¸šåŠ¡æŒç»­ç¨³å®šè¿è¡Œ:å¦‚æœæˆ‘ä»¬çš„ç›‘æ§åšå¾—å¾ˆå®Œå–„ï¼Œå³ä½¿å‡ºç°æ•…éšœï¼Œèƒ½ç¬¬ä¸€æ—¶é—´æ¥æ”¶åˆ°æ•…éšœæŠ¥è­¦åœ¨ç¬¬ä¸€æ—¶é—´å¤„ç†è§£å†³ï¼Œä»è€Œä¿è¯ä¸šåŠ¡æŒç»­æ€§çš„ç¨³å®šè¿è¡Œã€‚ï¼ˆå¾€å¾€ï¼Œç¬¬ä¸€æ—¶é—´çŸ¥é“ä¸šåŠ¡å®•æœºçš„éƒ½æ˜¯ç”¨æˆ·ï¼‰</span><br></pre></td></tr></table></figure><p><strong>ç›‘æ§è½¯ä»¶ä»‹ç»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.CACTI ç½‘ç»œç›‘æ§</span><br><span class="line">2.Nagios ç³»ç»Ÿç›‘æ§        https://www.nagios.com/</span><br><span class="line">3.falcon å°ç±³ç›‘æ§https://open-falcon.github.io/</span><br></pre></td></tr></table></figure><p><strong>ç›‘æ§æœ‰å“ªäº›æ–¹é¢</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">ç¡¬ä»¶å±‚</span><br><span class="line">- CPUæ¸©åº¦</span><br><span class="line">- é£æ‰‡è½¬é€Ÿ</span><br><span class="line">- ç£ç›˜æ˜¯å¦æŸå</span><br><span class="line">- CMOSç”µæ± ç”µé‡</span><br><span class="line">- å†…å­˜æ˜¯å¦æŸå</span><br><span class="line">...</span><br><span class="line">ç³»ç»Ÿå±‚</span><br><span class="line">- CPUï¼šä½¿ç”¨ç‡ã€è´Ÿè½½</span><br><span class="line">- å†…å­˜ï¼šä½¿ç”¨ç‡</span><br><span class="line">- ç£ç›˜ï¼šä½¿ç”¨ç‡ï¼ŒIO</span><br><span class="line">- è¿›ç¨‹</span><br><span class="line">- TCPçŠ¶æ€</span><br><span class="line">- ç³»ç»Ÿè´Ÿè½½</span><br><span class="line">- æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">...</span><br><span class="line">ç½‘ç»œå±‚</span><br><span class="line">- ç½‘ç»œè®¾å¤‡ï¼šè·¯ç”±å™¨ï¼Œäº¤æ¢æœº</span><br><span class="line">- ç½‘å¡å…¥å£æµé‡</span><br><span class="line">- ç½‘å¡å‡ºå£æµé‡</span><br><span class="line">- å¸¦å®½çš„å³°å€¼</span><br><span class="line">...</span><br><span class="line">åº”ç”¨å±‚</span><br><span class="line">- MySQLï¼šä¸»ä»å¤åˆ¶æ˜¯å¦æœ‰å»¶è¿Ÿï¼ˆzabbixç›‘æ§æ¨¡æ¿ï¼‰</span><br><span class="line">- redisï¼šä¸»ä»å¤åˆ¶æ˜¯å¦æœ‰å»¶è¿Ÿ</span><br><span class="line">- ç›‘æ§æ€è·¯:zabbixæ²¡æœ‰å›ºå®šæ¨¡æ¿ï¼Œå¯ä»¥åœ¨ä¸»åº“ä¸­<span class="built_in">set</span>ä¸€ä¸ªkeyä¸ºæ—¶é—´æˆ³ï¼Œç„¶åä»åº“ä¼šåŒæ­¥è¿™ä¸ªæ—¶</span><br><span class="line">- é—´æˆ³ï¼ˆåŠ¨æ€ï¼‰ï¼Œå†™è„šæœ¬æ—¶æ—¶è·å–è¿™ä¸¤ä¸ªæ—¶é—´æˆ³ï¼Œåšå¯¹æ¯”</span><br><span class="line">- NFSï¼šç£ç›˜æŒ‚è½½çŠ¶å†µ</span><br><span class="line">- tomcatï¼šJVMç›‘æ§ï¼Œè€å¹´ä»£ã€æ–°ç”Ÿä»£ã€æ°¸ä¹…å¸¦ã€full-gcï¼ˆåƒåœ¾å›æ”¶ï¼‰</span><br><span class="line">- rsyncçš„åŒæ­¥æƒ…å†µï¼ŒMD5æ ¡éªŒæ–‡ä»¶æ˜¯å¦è¢«ç¯¡æ”¹</span><br><span class="line">...</span><br><span class="line">ä¸šåŠ¡å±‚</span><br><span class="line">- URLçš„ç›‘æ§</span><br><span class="line">- APIçš„ç›‘æ§</span><br><span class="line">- nginxçš„çŠ¶æ€ç </span><br><span class="line">- tomcatçš„exception</span><br><span class="line">- è¯·æ±‚æ—¶é—´</span><br><span class="line">- å“åº”æ—¶é—´</span><br><span class="line">- åŠ è½½æ—¶é—´</span><br><span class="line">- æ¸²æŸ“æ—¶é—´</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨ç›‘æ§å‘½ä»¤">å¸¸ç”¨ç›‘æ§å‘½ä»¤</h3><h4 id="CPUç›‘æ§å‘½ä»¤">CPUç›‘æ§å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 ~]# w</span><br><span class="line">10:33:44 up 1:28, 1 user, load average: 0.00, 0.01, 0.05</span><br><span class="line">USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT</span><br><span class="line">root pts/0 10.0.0.1 09:44 0.00s 0.03s 0.00s w</span><br><span class="line"></span><br><span class="line">é›¶å®½æ–­è¨€</span><br><span class="line">ifconfig eth0|grep -Po <span class="string">&#x27;\d\d\.\d\.\d\.\d(?=  netmask)&#x27;</span></span><br><span class="line">ifconfig eth0|grep -Po <span class="string">&#x27;[1-9][0-9]+\.[0-9]+\.[0-9]+\.[0-9]+(?=  netmask)&#x27;</span></span><br><span class="line">10.0.0.7</span><br><span class="line"></span><br><span class="line">\K æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ PCRE ç¬¦å·ï¼Œè¡¨ç¤ºâ€œå¿½ç•¥ä¹‹å‰çš„åŒ¹é…â€ï¼Œ</span><br><span class="line">ifconfig eth0 | grep -oP <span class="string">&#x27;inet \K(\d+\.\d+\.\d+\.\d+)&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@web02 ~]# top</span><br><span class="line"></span><br><span class="line">[root@web02 ~]# htop</span><br><span class="line">[root@web02 ~]# glances</span><br><span class="line">[root@web02 ~]# <span class="built_in">uptime</span></span><br><span class="line">10:37:12 up 1:32, 1 user, load average: 0.13, 0.09, 0.01</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸ç®¡ç”¨ä»€ä¹ˆå‘½ä»¤ç›‘æ§ï¼ŒæŸ¥çœ‹CPUï¼Œæˆ‘ä»¬éƒ½å¿…é¡»äº†è§£ï¼Œç³»ç»Ÿçš„ç”¨æˆ·æ€å’Œå†…å’Œæ€ã€‚</span></span><br><span class="line">%Cpu(s): 0.0 us, 0.0 sy, 0.0 ni,100.0 <span class="built_in">id</span>, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st</span><br><span class="line">us: ç”¨æˆ·æ€ è·Ÿç”¨æˆ·çš„æ“ä½œæœ‰å…³35%</span><br><span class="line">sy: å†…å’Œæ€ è·Ÿå†…æ ¸çš„å¤„ç†æœ‰å…³65%</span><br><span class="line"><span class="built_in">id</span>: CPUç©ºé—²</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">[root@web02 ~]# time <span class="built_in">ls</span></span><br><span class="line">backup.sh group_vars_web_group</span><br><span class="line">real 0m0.002s çœŸå®æ‰§è¡Œæ—¶é—´</span><br><span class="line">user 0m0.001s ç”¨æˆ·æ‰§è¡Œæ—¶é—´</span><br><span class="line">sys 0m0.001s ç³»ç»Ÿæ‰§è¡Œæ—¶é—´</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å†…å­˜ç›‘æ§å‘½ä»¤">å†…å­˜ç›‘æ§å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 ~]# free -m</span><br><span class="line">   total used free shared buff/cache available</span><br><span class="line">Mem: 972 94 588 7 290 712</span><br><span class="line">Swap: 1023 0 1023</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## å¦‚ä½•æŸ¥çœ‹å•ä¸ªè¿›ç¨‹å ç”¨å†…å­˜ï¼Ÿ</span></span><br><span class="line"><span class="comment">#è¿›ç¨‹å ç”¨å†…å­˜å…¬å¼</span></span><br><span class="line">pmem = VmRSS / MemTotal * 100</span><br><span class="line">process mem = è™šæ‹Ÿå†…å­˜ / æ€»å†…å­˜ * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@web02 ~]# <span class="built_in">cat</span> mem.py</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># _*_ coding:UTF-8 _*_</span></span><br><span class="line"><span class="comment"># æ”¶é›†ç¨‹åºæ‰€å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå æ‰€æœ‰ç‰©ç†å†…å­˜çš„æ¯”ä¾‹</span></span><br><span class="line"><span class="comment"># Python: 2.7.6</span></span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from subprocess import Popen,PIPE</span><br><span class="line"></span><br><span class="line">def get_pid(program):</span><br><span class="line"><span class="string">&#x27;è·å–ç›®æ ‡ç¨‹åºçš„PIDåˆ—è¡¨&#x27;</span></span><br><span class="line">p = Popen([<span class="string">&#x27;pidof&#x27;</span>,program],stdout=PIPE,stderr=PIPE)</span><br><span class="line">pids,stderrput = p.communicate()</span><br><span class="line"><span class="comment"># pids = p.stdout.read() #è¿™ç§æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä¹Ÿå¯ä»¥å¯¹stderrputæ¥è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> pids:</span><br><span class="line"><span class="built_in">return</span> pids.split()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">raise ValueError</span><br><span class="line"></span><br><span class="line">def mem_calc(pids):</span><br><span class="line"><span class="string">&#x27;è®¡ç®—PIDså ç”¨çš„å†…å­˜å¤§å°&#x27;</span></span><br><span class="line">mem_total = 0</span><br><span class="line"><span class="keyword">for</span> pid <span class="keyword">in</span> pids:</span><br><span class="line">os.chdir(<span class="string">&#x27;/proc/%s&#x27;</span> % pid)</span><br><span class="line">with open(<span class="string">&#x27;status&#x27;</span>) as fd:</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> fd:</span><br><span class="line"><span class="keyword">if</span> line.startswith(<span class="string">&#x27;VmRSS&#x27;</span>):</span><br><span class="line">mem = line.strip().<span class="built_in">split</span>()[1]</span><br><span class="line">mem_total += int(mem)</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="built_in">return</span> mem_total</span><br><span class="line"></span><br><span class="line">def mem_percent(mem):</span><br><span class="line"><span class="string">&#x27;è®¡ç®—ç¨‹åºå†…å­˜å ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯”&#x27;</span></span><br><span class="line">with open(<span class="string">&#x27;/proc/meminfo&#x27;</span>) as fd:</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> fd:</span><br><span class="line"><span class="keyword">if</span> line.startswith(<span class="string">&#x27;MemTotal&#x27;</span>):</span><br><span class="line">total = line.strip().<span class="built_in">split</span>()[1]</span><br><span class="line">percent = (<span class="built_in">float</span>(mem)/int(total)) * 100</span><br><span class="line"><span class="built_in">return</span> percent</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">try:</span><br><span class="line">program = sys.argv[1]</span><br><span class="line">pids = get_pid(program)</span><br><span class="line">except IndexError as e:</span><br><span class="line">sys.exit(<span class="string">&#x27;%s need a Program name &#x27;</span> % __file__)</span><br><span class="line">except ValueError as e:</span><br><span class="line">sys.exit(<span class="string">&#x27;%s not a Process Name or not Start&#x27;</span> % program )</span><br><span class="line">mem_total = mem_calc(pids)</span><br><span class="line">percent = mem_percent(mem_total)</span><br><span class="line"><span class="built_in">return</span> program,mem_total,percent</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">program,mem_total,mem_percent=main()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;è¿›ç¨‹åç§°:%s\nç‰©ç†å†…å­˜ä¸º:%s\nç™¾åˆ†æ¯”ä¸º:%.2f%%&#x27;</span>%</span><br><span class="line">(program,mem_total,mem_percent))</span><br></pre></td></tr></table></figure><h4 id="ç£ç›˜ç›‘æ§å‘½ä»¤">ç£ç›˜ç›‘æ§å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 ~]# <span class="built_in">df</span> -h</span><br><span class="line"></span><br><span class="line">[root@web02 ~]# iotop</span><br><span class="line">[root@web02 ~]# iostat -dm 1 10</span><br><span class="line">[root@web01 ~]# iostat -dm 1 10</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (web01)     08/04/2024      _x86_64_        (1 CPU)</span><br><span class="line"></span><br><span class="line">Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn</span><br><span class="line">scd0              0.00         0.00         0.00          1          0</span><br><span class="line">sda               1.08         0.02         0.00         93         15</span><br><span class="line">[root@web02 ~]# dstat</span><br><span class="line">----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--</span><br><span class="line">usr sys idl wai hiq siq| <span class="built_in">read</span>  writ| recv  send|  <span class="keyword">in</span>   out | int   csw </span><br><span class="line">  0   0  99   0   0   0|  36k   45k|   0     0 |   0     0 |  56   125 </span><br><span class="line">  0   0 100   0   0   0|   0     0 |  60B  874B|   0     0 |  56    94 </span><br></pre></td></tr></table></figure><h4 id="ç½‘ç»œç›‘æ§å‘½ä»¤">ç½‘ç»œç›‘æ§å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 ~]# ifconfig</span><br><span class="line">[root@web02 ~]# iftop</span><br><span class="line">[root@web02 ~]# nethogs</span><br><span class="line">[root@web02 ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.0.0.254      0.0.0.0         UG    102    0        0 eth0</span><br><span class="line">10.0.0.0        0.0.0.0         255.255.255.0   U     102    0        0 eth0</span><br><span class="line">172.16.1.0      0.0.0.0         255.255.255.0   U     101    0        0 eth1</span><br></pre></td></tr></table></figure><h4 id="TCPç›‘æ§å‘½ä»¤">TCPç›‘æ§å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]# netstat -an|awk <span class="string">&#x27;/^tcp/ &#123;print $NF&#125;&#x27;</span>|<span class="built_in">sort</span>|<span class="built_in">uniq</span> -c</span><br><span class="line">      2 ESTABLISHED</span><br><span class="line">      6 LISTEN</span><br><span class="line">[root@web01 ~]# netstat -an|awk <span class="string">&#x27;/^tcp/ &#123;++state[$NF]&#125; END &#123;for(key in state)print key,&quot; \t&quot; ,state[key]&#125;&#x27;</span></span><br><span class="line">LISTEN           6</span><br><span class="line">ESTABLISHED      2</span><br><span class="line">[root@web02 ~]# ss -n|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|<span class="built_in">sort</span>|<span class="built_in">uniq</span> -c</span><br><span class="line">     89 ESTAB</span><br><span class="line">      1 State</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿçš„oom">ç³»ç»Ÿçš„oom</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç”¨æˆ·ä¸æ–­å¢å¤šï¼ŒæœåŠ¡æ¶ˆè€—çš„å†…å­˜è¶Šæ¥è¶Šå¤šï¼Œå½“ç³»ç»Ÿå†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿäº§ç”Ÿoomï¼ˆout of memoryï¼‰</span><br><span class="line">1.å½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶å°±ä¼šå¤§é‡ä½¿ç”¨swapï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰</span><br><span class="line">2.å½“ç³»ç»Ÿå¤§é‡ä½¿ç”¨swapçš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šç‰¹åˆ«å¡</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šæœ‰æ—¶å¯èƒ½å†…å­˜è¿˜æœ‰å‰©ä½™300Mæˆ–è€…500Mï¼Œä½†æ˜¯swapä¾ç„¶è¢«ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">[root@web02 ~]# <span class="built_in">dd</span> &lt; /dev/zero &gt; /dev/null bs=2000M</span><br><span class="line">[root@web02 ~]# <span class="built_in">tail</span> -f /var/log/messages</span><br><span class="line">Out of memory: Kill process 29957 (<span class="built_in">dd</span>) score 366 or sacrifice child</span><br><span class="line">Killed process 29957 (<span class="built_in">dd</span>) total-vm:2532680kB, anon-rss:1416508kB, filers:0kB</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†ç›‘æ§è½¯ä»¶ä»¥åŠå¸¸ç”¨ç›‘æ§å‘½ä»¤</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="zabbix" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/zabbix/"/>
    
    
    <category term="zabbix" scheme="https://lukme.top/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçš„è¯»å†™åˆ†ç¦»</title>
    <link href="https://lukme.top/posts/12e80162.html"/>
    <id>https://lukme.top/posts/12e80162.html</id>
    <published>2024-08-17T12:18:10.000Z</published>
    <updated>2024-10-02T12:11:31.003Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¯»å†™åˆ†ç¦»è½¯ä»¶">è¯»å†™åˆ†ç¦»è½¯ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Atlasæ˜¯ç”± Qihoo 360å…¬å¸Webå¹³å°éƒ¨åŸºç¡€æ¶æ„å›¢é˜Ÿå¼€å‘ç»´æŠ¤çš„ä¸€ä¸ªåŸºäºMySQLåè®®çš„æ•°æ®ä¸­é—´å±‚é¡¹ ç›®ã€‚å®ƒåœ¨MySQLå®˜æ–¹æ¨å‡ºçš„MySQL-Proxy 0.8.2ç‰ˆæœ¬çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹äº†å¤§é‡bugï¼Œæ·»åŠ äº†å¾ˆå¤šåŠŸèƒ½ç‰¹ æ€§ã€‚ç›®å‰è¯¥é¡¹ç›®åœ¨360å…¬å¸å†…éƒ¨å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œå¾ˆå¤šMySQLä¸šåŠ¡å·²ç»æ¥å…¥äº†Atlaså¹³å°ï¼Œæ¯å¤©æ‰¿è½½çš„è¯» å†™è¯·æ±‚æ•°è¾¾å‡ åäº¿æ¡ã€‚åŒæ—¶ï¼Œæœ‰è¶…è¿‡50å®¶å…¬å¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²äº†Atlasï¼Œè¶…è¿‡800äººå·²åŠ å…¥äº†æˆ‘ä»¬çš„å¼€ å‘è€…äº¤æµç¾¤ï¼Œå¹¶ä¸”è¿™äº›æ•°å­—è¿˜åœ¨ä¸æ–­å¢åŠ ã€‚</span><br><span class="line"></span><br><span class="line">mysql-proxy</span><br><span class="line">Atlasï¼šé˜¿é‡Œ</span><br><span class="line">Atlasï¼š360</span><br><span class="line">mycat</span><br></pre></td></tr></table></figure><p>AtlasåŠŸèƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.è¯»å†™åˆ†ç¦»</span><br><span class="line">2.ä»åº“è´Ÿè½½å‡è¡¡</span><br><span class="line">3.IPè¿‡æ»¤</span><br><span class="line">4.è‡ªåŠ¨åˆ†è¡¨</span><br><span class="line">5.DBAå¯å¹³æ»‘ä¸Šä¸‹çº¿DB</span><br><span class="line">6.è‡ªåŠ¨æ‘˜é™¤å®•æœºçš„DB</span><br></pre></td></tr></table></figure><p><strong>Atlasç›¸å¯¹äºå®˜æ–¹MySQL-Proxyçš„ä¼˜åŠ¿</strong></p><p>1.å°†ä¸»æµç¨‹ä¸­æ‰€æœ‰ Lua ä»£ç ç”¨Cé‡å†™ï¼ŒLuaä»…ç”¨äºç®¡ç†æ¥å£</p><p>2.é‡å†™ç½‘ç»œæ¨¡å‹ã€çº¿ç¨‹æ¨¡å‹</p><p>3.å®ç°äº†çœŸæ­£æ„ä¹‰ä¸Šçš„è¿æ¥æ± </p><p>4.ä¼˜åŒ–äº†é”æœºåˆ¶ï¼Œæ€§èƒ½æé«˜æ•°åå€</p><p><img src="https://cos.lukme.top/Pic/QQ_1724851191524.png" alt="QQ_1724851191524"></p><h2 id="å®‰è£…é…ç½®Atlas">å®‰è£…é…ç½®Atlas</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¸‹è½½atlas</span></span><br><span class="line">[root@mha-manager ~]# wget http://test.driverzeng.com/MySQL_plugins/Atlas-2.2.1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£…Atlas</span></span><br><span class="line">[root@mha-manager ~]# rpm -ivh Atlas-2.2.1.el6.x86_64.rpm</span><br><span class="line">[root@mha-manager ~]# ll /usr/local/mysql-proxy/</span><br><span class="line">drwxr-xr-x 2 root root 75 Aug 28 15:54 bin <span class="comment"># ç¨‹åºç›¸å…³å‘½ä»¤</span></span><br><span class="line">drwxr-xr-x 2 root root 22 Aug 28 15:54 conf <span class="comment"># ç¨‹åºç›¸å…³é…ç½®</span></span><br><span class="line">drwxr-xr-x 3 root root 331 Aug 28 15:54 lib <span class="comment"># ç¨‹åºç›¸å…³æ’ä»¶</span></span><br><span class="line">drwxr-xr-x 2 root root 6 Dec 17 2014 <span class="built_in">log</span> <span class="comment"># ç¨‹åºç›¸å…³æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db01 ~]# <span class="built_in">cat</span> /usr/local/mysql-proxy/conf/test.cnf </span><br><span class="line">[mysql-proxy]</span><br><span class="line"><span class="comment">#å¸¦#å·çš„ä¸ºéå¿…éœ€çš„é…ç½®é¡¹ç›®</span></span><br><span class="line"><span class="comment">#ç®¡ç†æ¥å£çš„ç”¨æˆ·å</span></span><br><span class="line">admin-username = user</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç®¡ç†æ¥å£çš„å¯†ç </span></span><br><span class="line">admin-password = <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Atlasåç«¯è¿æ¥çš„MySQLä¸»åº“çš„IPå’Œç«¯å£ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œç”¨é€—å·åˆ†éš”</span></span><br><span class="line">proxy-backend-addresses = 172.16.1.51:3306</span><br><span class="line"></span><br><span class="line"><span class="comment">#Atlasåç«¯è¿æ¥çš„MySQLä»åº“çš„IPå’Œç«¯å£ï¼Œ@åé¢çš„æ•°å­—ä»£è¡¨æƒé‡ï¼Œç”¨æ¥ä½œè´Ÿè½½å‡è¡¡ï¼Œè‹¥çœç•¥åˆ™é»˜è®¤ä¸º1ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œç”¨é€—å·åˆ†éš”</span></span><br><span class="line">proxy-read-only-backend-addresses = 172.16.1.52:3306@1,172.16.1.53:3306@1,172.16.1.54:3306@1</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨æˆ·åä¸å…¶å¯¹åº”çš„åŠ å¯†è¿‡çš„MySQLå¯†ç ï¼Œå¯†ç ä½¿ç”¨PREFIX/binç›®å½•ä¸‹çš„åŠ å¯†ç¨‹åºencryptåŠ å¯†ï¼Œä¸‹è¡Œçš„user1å’Œuser2ä¸ºç¤ºä¾‹ï¼Œå°†å…¶æ›¿æ¢ä¸ºä½ çš„MySQLçš„ç”¨æˆ·åå’ŒåŠ å¯†å¯†ç ï¼</span></span><br><span class="line">pwds = root:3yb5jEku5h4=, mha:3yb5jEku5h4=</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶ä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼ï¼Œè®¾ä¸ºfalseæ—¶ä¸ºå‰å°æ–¹å¼ï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue,trueåé¢ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</span></span><br><span class="line">daemon = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶Atlasä¼šå¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªä¸ºmonitorï¼Œä¸€ä¸ªä¸ºworkerï¼Œmonitoråœ¨workeræ„å¤–é€€å‡ºåä¼šè‡ªåŠ¨å°†å…¶é‡å¯ï¼Œè®¾ä¸ºfalseæ—¶åªæœ‰workerï¼Œæ²¡æœ‰monitorï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue,trueåé¢ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</span></span><br><span class="line">keepalive = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å·¥ä½œçº¿ç¨‹æ•°ï¼Œå¯¹Atlasçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œå¯æ ¹æ®æƒ…å†µé€‚å½“è®¾ç½®</span></span><br><span class="line">event-threads = 8</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ—¥å¿—çº§åˆ«ï¼Œåˆ†ä¸ºmessageã€warningã€criticalã€errorã€debugäº”ä¸ªçº§åˆ«</span></span><br><span class="line">log-level = error</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ—¥å¿—å­˜æ”¾çš„è·¯å¾„</span></span><br><span class="line">log-path = /usr/local/mysql-proxy/log</span><br><span class="line"></span><br><span class="line"><span class="comment">#SQLæ—¥å¿—çš„å¼€å…³ï¼Œå¯è®¾ç½®ä¸ºOFFã€ONã€REALTIMEï¼ŒOFFä»£è¡¨ä¸è®°å½•SQLæ—¥å¿—ï¼ŒONä»£è¡¨è®°å½•SQLæ—¥å¿—ï¼ŒREALTIMEä»£è¡¨è®°å½•SQLæ—¥å¿—ä¸”å®æ—¶å†™å…¥ç£ç›˜ï¼Œé»˜è®¤ä¸ºOFF</span></span><br><span class="line">sql-log = ON</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ…¢æ—¥å¿—è¾“å‡ºè®¾ç½®ã€‚å½“è®¾ç½®äº†è¯¥å‚æ•°æ—¶ï¼Œåˆ™æ—¥å¿—åªè¾“å‡ºæ‰§è¡Œæ—¶é—´è¶…è¿‡sql-log-slowï¼ˆå•ä½ï¼šms)çš„æ—¥å¿—è®°å½•ã€‚ä¸è®¾ç½®è¯¥å‚æ•°åˆ™è¾“å‡ºå…¨éƒ¨æ—¥å¿—ã€‚</span></span><br><span class="line"><span class="comment">#sql-log-slow = 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹åç§°ï¼Œç”¨äºåŒä¸€å°æœºå™¨ä¸Šå¤šä¸ªAtlaså®ä¾‹é—´çš„åŒºåˆ†</span></span><br><span class="line"><span class="comment">#instance = test</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Atlasç›‘å¬çš„å·¥ä½œæ¥å£IPå’Œç«¯å£</span></span><br><span class="line">proxy-address = 0.0.0.0:1234</span><br><span class="line"></span><br><span class="line"><span class="comment">#Atlasç›‘å¬çš„ç®¡ç†æ¥å£IPå’Œç«¯å£</span></span><br><span class="line">admin-address = 0.0.0.0:2345</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ†è¡¨è®¾ç½®ï¼Œæ­¤ä¾‹ä¸­personä¸ºåº“åï¼Œmtä¸ºè¡¨åï¼Œidä¸ºåˆ†è¡¨å­—æ®µï¼Œ3ä¸ºå­è¡¨æ•°é‡ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸åˆ†è¡¨åˆ™ä¸éœ€è¦è®¾ç½®è¯¥é¡¹</span></span><br><span class="line"><span class="comment">#tables = person.mt.id.3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é»˜è®¤å­—ç¬¦é›†ï¼Œè®¾ç½®è¯¥é¡¹åå®¢æˆ·ç«¯ä¸å†éœ€è¦æ‰§è¡ŒSET NAMESè¯­å¥</span></span><br><span class="line">charset = utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…è®¸è¿æ¥Atlasçš„å®¢æˆ·ç«¯çš„IPï¼Œå¯ä»¥æ˜¯ç²¾ç¡®IPï¼Œä¹Ÿå¯ä»¥æ˜¯IPæ®µï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸è®¾ç½®è¯¥é¡¹åˆ™å…è®¸æ‰€æœ‰IPè¿æ¥ï¼Œå¦åˆ™åªå…è®¸åˆ—è¡¨ä¸­çš„IPè¿æ¥</span></span><br><span class="line">client-ips = 127.0.0.1, 172.16.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#Atlaså‰é¢æŒ‚æ¥çš„LVSçš„ç‰©ç†ç½‘å¡çš„IP(æ³¨æ„ä¸æ˜¯è™šIP)ï¼Œè‹¥æœ‰LVSä¸”è®¾ç½®äº†client-ipsåˆ™æ­¤é¡¹å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™å¯ä»¥ä¸è®¾ç½®</span></span><br><span class="line"><span class="comment">#lvs-ips = 192.168.1.1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.å¯åŠ¨Atlas</span></span><br><span class="line">[root@mha ~]# /usr/local/mysql-proxy/bin/mysql-proxyd <span class="built_in">test</span> start</span><br></pre></td></tr></table></figure><h2 id="Atlasç®¡ç†æ¥å£ä½¿ç”¨">Atlasç®¡ç†æ¥å£ä½¿ç”¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ç®¡ç†æ¥å£</span></span><br><span class="line">[root@mha-manager ~]# mysql -uuser -ppwd -h127.0.0.1 -P2345</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from <span class="built_in">help</span>;</span><br><span class="line">db01 [(none)]&gt;<span class="keyword">select</span> * from <span class="built_in">help</span>;</span><br><span class="line">+----------------------------+---------------------------------------------------------+</span><br><span class="line">| <span class="built_in">command</span>                    | description                                             |</span><br><span class="line">+----------------------------+---------------------------------------------------------+</span><br><span class="line">| SELECT * FROM <span class="built_in">help</span>         | æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">| SELECT * FROM backends     | æŸ¥çœ‹åç«¯æ•°æ®åº“</span><br><span class="line">| SET OFFLINE <span class="variable">$backend_id</span>    | ä¸‹çº¿æ•°æ®åº“ <span class="built_in">set</span> offline 2;</span><br><span class="line">| SET ONLINE <span class="variable">$backend_id</span>     | ä¸Šçº¿æ•°æ®åº“ <span class="built_in">set</span> online 2;</span><br><span class="line">| ADD MASTER <span class="variable">$backend</span>        | æ·»åŠ ä¸€ä¸ªä¸»åº“ add master 172.16.1.88:3306;</span><br><span class="line">| ADD SLAVE <span class="variable">$backend</span>         | æ·»åŠ ä¸€ä¸ªä»åº“ add slave 172.16.1.77:3306;</span><br><span class="line">| REMOVE BACKEND <span class="variable">$backend_id</span> | åˆ é™¤åç«¯æ•°æ®åº“ remove backend 2;</span><br><span class="line">| SELECT * FROM clients      | æŸ¥çœ‹å¯è¿æ¥çš„å®¢æˆ·ç«¯ <span class="keyword">select</span> * from clients</span><br><span class="line">| ADD CLIENT <span class="variable">$client</span>         | æ·»åŠ ä¸€ä¸ªå¯è¿æ¥atlasçš„å®¢æˆ·ç«¯ add client 10.0.0;</span><br><span class="line">| REMOVE CLIENT <span class="variable">$client</span>      | åˆ é™¤å®¢æˆ·ç«¯ remove client 10.0.0 </span><br><span class="line">| SELECT * FROM pwds         | æŸ¥çœ‹æ‰€æœ‰å¯è¿æ¥atlasçš„ç”¨æˆ·å’Œå¯†ç  <span class="keyword">select</span> * from pwds;</span><br><span class="line">| ADD PWD <span class="variable">$pwd</span>               | æ·»åŠ ä¸€ä¸ªæ˜æ–‡çš„å¯†ç ç”¨æˆ· add <span class="built_in">pwd</span> mha:mha;</span><br><span class="line">| ADD ENPWD <span class="variable">$pwd</span>             | æ·»åŠ ä¸€ä¸ªåŠ å¯†çš„å¯†ç ç”¨æˆ· add enpwd tls:O2jBXONX098=;</span><br><span class="line">| REMOVE PWD <span class="variable">$pwd</span>            | åˆ é™¤ç”¨æˆ· remove <span class="built_in">pwd</span> zls;</span><br><span class="line">| SAVE CONFIG                | ä¿å­˜é…ç½®æ–‡ä»¶</span><br><span class="line">| SELECT VERSION             | æŸ¥çœ‹atlasç‰ˆæœ¬å·</span><br><span class="line">+----------------------------+---------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹åç«¯æ•°æ®åº“   ----rw ä¸»åº“   ----roä»åº“</span></span><br><span class="line">db01 [(none)]&gt;<span class="keyword">select</span> * from backends;</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">| backend_ndx | address          | state | <span class="built_in">type</span> |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">|           1 | 172.16.1.51:3306 | up    | rw   |</span><br><span class="line">|           2 | 172.16.1.52:3306 | up    | ro   |</span><br><span class="line">|           3 | 172.16.1.53:3306 | up    | ro   |</span><br><span class="line">|           4 | 172.16.1.54:3306 | up    | ro   |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¹³æ»‘ä¸‹çº¿DB</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> offline 2;</span><br><span class="line"><span class="comment"># å¹³æ»‘ä¸Šçº¿</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> online 2;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Atlasç»“åˆMHAè„šæœ¬">Atlasç»“åˆMHAè„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">mha_log=<span class="string">&quot;/etc/mha/logs/manager.log&quot;</span></span><br><span class="line">down_master=$(sed -nr <span class="string">&#x27;s#(.*)\(.*\) \(current master\)$#\1#gp&#x27;</span> <span class="variable">$&#123;mha_log&#125;</span>|tail-1)</span><br><span class="line">new_master=$(sed -nr <span class="string">&#x27;s#(.*)\(.*\) \(new master\)$#\1#gp&#x27;</span> /etc/mha/logs/manager.log|<span class="built_in">tail</span> -1)</span><br><span class="line"></span><br><span class="line">atlas_manager_user=<span class="string">&#x27;user&#x27;</span></span><br><span class="line">atlas_manager_password=<span class="string">&#x27;pwd&#x27;</span></span><br><span class="line">atlas_manager_port=<span class="string">&#x27;2345&#x27;</span></span><br><span class="line">atlas_conn=<span class="string">&quot;mysql -u<span class="variable">$&#123;atlas_manager_user&#125;</span> -p<span class="variable">$&#123;atlas_manager_password&#125;</span> -P<span class="variable">$&#123;atlas_manager_port&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> atlas_ip <span class="keyword">in</span> 51 52 53 54;<span class="keyword">do</span></span><br><span class="line">  down_master_backend_id=$(<span class="variable">$&#123;atlas_conn&#125;</span> -h172.16.1.<span class="variable">$&#123;atlas_ip&#125;</span> -e <span class="string">&#x27;select * from backends&#x27;</span>|grep <span class="string">&quot;<span class="variable">$&#123;new_master&#125;</span>&quot;</span>|awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">  <span class="variable">$&#123;atlas_conn&#125;</span> -h172.16.1.<span class="variable">$&#123;atlas_ip&#125;</span> -e <span class="string">&quot;remove backend <span class="variable">$&#123;down_master_backend_id&#125;</span>&quot;</span> </span><br><span class="line">  <span class="variable">$&#123;atlas_conn&#125;</span> -h172.16.1.<span class="variable">$&#123;atlas_ip&#125;</span> -e <span class="string">&quot;add slave <span class="variable">$&#123;down_master&#125;</span>:3306;save config&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mha-manager ~]# vim /etc/mha/app1/master_ip_failover</span><br><span class="line">sub <span class="function"><span class="title">start_vip</span></span>() &#123;</span><br><span class="line">`ssh <span class="variable">$ssh_user</span>\@<span class="variable">$new_master_host</span> \&quot; <span class="variable">$ssh_start_vip</span> \&quot;`;</span><br><span class="line">`/bin/sh -x \&quot;/root/atlas_mha.sh\&quot;`;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysqladmin  -umha -pmha -h172.16.1.55 ping</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä»‹ç»äº†MySQLè¯»å†™åˆ†ç¦»è½¯ä»¶Atlasçš„éƒ¨ç½²</summary>
    
    
    
    <category term="MySQL" scheme="https://lukme.top/categories/MySQL/"/>
    
    
    <category term="MySQL" scheme="https://lukme.top/tags/MySQL/"/>
    
    <category term="MHA" scheme="https://lukme.top/tags/MHA/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçš„MHAé«˜å¯ç”¨</title>
    <link href="https://lukme.top/posts/df39ce32.html"/>
    <id>https://lukme.top/posts/df39ce32.html</id>
    <published>2024-08-15T15:10:10.000Z</published>
    <updated>2024-08-15T15:14:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="MHAä»‹ç»åŠç»„æˆ">MHAä»‹ç»åŠç»„æˆ</h2><h3 id="MHAä»‹ç»">MHAä»‹ç»</h3><p>â€‹MHAèƒ½å¤Ÿåœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å®ç°è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ•…éšœè½¬ç§»ï¼Œé€šå¸¸åœ¨10-30ç§’ä»¥å†…;åœ¨å¤åˆ¶æ¡†æ¶ä¸­ï¼ŒMHAèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å¤åˆ¶è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œç”±äºä¸éœ€è¦åœ¨ç°æœ‰çš„replicationä¸­æ·»åŠ é¢å¤–çš„æœåŠ¡å™¨ï¼Œä»…éœ€è¦ä¸€ä¸ªmanagerèŠ‚ç‚¹ï¼Œè€Œä¸€ä¸ªManagerèƒ½ç®¡ç†å¤šå¥—å¤åˆ¶ï¼Œæ‰€ä»¥èƒ½å¤§å¤§åœ°èŠ‚çº¦æœåŠ¡å™¨çš„æ•°é‡;å¦å¤–ï¼Œå®‰è£…ç®€å•ï¼Œæ— æ€§èƒ½æŸè€—ï¼Œä»¥åŠä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„å¤åˆ¶éƒ¨ç½²ä¹Ÿæ˜¯å®ƒçš„ä¼˜åŠ¿ä¹‹å¤„ã€‚</p><p>MHAè¿˜æä¾›åœ¨çº¿ä¸»åº“åˆ‡æ¢çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå®‰å…¨åœ°åˆ‡æ¢å½“å‰è¿è¡Œçš„ä¸»åº“åˆ°ä¸€ä¸ªæ–°çš„ä¸»åº“ä¸­(é€šè¿‡å°†ä»åº“æå‡ä¸ºä¸»åº“),å¤§æ¦‚0.5-2ç§’å†…å³å¯å®Œæˆã€‚</p><h3 id="MHAçš„ç»„æˆéƒ¨åˆ†">MHAçš„ç»„æˆéƒ¨åˆ†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">`MHA Managerï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰`</span><br><span class="line">å¯ä»¥å•ç‹¬éƒ¨ç½²åœ¨ä¸€å°ç‹¬ç«‹çš„æœºå™¨ä¸Šç®¡ç†å¤šä¸ªmaster-slaveé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨ä¸€å°slaveä¸Šã€‚</span><br><span class="line"></span><br><span class="line">`MHA Nodeï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰`</span><br><span class="line">è¿è¡Œåœ¨æ¯å°MySQLæœåŠ¡å™¨ä¸Š   MHA Manager ä¼šå®šæ—¶æ¢æµ‹é›†ç¾¤ä¸­çš„masterèŠ‚ç‚¹ï¼Œå½“masterå‡ºç°æ•…éšœæ—¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°†æœ€æ–°æ•°æ®çš„slaveæå‡ä¸ºæ–°çš„masterï¼›ç„¶åå°†æ‰€æœ‰å…¶ä»–çš„slaveé‡æ–°æŒ‡å‘æ–°çš„masterï¼Œæ•´ä¸ªæ•…éšœè½¬ç§»è¿‡ç¨‹å¯¹åº”ç”¨ç¨‹åºæ˜¯å®Œå…¨é€æ˜çš„ï¼›</span><br></pre></td></tr></table></figure><h3 id="MHAè½¯ä»¶ç»“æ„ä»‹ç»">MHAè½¯ä»¶ç»“æ„ä»‹ç»</h3><table><thead><tr><th>èŠ‚ç‚¹ä¿¡æ¯</th><th>è½¯ä»¶ç»„ä»¶</th><th>ä½œç”¨ä»‹ç»</th></tr></thead><tbody><tr><td>MHA Managerï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰</td><td>masterha_manger</td><td>ç”¨äºå¯åŠ¨MHA</td></tr><tr><td></td><td>masterha_check_ssh</td><td>ç”¨äºæ£€æŸ¥MHAçš„SSHé…ç½®äº’ä¿¡çŠ¶å†µ</td></tr><tr><td></td><td>masterha_check_repl</td><td>ç”¨äºæ£€æŸ¥MySQLå¤åˆ¶çŠ¶æ€ï¼Œä»¥åŠé…ç½®ä¿¡æ¯</td></tr><tr><td></td><td>masterha_master_monitor</td><td>ç”¨äºæ£€æµ‹masteræ˜¯å¦å®•æœº</td></tr><tr><td></td><td>masterha_check_status</td><td>ç”¨äºæ£€æµ‹å½“å‰MHAè¿è¡ŒçŠ¶æ€</td></tr><tr><td></td><td>masterha_master_switch</td><td>ç”¨äºæ§åˆ¶æ•…éšœè½¬ç§»ï¼ˆè‡ªåŠ¨æˆ–è€…æ‰‹åŠ¨ï¼‰</td></tr><tr><td></td><td>masterha_conf_host</td><td>æ·»åŠ æˆ–åˆ é™¤é…ç½®çš„serverä¿¡æ¯</td></tr><tr><td>MHA Nodeï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰</td><td>save_binary_logs</td><td>ä¿å­˜å’Œå¤åˆ¶masterçš„äºŒè¿›åˆ¶æ—¥å¿—</td></tr><tr><td></td><td>apply_diff_relay_logs</td><td>è¯†åˆ«å·®å¼‚çš„ä¸­ç»§æ—¥å¿—äº‹ä»¶å¹¶å°†å…¶å·®å¼‚çš„äº‹ä»¶åº”ç”¨äºå…¶ä»–slave</td></tr><tr><td></td><td>purge_relay_logs</td><td>æ¸…é™¤ä¸­ç»§æ—¥å¿—ï¼ˆä¸ä¼šé˜»å¡SQLçº¿ç¨‹ï¼‰</td></tr></tbody></table><h2 id="MHAçš„å·¥ä½œçš„åŸç†">MHAçš„å·¥ä½œçš„åŸç†</h2><p><img src="https://cos.lukme.top/Pic/QQ_1724757765903.png" alt="QQ_1724757765903"></p><p>:dango:<strong>MHAçš„è®¾è®¡åŸç†åˆ†æï¼ˆFailover è¿‡ç¨‹ï¼‰</strong></p><h3 id="1-MHAè½¯ä»¶å¯åŠ¨">1.MHAè½¯ä»¶å¯åŠ¨</h3><p>æ ¹æ®å¯åŠ¨å‘½ä»¤ï¼Œåˆ†æMHAè½¯ä»¶å¯åŠ¨åŸç†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover  &lt; /dev/null &gt; /var/log/mha/app1/manager.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä»¥ä¸Šå¯åŠ¨å‘½ä»¤ï¼Œéœ€è¦å…ˆè°ƒå–MHAå¯åŠ¨è„šæœ¬æ–‡ä»¶<code>masterha_manager</code> ï¼Œ</p><p><code>--conf=.../app1.cnf</code> ä¼šæ ¹æ®åŠ è½½çš„MHAçš„é…ç½®æ–‡ä»¶ä¸åŒï¼Œå®ç°ç®¡ç†å¤šä¸ªé«˜å¯ç”¨æ¶æ„ç¯å¢ƒï¼Œè¿›è¡Œé«˜å¯ç”¨ä¸šåŠ¡çš„æ¶æ„ç¯å¢ƒçš„åŒºåˆ†ï¼›</p><p><code>--remove_dead_master_conf</code>å‚æ•°è¡¨ç¤ºåœ¨ä¸»èŠ‚ç‚¹å‡ºç°å®•æœºæƒ…å†µæ—¶ï¼Œå°†ä¼šä»é›†ç¾¤ä¸­è¢«è¸¢å‡ºï¼Œå³ä»é…ç½®æ–‡ä»¶ä¸­åˆ é™¤æ‰æ•…éšœèŠ‚ç‚¹ï¼›</p><p><code>--ignore_last_failover</code> é»˜è®¤MHAæœåŠ¡æ˜¯ä¸èƒ½é¢‘ç¹è¿›è¡Œæ•…éšœåˆ‡æ¢çš„ï¼Œéœ€è¦æœ‰ä¸€å®šçš„é—´éš”æ—¶é—´ï¼ŒåŠ æ­¤å‚æ•°è¡¨ç¤ºå¿½ç•¥åˆ‡æ¢çš„é—´éš”æ—¶é—´ï¼›</p><p><code>/var/log/mha/app1/manager.log 2&gt;&amp;1</code>æœ€åå°†MHAå¯åŠ¨è¿è¡Œçš„ä¿¡æ¯æ”¾å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­å³å¯</p><p>:dango:<strong>è¡¥å……</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¡¥å……è¯´æ˜ï¼š--ignore_last_failover</span><br><span class="line"></span><br><span class="line">ã€å®˜æ–¹è§£é‡Šã€‘</span><br><span class="line">If the previous failover failed, MHA does not start failover because the problem might happen again. The normal step to start failover is manually remove failover error file <span class="built_in">which</span> is created under (manager_workdir)/(app_name).failover.error .By setting --ignore_last_failover, MHA continues failover regardless of the last failover status.</span><br><span class="line"></span><br><span class="line">å¦‚æœä¸Šä¸€æ¬¡é«˜å¯ç”¨åŠŸèƒ½å¤±è´¥ï¼ŒMHAä¸ä¼šå†å¯åŠ¨é«˜å¯ç”¨åŠŸèƒ½ï¼Œå› ä¸ºè¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šå†æ¬¡å‡ºç°ã€‚åç»­å†æƒ³å¯åŠ¨æ•…éšœè½¬ç§»çš„æ­£å¸¸æ­¥éª¤æ˜¯æ‰‹åŠ¨åˆ é™¤æ•…éšœè½¬ç§»é”™è¯¯æ–‡ä»¶ï¼Œé”™è¯¯æ–‡ä»¶ä¼šåœ¨manager_workdirç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºapp_name.failover.errorçš„æ–‡ä»¶ã€‚å¯¹äºè®¾ç½®--ignore_last_failoverï¼Œè¡¨ç¤ºæ— è®ºä¸Šæ¬¡æ•…éšœåˆ‡æ¢çŠ¶æ€å¦‚ä½•ï¼ŒMHAéƒ½ä¼šç»§ç»­è¿›è¡Œå¯åŠ¨æ•…éšœåˆ‡æ¢åŠŸèƒ½</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨ç¼ºçœæƒ…å†µä¸‹ï¼Œå¦‚æœ MHA æ£€æµ‹åˆ°è¿ç»­å‘ç”Ÿå®•æœºï¼Œä¸”ä¸¤æ¬¡å®•æœºé—´éš”ä¸è¶³ 8 å°æ—¶çš„è¯ï¼Œåˆ™ä¸ä¼šè¿›è¡Œ Failoverï¼›ä¹‹æ‰€ä»¥è¿™æ ·é™åˆ¶æ˜¯ä¸ºäº†é¿å… ping-pong æ•ˆåº”ã€‚è¯¥å‚æ•°ä»£è¡¨å¿½ç•¥ä¸Šæ¬¡ MHA è§¦å‘åˆ‡æ¢äº§ç”Ÿçš„æ–‡ä»¶ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼ŒMHA å‘ç”Ÿåˆ‡æ¢åä¼šåœ¨æ—¥å¿—è®°å½•ï¼Œåœ¨æ—¥å¿—ç›®å½•ä¸­ä¼šç”Ÿæˆ app1.failover.complete æ–‡ä»¶ï¼›ä¸‹æ¬¡å†æ¬¡åˆ‡æ¢çš„æ—¶å€™å¦‚æœå‘ç°è¯¥ç›®å½•ä¸‹å­˜åœ¨è¯¥æ–‡ä»¶å°†ä¸å…è®¸è§¦å‘åˆ‡æ¢ï¼Œé™¤éåœ¨ç¬¬ä¸€æ¬¡åˆ‡æ¢ååˆ é™¤è¯¥æ–‡ä»¶ï¼›</span><br><span class="line"></span><br><span class="line">`å®˜æ–¹é»˜è®¤8å°æ—¶ä¹‹å†…ä¸èƒ½å†æ¬¡æ‰§è¡Œåˆ‡æ¢ä¸»åº“ï¼Œé™¤éåˆ é™¤é”æ–‡ä»¶  è®¾ç½®çš„å·¥ä½œç›®å½•ä¸‹çš„*.failover.erroræ–‡ä»¶`</span><br></pre></td></tr></table></figure><h3 id="2-MHAå®ç°ç›‘æ§">2.MHAå®ç°ç›‘æ§</h3><p>åˆ©ç”¨MHAå¯åŠ¨è„šæœ¬æ–‡ä»¶<code>masterha_manager</code>ä¼šè‡ªåŠ¨è°ƒç”¨ç›‘æ§è„šæœ¬æ–‡ä»¶<code>masterha_master_monitor</code>ï¼Œå¹¶ä¸”æ¯éš”é…ç½®æ–‡ä»¶æŒ‡å®šæ—¶é—´ï¼›</p><p><code>ping_interval=2</code> è¿›è¡Œè„šæœ¬ç›‘æ§ä¸€æ¬¡ï¼Œä»è€Œåˆ¤æ–­ä¸»èŠ‚ç‚¹æ˜¯å¦å¤„äºå­˜æ´»çŠ¶æ€ï¼Œè¿ç»­4æ¬¡è¿˜æ²¡æœ‰ä¸»åº“å¿ƒè·³ï¼Œå³è¯´æ˜ä¸»åº“å®•æœºï¼›</p><figure class="highlight plaintext"><figcaption><span>wiki</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç›‘æ§è„šæœ¬éªŒè¯ä¸»èŠ‚ç‚¹å­˜æ´»æ–¹æ³•</span><br><span class="line">[root@xiaoQ-03 ~]# mysql -umha -pmha -h192.168.30.101 -e &quot;select user();&quot;</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">+-----------------+</span><br><span class="line">| user()          |</span><br><span class="line">+-----------------+</span><br><span class="line">| mha@172.16.1.51 |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure><h3 id="3-MHAé€‰ä¸»è¿‡ç¨‹">3.MHAé€‰ä¸»è¿‡ç¨‹</h3><p>åœ¨MHAä¸­è¿›è¡Œé€‰ä¸»æ—¶ï¼Œæ ¹æ®é€‰ä¸»æºç æ–‡ä»¶ä¿¡æ¯åˆ†æï¼Œä¸»è¦ä¼šåˆ©ç”¨åˆ°å››ä¸ªæ•°ç»„ï¼šalive latest pref badï¼Œå¹¶ä¸”ä¼šè¯†åˆ«èŠ‚ç‚¹ç¼–å·ä¿¡æ¯ï¼›</p><p>åœ¨è¿›è¡Œé€‰ä¸»æ—¶ï¼Œä¸»è¦ä¼šå…³æ³¨ç«é€‰æ–°ä¸»èŠ‚ç‚¹çš„æ—¥å¿—é‡ã€ä»¥åŠæ˜¯å¦è®¾ç½®candidate_masterå‚æ•°é…ç½®ä¿¡æ¯ï¼›</p><table><thead><tr><th>æ•°ç»„ä¿¡æ¯</th><th>ç®€è¿°</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td>alive</td><td>å­˜æ´»æ•°ç»„</td><td>ä¸»è¦ç”¨äºæ¢æµ‹å­˜æ´»çš„èŠ‚ç‚¹çŠ¶æ€ï¼›å½“ä¸»åº“å®•æœºåï¼Œæ¢æµ‹çš„å°±æ˜¯ä¸¤ä¸ªä»åº“èŠ‚ç‚¹</td></tr><tr><td>latest</td><td>æœ€æ–°æ•°ç»„</td><td>è¡¨ç¤ºè·å–æ—¥å¿—æœ€æ–°çš„ä»åº“ä¿¡æ¯ï¼Œå³æ•°æ®é‡æœ€æ¥è¿‘ä¸»åº“çš„ä»åº“ï¼ˆæ ¹æ®GTIDä¿¡æ¯ æˆ– positionä¿¡æ¯ï¼‰</td></tr><tr><td>pref</td><td>å¤‡é€‰æ•°ç»„</td><td>åœ¨æ•°ç»„ä¸­å…·æœ‰candidate_masterå‚æ•°åˆ¤æ–­æ¡ä»¶ï¼Œæ­¤å‚æ•°å¯ä»¥æ”¾å…¥é…ç½®æ–‡ä»¶èŠ‚ç‚¹ä¸­ï¼Œä¾¿äºèŠ‚ç‚¹ä¼˜å…ˆé€‰æ‹©ä¸ºæ–°ä¸»</td></tr><tr><td>bad</td><td>ä¸é€‰æ•°ç»„</td><td>å¦‚æœè®¾å®šäº†å‚æ•°ï¼šno_master=1ï¼Œè¡¨ç¤ºç›¸åº”èŠ‚ç‚¹ä¸å‚ä¸ç«é€‰ä¸»ï¼›<br>å¦‚æœè®¾å®šäº†å‚æ•°ï¼šlog_bin=0ï¼ˆäºŒè¿›åˆ¶æ—¥å¿—æ²¡å¼€ï¼‰ï¼Œè¡¨ç¤ºç›¸åº”èŠ‚ç‚¹ä¸å‚ä¸ç«é€‰ä¸»ï¼›<br>å¦‚ä½•è®¾å®šäº†å‚æ•°ï¼šcheck_slave_delayï¼Œæ£€æŸ¥ä»åº“å»¶è¿Ÿä¸»åº“100Mæ•°æ®ä¿¡æ¯æ—¥å¿—é‡ï¼Œè¡¨ç¤ºèŠ‚ç‚¹ä¸å‚ä¸ç«é€‰ä¸»</td></tr></tbody></table><p>MHAé€‰ä¸»åˆ¤æ–­æ€»ç»“ï¼ˆåˆ©ç”¨ifåˆ¤æ–­é€‰ä¸»çš„æƒ…å†µï¼‰</p><ul><li><p>å¾ªç¯å¯¹æ¯”latestæ•°ç»„å’Œprefæ•°ç»„çš„slaveï¼Œå¦‚æœå­˜åœ¨ç›¸åŒçš„slaveï¼Œå¹¶ä¸”è¿™ä¸ªslaveä¸åœ¨badæ•°ç»„å½“ä¸­ï¼Œè¯¥slaveä¼šè¢«æ¨é€‰ä¸ºæ–°çš„master</p><p>DB02èŠ‚ç‚¹å³æ»¡è¶³latestæ•°ç»„ä¿¡æ¯ï¼Œåˆæ»¡è¶³perfæ•°ç»„ä¿¡æ¯ï¼Œä½†ä¸æ»¡è¶³badæ•°æ®ä¿¡æ¯ï¼Œå³ä¼šè¢«é€‰ä¸ºæ–°ä¸»ï¼Œæœ‰å¤šä¸ªæŒ‰ç…§å·ç é¡ºåºé€‰ä¸¾ï¼›</p></li><li><p>å¦‚æœprefå’Œbadæ•°ç»„å½“ä¸­çš„ä¸ªæ•°ä¸º0ï¼Œåˆ™é€‰æ‹©latestæ•°ç»„å½“ä¸­çš„ç¬¬ä¸€ä¸ªslaveä¸ºmasterï¼›</p><p>DB02èŠ‚ç‚¹æ²¡æœ‰candidate_masterå‚æ•°é…ç½®ï¼Œåˆæ²¡æœ‰ä¸é€‰æ•°ç»„é‡Œçš„ä¸‰ç§æƒ…å†µé…ç½®ï¼Œå³db02æ°å¥½æ˜¯latestï¼Œä¸ºæ–°ä¸»ï¼›</p></li><li><p>å¾ªç¯å¯¹æ¯”aliveæ•°ç»„å’Œprefæ•°ç»„å½“ä¸­çš„slavesï¼Œå¦‚æœæœ‰ä¸€ä¸ªslaveç›¸åŒï¼Œå¹¶ä¸”ä¸åœ¨badæ•°ç»„å½“ä¸­ï¼Œè¯¥èŠ‚ç‚¹å°±ä¼šæˆä¸ºæ–°çš„masterï¼›</p><p>DB02èŠ‚ç‚¹å³ä¸æ»¡è¶³latestï¼Œä¹Ÿä¸æ»¡è¶³badï¼Œä½†æ˜¯æ»¡è¶³prefï¼Œä¹Ÿä¼šè¢«é€‰æ‹©ä½œä¸ºæ–°ä¸»ï¼›</p></li><li><p>å¾ªç¯latestæ•°ç»„ï¼Œå¦‚æœåˆå¾ªç¯åˆ°slaveä¸åœ¨badæ•°ç»„å½“ä¸­ï¼Œè¿™ä¸ªslaveå°±ä¼šæˆä¸ºmasterï¼Œå°±ç®—æ·»åŠ äº†candidate_master=1å‚æ•°ï¼›</p><p>è¯¥slaveä¹Ÿä¸ä¸€å®šä¼šæˆä¸ºä¸»åº“ï¼›</p><p>DB02èŠ‚ç‚¹å³æ»¡è¶³latestæ•°ç»„ï¼Œä¸æ˜¯badæ•°ç»„ï¼Œä¹Ÿä¼šæˆä¸ºæ–°çš„ä¸»ï¼›</p></li><li><p>ä»æ´»ç€çš„slaveå½“ä¸­è¿›è¡Œå¾ªç¯ï¼Œå¦‚æœå¾ªç¯åˆ°slaveä¸åœ¨badæ•°ç»„å½“ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªslaveå°±ä¼šæˆä¸ºä¸»åº“ï¼›</p><p>DB02èŠ‚ç‚¹æ˜¯æ´»ç€çš„ï¼Œä¸æ»¡è¶³badï¼Œä¹Ÿå¯ä»¥æˆä¸ºæ–°çš„ä¸»ï¼›</p></li><li><p>å¦‚æœè¿›è¡Œäº†å¤šæ¬¡é€‰æ‹©éƒ½æ‰¾ä¸åˆ°ä¸»åº“ï¼Œé‚£ä¹ˆä¸»åº“é€‰æ‹©å¤±è´¥ï¼Œfailoverå¤±è´¥ï¼›</p></li></ul><p>é€‰ä¸»ç­–ç•¥ç®€è¿°è¡¨ï¼š</p><table><thead><tr><th>ä¼˜å…ˆçº§</th><th>aliveæ•°ç»„</th><th>latestæ•°ç»„</th><th>prefæ•°ç»„</th><th>badæ•°ç»„</th><th>é€‰ä¸»ç­–ç•¥</th><th>å¤šä¸ªé€‰æ‹©æƒ…å†µ</th></tr></thead><tbody><tr><td>01</td><td><code>æ»¡è¶³</code></td><td><code>æ»¡è¶³</code></td><td><code>æ»¡è¶³</code></td><td>ä¸æ»¡è¶³</td><td>ä¼˜é€‰é€‰æ‹©</td><td>æŒ‰ç…§èŠ‚ç‚¹å·ç é¡ºåºé€‰æ‹©</td></tr><tr><td>02</td><td><code>æ»¡è¶³</code></td><td><code>æ»¡è¶³</code></td><td>ä¸æ»¡è¶³</td><td>ä¸æ»¡è¶³</td><td>ä¼˜é€‰é€‰æ‹©</td><td>æŒ‰ç…§èŠ‚ç‚¹å·ç é¡ºåºé€‰æ‹©</td></tr><tr><td>03</td><td><code>æ»¡è¶³</code></td><td>ä¸æ»¡è¶³</td><td><code>æ»¡è¶³</code></td><td>ä¸æ»¡è¶³</td><td>ä¼˜é€‰é€‰æ‹©</td><td>æŒ‰ç…§èŠ‚ç‚¹å·ç é¡ºåºé€‰æ‹©</td></tr><tr><td>04</td><td><code>æ»¡è¶³</code></td><td>ä¸æ»¡è¶³</td><td>ä¸æ»¡è¶³</td><td>ä¸æ»¡è¶³</td><td>ä¼˜é€‰æ´»ç€èŠ‚ç‚¹</td><td>æŒ‰ç…§èŠ‚ç‚¹å·ç é¡ºåºé€‰æ‹©</td></tr></tbody></table><blockquote><p>è¯´æ˜ï¼šåœ¨è¿›è¡Œæ‰‹å·¥æŒ‡å®šåˆ‡æ¢æ–°ä¸»æ—¶ï¼Œå³åº”ç”¨äº†prio_new_master_hostå‚æ•°ä¿¡æ¯æ—¶ï¼Œä¼šæœ€ä¼˜å…ˆé€‰æ‹©ç›¸åº”èŠ‚ç‚¹ä¸ºæ–°ä¸»ï¼›</p><p>ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ï¼šæ ¹æ®mhaé…ç½®æ–‡ä»¶é‡Œserveråçš„æ•°å€¼å°çš„åˆ‡æ¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[server1]</span><br><span class="line">hostname=10.0.0.51</span><br><span class="line">port=3306</span><br><span class="line">[server2]</span><br><span class="line">hostname=10.0.0.52</span><br><span class="line">port=3306</span><br></pre></td></tr></table></figure></blockquote><h3 id="4-MHAæ•°æ®è¡¥å¿">4.MHAæ•°æ®è¡¥å¿</h3><p>åœ¨è¿›è¡Œæ•°æ®è¡¥å¿ä¹‹å‰ï¼Œéœ€è¦è®©æ–°ä¸»åº“ä¸åŸæœ‰å®•æœºä¸»åº“è¿›è¡Œå¯¹æ¯”ï¼Œè·æ‚‰éœ€è¦è¡¥å¿çš„æ•°æ®é‡æƒ…å†µï¼Œå³å¯¹æ¯”å·®çš„æ•°æ®æ—¥å¿—é‡ä¿¡æ¯ï¼›</p><p>ç„¶åå¯ä»¥ä»binlogæ—¥å¿—ä¸­ï¼Œè¿›è¡Œè¡¥å……æ•°æ®ä¿¡æ¯çš„æˆªå–ï¼Œéšä¹‹è¿›è¡Œæ•°æ®ä¿¡æ¯è¡¥å¿ï¼Œä½†æ˜¯æœ‰ç§ç‰¹æ®Šæƒ…å†µï¼Œè‹¥åŸæœ‰ä¸»åº“æ— æ³•è®¿é—®äº†ï¼›</p><p>æ‰€ä»¥è¿›è¡Œæ•°æ®è¡¥å¿æ“ä½œï¼Œä¹Ÿéœ€è¦åˆ†å„ç§æƒ…æ™¯è¿›è¡Œå¤„ç†ï¼š</p><ul><li><p>åŸä¸»åº“SSHè¿æ¥æ­£å¸¸ï¼š</p><p>å„ä¸ªä»èŠ‚ç‚¹è‡ªåŠ¨è°ƒç”¨ï¼š<code>save_binary_logs</code>è„šæœ¬æ–‡ä»¶ï¼Œç«‹å³ä¿å­˜ç¼ºå¤±éƒ¨åˆ†çš„bin_logï¼Œåˆ°å„èŠ‚ç‚¹/var/tmp/ç›®å½•ï¼›</p></li><li><p>åŸä¸»åº“SSHè¿æ¥å¼‚å¸¸ï¼š</p><p>å„ä¸ªä»èŠ‚ç‚¹è‡ªåŠ¨è°ƒç”¨ï¼š<code>apply_diff_relay_logs</code>è„šæœ¬æ–‡ä»¶ï¼Œè¿›è¡Œrelay_logæ—¥å¿—å·®å¼‚ä¿¡æ¯è¡¥å¿ï¼›</p></li><li><p>é¢å¤–ç‰¹æ®Šæ•°æ®è¡¥å……ï¼šï¼ˆåˆ©ç”¨ä¸»åº“æ—¥å¿—å†—ä½™æœºåˆ¶ï¼‰</p><p>MHAæä¾›äº†binlog_serveråŠŸèƒ½ï¼Œå¯ä»¥å®æ—¶æ‹‰å–ä¸»åº“çš„binlogæ—¥å¿—åˆ°å¤‡ä»½èŠ‚ç‚¹ï¼Œä»è€Œè¿›è¡Œæ•°æ®é¢å¤–è¡¥å¿ï¼›</p></li></ul><h3 id="5-MHAä¸šåŠ¡åˆ‡æ¢">5.MHAä¸šåŠ¡åˆ‡æ¢</h3><p>è‡ªåŠ¨è§£é™¤åŸæœ‰çš„ä¸»ä»å…³ç³»ï¼Œå®ç°æ–°çš„ä¸»ä»å…³ç³»çš„å»ºç«‹ï¼›</p><figure class="highlight plaintext"><figcaption><span>wiki</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æ‰€æœ‰ä»åº“è§£é™¤ä¸»ä»å…³ç³»æ“ä½œ</span><br><span class="line">stop slave;</span><br><span class="line">reset slave;</span><br><span class="line"></span><br><span class="line"># æ‰€æœ‰ä»åº“é‡æ„ä¸»ä»å…³ç³»æ“ä½œ</span><br><span class="line">change master to ...</span><br></pre></td></tr></table></figure><h3 id="6-MHAåº”ç”¨é€æ˜">6.MHAåº”ç”¨é€æ˜</h3><p>å®ç°MHAçš„VIPåŠŸèƒ½ï¼Œåˆ©ç”¨è„šæœ¬å®ç°ï¼Œä¸Šä¼ mha_script.taræ–‡ä»¶åˆ°/usr/local/binç›®å½•ä¸­ï¼Œç„¶åè¿›è¡Œè§£å‹å¤„ç†ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># ä¸Šä¼ MHAæ‰€éœ€çš„è„šæœ¬æ–‡ä»¶</span><br><span class="line">[root@xiaoQ-03 ~]# cd /usr/local/bin/</span><br><span class="line">[root@xiaoQ-03 bin]# chmod +x /usr/local/bin/*</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹MHAè„šæœ¬æ–‡ä»¶çš„ä¿¡æ¯</span><br><span class="line">[root@xiaoQ-03 bin]# cp master_ip_failover master_ip_failover.bak</span><br><span class="line">[root@xiaoQ-03 bin]# dos2unix /usr/local/bin/*</span><br><span class="line">[root@xiaoQ-03 bin]# vim master_ip_failover</span><br><span class="line">13 my $vip = &#x27;192.168.30.110/24&#x27;;</span><br><span class="line">14 my $key = &#x27;1&#x27;;</span><br><span class="line">15 my $if = &#x27;eth0&#x27;;</span><br><span class="line">16 my $ssh_start_vip = &quot;/sbin/ifconfig $if:$key $vip&quot;;</span><br><span class="line">17 my $ssh_stop_vip = &quot;/sbin/ifconfig $if:$key down&quot;;</span><br><span class="line">18 my $ssh_Bcast_arp= &quot;/sbin/arping -I $if -c 3 -A 192.168.30.110&quot;;</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@xiaoQ-03 ~]# vim /etc/mha/app1.cnf</span><br><span class="line">master_ip_failover_script=/usr/local/bin/master_ip_failover</span><br><span class="line"></span><br><span class="line"># é‡å¯MHAæœåŠ¡</span><br><span class="line">[root@xiaoQ-03 bin]# masterha_stop --conf=/etc/mha/app1.cnf</span><br><span class="line">[root@xiaoQ-03 bin]# nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover  &lt; /dev/null&gt; /var/log/mha/app1/manager.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># æ‰‹å·¥åœ¨ä¸»åº“ä¸Šæ·»åŠ VIP</span><br><span class="line">[root@xiaoQ-03 bin]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:103046) is running(0:PING_OK), master:192.168.30.101</span><br><span class="line">-- æ ¸å®æ­¤æ—¶çš„MHAçš„ä¸»åº“èŠ‚ç‚¹</span><br><span class="line">ifconfig eth0:1 192.168.30.110/24</span><br><span class="line">-- åœ¨ä¸»åº“èŠ‚ç‚¹æ‰‹å·¥æ·»åŠ vipåœ°å€ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"># è¿›è¡ŒVIPåœ°å€è¿æ¥æµ‹è¯•</span><br><span class="line">-- å¯ä»¥ä½¿ç”¨navcatè½¯ä»¶ï¼Œè¿æ¥MHAçš„vipåœ°å€ï¼ŒæŸ¥çœ‹æ‰€è¿ä¸»æœºä¿¡æ¯æ˜¯å¦ä¸ºä¸»èŠ‚ç‚¹ï¼Œå½“æ•…éšœè½¬ç§»åå¯ä»¥æ ¸å®VIPåœ°å€æ˜¯å¦æŒç»­è¿æ¥ï¼›</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šè¿›è¡ŒMHAçš„VIPåœ°å€æ¼‚ç§»æ—¶ï¼Œåªèƒ½åœ¨å±€åŸŸç½‘ç¯å¢ƒè¿›è¡Œæ¼‚ç§»ï¼Œä¸èƒ½å®ç°è·¨ç½‘æ®µçš„VIPåœ°å€æ¼‚ç§»ï¼›</p></blockquote><h3 id="7-MHAæ•…éšœæŠ¥è­¦">7.MHAæ•…éšœæŠ¥è­¦</h3><p>å®ç°MHAçš„æŠ¥è­¦åŠŸèƒ½ï¼Œåˆ©ç”¨è„šæœ¬å®ç°ï¼Œä¸Šä¼ mha_script.taræ–‡ä»¶åˆ°/usr/local/binç›®å½•ä¸­ï¼Œç„¶åè¿›è¡Œè§£å‹å¤„ç†ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡†å¤‡è„šæœ¬æ–‡ä»¶</span></span><br><span class="line">[root@xiaoQ-03 bin]# <span class="built_in">cp</span> send_report send_report.bak</span><br><span class="line">28 my <span class="variable">$smtp</span>=<span class="string">&#x27;smtp.qq.com&#x27;</span>;</span><br><span class="line">-- smtpæœåŠ¡å™¨åœ°å€åŸŸå</span><br><span class="line">29 my <span class="variable">$mail_from</span>=<span class="string">&#x27;330882721@qq.com&#x27;</span>;</span><br><span class="line">-- å‘ä»¶ç®±ä¿¡æ¯é…ç½®</span><br><span class="line">30 my <span class="variable">$mail_user</span>=<span class="string">&#x27;330882721&#x27;</span>;</span><br><span class="line">-- ç”¨æˆ·å QQå·</span><br><span class="line">31 my <span class="variable">$mail_pass</span>=<span class="string">&#x27;ypokkranqlgkcbba&#x27;</span>;</span><br><span class="line">-- é‚®ç®±æˆæƒç </span><br><span class="line">32 my <span class="variable">$mail_to</span>=<span class="string">&#x27;330882721@qq.com&#x27;</span>;</span><br><span class="line">or</span><br><span class="line">my <span class="variable">$mail_to</span>=[<span class="string">&#x27;to1@qq.com&#x27;</span>,<span class="string">&#x27;to2@qq.com&#x27;</span>];</span><br><span class="line">-- æ”¶ä»¶ç®±ä¿¡æ¯é…ç½®</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@xiaoQ-03 ~]# vim /etc/mha/app1.cnf</span><br><span class="line">report_script=/usr/local/bin/send_report</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯MHAæœåŠ¡</span></span><br><span class="line">[root@xiaoQ-03 bin]# masterha_stop --conf=/etc/mha/app1.cnf</span><br><span class="line">[root@xiaoQ-03 bin]# <span class="built_in">nohup</span> masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover  &lt; /dev/null&gt; /var/log/mha/app1/manager.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h3 id="8-MHAé¢å¤–è¡¥å¿">8.MHAé¢å¤–è¡¥å¿</h3><p>åˆ©ç”¨binlog_serverä½œä¸ºé¢å¤–çš„æ—¥å¿—è¡¥å¿çš„å†—ä½™æ–¹æ¡ˆï¼Œå³å®æ—¶ä¿å­˜ä¸»åº“çš„bin_logæ—¥å¿—æ–‡ä»¶åˆ°ç‰¹å®šèŠ‚ç‚¹ç›®å½•ä¸­ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ—¥å¿—å­˜æ”¾ç›®å½•</span></span><br><span class="line">[root@xiaoQ-03 ~]# <span class="built_in">mkdir</span> -p /data/binlog_server/</span><br><span class="line">[root@xiaoQ-03 ~]# <span class="built_in">chown</span> -R mysql.mysql /data/*</span><br><span class="line">[root@xiaoQ-03 ~]# <span class="built_in">cd</span> /data/binlog_server</span><br><span class="line">[root@xiaoQ-03 binlog_server]# mysql -e <span class="string">&quot;show slave status\G&quot;</span>|grep <span class="string">&quot;Master_Log&quot;</span></span><br><span class="line">Master_Log_File: mysql-bin.000002</span><br><span class="line">Read_Master_Log_Pos: 1201</span><br><span class="line">Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">Exec_Master_Log_Pos: 1201</span><br><span class="line">-- æ‹‰å–æ—¥å¿—çš„èµ·ç‚¹ï¼Œéœ€è¦æŒ‰ç…§ç›®å‰ä»åº“çš„å·²ç»è·å–åˆ°çš„äºŒè¿›åˆ¶æ—¥å¿—ç‚¹ä¸ºèµ·ç‚¹</span><br><span class="line">[root@xiaoQ-03 binlog_server]# mysqlbinlog -R --host=192.168.30.101 --user=mha --password=mha --raw --stop-never mysql-bin.000002 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™é…ç½®æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">[root@xiaoQ-03 ~]# vim /etc/mha/app1.cnf</span><br><span class="line">[binlog1]</span><br><span class="line">no_master=1</span><br><span class="line">-- ä¸å­˜äºç«é€‰</span><br><span class="line">hostname=192.168.30.103</span><br><span class="line">-- å°†æ—¥å¿—é¢å¤–è¡¥å¿åˆ°å“ªä¸ªä¸»æœºä¸Š</span><br><span class="line">master_binlog_dir=/data/binlog_server/</span><br><span class="line">-- æ—¥å¿—é¢å¤–è¡¥å¿çš„å­˜å‚¨ç›®å½•</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯MHAæœåŠ¡</span></span><br><span class="line">[root@xiaoQ-03 bin]# masterha_stop --conf=/etc/mha/app1.cnf</span><br><span class="line">[root@xiaoQ-03 bin]# <span class="built_in">nohup</span> masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover  &lt; /dev/null&gt; /var/log/mha/app1/manager.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h2 id="MHAæ­å»º">MHAæ­å»º</h2><ul><li>æ­å»ºMySQLçš„MHAéœ€è¦ä¿è¯ä¸»ä»å¤åˆ¶æ˜¯OKçš„</li></ul><p><strong>ç¯å¢ƒä¸€è§ˆ</strong></p><table><thead><tr><th style="text-align:left">ä¸»æœºå</th><th>WanIP</th><th>LanIP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:left">mha</td><td>10.0.0.50</td><td>172.16.1.50</td><td>MHAç®¡ç†ç«¯</td></tr><tr><td style="text-align:left">db01</td><td>10.0.0.51</td><td>172.16.1.51</td><td>æš‚æ—¶ä¸»åº“ï¼Œå®¢æˆ·ç«¯</td></tr><tr><td style="text-align:left">db02</td><td>10.0.0.52</td><td>172.16.1.52</td><td>ä»åº“ï¼ŒMHAå®¢æˆ·ç«¯</td></tr><tr><td style="text-align:left">db03</td><td>10.0.0.53</td><td>172.16.1.53</td><td>ä»åº“ï¼ŒMHAå®¢æˆ·ç«¯</td></tr><tr><td style="text-align:left">db04</td><td>10.0.0.54</td><td>172.16.1.54</td><td>ä»åº“ï¼ŒMHAå®¢æˆ·ç«¯</td></tr></tbody></table><h3 id="MHAçš„å¿…è¦æ¡ä»¶">MHAçš„å¿…è¦æ¡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸»ä»å¤åˆ¶OK</span><br><span class="line">2.æ•°æ®åº“çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¾—æœ‰repä¸»ä»å¤åˆ¶ç”¨æˆ·</span><br><span class="line">3.æ•°æ®åº“æ¯ä¸ªèŠ‚ç‚¹è¦æœ‰mhaç”¨æˆ·</span><br><span class="line">4.å…³é—­è‡ªåŠ¨åˆ é™¤relay-log</span><br><span class="line">5.æ¯ä¸€å°éƒ½éœ€è¦åšå…å¯†è¿æ¥</span><br><span class="line">6.åšmysqldè½¯é“¾æ¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‰å°ä»åº“è®¾ç½®åªè¯»ï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global read_only=1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å››å°æ•°æ®åº“å…³é—­relaylogè‡ªåŠ¨åˆ é™¤åŠŸèƒ½ï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global relay_log_purge = 0;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>:dango:<strong>ä¸»ä»å¤åˆ¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ç¼–è¾‘ä¸»åº“é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">server_id=1</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">skip_name=resolve</span><br><span class="line"><span class="comment">#å…³é—­è‡ªåŠ¨åˆ é™¤relay-log</span></span><br><span class="line">relay_log_purge=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ä»åº“é…ç½®æ–‡ä»¶çš„æ¯å°server_idä¸åŒå³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.ä¸»åº“åˆ›å»ºä¸»ä»å¤åˆ¶ç”¨æˆ·</span></span><br><span class="line">mysql&gt; grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸»åº“æ£€æŸ¥bin-logä½ç½®ç‚¹</span></span><br><span class="line">db01 [(none)]&gt;show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000003 |      327 |              |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æ‰€æœ‰ä»åº“æ‰§è¡Œ</span></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000003&#x27;</span>,</span><br><span class="line">master_log_pos=327,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰€æœ‰ä»åº“å¼€å¯ä¸»ä»å¤åˆ¶</span></span><br><span class="line">mysql &gt; start slave;</span><br></pre></td></tr></table></figure><p>:dango:<strong>ä¸»åº“æ‰§è¡Œ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸»åº“æ‰§è¡Œï¼ˆä¸»ä»å¤åˆ¶OKæƒ…å†µä¸‹ï¼‰</span></span><br><span class="line"><span class="comment">#æ¯å°éƒ½æœ‰ä¸»ä»å¤åˆ¶ç”¨æˆ·</span></span><br><span class="line">mysql&gt; grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¯å°éƒ½æœ‰mhaç”¨æˆ·</span></span><br><span class="line">mysql&gt; grant all on *.* to mha@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;mha&#x27;</span>;</span><br></pre></td></tr></table></figure><p>:dango:<strong>äº’ä¿¡å…å¯†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯ä»¥æ‰§è¡Œè„šæœ¬ï¼Œæ¯ä¸€å°éƒ½éœ€è¦å…å¯†ï¼ˆæ³¨æ„ä¿®æ”¹å¯†ç  -p 1 ï¼‰</span></span><br><span class="line">[root@db01 ~]# <span class="built_in">cat</span> push_public_key.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">yum -y install sshpass</span><br><span class="line"><span class="built_in">test</span> -f ~/.ssh/id_rsa || ssh-keygen -t rsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_rsa &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> 50 51 52 53 54;<span class="keyword">do</span></span><br><span class="line">ping -c1 -W1 172.16.1.<span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">[ $? -eq 0 ] &amp;&amp;\</span><br><span class="line">sshpass -p 1 ssh-copy-id -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa.pub root@172.16.1.<span class="variable">$ip</span> &amp;&gt;/dev/null &amp;&amp;\</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;172.16.1.<span class="variable">$ip</span> æ¨é€æˆåŠŸ...&quot;</span> ||\</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;172.16.1.<span class="variable">$ip</span> æ¨é€å¤±è´¥...&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸ç”¨è„šæœ¬</span></span><br><span class="line"><span class="comment">## ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">[root@db01 ~]# ssh-keygen -t dsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">[root@db02 ~]# ssh-keygen -t dsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">[root@db03 ~]# ssh-keygen -t dsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">[root@db04 ~]# ssh-keygen -t dsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">[root@mha-manager ~]# ssh-keygen -t dsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ¨é€å…¬é’¥ï¼ˆæ¯ä¸€å°éƒ½éœ€è¦æ‰§è¡Œï¼Œsshpasséœ€è¦å®‰è£…ï¼Œä¸ç„¶éœ€è¦äº¤äº’ï¼‰</span></span><br><span class="line">[root@db01 ~]# sshpass -p 1 ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.50</span><br><span class="line">[root@db01 ~]# sshpass -p 1 ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.51</span><br><span class="line">[root@db01 ~]# sshpass -p 1 ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.52</span><br><span class="line">[root@db01 ~]# sshpass -p 1 ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.53</span><br><span class="line">[root@db01 ~]# sshpass -p 1 ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.54</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰€ä»¥ç”¨è„šæœ¬å§</span></span><br></pre></td></tr></table></figure><p>:dango:<strong>å‘½ä»¤è½¯é“¾æ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span><br><span class="line">[root@db01 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysql /usr/bin/mysql</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span><br><span class="line">[root@db02 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysql /usr/bin/mysql</span><br><span class="line"></span><br><span class="line">[root@db03 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span><br><span class="line">[root@db03 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysql /usr/bin/mysql</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span><br><span class="line">[root@db04 ~]# <span class="built_in">ln</span> -s /app/mysql/bin/mysql /usr/bin/mysql</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²MHAå®¢æˆ·ç«¯">éƒ¨ç½²MHAå®¢æˆ·ç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MySQL 5.6ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨node0.56ç‰ˆæœ¬</span></span><br><span class="line">[root@db01 ~]# wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-node-0.56-0.el6.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQL 5.7åŠä»¥ä¸Šå»ºè®®ä½¿ç”¨node0.58ç‰ˆæœ¬</span></span><br><span class="line">[root@db01 ~]# wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†nodeä¼ åˆ°å…¶å®ƒæœºå™¨</span></span><br><span class="line">[root@db01 ~]# scp mha4mysql-node-0.56-0.el6.noarch.rpm 10.0.0.50:/root</span><br><span class="line">[root@db01 ~]# scp mha4mysql-node-0.56-0.el6.noarch.rpm 10.0.0.52:/root</span><br><span class="line">[root@db01 ~]# scp mha4mysql-node-0.56-0.el6.noarch.rpm 10.0.0.53:/root</span><br><span class="line">[root@db01 ~]# scp mha4mysql-node-0.56-0.el6.noarch.rpm 10.0.0.54:/root</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…nodeï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½åšï¼‰</span></span><br><span class="line">[root@db01 ~]# yum -y localinstall mha4mysql-node-0.56-0.el6.noarch.rpm</span><br><span class="line">[root@db02 ~]# yum -y localinstall mha4mysql-node-0.56-0.el6.noarch.rpm</span><br><span class="line">[root@db03 ~]# yum -y localinstall mha4mysql-node-0.56-0.el6.noarch.rpm</span><br><span class="line">[root@db04 ~]# yum -y localinstall mha4mysql-node-0.56-0.el6.noarch.rpm</span><br><span class="line">[root@mha ~]# yum -y localinstall mha4mysql-node-0.56-0.el6.noarch.rpm</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²MHAç®¡ç†ç«¯">éƒ¨ç½²MHAç®¡ç†ç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºé…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•</span></span><br><span class="line">[root@mha-manager ~]# <span class="built_in">mkdir</span> /etc/mha</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç¼–å†™é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@mha-manager ~]# vim /etc/mha/app1.cnf</span><br><span class="line">[server default]</span><br><span class="line">manager_log=/etc/mha/logs/manager.log</span><br><span class="line">manager_workdir=/etc/mha/app1</span><br><span class="line">master_binlog_dir=/app/mysql/data</span><br><span class="line">user=mha</span><br><span class="line">password=mha</span><br><span class="line">ping_interval=2</span><br><span class="line">repl_user=rep</span><br><span class="line">repl_password=123</span><br><span class="line">ssh_user=root</span><br><span class="line">ssh_port=22</span><br><span class="line"></span><br><span class="line">[server1]</span><br><span class="line"><span class="comment">#candidate_master=1</span></span><br><span class="line"><span class="comment">#check_repl_delay=0</span></span><br><span class="line">hostname=172.16.1.51</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server2]</span><br><span class="line"><span class="comment">#candidate_master=1</span></span><br><span class="line"><span class="comment">#check_repl_delay=0</span></span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server3]</span><br><span class="line">hostname=172.16.1.53</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server4]</span><br><span class="line">hostname=172.16.1.54</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åˆ›å»ºMHAç®¡ç†ç”¨æˆ·</span></span><br><span class="line">mysql&gt; grant all on *.* to mha@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;mha&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æ—¥å¿—å’Œå·¥ä½œç›®å½•ç›®å½•åˆ›å»º</span></span><br><span class="line">[root@mha-manager ~]# <span class="built_in">mkdir</span> -p /etc/mha/&#123;logs,app1&#125;</span><br><span class="line">[root@mha-manager ~]# ll /etc/mha/</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 2 root root 6 Aug 27 12:20 app1</span><br><span class="line">-rw-r--r-- 1 root root 457 Aug 27 12:16 app1.cnf</span><br><span class="line">drwxr-xr-x 2 root root 6 Aug 27 12:19 logs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æ£€æµ‹MHA sshå…å¯†</span></span><br><span class="line">[root@mha-manager ~]# masterha_check_ssh --conf=/etc/mha/app1.cnf</span><br><span class="line">All SSH connection tests passed successfully.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.æ£€æµ‹MHA ä¸»ä»å¤åˆ¶</span></span><br><span class="line">[root@mha-manager ~]# masterha_check_repl --conf=/etc/mha/app1.cnf</span><br><span class="line">MySQL Replication Health is OK.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.å¯åŠ¨MHA</span></span><br><span class="line"><span class="built_in">nohup</span> masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover &lt; /dev/null &gt; /etc/mha/logs/manager.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`masterha_managerï¼š`å¯åŠ¨å‘½ä»¤</span><br><span class="line">--conf=/etc/mha/app1.cnfï¼šæŒ‡å®šé…ç½®æ–‡ä»¶</span><br><span class="line">--remove_dead_master_confï¼šåšå®Œåˆ‡æ¢åï¼Œä»é…ç½®æ–‡ä»¶ä¸­æ‘˜é™¤å®•æœºçš„ä¸»åº“</span><br><span class="line">--ignore_last_failoverï¼šå¿½ç•¥ä¸Šä¸€æ¬¡åˆ‡æ¢</span><br><span class="line"></span><br><span class="line"><span class="comment"># MHAåˆ‡æ¢æœºåˆ¶ï¼š</span></span><br><span class="line">1.MHAåœ¨åšä¸€æ¬¡åˆ‡æ¢åï¼Œç”Ÿæˆä¸€ä¸ªé”æ–‡ä»¶ï¼ˆapp1.failover.completeï¼‰ï¼Œåœ¨å·¥ä½œç›®å½•ä¸‹ï¼Œ8ä¸ªå°æ—¶ä¹‹å†…ï¼Œæ— æ³•åšç¬¬äºŒæ¬¡åˆ‡æ¢</span><br><span class="line">2.MHAåˆ‡æ¢å®Œæˆåï¼Œä¼šè‡ªåŠ¨ç»“æŸMHAçš„è¿›ç¨‹</span><br><span class="line">3.åœ¨æ‰€æœ‰ä»åº“æ•°æ®ç›¸åŒæ—¶ï¼ŒMHAä¼šé€‰æ‹©é…ç½®æ–‡ä»¶ä¸­æ ‡ç­¾<span class="built_in">id</span>æœ€å°çš„åˆ‡æ¢</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.å¯åŠ¨åæ£€æµ‹</span></span><br><span class="line">[root@mha-manager ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:19524) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä½¿ç”¨systemdç®¡ç†mha</span></span><br><span class="line">[root@mha-manager ~]# vim /usr/lib/systemd/system/mha.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=MHA</span><br><span class="line">After=network.target sshd-keygen.service</span><br><span class="line">Wants=sshd-keygen.service</span><br><span class="line">[Service]</span><br><span class="line">Type=sample</span><br><span class="line">ExecStart=/usr/bin/masterha_manager --conf=/etc/mha/app1.cnf --</span><br><span class="line">remove_dead_master_conf --ignore_last_failover &gt; /etc/mha/logs/manager.log</span><br><span class="line">ExecStop=/usr/bin/masterha_stop --conf=/etc/mha/app1.cnf</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="MHAé…ç½®æ–‡ä»¶è¯¦è§£-dango">MHAé…ç½®æ–‡ä»¶è¯¦è§£:dango:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[server default]</span><br><span class="line"><span class="comment">#è®¾ç½®managerçš„å·¥ä½œç›®å½•</span></span><br><span class="line">manager_workdir=/var/log/masterha/app1</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®managerçš„æ—¥å¿—</span></span><br><span class="line">manager_log=/var/log/masterha/app1/manager.log </span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®master ä¿å­˜binlogçš„ä½ç½®ï¼Œä»¥ä¾¿MHAå¯ä»¥æ‰¾åˆ°masterçš„æ—¥å¿—ï¼Œæˆ‘è¿™é‡Œçš„ä¹Ÿå°±æ˜¯mysqlçš„æ•°æ®ç›®å½•</span></span><br><span class="line">master_binlog_dir=/data/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®è‡ªåŠ¨failoveræ—¶å€™çš„åˆ‡æ¢è„šæœ¬</span></span><br><span class="line">master_ip_failover_script= /usr/local/bin/master_ip_failover</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®æ‰‹åŠ¨åˆ‡æ¢æ—¶å€™çš„åˆ‡æ¢è„šæœ¬</span></span><br><span class="line">master_ip_online_change_script= /usr/local/bin/master_ip_online_change</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®mysqlä¸­rootç”¨æˆ·çš„å¯†ç ï¼Œè¿™ä¸ªå¯†ç æ˜¯å‰æ–‡ä¸­åˆ›å»ºç›‘æ§ç”¨æˆ·çš„é‚£ä¸ªå¯†ç </span></span><br><span class="line">password=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®ç›‘æ§ç”¨æˆ·root</span></span><br><span class="line">user=root</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®ç›‘æ§ä¸»åº“ï¼Œå‘é€pingåŒ…çš„æ—¶é—´é—´éš”ï¼Œå°è¯•ä¸‰æ¬¡æ²¡æœ‰å›åº”çš„æ—¶å€™è‡ªåŠ¨è¿›è¡Œfailover</span></span><br><span class="line">ping_interval=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®è¿œç«¯mysqlåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶binlogçš„ä¿å­˜ä½ç½®</span></span><br><span class="line">remote_workdir=/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®å¤åˆ¶ç”¨æˆ·çš„å¯†ç </span></span><br><span class="line">repl_password=123</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®å¤åˆ¶ç¯å¢ƒä¸­çš„å¤åˆ¶ç”¨æˆ·å </span></span><br><span class="line">repl_user=rep</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®å‘ç”Ÿåˆ‡æ¢åå‘é€çš„æŠ¥è­¦çš„è„šæœ¬</span></span><br><span class="line">report_script=/usr/local/send_report</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€æ—¦MHAåˆ°server02çš„ç›‘æ§ä¹‹é—´å‡ºç°é—®é¢˜ï¼ŒMHA Managerå°†ä¼šå°è¯•ä»server03ç™»å½•åˆ°server02</span></span><br><span class="line">secondary_check_script= /usr/local/bin/masterha_secondary_check -s server03 -s server02 --user=root --master_host=server02 --master_ip=192.168.0.50 --master_port=3306</span><br><span class="line"><span class="comment">#è®¾ç½®æ•…éšœå‘ç”Ÿåå…³é—­æ•…éšœä¸»æœºè„šæœ¬ï¼ˆè¯¥è„šæœ¬çš„ä¸»è¦ä½œç”¨æ˜¯å…³é—­ä¸»æœºæ”¾åœ¨å‘ç”Ÿè„‘è£‚,è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ï¼‰</span></span><br><span class="line">shutdown_script=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#è®¾ç½®sshçš„ç™»å½•ç”¨æˆ·å</span></span><br><span class="line">ssh_user=root </span><br><span class="line">[server1]</span><br><span class="line">hostname=10.0.0.51</span><br><span class="line">port=3306</span><br><span class="line">[server2]</span><br><span class="line">hostname=10.0.0.52</span><br><span class="line">port=3306</span><br><span class="line"><span class="comment">#è®¾ç½®ä¸ºå€™é€‰masterï¼Œå¦‚æœè®¾ç½®è¯¥å‚æ•°ä»¥åï¼Œå‘ç”Ÿä¸»ä»åˆ‡æ¢ä»¥åå°†ä¼šå°†æ­¤ä»åº“æå‡ä¸ºä¸»åº“ï¼Œå³ä½¿è¿™ä¸ªä¸»åº“ä¸æ˜¯é›†ç¾¤ä¸­äº‹ä»¶æœ€æ–°çš„slaveã€‚</span></span><br><span class="line">candidate_master=1</span><br><span class="line"><span class="comment">#é»˜è®¤æƒ…å†µä¸‹å¦‚æœä¸€ä¸ªslaveè½åmaster 100Mçš„relay logsçš„è¯ï¼ŒMHAå°†ä¸ä¼šé€‰æ‹©è¯¥slaveä½œä¸ºä¸€ä¸ªæ–°çš„masterï¼Œå› ä¸ºå¯¹äºè¿™ä¸ªslaveçš„æ¢å¤éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œé€šè¿‡è®¾ç½®check_repl_delay=0,MHAè§¦å‘åˆ‡æ¢åœ¨é€‰æ‹©ä¸€ä¸ªæ–°çš„masterçš„æ—¶å€™å°†ä¼šå¿½ç•¥å¤åˆ¶å»¶æ—¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹äºè®¾ç½®äº†candidate_master=1çš„ä¸»æœºéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™ä¸ªå€™é€‰ä¸»åœ¨åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ä¸€å®šæ˜¯æ–°çš„master</span></span><br><span class="line">check_repl_delay=0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">#ä¸€æ—¦MHAåˆ°server02çš„ç›‘æ§ä¹‹é—´å‡ºç°é—®é¢˜ï¼ŒMHA Managerå°†ä¼šå°è¯•ä»server03ç™»å½•åˆ°server02</span></span><br><span class="line">secondary_check_script= /usr/local/bin/masterha_secondary_check -s server03 -s </span><br><span class="line">server02 --user=root --master_host=server02 --master_ip=192.168.0.50 --</span><br><span class="line">master_port=3306</span><br><span class="line"></span><br><span class="line"> <span class="comment">#è®¾ç½®æ•…éšœå‘ç”Ÿåå…³é—­æ•…éšœä¸»æœºè„šæœ¬ï¼ˆè¯¥è„šæœ¬çš„ä¸»è¦ä½œç”¨æ˜¯å…³é—­ä¸»æœºæ”¾åœ¨å‘ç”Ÿè„‘è£‚,è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ï¼‰</span></span><br><span class="line">shutdown_script=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#è®¾ç½®sshçš„ç™»å½•ç”¨æˆ·å</span></span><br><span class="line">ssh_user=root </span><br><span class="line"></span><br><span class="line">[server1]</span><br><span class="line">hostname=10.0.0.51</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server2]</span><br><span class="line">hostname=10.0.0.52</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®ä¸ºå€™é€‰ masterï¼Œå¦‚æœè®¾ç½®è¯¥å‚æ•°ä»¥åï¼Œå‘ç”Ÿä¸»ä»åˆ‡æ¢ä»¥åå°†ä¼šå°†æ­¤ä»åº“æå‡ä¸ºä¸»åº“ï¼Œå³ä½¿è¿™ä¸ªä¸»åº“ä¸æ˜¯é›†ç¾¤ä¸­äº‹ä»¶æœ€æ–°çš„ slaveã€‚</span></span><br><span class="line">candidate_master=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#é»˜è®¤æƒ…å†µä¸‹å¦‚æœä¸€ä¸ª slave è½å master 100M çš„ relay logs çš„è¯ï¼ŒMHA å°†ä¸ä¼šé€‰æ‹©è¯¥ slave ä½œä¸ºä¸€ä¸ªæ–°çš„ masterï¼Œå› ä¸ºå¯¹äºè¿™ä¸ª slave çš„æ¢å¤éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œé€šè¿‡è®¾ç½® check_repl_delay=0,MHA è§¦å‘åˆ‡æ¢åœ¨é€‰æ‹©ä¸€ä¸ªæ–°çš„ master çš„æ—¶å€™å°†ä¼šå¿½ç•¥å¤åˆ¶å»¶æ—¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹äºè®¾ç½®äº† candidate_master=1 çš„ä¸»æœºéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™ä¸ªå€™é€‰ä¸»åœ¨åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ä¸€å®šæ˜¯æ–°çš„ master</span></span><br><span class="line">check_repl_delay=0</span><br></pre></td></tr></table></figure><h3 id="åˆ‡æ¢æ—¥å¿—â€“æ³¨æ„å‡ ç‚¹">åˆ‡æ¢æ—¥å¿—â€“æ³¨æ„å‡ ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åˆ‡æ¢æ—¥å¿—ï¼š</span></span><br><span class="line"><span class="comment"># GTIDä¸»ä»æ²¡æœ‰å¼€å¯</span></span><br><span class="line">GTID failover mode = 0</span><br><span class="line">Starting Non-GTID based failover.</span><br><span class="line"></span><br><span class="line"><span class="comment"># VIPæ¼‚ç§»çš„è„šæœ¬æ²¡æœ‰è®¾ç½®</span></span><br><span class="line">master_ip_failover_script is not <span class="built_in">set</span>. Skipping invalidating dead master IP address.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ²¡æœ‰é…ç½® Candidate masters</span></span><br><span class="line">Candidate masters from the configuration file:</span><br><span class="line">Non-candidate masters:</span><br><span class="line">candidate_master=1 // è®¾ç«‹å¤ªå­ï¼Œä½†æ˜¯å¦‚æœå¤ªå­è½åå…¶ä»–æœºå™¨æ•°æ®è¶…è¿‡100Mï¼Œå°±åºŸå‚¨</span><br><span class="line">check_repl_delay=0 // å…³é—­å¯¹å¤ªå­è½åçš„æ£€æµ‹</span><br><span class="line"></span><br><span class="line"><span class="comment"># change masterè¯­å¥ ä»¥åæ¢å¤æ•°æ®æ—¶å€™è¦æ ¹æ®è¿™ä¸ªç‚¹ä½æ¥åˆ‡æ¢</span></span><br><span class="line">All other slaves should start replication from here. Statement should be:</span><br><span class="line">CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;172.16.1.54&#x27;</span>, MASTER_PORT=3306,MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000003&#x27;</span>, MASTER_LOG_POS=878597, MASTER_USER=<span class="string">&#x27;rep&#x27;</span>,MASTER_PASSWORD=<span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>MHAç›¸å…³å·¥å…·å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">save_binary_logs</span><br><span class="line">--<span class="built_in">command</span>=save</span><br><span class="line">--start_file=mysql-bin.000001</span><br><span class="line">--start_pos=878597</span><br><span class="line">--binlog_dir=/app/mysql/data</span><br><span class="line">--</span><br><span class="line">output_file=/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.bi</span><br><span class="line">nlog</span><br><span class="line">--handle_raw_binlog=1</span><br><span class="line">--disable_log_bin=0</span><br><span class="line">--manager_version=0.58</span><br><span class="line">pply_diff_relay_logs</span><br><span class="line">--<span class="built_in">command</span>=apply</span><br><span class="line">--slave_user=<span class="string">&#x27;mha&#x27;</span></span><br><span class="line">--slave_host=172.16.1.54</span><br><span class="line">--slave_ip=172.16.1.54</span><br><span class="line">--slave_port=3306</span><br><span class="line">--</span><br><span class="line">apply_files=/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.bi</span><br><span class="line">nlog</span><br><span class="line">--workdir=/var/tmp</span><br><span class="line">--target_version=5.7.42-<span class="built_in">log</span></span><br><span class="line">--timestamp=20240827154042</span><br><span class="line">--handle_raw_binlog=1</span><br><span class="line">--disable_log_bin=0</span><br><span class="line">--manager_version=0.58</span><br><span class="line">--slave_pass=xxx</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p><strong>binlogçš„è·¯å¾„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å…ˆå°†binlogä¿å­˜åœ¨å®•æœºä¸»åº“çš„ /var/tmp/</span></span><br><span class="line">[root@db02 ~]# ll</span><br><span class="line">/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">-rw-r--r-- 1 root root 177 Aug 27 15:40</span><br><span class="line">/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line"><span class="comment"># 2.å°†binlogä»å®•æœºä¸»åº“ä¿å­˜åˆ°manageræ‰€åœ¨çš„æœºå™¨</span></span><br><span class="line">[root@mha-manager ~]# ll</span><br><span class="line">/etc/mha/app1/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">-rw-r--r-- 1 root root 177 Aug 27 15:40</span><br><span class="line">/etc/mha/app1/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line"><span class="comment"># 3.å°†binlogä»manageræ‰€åœ¨çš„æœºå™¨å‘é€ç»™æ–°ä¸»åº“</span></span><br><span class="line">[root@db04 ~]# ll</span><br><span class="line">/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">-rw-r--r-- 1 root root 177 Aug 27 15:40</span><br><span class="line">/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/QQ_1724772576926.png" alt="QQ_1724772576926"></p><h2 id="MHAè‡ªåŠ¨æ¢å¤">MHAè‡ªåŠ¨æ¢å¤</h2><h3 id="æ‰‹åŠ¨æ¢å¤">æ‰‹åŠ¨æ¢å¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¿®å¤å®•æœºçš„ä¸»åº“</span></span><br><span class="line">[root@db02 ~]# systemctl start mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ‰¾åˆ°change masterè¯­å¥</span></span><br><span class="line">CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;172.16.1.54&#x27;</span>, MASTER_PORT=3306,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000003&#x27;</span>, MASTER_LOG_POS=878597, MASTER_USER=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å¯åŠ¨ä¸»ä»å¤åˆ¶</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"><span class="comment"># 4.è¡¥å…¨é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@mha-manager ~]# vim /etc/mha/app1.cnf</span><br><span class="line">[server2]</span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.å¯åŠ¨MHA</span></span><br><span class="line">[root@mha-manager ~]# systemctl start mha</span><br><span class="line"><span class="comment"># 6.æ£€æµ‹MHAå¯åŠ¨</span></span><br><span class="line">[root@mha-manager ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨æ¢å¤è„šæœ¬">è‡ªåŠ¨æ¢å¤è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line"><span class="comment">#vars</span></span><br><span class="line">log_file=<span class="string">&#x27;/etc/mha/logs/manager.log&#x27;</span></span><br><span class="line">mha_conf=<span class="string">&quot;/etc/mha/app1.cnf&quot;</span></span><br><span class="line">repl_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">mha_user=$(awk -F= <span class="string">&#x27;/^user/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">mha_password=$(awk -F= <span class="string">&#x27;/^password/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">down_master=$(sed -nr <span class="string">&#x27;s#^Master (.*)\(.*\).*!$#\1#gp&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1 )</span><br><span class="line">change_master=$(grep -i <span class="string">&#x27;change master to&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1|awk -F: <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|sed <span class="string">&quot;s#xxx#<span class="variable">$&#123;repl_pass&#125;</span>#g&quot;</span>)</span><br><span class="line">master_ip_failover_script=/etc/mha/app1/master_ip_failover</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨MySQLï¼Œæ£€æµ‹MySQLæ˜¯å¦å®Œå…¨å¯åŠ¨ï¼Œå¯åŠ¨åæ‰§è¡Œå‘½ä»¤ï¼Œå¼€å¯ä¸»ä»å¤åˆ¶</span></span><br><span class="line">ssh <span class="variable">$&#123;down_master&#125;</span> <span class="string">&#x27;systemctl start mysqld&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  mysqladmin -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;down_master&#125;</span> ping &amp;&gt;/dev/null</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    mysql -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;down_master&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;change_master&#125;</span>;start slave&quot;</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°å†™å…¥MHAç®¡ç†ç«¯é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$&#123;mha_conf&#125;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[server default]</span></span><br><span class="line"><span class="string">manager_log=/etc/mha/logs/manager.log</span></span><br><span class="line"><span class="string">manager_workdir=/etc/mha/app1</span></span><br><span class="line"><span class="string">master_binlog_dir=/app/mysql/data</span></span><br><span class="line"><span class="string">password=$&#123;mha_password&#125;</span></span><br><span class="line"><span class="string">ping_interval=2</span></span><br><span class="line"><span class="string">repl_password=123</span></span><br><span class="line"><span class="string">repl_user=rep</span></span><br><span class="line"><span class="string">ssh_port=22</span></span><br><span class="line"><span class="string">ssh_user=root</span></span><br><span class="line"><span class="string">user=$&#123;mha_user&#125;</span></span><br><span class="line"><span class="string">[server1]</span></span><br><span class="line"><span class="string">hostname=172.16.1.51</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">[server2]</span></span><br><span class="line"><span class="string">hostname=172.16.1.52</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">[server3]</span></span><br><span class="line"><span class="string">hostname=172.16.1.53</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">[server4]</span></span><br><span class="line"><span class="string">hostname=172.16.1.54</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨MHAï¼Œå¹¶ä¸”æ£€æµ‹MHAçŠ¶æ€ï¼Œç›´è‡³å¯åŠ¨æˆåŠŸç»“æŸå¾ªç¯</span></span><br><span class="line">systemctl start mha</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  masterha_check_status --conf=<span class="variable">$&#123;mha_conf&#125;</span> &amp;&gt;/dev/null</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    action <span class="string">&quot;mha server&quot;</span> /bin/true</span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[root@mha ~]# <span class="built_in">cat</span> failover_status </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#ä¸Šä¸€æ¬¡æ–°ä¸»åº“</span></span><br><span class="line">last_new_master=$(grep <span class="string">&#x27;(new master)&#x27;</span> /etc/mha/logs/manager.log |<span class="built_in">tail</span> -2|awk -F <span class="string">&#x27;(&#x27;</span> <span class="string">&#x27;NR==1&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@mha ~]# <span class="built_in">cat</span> recovery_mha.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">. /root/failover_status</span><br><span class="line"></span><br><span class="line">log_file=<span class="string">&#x27;/etc/mha/logs/manager.log&#x27;</span></span><br><span class="line">mha_conf=<span class="string">&quot;/etc/mha/app1.cnf&quot;</span></span><br><span class="line">repl_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">mha_user=$(awk -F= <span class="string">&#x27;/^user/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">mha_password=$(awk -F= <span class="string">&#x27;/^password/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">down_master=$(sed -nr <span class="string">&#x27;s#^Master (.*)\(.*\).*!$#\1#gp&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1 )</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"><span class="comment">#åˆ¤æ–­æ˜¯å¦ä¿®å¤å®Œæˆ</span></span><br><span class="line"><span class="comment">#å½“å‰downçš„ä¸»åº“å’Œä¸Šæ¬¡ä¸»åº“ä¸€è‡´æ—¶ï¼Œåˆ¤å®šä¿®å¤å®Œæˆï¼ˆä¾æ®æˆªå–Master 172.16.1.*(172.16.1.*:3306) is down!ï¼‰</span></span><br><span class="line"><span class="comment">#åˆ¤å®šä¾æ®å°±æ˜¯åªæœ‰ä¿®å¤å®Œæˆæ‰ä¼šæœ‰Master 172.16.1.*(172.16.1.*:3306) is down!ï¼‰</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;down_master&#125;</span> == <span class="variable">$&#123;last_new_master&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">    change_master=$(grep -i <span class="string">&#x27;change master to&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1|awk -F: <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|sed <span class="string">&quot;s#xxx#<span class="variable">$&#123;repl_pass&#125;</span>#g&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ä¸»åº“ä¿®å¤ä¸­...&quot;</span></span><br><span class="line">    ssh <span class="variable">$&#123;down_master&#125;</span> -C <span class="string">&#x27;systemctl start mysqld&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">      mysqladmin -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;down_master&#125;</span> ping &amp;&gt;/dev/null</span><br><span class="line">      <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="comment">#downçš„æœºå™¨åšä»åº“</span></span><br><span class="line">        mysql -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;down_master&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;change_master&#125;</span>;start slave&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;ä¸»åº“ä¿®å¤æˆåŠŸ...&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨è¡¥å…¨MHAé…ç½®æ–‡ä»¶...&quot;</span></span><br><span class="line">    <span class="built_in">cat</span> &gt; <span class="variable">$&#123;mha_conf&#125;</span> &lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string">        [server default]</span></span><br><span class="line"><span class="string">        manager_log=/etc/mha/logs/manager.log</span></span><br><span class="line"><span class="string">        manager_workdir=/etc/mha/app1</span></span><br><span class="line"><span class="string">        master_binlog_dir=/app/mysql/data</span></span><br><span class="line"><span class="string">        password=$&#123;mha_password&#125;</span></span><br><span class="line"><span class="string">        ping_interval=2</span></span><br><span class="line"><span class="string">        repl_password=123</span></span><br><span class="line"><span class="string">        repl_user=rep</span></span><br><span class="line"><span class="string">        ssh_port=22</span></span><br><span class="line"><span class="string">        ssh_user=root</span></span><br><span class="line"><span class="string">        user=$&#123;mha_user&#125;</span></span><br><span class="line"><span class="string">        [server1]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.51</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        [server2]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.52</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        [server3]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.53</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        [server4]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.54</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        EOF</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨å¯åŠ¨MHA...&quot;</span></span><br><span class="line">    systemctl start mha</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">      masterha_check_status --conf=<span class="variable">$&#123;mha_conf&#125;</span> &amp;&gt;/dev/null</span><br><span class="line">      <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        action <span class="string">&quot;MHA managerå¯åŠ¨&quot;</span> /bin/true</span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">continue</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="MHAçš„vipæ¼‚ç§»">MHAçš„vipæ¼‚ç§»</h3><p><strong>é…ç½®master_ip_failover</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¿®æ”¹MHAé…ç½®æ–‡ä»¶ï¼ŒåŠ ä¸Šè„šæœ¬</span></span><br><span class="line">[root@mha-manager ~]# vim /etc/mha/app1.cnf</span><br><span class="line">[server default]</span><br><span class="line">master_ip_failover_script=/etc/mha/app1/master_ip_failover</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹MHAè„šæœ¬ åŠ ä¸Šç»‘å®švipçš„å‘½ä»¤(å…ˆä¸Šä¼ è„šæœ¬)</span></span><br><span class="line">[root@mha-manager ~]# vim /etc/mha/app1/master_ip_failover</span><br><span class="line">my <span class="variable">$vip</span> = <span class="string">&#x27;172.16.1.55/24&#x27;</span>;</span><br><span class="line">my <span class="variable">$key</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">my <span class="variable">$ssh_start_vip</span> = <span class="string">&quot;/sbin/ifconfig eth1:<span class="variable">$key</span> <span class="variable">$vip</span>&quot;</span>;</span><br><span class="line">my <span class="variable">$ssh_stop_vip</span> = <span class="string">&quot;/sbin/ifconfig eth1:<span class="variable">$key</span> down&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ç»™è„šæœ¬æ‰§è¡Œæƒé™</span></span><br><span class="line">[root@mha-manager ~]# <span class="built_in">chmod</span> +x /etc/mha/app1/master_ip_failover</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æ‰‹åŠ¨åœ¨ä¸»åº“ä¸Šç»‘å®šVIP</span></span><br><span class="line">[root@db01 ~]# ifconfig eth1:1 172.16.1.55/24</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.é‡å¯MHA</span></span><br><span class="line">[root@mha-manager ~]# systemctl stop mha</span><br><span class="line">[root@mha-manager ~]# systemctl start mha</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ·»åŠ è„šæœ¬åï¼Œå¯åŠ¨ä¸èµ·æ¥çš„åŸå› ï¼š</span></span><br><span class="line">1.è„šæœ¬æƒé™é—®é¢˜</span><br><span class="line">[root@mha-manager ~]# <span class="built_in">chmod</span> +x /etc/mha/app1/master_ip_failover</span><br><span class="line">2.è„šæœ¬è¯­æ³•é—®é¢˜</span><br><span class="line">3.è„šæœ¬æ ¼å¼é—®é¢˜</span><br><span class="line">[root@mha-manager ~]# dos2unix /etc/mha/app1/master_ip_failover</span><br><span class="line">dos2unix: converting file /etc/mha/app1/master_ip_failover to Unix format ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è‡ªåŠ¨æ¢å¤è„šæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[root@mha ~]# <span class="built_in">cat</span> failover_status </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#ä¸Šä¸€æ¬¡æ–°ä¸»åº“</span></span><br><span class="line">last_new_master=$(grep <span class="string">&#x27;(new master)&#x27;</span> /etc/mha/logs/manager.log |<span class="built_in">tail</span> -2|awk -F <span class="string">&#x27;(&#x27;</span> <span class="string">&#x27;NR==1&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@mha ~]# <span class="built_in">cat</span> recovery_mha.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">. /root/failover_status</span><br><span class="line"></span><br><span class="line">log_file=<span class="string">&#x27;/etc/mha/logs/manager.log&#x27;</span></span><br><span class="line">mha_conf=<span class="string">&quot;/etc/mha/app1.cnf&quot;</span></span><br><span class="line">repl_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">mha_user=$(awk -F= <span class="string">&#x27;/^user/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">mha_password=$(awk -F= <span class="string">&#x27;/^password/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">down_master=$(sed -nr <span class="string">&#x27;s#^Master (.*)\(.*\).*!$#\1#gp&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1 )</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"><span class="comment">#åˆ¤æ–­æ˜¯å¦ä¿®å¤å®Œæˆ</span></span><br><span class="line"><span class="comment">#å½“å‰downçš„ä¸»åº“å’Œä¸Šæ¬¡ä¸»åº“ä¸€è‡´æ—¶ï¼Œåˆ¤å®šä¿®å¤å®Œæˆï¼ˆä¾æ®æˆªå–Master 172.16.1.*(172.16.1.*:3306) is down!ï¼‰</span></span><br><span class="line"><span class="comment">#åˆ¤å®šä¾æ®å°±æ˜¯åªæœ‰ä¿®å¤å®Œæˆæ‰ä¼šæœ‰Master 172.16.1.*(172.16.1.*:3306) is down!ï¼‰</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;down_master&#125;</span> == <span class="variable">$&#123;last_new_master&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">    change_master=$(grep -i <span class="string">&#x27;change master to&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1|awk -F: <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|sed <span class="string">&quot;s#xxx#<span class="variable">$&#123;repl_pass&#125;</span>#g&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ä¸»åº“ä¿®å¤ä¸­...&quot;</span></span><br><span class="line">    ssh <span class="variable">$&#123;down_master&#125;</span> -C <span class="string">&#x27;systemctl start mysqld&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">      mysqladmin -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;down_master&#125;</span> ping &amp;&gt;/dev/null</span><br><span class="line">      <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="comment">#downçš„æœºå™¨åšä»åº“</span></span><br><span class="line">        mysql -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;down_master&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;change_master&#125;</span>;start slave&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;ä¸»åº“ä¿®å¤æˆåŠŸ...&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨è¡¥å…¨MHAé…ç½®æ–‡ä»¶...&quot;</span></span><br><span class="line">    <span class="built_in">cat</span> &gt; <span class="variable">$&#123;mha_conf&#125;</span> &lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string">        [server default]</span></span><br><span class="line"><span class="string">        master_ip_failover_script=/etc/mha/app1/master_ip_failover</span></span><br><span class="line"><span class="string">        manager_log=/etc/mha/logs/manager.log</span></span><br><span class="line"><span class="string">        manager_workdir=/etc/mha/app1</span></span><br><span class="line"><span class="string">        master_binlog_dir=/app/mysql/data</span></span><br><span class="line"><span class="string">        password=$&#123;mha_password&#125;</span></span><br><span class="line"><span class="string">        ping_interval=2</span></span><br><span class="line"><span class="string">        repl_password=123</span></span><br><span class="line"><span class="string">        repl_user=rep</span></span><br><span class="line"><span class="string">        ssh_port=22</span></span><br><span class="line"><span class="string">        ssh_user=root</span></span><br><span class="line"><span class="string">        user=$&#123;mha_user&#125;</span></span><br><span class="line"><span class="string">        [server1]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.51</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        [server2]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.52</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        [server3]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.53</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        [server4]</span></span><br><span class="line"><span class="string">        hostname=172.16.1.54</span></span><br><span class="line"><span class="string">        port=3306</span></span><br><span class="line"><span class="string">        EOF</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨å¯åŠ¨MHA...&quot;</span></span><br><span class="line">    systemctl start mha</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">      masterha_check_status --conf=<span class="variable">$&#123;mha_conf&#125;</span> &amp;&gt;/dev/null</span><br><span class="line">      <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        action <span class="string">&quot;MHA managerå¯åŠ¨&quot;</span> /bin/true</span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">continue</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="MySQL-binlogå®æ—¶åŒæ­¥">MySQL binlogå®æ—¶åŒæ­¥</h3><p><strong>ä½¿ç”¨mysqlbinlogå®æ—¶åŒæ­¥binlog</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## MHA é…ç½® binlog server</span></span><br><span class="line"><span class="comment"># 1.ä¿®æ”¹MHAé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@mha-manager ~]# vim /etc/mha/app1.cnf</span><br><span class="line">[binlog1]</span><br><span class="line"><span class="comment">#åŠ ä¸Šno_masterä¹‹åæ— è®ºå¦‚ä½•éƒ½ä¸ä¼šè¢«æå‡ä¸ºä¸»åº“</span></span><br><span class="line">no_master=1</span><br><span class="line">hostname=172.16.1.50</span><br><span class="line">master_binlog_dir=/data/mysql/binlog/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ›å»ºbinlogç›®å½•</span></span><br><span class="line">[root@mha-manager ~]# <span class="built_in">mkdir</span> -p /data/mysql/binlog/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.manageræœåŠ¡å™¨å®‰è£…mysql5.7å®¢æˆ·ç«¯</span></span><br><span class="line">[root@mha-manager ~]# <span class="built_in">cat</span> /etc/yum.repos.d/mysql-community.repo</span><br><span class="line">[mysql56-community]</span><br><span class="line">name=MySQL 5.6 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-5.6-community/el/7/<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[root@mha-manager binlog]# yum install -y mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å®æ—¶åŒæ­¥binlog</span></span><br><span class="line">[root@mha-manager binlog]# mysqlbinlog -R --host=172.16.1.55 --user=mha --password=mha --raw --stop-never mysql-bin.000001 &amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">MySQLçš„é«˜å¯ç”¨MHAçš„éƒ¨ç½²åŠäºŒæ¬¡å¼€å‘</summary>
    
    
    
    <category term="MySQL" scheme="https://lukme.top/categories/MySQL/"/>
    
    
    <category term="MySQL" scheme="https://lukme.top/tags/MySQL/"/>
    
    <category term="MHA" scheme="https://lukme.top/tags/MHA/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçš„ä¸»ä»å¤åˆ¶</title>
    <link href="https://lukme.top/posts/9ee789ff.html"/>
    <id>https://lukme.top/posts/9ee789ff.html</id>
    <published>2024-08-12T15:28:10.000Z</published>
    <updated>2024-08-12T15:42:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>:dango:<strong>ä¸ºä»€ä¹ˆåšä¸»ä»å¤åˆ¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸ºäº†åšé«˜å¯ç”¨</span><br><span class="line">2.ä¸ºäº†è§£å†³MySQLçš„å•ç‚¹æ•…éšœ</span><br><span class="line">3.åˆ†æ‘Šä¸»åº“çš„å‹åŠ›</span><br><span class="line">4.å¤‡ä»½ï¼ˆå»¶æ—¶ä»åº“ï¼‰</span><br></pre></td></tr></table></figure><h2 id="ä¸»ä»å¤åˆ¶åŸç†">ä¸»ä»å¤åˆ¶åŸç†</h2><p><code>ä¸‰ä¸ªçº¿ç¨‹å››ä¸ªæ–‡ä»¶é…åˆ</code></p><p><img src="https://cos.lukme.top/Pic/QQ_1724397104506.png" alt="QQ_1724397104506"></p><p><strong>1ï¼‰</strong> Slave ä¸Šé¢çš„IO çº¿ç¨‹è¿æ¥ä¸Š Masterï¼Œå¹¶è¯·æ±‚ä»æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æŒ‡å®šä½ç½®(æˆ–è€…ä»æœ€å¼€å§‹çš„æ—¥å¿—)ä¹‹åçš„æ—¥å¿—å†…å®¹ã€‚ï¼ˆè¯·æ±‚æœ‰æ²¡æœ‰æ–°çš„æ•°æ®ï¼‰<br><strong>2ï¼‰</strong> Master æ¥æ”¶åˆ°æ¥è‡ª Slave çš„ IO çº¿ç¨‹çš„è¯·æ±‚åï¼Œé€šè¿‡è´Ÿè´£å¤åˆ¶çš„ IO çº¿ç¨‹æ ¹æ®è¯·æ±‚ä¿¡æ¯è¯»å–æŒ‡å®šæ—¥å¿—æŒ‡å®šä½ç½®ä¹‹åçš„æ—¥å¿—ä¿¡æ¯ï¼Œè¿”å›ç»™ Slave ç«¯çš„ IO çº¿ç¨‹ã€‚</p><p>3ï¼‰Slave çš„ IO çº¿ç¨‹æ¥æ”¶åˆ°ä¿¡æ¯åï¼Œå°†æ¥æ”¶åˆ°çš„æ—¥å¿—å†…å®¹ä¾æ¬¡å†™å…¥åˆ° Slave ç«¯çš„RelayLogï¼ˆä¸­ç»§æ—¥å¿—æ–‡ä»¶ï¼‰æ–‡ä»¶(MySQL-relay-bin.xxxxxx)çš„æœ€æœ«ç«¯ï¼Œå¹¶å°†è¯»å–åˆ°çš„Master ç«¯çš„bin-log çš„æ–‡ä»¶åå’Œä½ç½®è®°å½•åˆ°master-info æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡è¯»å–çš„æ—¶å€™èƒ½å¤Ÿæ¸…æ¥šçš„å‘Šè¯‰Masterâ€œæˆ‘éœ€è¦ä»æŸä¸ªbin-log çš„å“ªä¸ªä½ç½®å¼€å§‹å¾€åçš„æ—¥å¿—å†…å®¹ï¼Œè¯·å‘ç»™æˆ‘â€ ã€‚<br>**4ï¼‰**Slave çš„ SQL çº¿ç¨‹æ£€æµ‹åˆ° Relay Log ä¸­æ–°å¢åŠ äº†å†…å®¹åï¼Œä¼šé©¬ä¸Šè§£æè¯¥ Log æ–‡ä»¶ä¸­çš„å†…å®¹æˆä¸ºåœ¨ Master ç«¯çœŸå®æ‰§è¡Œæ—¶å€™çš„é‚£äº›å¯æ‰§è¡Œçš„ Query è¯­å¥ï¼Œå¹¶åœ¨è‡ªèº«æ‰§è¡Œè¿™äº› Queryã€‚åŒæ—¶å°†æ‰§è¡Œrelay log åå­—å’Œä½ç½®ç‚¹è®°å½•åˆ°relay-log.infoé‡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¸‰ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"># ä»åº“</span></span><br><span class="line">IOçº¿ç¨‹ï¼šå’Œä¸»åº“å»ºç«‹è¿æ¥æ¥æ”¶ä¸»åº“æ–°æ•°æ®</span><br><span class="line">SQLçº¿ç¨‹ï¼šå°†IOçº¿ç¨‹æ¥æ”¶åˆ°çš„æ–°æ•°æ®åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»åº“</span></span><br><span class="line">dumpçº¿ç¨‹ï¼šæ¥æ”¶IOçº¿ç¨‹çš„è¯·æ±‚ï¼Œä»binlogä¸­å–å‡ºæ–°æ•°æ®è¿”å›ç»™IOçº¿ç¨‹</span><br><span class="line"></span><br><span class="line"><span class="comment">## å››ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># ä»åº“</span></span><br><span class="line">master.infoï¼šè®°å½•IOçº¿ç¨‹ä¸Šä¸€æ¬¡å–å‡ºä¸»åº“ä¸Šbinlogçš„åå­—å’Œä½ç½®ç‚¹ï¼ˆä¸»åº“ä¿¡æ¯ï¼‰</span><br><span class="line">relay-logï¼šå­˜å‚¨binlogä¸­æ–°å¢çš„æ•°æ®ï¼ˆä¸æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼‰å¤åˆ¶SQLçº¿ç¨‹åœ¨æ‰§è¡Œå®Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰äº‹ä»¶å¹¶ä¸”ä¸å†éœ€è¦å®ƒåï¼Œä¼šè‡ªåŠ¨åˆ é™¤æ¯ä¸ªä¸­ç»§æ—¥å¿—æ–‡ä»¶</span><br><span class="line">relay-log.infoï¼šè®°å½•SQLè¯­å¥ä¸Šä¸€å›æ‰§è¡Œåˆ°ä¸­ç»§æ—¥å¿—çš„å“ªä¸ªä½ç½®ç‚¹äº†</span><br><span class="line"><span class="comment"># ä¸»åº“</span></span><br><span class="line">bin-logï¼šäºŒè¿›åˆ¶æ—¥å¿—è®°å½•ä¸»åº“æ‰€æœ‰å¯¹è¡¨æ•°æ®å‘ç”Ÿå˜åŒ–çš„è¯­å¥</span><br></pre></td></tr></table></figure><h2 id="æ­å»ºä¸»ä»å¤åˆ¶">æ­å»ºä¸»ä»å¤åˆ¶</h2><p>:dango:<strong>ç¯å¢ƒä¸€è§ˆ    ä¸€ä¸»ä¸‰ä»</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>LanIP</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>db01</td><td>10.0.0.51</td><td>172.16.1.51</td><td>master</td></tr><tr><td>db02</td><td>10.0.0.52</td><td>172.16.1.52</td><td>slave</td></tr><tr><td>db03</td><td>10.0.0.53</td><td>172.16.1.53</td><td>slave</td></tr><tr><td>db04</td><td>10.0.0.54</td><td>172.16.1.54</td><td>slave</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸»åº“</span></span><br><span class="line">1.ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">server_id=1</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">skip_name_resolve</span><br><span class="line"></span><br><span class="line">2.é‡å¯</span><br><span class="line">[root@db01 ~]# systemctl restart mysqld</span><br><span class="line"></span><br><span class="line">3.åˆ›å»ºä¸»ä»å¤åˆ¶ç”¨æˆ·</span><br><span class="line">mysql&gt; grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">4.æŸ¥çœ‹binlogï¼ˆmasterï¼‰ä¿¡æ¯  è®°å½•binlogæ–‡ä»¶åå’Œç‚¹</span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File             | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000001 |  1324392 |</span><br><span class="line">+------------------+----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»åº“æ“ä½œ   ï¼ˆ db02,db03,db04 ï¼‰</span></span><br><span class="line">1.ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">server_id=2</span><br><span class="line">skip_name_resolve</span><br><span class="line"></span><br><span class="line">2.é‡å¯æ•°æ®åº“</span><br><span class="line">[root@db01 ~]# systemctl restart mysqld</span><br><span class="line"></span><br><span class="line">3.ç™»å½•MySQLæ‰§è¡Œchange master è¯­å¥</span><br><span class="line">mysql &gt; change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=1324392,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############</span></span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,     <span class="comment">#ä¸»åº“ip</span></span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,  <span class="comment">#ä¸»ä»å¤åˆ¶çš„ç”¨æˆ·</span></span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,   <span class="comment">#repç”¨æˆ·çš„å¯†ç </span></span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,<span class="comment">#ä¸»åº“åœ¨ç”¨çš„binlogæ–‡ä»¶</span></span><br><span class="line">master_log_pos=1324392, <span class="comment">#ä¸»åº“æ’å…¥ç‚¹ä½ç½®</span></span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">4.å¼€å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line">5.æŸ¥çœ‹ä¸»ä»å¤åˆ¶çŠ¶æ€   (ä¿è¯ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯OKçš„)</span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä¸»ä»æ•…éšœå¤„ç†-dango">ä¸»ä»æ•…éšœå¤„ç†:dango:</h2><p>mysqlé‡Œæ‰§è¡Œ<code>show slave status\G</code> æŸ¥çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹å‡ºé”™</p><p>:dango:<strong>IOçº¿ç¨‹æ•…éšœ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.æ£€æŸ¥è¿æ¥æ˜¯å¦æœ‰é—®é¢˜</span></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=1324392,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æ£€æŸ¥IPæ˜¯å¦æœ‰é—®é¢˜</span></span><br><span class="line">ping 172.16.1.51   ping ä¸»æœºip</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æ£€æŸ¥ç«¯å£æ˜¯å¦æœ‰é—®é¢˜</span></span><br><span class="line">telnet 172.16.1.51 3306</span><br><span class="line">ç«¯å£ä¸é€šï¼š</span><br><span class="line">- é˜²ç«å¢™ selinux</span><br><span class="line">- æœåŠ¡æ²¡èµ·</span><br><span class="line">- æ²¡æœ‰åˆ›å»ºè¿œç¨‹è¿æ¥çš„ç”¨æˆ·</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç èƒ½å¦ç™»å½•</span></span><br><span class="line">[root@db02 ~]# mysql -urep -p123 -h172.16.1.51</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.  ä¸»åº“  æ£€æŸ¥binlogåå­—å’Œä½ç½®ç‚¹</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File             | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000001 |  1324392 |</span><br><span class="line">+------------------+----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.æ£€æŸ¥ä¸»åº“å’Œä»åº“é…ç½®æ–‡ä»¶çš„server_idæ˜¯å¦ç›¸åŒ</span></span><br><span class="line"><span class="comment">#å¦‚æœç›¸åŒåˆ™æŠ¥é”™å¦‚ä¸‹ï¼š</span></span><br><span class="line">Last_IO_Error:Fatal error:The slave I/0 thread stops because master and slave have equal MySQL server ids;these ids must be different <span class="keyword">for</span> replication to work (or the --repLicate-same-server-id option must be used on slave but this does not always make sense;please c</span><br><span class="line"></span><br><span class="line"><span class="comment">#7.æ£€æŸ¥uuidæ˜¯å¦ä¸€æ ·ï¼ˆå¦‚æœä½ æ˜¯ç›´æ¥å…‹éš†è™šæ‹Ÿæœºï¼‰</span></span><br><span class="line">[root@db01 ~]# <span class="built_in">cat</span> /app/mysql/data/auto.cnf </span><br><span class="line">[auto]</span><br><span class="line">server-uuid=80a4722e-60ef-11ef-baf4-000c29bff80f</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœuuidä¸€ç›´åˆ™æŠ¥é”™å¦‚ä¸‹</span></span><br><span class="line">error:The slave I/0 thread stops because master and slave have equal MySQL server UUIDs;these UUIDs must be different <span class="keyword">for</span> replication to work.</span><br></pre></td></tr></table></figure><p>:dango:<strong>SQLçº¿ç¨‹æ•…éšœ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¹æœ¬åŸå› ï¼šä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´</span></span><br><span class="line"><span class="comment"># 1.ä¸»åº“æœ‰ä»åº“æ²¡æœ‰çš„æ•°æ®</span></span><br><span class="line">å‡ºç°åŸå› ï¼šæ–°åŠ çš„ä»åº“ä¸»ä»å¤åˆ¶ç‚¹ä½æ˜¯ä¸»åº“å·²æœ‰æ•°æ®çŠ¶æ€</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¸»åº“æ²¡æœ‰ä»åº“æœ‰çš„æ•°æ®</span></span><br><span class="line">`å‡ºç°åŸå› `:ç›´æ¥åœ¨ä»åº“ä¸­æ“ä½œæ•°æ®åº“</span><br><span class="line">`è§£å†³`:</span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šä»åº“è®¾ç½®ä¸ºåªè¯»ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰</span><br><span class="line"><span class="comment"># åœ¨å‘½ä»¤è¡Œä¸´æ—¶è®¾ç½®</span></span><br><span class="line"><span class="built_in">set</span> global read_only=1;</span><br><span class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­æ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line">read_only=1</span><br></pre></td></tr></table></figure><p>:dango:<strong>ç”Ÿæˆç¯å¢ƒå¦‚ä½•æ·»åŠ æ–°ä»åº“  ä¿æŒæ–°ä¸»æ•°æ®ä¸€è‡´  é¿å…SQLçº¿ç¨‹æ•…éšœ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä»åº“åˆå§‹åŒ–ç¯å¢ƒ</span></span><br><span class="line">[root@db04 ~]# systemctl stop mysqld</span><br><span class="line">[root@db04 ~]# <span class="built_in">rm</span> -fr /app/mysql/data</span><br><span class="line">[root@db04 ~]# /app/mysql/scripts/mysql_install_db --user=mysql --basedir=/app/mysql --datadir=/app/mysql/data</span><br><span class="line"></span><br><span class="line">`mysql5.7`</span><br><span class="line">/app/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/app/mysq --datadir=/app/mysql/data</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# systemctl start mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ä¸»åº“æ‰“ç‚¹å…¨å¤‡</span></span><br><span class="line">[root@db01 ~]# mysqldump -A -R --triggers --master-data=2 --single-transaction|gzip &gt; /tmp/full.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.ä»åº“æ¢å¤æ•°æ®</span></span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.54:/root</span><br><span class="line">[root@db04 ~]# zcat /root/full.sql.gz |mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4..æŸ¥çœ‹ä¸»åº“å…¨å¤‡çš„ç‚¹ä½</span></span><br><span class="line">[root@db04 ~]# zcat /root/full.sql.gz |<span class="built_in">head</span> -25</span><br><span class="line">--MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, MASTER_LOG_POS=1843126;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.ä»åº“æ‰§è¡Œchange masterè¯­å¥</span></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=1843126;</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.å¼€å¯ä¸»ä»å¤åˆ¶</span></span><br><span class="line">mysql&gt; start slave;</span><br></pre></td></tr></table></figure><p>:dango:<strong>å–æ¶ˆä¸»ä»å¤åˆ¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;stop slave;</span><br><span class="line"></span><br><span class="line">mysql&gt;reset slave all;</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ•°æ®åº“çš„å»¶æ—¶ä»åº“">æ•°æ®åº“çš„å»¶æ—¶ä»åº“</h2><p><strong>:dango:ä¼ ç»Ÿä¸»ä»å¤åˆ¶ç¼ºé™·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.ä¼ ç»Ÿä½ä»å¤åˆ¶æ— æ³•åšå¤‡ä»½</span><br><span class="line">2.ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ— æ³•è¿‡æ»¤å¤åˆ¶</span><br><span class="line">3.ä¼ ç»Ÿä¸»ä»å¤åˆ¶é€Ÿåº¦æ…¢</span><br><span class="line">4.ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œä»åº“æ•°æ®å»¶è¿Ÿ</span><br><span class="line"></span><br><span class="line">`å»¶æ—¶ä»åº“åº”è¿è€Œç”Ÿ`</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä¸€èˆ¬ä¼ä¸šä¸­ä¼šå»¶æ—¶3-6å°æ—¶ï¼ˆå¼€ä¸å¼€å¯ä»åº“å»¶æ—¶   çœ‹ä¼ä¸šéœ€æ±‚ï¼Œä¼˜å¼Šç«¯éƒ½æœ‰ï¼‰</span><br><span class="line"></span><br><span class="line">`ä¼˜ç‚¹ï¼š`</span><br><span class="line">1.åšå»¶æ—¶ä»åº“çš„æœåŠ¡å™¨ï¼Œæ— æ³•åœ¨ç”Ÿäº§ä¸­ç»§ç»­æä¾›æœåŠ¡</span><br><span class="line">2.å¤‡ä»½</span><br><span class="line">3.æ¢å¤æ•°æ®é€Ÿåº¦æ›´å¿«</span><br><span class="line"></span><br><span class="line">`å¼Šç«¯:`</span><br><span class="line">ä¼ä¸šä½¿ç”¨ä»åº“å»¶æ—¶åšå¤‡ä»½éœ€æ±‚ï¼Œéœ€è¦ä¸€å°æœåŠ¡å™¨åšå¤‡èƒï¼Œæµªè´¹èµ„æº</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>:dango:<strong>å»¶æ—¶ä»åº“åŸç†</strong></p><p>å¦‚ä¸‹ä¸»ä»åŸºç¡€ä¸Šï¼ŒIOçº¿ç¨‹ç»§ç»­æ‹¿æ•°æ®ï¼ŒSQLçº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´åï¼Œå»¶æ—¶æ‰§è¡Œï¼Œå½“ä¸»åº“å‡ºç°åˆ é™¤åº“æ“ä½œï¼Œé‚£ä¹ˆä»åº“å°†åœ¨è®¾ç½®çš„å»¶æ—¶ä¹‹åæ‰ä¼šåˆ é™¤åº“ï¼Œè¿™å°±æ˜¯å»¶æ—¶ä»åº“å®ç°åŸç†</p><p><img src="https://cos.lukme.top/Pic/QQ_1724397104506-1724654962435-1.png" alt="QQ_1724397104506"></p><p>:dango:<strong>å¦‚ä½•é…ç½®å»¶æ—¶ä»åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åœæ­¢ä¸»ä»å¤åˆ¶</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. è®¾ç½®å»¶æ—¶180s</span></span><br><span class="line">mysql&gt; change master to master_delay=180;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å¼€å¯ä¸»ä»</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">mysql&gt; show slave status \G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…³é—­å»¶æ—¶ä»åº“</span></span><br><span class="line"><span class="comment">#åœæ­¢ä¸»ä»å¤åˆ¶</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®å»¶æ—¶ä¸º0å…³é—­</span></span><br><span class="line">mysql&gt; change master to master_delay=0;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å¯ä¸»ä»</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨å»¶æ—¶ä»åº“æ¢å¤æ•°æ®</span></span><br><span class="line">`æ€è·¯ï¼š</span><br><span class="line">`IOçº¿ç¨‹ä¸åœï¼Œè¯»å–relay-logé‡ŒSQLçº¿ç¨‹æœ€åæ‹¿å–çš„ç‚¹ä½ä¸ºèµ·å§‹ç‚¹ï¼Œè¿‡æ»¤relay-binlogæ–‡ä»¶è¯»å–dropä¹‹å‰çš„ç‚¹ä¸ºç»“æŸç‚¹ï¼Œè¿™ä¸€æ®µä¸ºç¬¬ä¸€æ¬¡æ–°å¢æ•°æ®`</span><br><span class="line"></span><br><span class="line">`drop ä¹‹åç»“æŸç‚¹ä¸ºèµ·ç‚¹ï¼Œåœæ­¢æ•°æ®åº“å†™å…¥ï¼Œæ­¤æ—¶è¯»å–relay-binlogæ–‡ä»¶æœ€åç‚¹ï¼ˆIOä¸åœï¼‰ï¼Œæˆªå–ä¸ºç¬¬äºŒæ®µæ–°å¢æ•°æ®`</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.åœæ­¢å»¶æ—¶ä»åº“SQLçº¿ç¨‹</span></span><br><span class="line">mysql&gt; stop slave SQL_thread;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2å‡†å¤‡æ–°ç¯å¢ƒ</span></span><br><span class="line">[root@db03 ~]# systemctl stop mysqld</span><br><span class="line">[root@db03 ~]# <span class="built_in">rm</span> -fr /app/mysql/data</span><br><span class="line">[root@db03 ~]# /app/mysql/bin/mysqld --user=mysql --basedir=/app/mysql --datadir=/app/mysql/data</span><br><span class="line">[root@db03 ~]# systemctl start mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å…¨å¤‡å»¶æ—¶ä»åº“</span></span><br><span class="line">[root@db04 ~]# mysqldump -A -R --triggers &gt; /tmp/full_new.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æˆªå–relay-log</span></span><br><span class="line"><span class="built_in">cat</span> /app/mysql/data/relay-log.info </span><br><span class="line">./db04-relay-bin.000002</span><br><span class="line">12656</span><br><span class="line">mysql-bin.000003</span><br><span class="line">390768</span><br><span class="line">èµ·å§‹ä½ç½®ç‚¹ï¼š12656</span><br><span class="line"></span><br><span class="line">[root@db04 data]# mysqlbinlog --base64-output=decode-rows db04-relay-bin.000002 |grep -C 10 drop    <span class="comment">#dropä¹‹å‰</span></span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š24110</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å‡ºç¬¬ä¸€æ®µæ–°å¢æ•°æ®</span></span><br><span class="line">mysqlbinlog --start-position=12656 --stop-position=24110 /app/mysql/data/db04-relay-bin.000002 &gt;/tmp/inc1.sql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢ä¸»åº“å†™å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆªå–ç¬¬äºŒæ®µæ–°å¢æ•°æ®</span></span><br><span class="line">[root@db04 data]# mysqlbinlog --base64-output=decode-rows db04-relay-bin.000002 |grep -C 10 drop    <span class="comment">#dropä¹‹å</span></span><br><span class="line">èµ·å§‹ä½ç½®ç‚¹ï¼š24202</span><br><span class="line">mysqlbinlog --base64-output=decode-rows db04-relay-bin.000002</span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š220265</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å‡ºç¬¬äºŒæ®µæ–°åƒ§æ•°æ®</span></span><br><span class="line">mysqlbinlog --start-position=24202 --stop-position=240826 /app/mysql/data/db04-relay-bin.000002 &gt;/tmp/inc2.sql</span><br><span class="line"></span><br><span class="line">prodï¼š1051</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å…¥æ•°æ®</span></span><br><span class="line">å¯¼å…¥å»¶æ—¶ä»åº“å…¨å¤‡</span><br><span class="line">[root@db04 data]# scp /tmp/full.sql 172.16.1.53:/root</span><br><span class="line">[root@db03 ~]# mysql &lt;full.sql </span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å…¥ç¬¬ä¸€æ¬¡æ–°å¢æ•°æ®</span></span><br><span class="line">[root@db04 data]# scp /tmp/inc1.sql  172.16.1.53:/root   </span><br><span class="line">[root@db03 ~]# mysql &lt;inc1.sql </span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å…¥ç¬¬äºŒæ¬¡æ–°å¢æ•°æ®</span></span><br><span class="line">[root@db04 data]# scp /tmp/inc2.sql  172.16.1.53:/root</span><br><span class="line">[root@db03 ~]# mysql &lt;inc2.sql </span><br><span class="line"></span><br><span class="line"><span class="comment">#åº”ç”¨å‰²æ¥</span></span><br><span class="line">å¼€å‘æ”¹ä»£ç </span><br><span class="line">è¿ç»´å°†æ–°ç¯å¢ƒå…¨å¤‡åˆ°æ—§ç¯å¢ƒ</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®åº“çš„åŠåŒæ­¥å¤åˆ¶">æ•°æ®åº“çš„åŠåŒæ­¥å¤åˆ¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä»MYSQL5.5å¼€å§‹ï¼Œæ”¯æŒåŠè‡ªåŠ¨å¤åˆ¶ã€‚ä¹‹å‰ç‰ˆæœ¬çš„MySQL Replicationéƒ½æ˜¯å¼‚ï¼ˆasynchronousï¼‰çš„ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œä¸€äº›äº‹åŠ¡åï¼Œæ˜¯ä¸ä¼šç®¡å¤‡åº“çš„è¿›åº¦çš„ã€‚å¦‚æœå¤‡åº“ä¸å¹¸è½åï¼Œè€Œæ›´ä¸å¹¸çš„æ˜¯ä¸»åº“æ­¤æ—¶åˆå‡ºç°Crashï¼ˆä¾‹å¦‚å®•æœºï¼‰ï¼Œè¿™æ—¶å¤‡åº“ä¸­çš„æ•°æ®å°±æ˜¯ä¸å®Œæ•´çš„ã€‚ç®€è€Œè¨€ä¹‹ï¼Œåœ¨ä¸»åº“å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨å¤‡åº“æ¥ç»§ç»­æä¾›æ•°æ®ä¸€è‡´çš„æœåŠ¡äº†ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åŠåŒæ­¥å¤åˆ¶å‡ºç°åŸå› ï¼š`ä¸ºäº†ä¿è¯ä¸»åº“å’Œä»åº“çš„æ•°æ®ä¸€è‡´æ€§`</span><br><span class="line">ä»åº“çš„IOçº¿ç¨‹åœ¨æ²¡æœ‰æ¥æ”¶åˆ°ACKä¹‹å‰ï¼Œä¼šé˜»å¡ä¸»åº“å†™å…¥æ“ä½œ</span><br><span class="line"></span><br><span class="line">`åŠåŒæ­¥ç¼ºç‚¹`ï¼šé˜»å¡ä¸»åº“å†™å…¥æ•°æ®ï¼Œå½±å“ä¸»åº“æ€§èƒ½ï¼Œé™ä½ç”¨æˆ·ä½“éªŒ</span><br><span class="line">`åŠåŒæ­¥ä¼˜ç‚¹`ï¼šä¸»åº“å’Œä»åº“æ•°æ®ä¿è¯äº†ä¸€è‡´æ€§ï¼Œä¸ä¼šä¸¢æ•°æ®</span><br><span class="line"></span><br><span class="line">åŠåŒæ­¥å¤åˆ¶ï¼ˆSemi synchronous Replicationï¼‰åˆ™ä¸€å®šç¨‹åº¦ä¸Šä¿è¯æäº¤çš„äº‹åŠ¡å·²ç»ä¼ ç»™äº†è‡³å°‘ä¸€ä¸ªå¤‡åº“ã€‚å‡ºå‘ç‚¹æ˜¯ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå®‰å…¨çš„è€ƒè™‘ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>:dango:æ³¨æ„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1)åœ¨åŠåŒæ­¥å¤åˆ¶ä¸­ï¼ŒMasterèŠ‚ç‚¹ç­‰å¾…SlaveèŠ‚ç‚¹è¿”å›ç¡®è®¤ä¿¡æ¯çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæˆ–è€…ä¸€ç›´ç­‰å¾…ç›´åˆ°è¶…è¿‡rpl_semi_sync_master_timeouté…ç½®çš„æ—¶é—´ç‚¹ï¼ŒåŒæ­¥å¤åˆ¶å°†é€€åŒ–ä¸ºå¼‚æ­¥å¤åˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">2ï¼‰åœ¨é€€åŒ–ä¸ºå¼‚æ­¥å¤åˆ¶åï¼Œå¦‚æœSlaveèŠ‚ç‚¹è¿½ä¸Šäº†MasterèŠ‚ç‚¹ï¼Œé‚£ä¹ˆMasterèŠ‚ç‚¹åˆä¼šé‡æ–°è½¬ä¸ºåŠåŒæ­¥å¤åˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">çœ‹ä¼ä¸šé€‰æ‹©</span><br></pre></td></tr></table></figure><p>:dango:<strong>MySQLçš„åŠåŒæ­¥å¤åˆ¶åŸç†</strong></p><p>IOçº¿ç¨‹å–å‡ºæ•°æ®ä¹‹åï¼Œå…ˆæ”¾å…¥tcpç¼“å­˜ï¼Œç›´åˆ°SQLçº¿ç¨‹å®Œæˆå†ç»™IOçº¿ç¨‹è¿”å›ack</p><p><strong>åŠåŒæ­¥æ’ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]# ll /app/mysql/lib/plugin/</span><br><span class="line">-rwxr-xr-x 1 mysql mysql 515584 Aug  7 23:04 semisync_master.so</span><br><span class="line">-rwxr-xr-x 1 mysql mysql 276296 Aug  7 23:04 semisync_slave.so</span><br></pre></td></tr></table></figure><p><strong>:dango:é…ç½®åŠåŒæ­¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¸»åº“æ“ä½œ</span></span><br><span class="line"><span class="comment"># 1.ä¸»åº“æŸ¥çœ‹æ˜¯å¦æ”¯æŒåŠåŒæ­¥</span></span><br><span class="line">mysql&gt; show global variables like <span class="string">&#x27;have_dynamic_loading&#x27;</span>;</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name | Value|</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| have_dynamic_loading | YES |</span><br><span class="line">+----------------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£…ä¸»åº“åŠåŒæ­¥æ’ä»¶</span></span><br><span class="line">mysql&gt; INSTALL PLUGIN rpl_semi_sync_master SONAME<span class="string">&#x27;semisync_master.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å¯åŠ¨æ’ä»¶</span></span><br><span class="line">mysql&gt; SET GLOBAL rpl_semi_sync_master_enabled = 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.è®¾ç½®è¶…æ—¶æ—¶é—´(æ¯«ç§’)</span></span><br><span class="line">mysql&gt; SET GLOBAL rpl_semi_sync_master_timeout = 1000;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æ°¸ä¹…å¯åŠ¨+è¶…æ—¶æ—¶é—´</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout = 1000</span><br><span class="line"></span><br><span class="line">db01 [(none)]&gt;show variables like<span class="string">&#x27;rpl%&#x27;</span>;</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line">| Variable_name                      | Value    |</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | ON       |</span><br><span class="line">| rpl_semi_sync_master_timeout       | 1000     |</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32       |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON       |</span><br><span class="line">| rpl_stop_slave_timeout             | 31536000 |</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line"></span><br><span class="line">db01 [(none)]&gt;show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 0     |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä»åº“æ“ä½œ</span></span><br><span class="line"><span class="comment"># 1.å®‰è£…ä»åº“åŠåŒæ­¥æ’ä»¶</span></span><br><span class="line">mysql&gt; INSTALL PLUGIN rpl_semi_sync_slave SONAME<span class="string">&#x27;semisync_slave.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å¯åŠ¨æ’ä»¶</span></span><br><span class="line">mysql&gt; SET GLOBAL rpl_semi_sync_slave_enabled = 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.é‡å¯IOçº¿ç¨‹</span></span><br><span class="line">mysql&gt; stop slave io_thread;</span><br><span class="line">mysql&gt; start slave io_thread;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line">[root@db02 data]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">rpl_semi_sync_slave_enabled = 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 1     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 6     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 1363  |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 8178  |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 6     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 6     |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="MySQLè¿‡æ»¤å¤åˆ¶">MySQLè¿‡æ»¤å¤åˆ¶</h2><p>:dango:<strong>ä¸»åº“é…ç½®è¿‡æ»¤å¤åˆ¶</strong></p><ul><li>binlog-do-dbï¼šç™½åå•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]# <span class="built_in">cat</span> /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-do-db=prod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db01 [(none)]&gt;show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000006 |   515446 |     prod     |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line">binlogï¼šåªè®°å½•prodåº“çš„æ•°æ®</span><br></pre></td></tr></table></figure><ul><li>binlog-ignore-dbï¼šé»‘åå•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]# <span class="built_in">cat</span> /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-ignore-db=prod</span><br><span class="line">binlogï¼šä¸è®°å½•prodåº“çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| mysql-bin.000006 |   515446 |              |      prod        |</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>:dango:<strong>ä»åº“é…ç½®è¿‡æ»¤å¤åˆ¶</strong></p><p><strong>ç™½åå•</strong></p><ul><li>replicate-do-db=prod                    #ä»åº“SQLçº¿ç¨‹åªæ‰§è¡Œprodåº“çš„SQLè¯­å¥</li><li>replicate-do-table=prod.prod        #ä»åº“SQLçº¿ç¨‹åªæ‰§è¡Œprodåº“é‡Œprodè¡¨çš„SQLè¯­å¥</li><li>replicate-wild-do-table=prod.p*     #ä»åº“SQLçº¿ç¨‹åªæ‰§è¡Œprodåº“é‡Œæ‰€æœ‰på¼€å¤´è¡¨çš„SQLè¯­å¥</li></ul><p>SQLçº¿ç¨‹åªæ‰§è¡Œ Replicat_Do_DBæŒ‡å®šçš„åº“çš„SQLè¯­å¥</p><p><strong>é»‘åå•</strong></p><ul><li>replicate-ignore-db</li><li>replicate-ignore-table</li><li>replicate-wild-ignore-table</li></ul><p>SQLçº¿ç¨‹ä¸æ‰§è¡Œ Replicat_Ignore_DBæŒ‡å®šçš„åº“çš„SQLè¯­å¥</p><h2 id="åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶">åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶</h2><p>:dango:<strong>ä»€ä¹ˆæ˜¯GTID</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GTIDï¼šäº‹åŠ¡æäº¤åšçš„ä¸»ä»å¤åˆ¶ï¼ˆå…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ï¼‰</span><br><span class="line">GTID=UUIDï¼šä¸»åº“çš„èº«ä»½è¯å· + TIDï¼šäº‹åŠ¡æäº¤å·</span><br><span class="line">3E11FA47-71CA-11E1-9E33-C80AA9429562:23</span><br></pre></td></tr></table></figure><p>:dango:<strong>GTIDç‰¹æ€§</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(1).æ”¯æŒå¤šçº¿ç¨‹å¤åˆ¶:äº‹å®ä¸Šæ˜¯é’ˆå¯¹æ¯ä¸ªdatabaseå¼€å¯ç›¸åº”çš„ç‹¬ç«‹çº¿ç¨‹,å³æ¯ä¸ªåº“æœ‰ä¸€ä¸ªå•ç‹¬çš„(sqlthread).</span><br><span class="line">(2).æ”¯æŒå¯ç”¨GTID,åœ¨é…ç½®ä¸»ä»å¤åˆ¶,ä¼ ç»Ÿçš„æ–¹å¼é‡Œ,ä½ éœ€è¦æ‰¾åˆ°binlogå’ŒPOSç‚¹,ç„¶åchange master toæŒ‡å‘.åœ¨mysql5.6é‡Œ,æ— é¡»å†çŸ¥é“binlogå’ŒPOSç‚¹,åªéœ€è¦çŸ¥é“masterçš„IP/ç«¯å£/è´¦å·å¯†ç å³å¯,å› ä¸ºåŒæ­¥å¤åˆ¶æ˜¯è‡ªåŠ¨çš„,MySQLé€šè¿‡å†…éƒ¨æœºåˆ¶GTIDè‡ªåŠ¨æ‰¾ç‚¹åŒæ­¥.</span><br><span class="line">(3).åŸºäºRowå¤åˆ¶åªä¿å­˜æ”¹å˜çš„åˆ—,å¤§å¤§èŠ‚çœDisk Space/Network resourceså’ŒMemory usage.</span><br><span class="line">(4).æ”¯æŒæŠŠMaster å’ŒSlaveçš„ç›¸å…³ä¿¡æ¯è®°å½•åœ¨Tableä¸­åŸæ¥æ˜¯è®°å½•åœ¨æ–‡ä»¶é‡Œ,è®°å½•åœ¨è¡¨é‡Œ,å¢å¼ºå¯ç”¨æ€§</span><br><span class="line">(5).æ”¯æŒå»¶è¿Ÿå¤åˆ¶</span><br></pre></td></tr></table></figure><p>:dango:<strong>GTIDä¸»ä»é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">ä¸»åº“172.16.1.51</span><br><span class="line">ä»åº“172.16.1.52ã€172.16.1.53ã€172.16.1.54</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.ä¿®æ”¹ä¸»åº“é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=1</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency</span><br><span class="line"><span class="comment">#msyql5.6éœ€è¦å†åŠ ä¸‹é¢ä¸€ä¸ªï¼ˆ5.7ä¸éœ€è¦ï¼‰</span></span><br><span class="line">log_slave_updates</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=2</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency</span><br><span class="line"><span class="comment">#msyql5.6éœ€è¦å†åŠ ä¸‹é¢ä¸€ä¸ªï¼ˆ5.7ä¸éœ€è¦ï¼‰</span></span><br><span class="line">log_slave_updates</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=3</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency</span><br><span class="line"><span class="comment">#msyql5.6éœ€è¦å†åŠ ä¸‹é¢ä¸€ä¸ªï¼ˆ5.7ä¸éœ€è¦ï¼‰</span></span><br><span class="line">log_slave_updates</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=4</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency</span><br><span class="line"><span class="comment">#msyql5.6éœ€è¦å†åŠ ä¸‹é¢ä¸€ä¸ªï¼ˆ5.7ä¸éœ€è¦ï¼‰</span></span><br><span class="line">log_slave_updates</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åœ¨ä¸»åº“ä¸Šåˆ›å»ºä¸»ä»å¤åˆ¶ç”¨æˆ·</span></span><br><span class="line">mysql&gt; grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æ‰€æœ‰ä»åº“ä¸Šæ‰§è¡Œchange master</span></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.53&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_auto_position=1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æ‰€æœ‰ä»åº“å¼€å¯ä¸»ä»å¤åˆ¶</span></span><br><span class="line">start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹GTIDæ˜¯å¦å¼€å¯</span></span><br><span class="line">db01 [(none)]&gt;show variables like <span class="string">&#x27;%gtid%&#x27;</span>;</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line">| Variable_name                   | Value     |</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line">| binlog_gtid_simple_recovery     | OFF       |</span><br><span class="line">| enforce_gtid_consistency        | ON        |</span><br><span class="line">| gtid_executed                   |           |</span><br><span class="line">| gtid_mode                       | ON        |</span><br><span class="line">| gtid_next                       | AUTOMATIC |</span><br><span class="line">| gtid_owned                      |           |</span><br><span class="line">| gtid_purged                     |           |</span><br><span class="line">| simplified_binlog_gtid_recovery | OFF       |</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line"></span><br><span class="line">`æ³¨æ„`</span><br><span class="line"><span class="comment">## MySQL5.6å¼€å¯GTID</span></span><br><span class="line">gtid_mode=ON // å¼€å¯GTIDæ¨¡å—</span><br><span class="line">enforce_gtid_consistency // ä¿è¯GITDæ•°æ®å¼ºä¸€è‡´æ€§</span><br><span class="line">log-slave-updates // ä»åº“æ—¥å¿—æ›´æ–°ï¼ˆ1.åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶ 2.åŒä¸»+keepalived 3.çº§è”å¤åˆ¶ï¼‰</span><br><span class="line">log-bin=mysql-bin // å¼€å¯binlog</span><br><span class="line"></span><br><span class="line"><span class="comment">## MySQL5.7å¼€å¯GTID</span></span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">MySQLä¸»ä»å¤åˆ¶åŸç†åŠéƒ¨ç½²ï¼Œç‚¹å¼€çœ‹çœ‹å§</summary>
    
    
    
    <category term="MySQL" scheme="https://lukme.top/categories/MySQL/"/>
    
    
    <category term="MySQL" scheme="https://lukme.top/tags/MySQL/"/>
    
  </entry>
  
</feed>
