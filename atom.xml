<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£ç­ä¸Šçš„çŒ«</title>
  
  
  <link href="https://lukme.top/atom.xml" rel="self"/>
  
  <link href="https://lukme.top/"/>
  <updated>2025-01-21T13:39:33.790Z</updated>
  <id>https://lukme.top/</id>
  
  <author>
    <name>LuayğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¯¹æ¥HarboræœåŠ¡</title>
    <link href="https://lukme.top/posts/655061ae.html"/>
    <id>https://lukme.top/posts/655061ae.html</id>
    <published>2024-12-05T14:16:11.000Z</published>
    <updated>2025-01-21T13:39:33.790Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è‡ªå»ºè¯ä¹¦é…ç½®harborçš„https">è‡ªå»ºè¯ä¹¦é…ç½®harborçš„https:</h2><p><strong>1.harborç‰ˆæœ¬çš„é€‰æ‹©</strong><br>harboræ˜¯VMwareå…¬å¸åŸºäºGolangç¼–ç¨‹è¯­è¨€å¼€æºçš„é•œåƒä»“åº“æœåŠ¡ï¼Œä¹Ÿæ”¯æŒhelmä»“åº“ã€‚</p><p>å®˜æ–¹åœ°å€:<br><a href="https://github.com/goharbor/harbor">https://github.com/goharbor/harbor</a><br>ç‰ˆæœ¬æ¨èé€‰æ‹©2.8ä¹‹å‰çš„ï¼Œå› ä¸ºåœ¨2.8ä¹‹åçš„ç‰ˆæœ¬ç§»é™¤äº†CHARTMUSEUMé¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯helmä»“åº“ï¼Œå°½ç®¡ç§»é™¤äº†ï¼Œä½†æ˜¯å®˜æ–¹æœ‰å¯¹åº”çš„OCIå®ç°æ–¹å¼ã€‚</p><p><strong>2.ä¸‹è½½Harbor</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/goharbor/harbor/releases/download/v2.7.4/harbor-offline-installer-v2.7.4.tgz</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²HarboræœåŠ¡ç«¯ç¯å¢ƒ">éƒ¨ç½²HarboræœåŠ¡ç«¯ç¯å¢ƒ</h2><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>LanIP</th><th>åº”ç”¨</th><th>é…ç½®</th></tr></thead><tbody><tr><td>harbor</td><td>10.0.0.250</td><td>172.16.1.250</td><td>dockerï¼Œdocker-composeï¼ŒHarbor</td><td>2c 2G 50G</td></tr></tbody></table><p><strong>1.å®‰è£…dockerï¼Œdocker-compose</strong></p><p>ç•¥ï¼Œè¯¦æƒ…è§k8séƒ¨ç½²â€“dockeå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# docker -v</span><br><span class="line">Docker version 20.10.24, build 297e128</span><br><span class="line">[root@harbor ~]# docker-compose -v</span><br><span class="line">Docker Compose version v2.23.0</span><br></pre></td></tr></table></figure><p><strong>2.è§£å‹Harborè½¯ä»¶åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# tar xf harbor-offline-installer-v2.7.4.tgz -C /softwares/s</span><br></pre></td></tr></table></figure><p><strong>3.åˆ›å»ºå·¥ä½œç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# <span class="built_in">mkdir</span> -p /softwares/harbor/certs/&#123;ca,harbor-server,docker-client&#125;</span><br></pre></td></tr></table></figure><p><strong>4.è¿›å…¥åˆ°harborè¯ä¹¦å­˜æ”¾ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# <span class="built_in">cd</span> /softwares/harbor/certs/</span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll</span><br><span class="line">drwxr-xr-x 2 root root 4096 Dec  7 06:50 ca/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Dec  7 06:50 docker-client/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Dec  7 06:50 harbor-server/</span><br></pre></td></tr></table></figure><p><strong>5.åˆ›å»ºCAçš„ç§é’¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor certs]# openssl genrsa -out ca/ca.key 4096</span><br><span class="line"><span class="comment">#è¯ä¹¦æœ‰æ•ˆé•¿åº¦4096</span></span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll ca</span><br><span class="line">-rw------- 1 root root 3272 Dec  7 06:53 ca.key</span><br></pre></td></tr></table></figure><p><strong>6.åŸºäºè‡ªå»ºçš„CAç§é’¥åˆ›å»ºCAè¯ä¹¦(æ³¨æ„ï¼Œè¯ä¹¦ç­¾å‘çš„åŸŸåèŒƒå›´)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor certs]# openssl req -x509 -new -nodes -sha512 -days 3650 \</span><br><span class="line">-subj <span class="string">&quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=lukme.com&quot;</span> \</span><br><span class="line">-key ca/ca.key \</span><br><span class="line">-out ca/ca.crt</span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll ca/</span><br><span class="line">-rw-r--r-- 1 root root 2041 Dec  7 06:57 ca.crt</span><br><span class="line">-rw------- 1 root root 3272 Dec  7 06:53 ca.key</span><br></pre></td></tr></table></figure><p><strong>7.æŸ¥çœ‹è‡ªå»ºè¯ä¹¦ä¿¡æ¯ï¼Œæœ‰æ•ˆæœŸç­‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor certs]# openssl  x509 -<span class="keyword">in</span> ca/ca.crt -noout -text</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number:</span><br><span class="line">            79:78:08:92:7b:d2:03:77:42:e1:d8:19:96:78:8f:a1:b0:48:5e:45</span><br><span class="line">        Signature Algorithm: sha512WithRSAEncryption</span><br><span class="line">        Issuer: C = CN, ST = Beijing, L = Beijing, O = example, OU = Personal, CN = lukme.com</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Dec  7 06:57:18 2024 GMT</span><br><span class="line">            Not After : Dec  5 06:57:18 2034 GMT</span><br><span class="line">        Subject: C = CN, ST = Beijing, L = Beijing, O = example, OU = Personal, CN = lukme.com</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (4096 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">Â·Â·Â·</span><br></pre></td></tr></table></figure><p><strong>8 é…ç½®harborè¯ä¹¦</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. ç”ŸæˆharboræœåŠ¡å™¨çš„ç§é’¥</span></span><br><span class="line">[root@harbor certs]# openssl genrsa -out harbor-server/harbor.lukme.com.key 4096</span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll harbor-server/</span><br><span class="line">-rw------- 1 root root 3272 Dec  7 07:01 harbor.lukme.com.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. harboræœåŠ¡å™¨åŸºäºç§é’¥ç­¾å‘è¯ä¹¦è®¤è¯è¯·æ±‚ï¼ˆcsræ–‡ä»¶ï¼‰ï¼Œè®©è‡ªå»ºCAè®¤è¯</span></span><br><span class="line">[root@harbor certs]# openssl req -sha512 -new \</span><br><span class="line">-subj <span class="string">&quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=harbor.lukme.com&quot;</span> \</span><br><span class="line">-key harbor-server/harbor.lukme.com.key \</span><br><span class="line">-out harbor-server/harbor.lukme.com.csr</span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll harbor-server/</span><br><span class="line">-rw-r--r-- 1 root root 1712 Dec  7 07:03 harbor.lukme.com.csr</span><br><span class="line">-rw------- 1 root root 3272 Dec  7 07:01 harbor.lukme.com.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. ç”Ÿæˆ x509 v3 çš„æ‰©å±•æ–‡ä»¶ç”¨äºè®¤è¯</span></span><br><span class="line">[root@harbor certs]# <span class="built_in">cat</span> &gt; harbor-server/v3.ext &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">authorityKeyIdentifier=keyid,issuer</span></span><br><span class="line"><span class="string">basicConstraints=CA:FALSE</span></span><br><span class="line"><span class="string">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span></span><br><span class="line"><span class="string">extendedKeyUsage = serverAuth</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[alt_names]</span></span><br><span class="line"><span class="string">DNS.1=harbor.lukme.com</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll harbor-server/</span><br><span class="line">-rw-r--r-- 1 root root 1712 Dec  7 07:03 harbor.lukme.com.csr</span><br><span class="line">-rw------- 1 root root 3272 Dec  7 07:01 harbor.lukme.com.key</span><br><span class="line">-rw-r--r-- 1 root root  235 Dec  7 07:05 v3.ext</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. åŸºäº x509 v3 çš„æ‰©å±•æ–‡ä»¶è®¤è¯ç­¾å‘harbor serverè¯ä¹¦</span></span><br><span class="line">[root@harbor certs]# openssl x509 -req -sha512 -days 3650 \</span><br><span class="line">-extfile harbor-server/v3.ext \</span><br><span class="line">-CA ca/ca.crt -CAkey ca/ca.key -CAcreateserial \</span><br><span class="line">-<span class="keyword">in</span> harbor-server/harbor.lukme.com.csr \</span><br><span class="line">-out harbor-server/harbor.lukme.com.crt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll harbor-server/</span><br><span class="line">-rw-r--r-- 1 root root 2130 Dec  7 07:07 harbor.lukme.com.crt</span><br><span class="line">-rw-r--r-- 1 root root 1712 Dec  7 07:03 harbor.lukme.com.csr</span><br><span class="line">-rw------- 1 root root 3272 Dec  7 07:01 harbor.lukme.com.key</span><br><span class="line">-rw-r--r-- 1 root root  235 Dec  7 07:05 v3.ext</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. ä¿®æ”¹harborçš„é…ç½®æ–‡ä»¶ä½¿ç”¨è‡ªå»ºè¯ä¹¦</span></span><br><span class="line">[root@harbor certs]# <span class="built_in">cp</span> ../harbor.yml.tmpl ../harbor.yml</span><br><span class="line">[root@harbor certs]# vim ../harbor.yml</span><br><span class="line">...</span><br><span class="line">hostname: harbor.lukme.com</span><br><span class="line">https:</span><br><span class="line">  ...</span><br><span class="line">  certificate: /softwares/harbor/certs/harbor-server/harbor.lukme.com.crt</span><br><span class="line">  private_key: /softwares/harbor/certs/harbor-server/harbor.lukme.com.key</span><br><span class="line">...</span><br><span class="line">harbor_admin_password: 1</span><br><span class="line">...</span><br><span class="line">data_volume: /data/harbor  </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">#6. å®‰è£…harbor</span></span><br><span class="line">[root@harbor certs]# ../install.sh --with-chartmuseum</span><br><span class="line"></span><br><span class="line"><span class="comment">#7. è®¿é—®HarborUI</span></span><br><span class="line">https://harbor.lukme.com </span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">- 1.æ­¤å¤„åœ¨windowsè¦é…ç½®hostsæ–‡ä»¶è§£æï¼Œå†…å®¹ä¸º: <span class="string">&quot;10.0.0.250 harbor.lukme.com&quot;</span></span><br><span class="line">- 2.é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ä¸º: <span class="string">&quot;admin:1&quot;</span></span><br><span class="line">æ–°å»ºå…¬å¼€é¡¹ç›®éªŒè¯Harborå¯ç”¨</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241208093615700.png" alt="image-20241208093615700"></p><p><img src="https://cos.lukme.top/Pic/image-20241208093933288.png" alt="image-20241208093933288"></p><h2 id="ä¸Šä¼ é•œåƒå¯èƒ½ä¼šé‡åˆ°çš„æŠ¥é”™">ä¸Šä¼ é•œåƒå¯èƒ½ä¼šé‡åˆ°çš„æŠ¥é”™</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Q1ï¼š Get <span class="string">&quot;https://harbor.lukme.com/v2/&quot;</span>: dial tcp: lookup harbor.lukme.com on 127.0.0.53:53: no such host</span><br><span class="line">é”™è¯¯åŸå› :</span><br><span class="line">æ²¡æœ‰é…ç½®hostsæ–‡ä»¶è§£æã€‚</span><br><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line">æ·»åŠ hostsæ–‡ä»¶è§£æå³å¯ã€‚</span><br><span class="line"></span><br><span class="line">Q2: Get <span class="string">&quot;https://harbor.lukme.com/v2/&quot;</span>: x509: certificate signed by unknown authority</span><br><span class="line">é”™è¯¯åŸå› :</span><br><span class="line">dockerå®¢æˆ·ç«¯ä¸ä¿¡ä»»è‡ªå»ºè¯ä¹¦ã€‚</span><br><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line">æ‹·è´è‡ªå»ºè¯ä¹¦å³å¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="é…ç½®dockerå®¢æˆ·ç«¯è¯ä¹¦">é…ç½®dockerå®¢æˆ·ç«¯è¯ä¹¦</h2><p><strong>1. ç”Ÿæˆdockerå®¢æˆ·ç«¯è¯ä¹¦</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor certs]# openssl x509 -inform PEM -<span class="keyword">in</span> harbor-server/harbor.lukme.com.crt -out docker-client/harbor.lukme.com.cert</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶å®è¿™ä¸ªæ–‡ä»¶å’ŒHarborçš„è¯ä¹¦ä¸€æ ·ï¼Œå¯ä»¥md5æ£€éªŒä¸€ä¸‹</span></span><br><span class="line">[root@harbor certs]# <span class="built_in">md5sum</span> docker-client/harbor.lukme.com.cert harbor-server/harbor.lukme.com.crt </span><br><span class="line">44e9282de7a9dfc566f43205c8bbefa9  docker-client/harbor.lukme.com.cert</span><br><span class="line">44e9282de7a9dfc566f43205c8bbefa9  harbor-server/harbor.lukme.com.crt</span><br><span class="line"></span><br><span class="line">`æ‰€ä»¥åé¢çš„keyç›´æ¥å¤åˆ¶harborçš„äº†`</span><br></pre></td></tr></table></figure><p><strong>2. æ‹·è´docker clientè¯ä¹¦æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor certs]# <span class="built_in">cp</span> harbor-server/harbor.lukme.com.key docker-client/</span><br><span class="line">[root@harbor certs]# <span class="built_in">cp</span> ca/ca.crt docker-client/</span><br><span class="line"></span><br><span class="line">[root@harbor certs]# ll docker-client/</span><br><span class="line">-rw-r--r-- 1 root root 2041 Dec  7 08:17 ca.crt</span><br><span class="line">-rw-r--r-- 1 root root 2130 Dec  7 08:13 harbor.lukme.com.cert</span><br><span class="line">-rw------- 1 root root 3272 Dec  7 08:17 harbor.lukme.com.key</span><br></pre></td></tr></table></figure><p><strong>3. dockerå®¢æˆ·ç«¯åˆ›å»ºè‡ªå»ºè¯ä¹¦çš„ç›®å½•ç»“æ„</strong></p><p>ä»¥233èŠ‚ç‚¹ä¸ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@worker233 ~]# <span class="built_in">mkdir</span> -p /etc/docker/certs.d/harbor.lukme.com/mkdir -p </span><br><span class="line">/etc/docker/certs.d/harbor.lukme.com/</span><br><span class="line"><span class="comment">#æ³¨æ„åŸŸåçš„åç§°å’Œç›®å½•è¦ä¸€è‡´</span></span><br></pre></td></tr></table></figure><p><strong>4. dockerå®¢æˆ·ç«¯é…ç½®åç§°è§£æ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@worker233 ~]# <span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">10.0.0.250 harbor.lukme.com</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p><strong>5. å°†å®¢æˆ·ç«¯è¯ä¹¦æ–‡ä»¶è¿›è¡Œæ‹·è´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@worker233 ~]# scp harbor.lukme.com:/softwares/harbor/certs/docker-client/* /etc/docker/certs.d/harbor.lukme.com/</span><br></pre></td></tr></table></figure><p><strong>6. dockerå®¢æˆ·ç«¯éªŒè¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@worker233 ~]# docker login -u admin -p 1 harbor.lukme.com</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure><p><strong>å…¶ä»–dockerå®¢æˆ·ç«¯é‡å¤ä»¥ä¸Šæ­¥éª¤(3-5)</strong></p><p>å‚è€ƒé“¾æ¥:<br><a href="https://goharbor.io/docs/1.10/install-config/configure-https/#generate-a-certificate-authority-certificate">https://goharbor.io/docs/1.10/install-config/configure-https/#generate-a-certificate-authority-certificate</a><br><a href="https://www.cnblogs.com/yinzhengjie/p/17153673.html">https://www.cnblogs.com/yinzhengjie/p/17153673.html</a></p><p><strong>7. æ¨é€é•œåƒåˆ°Harbor</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.æŸ¥çœ‹é•œåƒ</span><br><span class="line">[root@worker233 ~]# docker images</span><br><span class="line">mysql              8.0       6c55ddbef969   7 weeks ago     591MB</span><br><span class="line"></span><br><span class="line">2.ç»™æ¨é€çš„é•œåƒæ‰“æ ‡ç­¾</span><br><span class="line">[root@worker233 ~]# docker tag mysql:8.0 harbor.lukme.com/mysql/mysql:8.0</span><br><span class="line"></span><br><span class="line">3.æ¨é€é•œåƒ</span><br><span class="line">[root@worker233 ~]# docker push harbor.lukme.com/mysql/mysql:8.0</span><br><span class="line">The push refers to repository [harbor.lukme.com/mysql/mysql]</span><br><span class="line">595880a638fc: Pushed </span><br><span class="line">e9e263909c0a: Pushed </span><br><span class="line">238a03116078: Pushed </span><br><span class="line">bad6f6fa0a06: Pushed </span><br><span class="line">20466b7f6582: Pushed </span><br><span class="line">cadedf47cc2b: Pushed </span><br><span class="line">8.0: digest: sha256:ce327c13199b0f553b3f3f53f8f1eabd725e589ec4bd1a937095812288b33e24 size: 2618</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241208094953820.png" alt="image-20241208094953820"></p><p><strong>8.éªŒè¯å…¶ä»–èŠ‚ç‚¹æ‹‰å–æ˜¯å¦ok</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# docker pull harbor.lukme.com/mysql/mysql:8.0</span><br><span class="line">8.0: Pulling from mysql/mysql</span><br><span class="line">2c0a233485c3: Pull complete </span><br><span class="line">b746eccf8a0b: Pull complete </span><br><span class="line">570d30cf82c5: Pull complete </span><br><span class="line">Digest: sha256:ce327c13199b0f553b3f3f53f8f1eabd725e589ec4bd1a937095812288b33e24</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> harbor.lukme.com/mysql/mysql:8.0</span><br><span class="line">harbor.lukme.com/mysql/mysql:8.0</span><br></pre></td></tr></table></figure><h2 id="Harborçš„ç§æœ‰é•œåƒä»“åº“">Harborçš„ç§æœ‰é•œåƒä»“åº“</h2><blockquote><p>æ‹‰å–Harborè®¾ç½®çš„ç§æœ‰é•œåƒä»“åº“ï¼Œå‚è€ƒsercetèµ„æºé‡Œï¼ŒHarborè®¤è¯</p></blockquote><h2 id="ç»¼åˆâ€”harborè®¤è¯">ç»¼åˆâ€”harborè®¤è¯</h2><h3 id="æ•…éšœæ’æŸ¥">æ•…éšœæ’æŸ¥</h3><blockquote><p>å°†harborä»“åº“çš„WordPressæ”¹ä¸ºç§æœ‰ä»“åº“ï¼Œå°†WordPressçš„é•œåƒä»“åº“æ‹‰å–æ”¹ä¸ºharborä»“åº“</p><p>èµ„æºæ¸…å•é‡Œçš„é•œåƒæ‹‰å–ç­–ç•¥æ”¹ä¸ºalwaysï¼Œé‚£ä¹ˆåº”ç”¨èµ„æºæ¸…å•åå°±ä¼šæŠ¥é”™é•œåƒæ‹‰å–å¤±è´¥é—®é¢˜</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;åˆ†æ&#x27;</span>ï¼š</span><br><span class="line">æ‹‰å–é•œåƒæ—¶å€™ä¼šå»è¿œç¨‹ä»“åº“å»ºç«‹è¿æ¥ï¼Œå¯¹æ¯”æœ¬åœ°çš„é•œåƒå’Œè¿œç¨‹ä»“åº“é•œåƒä¿¡æ¯æ˜¯å¦ä¸€è‡´ï¼Œåˆ¤æ–­æ˜¯å¦è¢«ä¿®æ”¹ï¼Œä½†æ˜¯ç”±äºè¿œç¨‹ä»“åº“ç§å¯†çš„ï¼Œæ²¡æœ‰è®¿é—®æƒé™</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;èµ„æºæ¸…å•å¦‚ä¸‹&#x27;</span></span><br><span class="line">[root@master231 secret]# <span class="built_in">cat</span> wordpress.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy-db-cm</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: db</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: db</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: datetime</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/localtime</span><br><span class="line">      - name: data</span><br><span class="line">      containers:</span><br><span class="line">      - name: db</span><br><span class="line">        image: mysql:8.0 </span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: datetime</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">          value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">        - name: MYSQL_DATABASE</span><br><span class="line">          value: wp</span><br><span class="line">        - name: MYSQL_USER</span><br><span class="line">          value: wp_user</span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: svc-db</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: db</span><br><span class="line">  ports:</span><br><span class="line">    - name: db</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 3306</span><br><span class="line">      targetPort: 3306</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy-wp-cm</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: wp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: wp</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: datetime</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/localtime</span><br><span class="line">      containers:</span><br><span class="line">      - name: wp</span><br><span class="line">        image: harbor.lukme.com/wordpress/wordpress:latest</span><br><span class="line">        imagePullPolicy: Always</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: datetime</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&quot;svc-db&quot;</span></span><br><span class="line">        - name: WORDPRESS_DB_USER</span><br><span class="line">          value: wp_user</span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_NAME</span><br><span class="line">          value: wp</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: svc-wp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  selector:</span><br><span class="line">    app: wp</span><br><span class="line">  ports:</span><br><span class="line">    - name: wp</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      nodePort: 30080</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241229215324649.png" alt="image-20241229215324649"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 secret]# kubectl get pod</span><br><span class="line">NAME                            READY   STATUS             RESTARTS   AGE</span><br><span class="line">deploy-db-cm-bcc685766-wsbq6    1/1     Running            0          5m49s</span><br><span class="line">deploy-wp-cm-665cc988c9-vtcvh   0/1     ImagePullBackOff   0          5m49s</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241229215408711.png" alt="image-20241229215408711"></p><h3 id="æ•…éšœè§£å†³">æ•…éšœè§£å†³</h3><p><strong>åŸºäºsecretå“åº”å¼åˆ›å»ºharborçš„è®¤è¯ä¿¡æ¯</strong>       ==åŸºäºharborçš„adminç”¨æˆ·==</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 secret]#  kubectl create secret docker-registry harbor-authentication --docker-username=admin --docker-password=1 --docker-email=admin@qq.com --docker-server=harbor.lukme.com </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;ä¿®æ”¹åèµ„æºæ¸…å•å¦‚ä¸‹&#x27;</span></span><br><span class="line">[root@master231 secret]# <span class="built_in">cat</span> wordpress.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy-db-cm</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: db</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: db</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: datetime</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/localtime</span><br><span class="line">      - name: data</span><br><span class="line">      containers:</span><br><span class="line">      - name: db</span><br><span class="line">        image: mysql:8.0 </span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: datetime</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">          value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">        - name: MYSQL_DATABASE</span><br><span class="line">          value: wp</span><br><span class="line">        - name: MYSQL_USER</span><br><span class="line">          value: wp_user</span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: svc-db</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: db</span><br><span class="line">  ports:</span><br><span class="line">    - name: db</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 3306</span><br><span class="line">      targetPort: 3306</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy-wp-cm</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: wp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: wp</span><br><span class="line">    spec:</span><br><span class="line">    <span class="comment"># æ‹‰å–ç§æœ‰é•œåƒä»“åº“æ—¶å¯ä»¥ä½¿ç”¨çš„è®¤è¯ä¿¡æ¯ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª</span></span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      <span class="comment"># æŒ‡å®šsecretçš„åç§°</span></span><br><span class="line">       - name: harbor-authentication</span><br><span class="line">      volumes:</span><br><span class="line">      - name: datetime</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/localtime</span><br><span class="line">      containers:</span><br><span class="line">      - name: wp</span><br><span class="line">        image: harbor.lukme.com/wordpress/wordpress:latest</span><br><span class="line">        imagePullPolicy: Always</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: datetime</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&quot;svc-db&quot;</span></span><br><span class="line">        - name: WORDPRESS_DB_USER</span><br><span class="line">          value: wp_user</span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_NAME</span><br><span class="line">          value: wp</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: svc-wp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  selector:</span><br><span class="line">    app: wp</span><br><span class="line">  ports:</span><br><span class="line">    - name: wp</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      nodePort: 30080</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 secret]# kubectl apply -f wordpress.yaml </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master231 secret]# kubectl get pod</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">deploy-db-cm-bcc685766-zscbg    1/1     Running   0          7s</span><br><span class="line">deploy-wp-cm-54c5879d98-pwrrs   1/1     Running   0          7s</span><br></pre></td></tr></table></figure><h3 id="åŸºäºharborå…¶å®ƒç”¨æˆ·è®¤è¯">åŸºäºharborå…¶å®ƒç”¨æˆ·è®¤è¯</h3><p><img src="https://cos.lukme.top/Pic/image-20241229223836514.png" alt="image-20241229223836514"></p><p><img src="https://cos.lukme.top/Pic/image-20241229223915450.png" alt="image-20241229223915450"></p><p><strong>åŸºäºå£°æ˜å¼åˆ›å»ºharborçš„è®¤è¯ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ä¹‹å‰Harborè®¤è¯ä¿¡æ¯å¦‚ä½•å†™çš„</span></span><br><span class="line">[root@master231 secret]# kubectl get secrets harbor-authentication -oyaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  .dockerconfigjson: eyJhdXRocyI6eyJoYXJib3IubHVrbWUuY29tIjp7InVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6IjEiLCJlbWFpbCI6ImFkbWluQHFxLmNvbSIsImF1dGgiOiJZV1J0YVc0Nk1RPT0ifX19</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2024-12-29T14:44:01Z&quot;</span></span><br><span class="line">  name: harbor-authentication</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;594485&quot;</span></span><br><span class="line">  uid: f5bcf199-437a-4c70-a55b-afe11e2e1204</span><br><span class="line"><span class="built_in">type</span>: kubernetes.io/dockerconfigjson</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç°é‡Œé¢æ˜¯base64ç¼–ç æ ¼å¼çš„ä¿¡æ¯ï¼Œåç¼–è¯‘å‡ºåŸæ ¼å¼</span></span><br><span class="line">[root@master231 secret]# <span class="built_in">echo</span> eyJhdXRocyI6eyJoYXJib3IubHVrbWUuY29tIjp7InVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6IjEiLCJlbWFpbCI6ImFkbWluQHFxLmNvbSIsImF1dGgiOiJZV1J0YVc0Nk1RPT0ifX19|<span class="built_in">base64</span> -d|more</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;auths&quot;</span>:&#123;<span class="string">&quot;harbor.lukme.com&quot;</span>:&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;admin@qq.com&quot;</span>,<span class="string">&quot;auth&quot;</span>:<span class="string">&quot;YWRtaW46MQ==&quot;</span>&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡Œé¢è¿˜æœ‰base64ç¼–ç ï¼Œå†æ¬¡åç¼–è¯‘</span></span><br><span class="line">[root@master231 secret]# <span class="built_in">echo</span> YWRtaW46MQ==|<span class="built_in">base64</span> -d|more</span><br><span class="line">admin:1</span><br></pre></td></tr></table></figure><p><strong>ä»¥ä¸Šä¸ºä¾‹ï¼Œè·å–è®¤è¯ä¿¡æ¯çš„base64ç¼–ç </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·å  luay</span><br><span class="line">å¯†ç     Harbor123</span><br><span class="line">é‚®ç®±    luay@harbor.com</span><br><span class="line"></span><br><span class="line">[root@master231 secret]# <span class="built_in">echo</span> -n luay:Harbor123|<span class="built_in">base64</span></span><br><span class="line">bHVheTpIYXJib3IxMjM=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¿¡æ¯è¡¥ä¸Šå¦‚ä¸‹</span></span><br><span class="line">&#123;<span class="string">&quot;auths&quot;</span>:&#123;<span class="string">&quot;harbor.lukme.com&quot;</span>:&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;luay&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;Harbor123&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;luay@harbor.com&quot;</span>,<span class="string">&quot;auth&quot;</span>:<span class="string">&quot;bHVheTpIYXJib3IxMjM=&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹èµ„æºæ¸…å•ï¼ŒåŠ ä¸Šsecretèµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 secret]# <span class="built_in">cat</span> wp.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy-db-cm</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: db</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: db</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: datetime</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/localtime</span><br><span class="line">      - name: data</span><br><span class="line">      containers:</span><br><span class="line">      - name: db</span><br><span class="line">        image: mysql:8.0 </span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: datetime</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">          value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">        - name: MYSQL_DATABASE</span><br><span class="line">          value: wp</span><br><span class="line">        - name: MYSQL_USER</span><br><span class="line">          value: wp_user</span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: svc-db</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: db</span><br><span class="line">  ports:</span><br><span class="line">    - name: db</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 3306</span><br><span class="line">      targetPort: 3306</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy-wp-cm</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: wp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: wp</span><br><span class="line">    spec:</span><br><span class="line">    <span class="comment"># æ‹‰å–ç§æœ‰é•œåƒä»“åº“æ—¶å¯ä»¥ä½¿ç”¨çš„è®¤è¯ä¿¡æ¯ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª</span></span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      <span class="comment"># æŒ‡å®šsecretçš„åç§°</span></span><br><span class="line">       - name: luay-authentication</span><br><span class="line">      volumes:</span><br><span class="line">      - name: datetime</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/localtime</span><br><span class="line">      containers:</span><br><span class="line">      - name: wp</span><br><span class="line">        image: harbor.lukme.com/wordpress/wordpress:latest</span><br><span class="line">        imagePullPolicy: Always</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: datetime</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&quot;svc-db&quot;</span></span><br><span class="line">        - name: WORDPRESS_DB_USER</span><br><span class="line">          value: wp_user</span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_NAME</span><br><span class="line">          value: wp</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: svc-wp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  selector:</span><br><span class="line">    app: wp</span><br><span class="line">  ports:</span><br><span class="line">    - name: wp</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      nodePort: 30080</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: luay-authentication</span><br><span class="line">  namespace: default</span><br><span class="line">stringData:</span><br><span class="line">  .dockerconfigjson: |</span><br><span class="line">    &#123;<span class="string">&quot;auths&quot;</span>:&#123;<span class="string">&quot;harbor.lukme.com&quot;</span>:&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;luay&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;Harbor123&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;luay@harbor.com&quot;</span>,<span class="string">&quot;auth&quot;</span>:<span class="string">&quot;bHVheTpIYXJib3IxMjM=&quot;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="built_in">type</span>: kubernetes.io/dockerconfigjson</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯">éªŒè¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 secret]# kubectl apply -f wp.yaml</span><br><span class="line">[root@master231 secret]# kubectl get po </span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">deploy-db-cm-bcc685766-gx2x6    1/1     Running   0          76s</span><br><span class="line">deploy-wp-cm-54c5879d98-2l8d8   1/1     Running   0          76s</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•ç§»é™¤luayç”¨æˆ·ï¼Œçœ‹çœ‹æ˜¯å¦è¿˜èƒ½æ‹‰å–æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line">[root@master231 secret]# kubectl get po</span><br><span class="line">NAME                            READY   STATUS         RESTARTS   AGE</span><br><span class="line">deploy-db-cm-bcc685766-hlxgk    1/1     Running        0          105s</span><br><span class="line">deploy-wp-cm-54c5879d98-z8qc4   1/1     Running        0          105s</span><br><span class="line">deploy-wp-cm-566b9c4787-llgmz   0/1     ErrImagePull   0          5s</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">k8så¯¹æ¥ç§æœ‰é•œåƒä»“åº“harbor</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>k8sæŠ¥é”™æ’æŸ¥æŠ€å·§</title>
    <link href="https://lukme.top/posts/5c722e91.html"/>
    <id>https://lukme.top/posts/5c722e91.html</id>
    <published>2024-12-04T15:12:16.000Z</published>
    <updated>2025-01-21T13:36:54.940Z</updated>
    
    <content type="html"><![CDATA[<h2 id="podæŠ¥é”™åŠå¯èƒ½åŸå› ">podæŠ¥é”™åŠå¯èƒ½åŸå› </h2><pre><code>1.ImagePullBackOff  é—®é¢˜åŸå› :  é•œåƒæ‹‰å–å¤±è´¥ã€‚  å¯èƒ½åŸå› ï¼š  1.å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜å¯¼è‡´ï¼Œæ£€æŸ¥Podæ‰€åœ¨èŠ‚ç‚¹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è®¿é—®ç½‘ç»œ;  2.é•œåƒåç§°å†™é”™ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé”™è¯¯;  3.é•œåƒæ˜¯ç§æœ‰ä»“åº“ï¼Œé•œåƒæ— æƒé™æ‹‰å–;  2.ContainerCreatingé—®é¢˜åˆ†æ:å®¹å™¨æ­£åœ¨åˆ›å»ºé˜¶æ®µï¼Œç­‰å¾…å®¹å™¨åˆ›å»ºï¼Œè¯¥è¿‡ç¨‹åŒ…å«æ‹‰å–é•œåƒçš„æ—¶é—´ã€‚3.Pendingé—®é¢˜åˆ†æ:ä»»åŠ¡å·²ç»è¢«K8Sé›†ç¾¤æ¥å—ï¼Œä½†æ˜¯æœªè°ƒåº¦åˆ°æŒ‡å®šèŠ‚ç‚¹ã€‚å¯èƒ½åŸå› :1.å½“å‰é›†ç¾¤ä¸æ­£å¸¸å·¥ä½œï¼Œè¯·æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼Œæ¯”å¦‚CNIç»„ä»¶æœªå®‰è£…;2.æŒ‡å®šçš„è°ƒåº¦çš„èŠ‚ç‚¹ä¸å­˜åœ¨æ—¶ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜;3.ç«¯å£å†²çªï¼Œæ— æ³•å®Œæˆè°ƒåº¦;4.æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«æ‰“ä¸Šæ±¡ç‚¹ï¼Œä¸”podæ²¡æœ‰é…ç½®æ±¡ç‚¹å®¹å¿ä¹Ÿä¼šå¯¼è‡´è¯¥çŠ¶æ€;4.CrashLoopBackOffé—®é¢˜åˆ†æ:å¤„äºè¯¥çŠ¶æ€ï¼Œè¯´æ˜Podå†…è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨é‡å¯ã€‚å¯èƒ½åŸå› :1.å¯èƒ½æ˜¯å®¹å™¨çš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œå‘½ä»¤ç»“æŸå¯¼è‡´çš„;5.Completedé—®é¢˜åˆ†æ:å®¹å™¨æ­£å¸¸é€€å‡ºï¼Œå®¹å™¨æ²¡æœ‰è¢«å¼ºåˆ¶ä¸­æ–­ã€‚6.Runningé—®é¢˜åˆ†æ:è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ã€‚7.Init:1/2 é—®é¢˜åˆ†æ:å½“å‰çš„Podå¤„äºåˆå§‹åŒ–å®¹å™¨é˜¶æ®µï¼Œç›®å‰å·²ç»å®Œæˆä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ï¼Œæ­£åœ¨è¿›è¡Œç¬¬äºŒä¸ªå®¹å™¨åˆå§‹åŒ–ã€‚8.PodInitializingé—®é¢˜åˆ†æ:Podæ­£å¤„äºåˆå§‹åŒ–é˜¶æ®µã€‚9.ErrImageNeverPull é—®é¢˜åˆ†æ:å°†é•œåƒä¸‹è½½ç­–ç•¥è®¾ç½®ä¸ºNeverï¼Œä¸”æœ¬åœ°ä¹Ÿæ²¡æœ‰ç¼“å­˜é•œåƒï¼Œå› æ­¤å¯åŠ¨å®¹å™¨å¤±è´¥ã€‚10.OutOfcpué—®é¢˜åˆ†æ:ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç”±äºCPUèµ„æºä¸è¶³å¯¼è‡´çš„ã€‚11.OutOfmemoryé—®é¢˜åˆ†æ:ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç”±äºå†…å­˜ä¸è¶³æ— æ³•åˆ†é…å¯¼è‡´çš„ã€‚12.NodePortsé—®é¢˜åˆ†æ:å½“å‰çš„workerèŠ‚ç‚¹çš„ç«¯å£å¯èƒ½å­˜åœ¨å†²çªã€‚13.RunContainerErroré—®é¢˜åˆ†æ:è¿è¡Œå®¹å™¨æ—¶å‡ºé”™ï¼Œå¯ä»¥é€šè¿‡kubectl describe pods &lt;POD_NAME&gt;æŸ¥çœ‹è¯¦ç»†çš„ä¿¡æ¯ã€‚14.ErrImagePullé—®é¢˜åˆ†æ:æ‹‰å–é•œåƒæ˜¯å¤±è´¥ã€‚å¯èƒ½åŸå› :1.é•œåƒåç§°å†™é”™äº†;2.æ²¡æœ‰è®¿é—®æƒé™;15.Terminatingé—®é¢˜åˆ†æ:Podçš„å®¹å™¨æ­£åœ¨åˆ é™¤ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šè¶…è¿‡30sã€‚16.CreateContainerConfigErroré—®é¢˜åˆ†æ:è¿è¡Œå®¹å™¨å‡ºé”™ï¼Œä¸€èˆ¬æƒ…ä¸‹ï¼Œæ˜¯é…ç½®å‡ºé”™ã€‚17.ContainerStatusUnknowné—®é¢˜åˆ†æ:å®¹å™¨é‡å¯ç­–ç•¥ä¸ºNerverï¼Œä¸”æˆ‘ä»¬æµ‹è¯•æ—¶å°†å·¥ä½œèŠ‚ç‚¹çš„å®¹å™¨ç›´æ¥åˆ é™¤å•¦ã€‚æ— æ³•è·å–</code></pre><h2 id="å¸¸ç”¨æ’é”™å‘½ä»¤">å¸¸ç”¨æ’é”™å‘½ä»¤</h2><h3 id="describe">describe</h3><blockquote><p><code> kubectl describe pod</code></p><p>æŸ¥çœ‹ç›¸å…³ Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬äº†è§£ Pod çš„çŠ¶æ€ã€é…ç½®å’Œè¿è¡ŒçŠ¶å†µã€‚å°¤å…¶æ˜¯Eventså¯ä»¥å¸®åŠ©æˆ‘ä»¬åšä¸€äº›æ•…éšœæ’æŸ¥ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl describe pod busybox-pod -n luay</span><br><span class="line"><span class="comment">#å¦‚æœæŸ¥çœ‹çš„podçš„åç§°ç©ºé—´ä¸æ˜¯é»˜è®¤defaultï¼Œåˆ™éœ€è¦æŒ‡å®š -n</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  18m   default-scheduler  Successfully assigned luay/busybox-pod to node03</span><br><span class="line">  Normal  Pulled     18m   kubelet            Container image <span class="string">&quot;busybox&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    18m   kubelet            Created container busybox-container</span><br><span class="line">  Normal  Started    18m   kubelet            Started container busybox-container</span><br><span class="line">  Normal  Pulled     18m   kubelet            Container image <span class="string">&quot;nginx:alpine&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    18m   kubelet            Created container nginx-container</span><br><span class="line">  Normal  Started    18m   kubelet            Started container nginx-container</span><br><span class="line">  </span><br><span class="line"><span class="comment">#æŸ¥çœ‹nodeèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">[root@master ~]# kubectl describe node master01</span><br></pre></td></tr></table></figure><h3 id="logs">logs</h3><blockquote><p><code> kubectl logs èµ„æºå</code>   å¯ä»¥ä½¿ç”¨kubectl get pod  æŸ¥çœ‹èµ„æºå</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;kubectl logs èµ„æºåç§°&#x27;</span></span><br><span class="line">[root@master ~]# kubectl logs mysql80 </span><br><span class="line"></span><br><span class="line"><span class="comment">#å®æ—¶æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">[root@master ~]# kubectl logs -f mysql80 </span><br><span class="line"></span><br><span class="line"><span class="comment">#åŸºäºä¸€ä¸ªPodå†…å¤šä¸ªå®¹å™¨æŸ¥çœ‹æŒ‡çš„å®¹å™¨çš„æ—¥å¿—   -c  æŒ‡å®šå®¹å™¨å</span></span><br><span class="line">[root@master ~]# kubectl logs -f multiple-wordpress -c db</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;multiple-wordpress&#x27;</span> podå</span><br><span class="line">-c æŒ‡å®špodé‡Œçš„æŸä¸€ä¸ªå®¹å™¨å</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹podä¸Šä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—ï¼ˆå‰ææ˜¯è¯¥å®¹å™¨å­˜åœ¨ï¼Œè‹¥ç§»é™¤äº†åˆ™çœ‹ä¸åˆ°ï¼‰</span></span><br><span class="line"><span class="string">&#x27;è¿™ç§æƒ…å†µå­˜åœ¨äºï¼Œæ€æ‰äº†podé‡ŒæŸä¸ªå®¹å™¨ï¼Œåˆè¢«kubeleté‡æ–°æ‹‰å–äº†å¦ä¸€ä¸ªæ–°çš„å®¹å™¨,-pæŸ¥çœ‹ä¸Šä¸ªå®¹å™¨æ—¥å¿—&#x27;</span></span><br><span class="line">[root@master ~]#  kubectl logs -f mysql80 -p</span><br><span class="line"><span class="string">&#x27;mysql80&#x27;</span> å®¹å™¨å   ----å¾…éªŒè¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹5åˆ†é’Ÿå†…çš„æ—¥å¿—ä¿¡æ¯ï¼Œ é»˜è®¤æ˜¯æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼Œå¯ä»¥è‡ªå®šä¹‰æŒ‡å®šæ—¶é—´ï¼Œä¾‹å¦‚: 5s, 2m, or 3h.</span></span><br><span class="line">[root@master ~]# kubectl logs -f mysql80 --since  5m</span><br></pre></td></tr></table></figure><h3 id="cp">cp</h3><p><strong>å°†æœ¬åœ°çš„æ–‡ä»¶æ‹·è´åˆ°Podçš„å®¹å™¨ä¸­</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl <span class="built_in">cp</span> wordpress.yaml mysql80:/tmp</span><br><span class="line"></span><br><span class="line">å¦‚ä½•æŸ¥çœ‹ï¼Ÿ</span><br><span class="line">[root@master ~]# kubectl <span class="built_in">exec</span> -it mysql80 --<span class="built_in">ls</span> /tmp</span><br><span class="line">ç±»ä¼¼äºdocker <span class="built_in">exec</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨-cæŒ‡å®š </span></span><br><span class="line">kubectl <span class="built_in">cp</span>  wordpress.yaml  -c wp multiple-wordpress:/</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;multiple-wordpress&#x27;</span>   <span class="comment">#podå   ---å¾…éªŒè¯</span></span><br><span class="line"><span class="string">&#x27;wp&#x27;</span> <span class="comment">#å®¹å™¨å</span></span><br><span class="line"></span><br><span class="line">å¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨-cæŒ‡å®šå®¹å™¨çš„åç§°ï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤Podè¿æ¥ç¬¬ä¸€ä¸ªå®¹å™¨</span><br></pre></td></tr></table></figure><h3 id="explain">explain</h3><p><strong>æŸ¥çœ‹æŒ‡å®šå­—æ®µçš„å¸®åŠ©ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl explain pods.</span><br><span class="line">[root@master ~]# kubectl explain pods.metadata</span><br><span class="line">[root@master ~]# kubectl explain pods.metadata.name</span><br><span class="line">[root@master ~]# kubectl explain pods.spec.containers</span><br></pre></td></tr></table></figure><p><strong>å¸¸è§çš„èµ„æºç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;ï¼š</span><br><span class="line">è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">&lt;Object&gt;:</span><br><span class="line">è¡¨ç¤ºæœ‰ä¸‹çº§å­—æ®µã€‚</span><br><span class="line"></span><br><span class="line"> &lt;[]Object&gt;:</span><br><span class="line">è¡¨ç¤ºæ•°ç»„å¯¹è±¡è¯´å¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸ªå¯¹è±¡çš„åŒºåˆ†ä½¿ç”¨<span class="string">&quot;-&quot;</span>ï¼ŒåŒä¸€ä¸ªå¯¹è±¡æ•°ç»„å†…çš„ç›¸å…³å­—æ®µå¯ä»¥ç›¸äº’äº¤æ¢ã€‚</span><br><span class="line"></span><br><span class="line">&lt;boolean&gt;:</span><br><span class="line">åªæœ‰<span class="literal">true</span>å’Œ<span class="literal">false</span>ä¸¤ä¸ªæœ‰æ•ˆå€¼ã€‚</span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">integer</span>&gt;:</span><br><span class="line">æ•´å‹ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚</span><br><span class="line"></span><br><span class="line">-required-</span><br><span class="line">è¡¨ç¤ºè¯¥å­—æ®µå¿…é¡»å®šä¹‰ï¼Œä¸å®šä¹‰åˆ™ä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">äº†è§£ä¸€äº›å¸¸è§æŠ¥é”™æŒ‡ä»¤ä»¥åŠæ’é”™æŠ€å·§</summary>
    
    
    
    <category term="kubernetes" scheme="https://lukme.top/categories/kubernetes/"/>
    
    
    <category term="kubernetes" scheme="https://lukme.top/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>k8sèµ„æºæ¸…å•</title>
    <link href="https://lukme.top/posts/219d8e69.html"/>
    <id>https://lukme.top/posts/219d8e69.html</id>
    <published>2024-12-03T12:20:13.000Z</published>
    <updated>2025-01-21T13:39:41.697Z</updated>
    
    <content type="html"><![CDATA[<h2 id="k8sèµ„æºæ¸…å•æè¿°">k8sèµ„æºæ¸…å•æè¿°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ApiVersion:</span><br><span class="line">èµ„æºçš„ç‰ˆæœ¬ï¼Œå®˜æ–¹å¯¹æ¯ä¸ªèµ„æºè§„å®šäº†ä¸åŒçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®èµ„æºçš„ç‰ˆæœ¬è¿›è¡Œä¹¦å†™ã€‚</span><br><span class="line">ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œèµ„æºçš„ç‰ˆæœ¬å¾ˆå°‘å˜åŠ¨ï¼Œé™¤éåœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œéšç€åŠŸèƒ½çš„å¢å¼ºï¼Œç‰ˆæœ¬å¯èƒ½ä¹Ÿä¼šå¾®è°ƒã€‚</span><br><span class="line"></span><br><span class="line">kind:</span><br><span class="line">èµ„æºçš„ç±»å‹ï¼ŒK8Sé›†ç¾¤ä¸­ä¸€åˆ‡çš†èµ„æºã€‚</span><br><span class="line"></span><br><span class="line">metadata:</span><br><span class="line">èµ„æºçš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š </span><br><span class="line">- èµ„æºçš„åç§°;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºæ‰€å±çš„åç§°ç©ºé—´;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„æ ‡ç­¾;(å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„æ³¨è§£;(æ—©æœŸç‰ˆæœ¬å¸¸ç”¨)</span><br><span class="line">- èµ„æºçš„åˆ›å»ºæ—¶é—´;</span><br><span class="line">- ...</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line">å®šä¹‰äº†ç”¨æˆ·å¯¹Podçš„æœŸæœ›çŠ¶æ€ã€‚ç”¨æˆ·å¯ä»¥åšå¦‚ä¸‹æ“ä½œ:</span><br><span class="line">- æŒ‡å®šèŠ‚ç‚¹è°ƒåº¦;</span><br><span class="line">- æŒ‡å®šè°ƒåº¦çš„äº²å’Œæ€§æˆ–åäº²å’Œæ€§;</span><br><span class="line">- èµ„æºçš„æ•°æ®æ˜¯å¦è¿›è¡ŒæŒä¹…åŒ–;</span><br><span class="line">- èµ„æºçš„é…ç½®æ–‡ä»¶æ˜¯å¦éœ€è¦ä¿®æ”¹;</span><br><span class="line">- èµ„æºçš„å®¹å™¨ä½¿ç”¨å…·ä½“çš„é•œåƒ;</span><br><span class="line">- èµ„æºçš„é™åˆ¶</span><br><span class="line">- èµ„æºçš„è®¤è¯ä¿¡æ¯</span><br><span class="line">- èµ„æºçš„å®‰å…¨ä¿¡æ¯</span><br><span class="line">- ...</span><br><span class="line"></span><br><span class="line">status:</span><br><span class="line">èµ„æºå®é™…çš„çŠ¶æ€ï¼Œæ¯”å¦‚è°ƒåº¦åˆ°å“ªä¸ªworkerèŠ‚ç‚¹ï¼Œå®é™…åˆ†é…çš„IPåœ°å€ï¼Œè¿è¡Œå‘¨æœŸï¼Œé‡å¯æ¬¡æ•°ç­‰ã€‚</span><br><span class="line">è¯¥èµ„æºä¸€èˆ¬ä¸éœ€è¦äººä¸ºå®šä¹‰ï¼Œè€Œæ˜¯æœ‰K8Sé›†ç¾¤è‡ªèº«ç»´æŠ¤ã€‚</span><br><span class="line"></span><br><span class="line">[root@master231 ~]# kubectl api-resources</span><br><span class="line">æŸ¥çœ‹æ‰€æœ‰èµ„æº</span><br></pre></td></tr></table></figure><h2 id="podèµ„æºåŠèµ„æºæ¸…å•">podèµ„æºåŠèµ„æºæ¸…å•</h2><p><strong>1.PODèµ„æº</strong></p><p><strong>kubernetesèµ„æºå¯¹è±¡æ“ä½œ</strong></p><table><thead><tr><th>èµ„æºå¯¹è±¡</th><th>å¢</th><th>åˆ </th><th>æ”¹</th><th>æŸ¥</th></tr></thead><tbody><tr><td>node</td><td></td><td>kubectl delete node</td><td></td><td>kubectl get nodes</td></tr><tr><td>namespace</td><td>kubectl create ns [èµ„æºå]</td><td>kubectl delete ns [èµ„æºå]</td><td>kubectl edit ns [èµ„æºå]</td><td>kubectl get ns</td></tr><tr><td>pod</td><td></td><td>kubectl delete pod [èµ„æºå]</td><td>kubectl edit pod[èµ„æºå]</td><td>kubectl get pod</td></tr></tbody></table><p><strong>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE     VERSION</span><br><span class="line">master   Ready    master   4d13h   v1.19.3</span><br><span class="line">node01   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br><span class="line">node02   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br><span class="line">node03   Ready    &lt;none&gt;   4d13h   v1.19.3</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹åç§°ç©ºé—´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   4d13h</span><br><span class="line">kube-flannel      Active   4d12h</span><br><span class="line">kube-node-lease   Active   4d13h</span><br><span class="line">kube-public       Active   4d13h</span><br><span class="line">kube-system       Active   4d13h</span><br><span class="line">luay              Active   4h17m</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹pod  (é»˜è®¤defaultåç§°ç©ºé—´)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   0          6h8m</span><br><span class="line">nginx-pod                1/1     Running   0          5h43m</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹pod  (æŒ‡å®šåç§°ç©ºé—´)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -n luay</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">busybox-pod   2/2     Running   0          3m30s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master ~]# kubectl get pod -n luay -o wide</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE     IP         NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">busybox-pod   2/2     Running   0          4m14s   10.2.2.6   node03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">-n æŒ‡å®šå‘½åç©ºé—´</span><br><span class="line">-o æŒ‡å®šè¾“å‡ºæ–¹å¼</span><br><span class="line">jsonï¼šè¾“å‡ºjsonæ ¼å¼</span><br><span class="line">yamlï¼šè¾“å‡ºyamlæ ¼å¼</span><br><span class="line">wideï¼šè¾“å‡ºè¯¦ç»†ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><strong>2.podçš„èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# vim nginx.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pod</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: nginx-containers</span><br><span class="line"></span><br><span class="line">`æ³¨é‡Š`</span><br><span class="line">apiVersion: v1       <span class="comment"># K8Sèµ„æºæ¥å£</span></span><br><span class="line">kind: Pod            <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line">metadata:            <span class="comment">#èµ„æºçš„å…ƒæ•°æ®</span></span><br><span class="line">  name: nginx-pod    <span class="comment"># PODåå­—</span></span><br><span class="line">  namespace: default <span class="comment"># æŒ‡å®šèµ„æºå¯åŠ¨åœ¨å“ªä¸ªåç§°ç©ºé—´ï¼Œé»˜è®¤default</span></span><br><span class="line">spec:                <span class="comment">#å®¹å™¨ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">  containers:        <span class="comment">#å®¹å™¨ä¿¡æ¯</span></span><br><span class="line">  - image: nginx:alpine           <span class="comment">#æŒ‡å®šå®¹å™¨é•œåƒ</span></span><br><span class="line">    imagePullPolicy: IfNotPresent <span class="comment">#æŒ‡å®šé•œåƒæ‹‰å–è§„åˆ™</span></span><br><span class="line">    name: nginx-containers        <span class="comment">#å®¹å™¨åå­—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Alwaysï¼šæ€»æ˜¯æ‹‰å–é•œåƒï¼Œä¸ç®¡å½“å‰æœºå™¨ä¸Šæ˜¯å¦æœ‰è¯¥é•œåƒéƒ½æ‹‰å– nginx:latest</span><br><span class="line">Neverï¼šä»ä¸æ‹‰å–é•œåƒï¼Œéœ€è¦æå‰docker pull</span><br><span class="line">IfNotPresentï¼šå¦‚æœé•œåƒä¸å­˜åœ¨ï¼Œåˆ™æ‹‰å–</span><br></pre></td></tr></table></figure><h2 id="èµ„æºæ¸…å•çš„å¢ï¼Œåˆ ï¼ŒæŸ¥">èµ„æºæ¸…å•çš„å¢ï¼Œåˆ ï¼ŒæŸ¥</h2><p><strong>1.ç¼–å†™èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# <span class="built_in">cat</span> single-pods.yaml </span><br><span class="line">apiVersion: v1  <span class="comment"># æŒ‡å®šèµ„æºçš„apiç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">kind: Pod       <span class="comment"># æŒ‡å®šèµ„æºçš„ç±»å‹</span></span><br><span class="line">metadata:       <span class="comment"># æŒ‡å®šPodçš„å…ƒæ•°æ®ä¿¡æ¯</span></span><br><span class="line">  name: xiuxian <span class="comment"># æŒ‡çš„Podçš„åç§°</span></span><br><span class="line">spec:           <span class="comment"># å®šä¹‰æœŸæœ›èµ„æº</span></span><br><span class="line">  containers:   <span class="comment"># å®šä¹‰å®¹å™¨èµ„æº</span></span><br><span class="line">  - name: c1    <span class="comment"># å®¹å™¨çš„åç§°</span></span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/yinzhengjie-k8s/apps:v1  <span class="comment"># å®¹å™¨çš„é•œåƒ</span></span><br></pre></td></tr></table></figure><p><strong>2.åˆ›å»ºèµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl create -f single-pods.yaml </span><br><span class="line">pod/xiuxian created</span><br></pre></td></tr></table></figure><p><strong>3.æŸ¥çœ‹èµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl get pods</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE</span><br><span class="line">xiuxian   1/1     Running   0          54s</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl get pods -o wide</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">xiuxian   1/1     Running   0          86s   10.100.2.4   worker233   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# curl 10.0.100.2.4</span><br><span class="line">curl: (6) Could not resolve host: 10.0.100.2.4</span><br><span class="line">[root@master231:1 pods]# curl 10.100.2.4</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;yinzhengjie apps v1&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">       div img &#123;</span><br><span class="line">          width: 900px;</span><br><span class="line">          height: 600px;</span><br><span class="line">          margin: 0;</span><br><span class="line">       &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1 style=<span class="string">&quot;color: green&quot;</span>&gt;å‡¡äººä¿®ä»™ä¼  v1 &lt;/h1&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;img src=<span class="string">&quot;1.jpg&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>4.åˆ é™¤èµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl delete -f single-pods.yaml </span><br><span class="line">pod <span class="string">&quot;xiuxian&quot;</span> deleted</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl get pods -o wide</span><br><span class="line">No resources found <span class="keyword">in</span> default namespace.</span><br><span class="line">[root@master231:1 pods]# </span><br></pre></td></tr></table></figure><p><strong>5.ä½¿ç”¨applyå‘½ä»¤åˆ›å»ºæˆ–è€…ä¿®æ”¹èµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ™æ˜¯åˆ›å»º</span></span><br><span class="line">[root@master231:1 pods]# kubectl apply -f single-pods.yaml </span><br><span class="line">pod/xiuxian created</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl get pods -o wide</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">xiuxian   1/1     Running   0          23s   10.100.2.5   worker233   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"><span class="comment">#å†æ¬¡æ‰§è¡Œåˆ™æ˜¯ä¿®æ”¹èµ„æºï¼Œè‹¥æ²¡æœ‰ä¿®æ”¹èµ„æºæ¸…å•åˆ™æç¤ºunchanged</span></span><br><span class="line">[root@master231:1 pods]# kubectl apply -f single-pods.yaml </span><br><span class="line">pod/xiuxian unchanged</span><br></pre></td></tr></table></figure><h2 id="å“åº”å¼Â·åŸºäºæ ‡ç­¾ç®¡ç†PODèµ„æº">å“åº”å¼Â·åŸºäºæ ‡ç­¾ç®¡ç†PODèµ„æº</h2><p><strong>1.æŸ¥çœ‹èµ„æºçš„æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">xiuxian   1/1     Running   0          5m54s   &lt;none&gt;</span><br></pre></td></tr></table></figure><p><strong>2.ç»™èµ„æºæ‰“æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl label pod xiuxian name=wanglin level=huashen</span><br><span class="line">pod/xiuxian labeled</span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">xiuxian   1/1     Running   0          9m17s   level=huashen,name=wanglin</span><br></pre></td></tr></table></figure><p><strong>3.å°†èµ„æºç§»é™¤æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl label pod xiuxian name-</span><br><span class="line">pod/xiuxian unlabeled</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">xiuxian   1/1     Running   0          10m   level=huashen</span><br></pre></td></tr></table></figure><p>**4.ä¿®æ”¹æ ‡ç­¾ **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">xiuxian   1/1     Running   0          10m   level=huashen</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl label pod xiuxian level=jindan --overwrite</span><br><span class="line">pod/xiuxian labeled</span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">xiuxian   1/1     Running   0          12m   level=jindan</span><br><span class="line"></span><br><span class="line">`--overwrite`ä¸åŠ ä¸Šåˆ™æŠ¥é”™levelçš„å€¼å·²å­˜åœ¨</span><br></pre></td></tr></table></figure><p><strong>5.ä¸ºæ‰€æœ‰Podèµ„æºæ‰“æ ‡ç­¾</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl label pods --all app=xiuxian</span><br><span class="line">pod/xiuxian labeled</span><br><span class="line">pod/xiuxian-v1 labeled</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE    LABELS</span><br><span class="line">xiuxian      1/1     Running   0          20m    app=xiuxian,level=jindan</span><br><span class="line">xiuxian-v1   1/1     Running   0          101s   app=xiuxian</span><br></pre></td></tr></table></figure><p><strong>åŸºäºæ ‡ç­¾è¿‡æ»¤èµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">xiuxian      1/1     Running   0          25m     app=xiuxian,level=jindan</span><br><span class="line">xiuxian-v1   1/1     Running   0          6m41s   app=xiuxian,name=wanglin</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿‡æ»¤keyé‡Œå«æœ‰nameçš„æ ‡ç­¾</span></span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels -l name</span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">xiuxian-v1   1/1     Running   0          6m21s   app=xiuxian,name=wanglin</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿‡æ»¤level=jindançš„æ ‡ç­¾</span></span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels -l level=jindan</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">xiuxian   1/1     Running   0          26m   app=xiuxian,level=jindan</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿‡æ»¤levelä¸ç­‰äºjindançš„æ ‡ç­¾</span></span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels -l  level!=jindan</span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">xiuxian-v1   1/1     Running   0          8m54s   app=xiuxian,name=wanglin</span><br></pre></td></tr></table></figure><p><strong>7.åŸºäºæ ‡ç­¾åˆ é™¤èµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">xiuxian      1/1     Running   0          30m   app=xiuxian,level=jindan</span><br><span class="line">xiuxian-v1   1/1     Running   0          11m   app=xiuxian,name=wanglin</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl delete pods -l name</span><br><span class="line">pod <span class="string">&quot;xiuxian-v1&quot;</span> deleted</span><br><span class="line"></span><br><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">xiuxian   1/1     Running   0          31m   app=xiuxian,level=jindan</span><br></pre></td></tr></table></figure><h2 id="å£°æ˜å¼Â·ä¿®æ”¹èµ„æºæ ‡ç­¾">å£°æ˜å¼Â·ä¿®æ”¹èµ„æºæ ‡ç­¾</h2><p><strong>1.ä¿®æ”¹èµ„æºæ¸…å•</strong>    è®°å¾—ä¿®æ”¹åè¦åº”ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# <span class="built_in">cat</span> single-pods.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: xiuxian</span><br><span class="line">  <span class="comment"># ä¸ºèµ„æºæ‰“æ ‡ç­¾</span></span><br><span class="line">  labels:</span><br><span class="line">    name: wanglin</span><br><span class="line">    level: jindan</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c1</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/yinzhengjie-k8s/apps:v1</span><br><span class="line"></span><br><span class="line"><span class="comment">#èµ„æºæ¸…å•ä¿®æ”¹åè¦åº”ç”¨ä¸€ä¸‹</span></span><br><span class="line">[root@master231:1 pods]# kubectl apply -f single-pods.yaml </span><br><span class="line">pod/xiuxian created</span><br></pre></td></tr></table></figure><p><strong>2.æŸ¥çœ‹èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# kubectl get pods --show-labels</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">xiuxian   1/1     Running   0          76s   level=jindan,name=wanglin</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹æ ‡ç­¾å’Œåˆ é™¤æ ‡ç­¾ç›´æ¥åœ¨èµ„æºæ¸…å•é‡Œä¿®æ”¹å³å¯ï¼Œä¿®æ”¹ååº”ç”¨ä¸€ä¸‹</p></blockquote><h2 id="å“åº”å¼å’Œå£°æ˜å¼çš„åŒºåˆ«">å“åº”å¼å’Œå£°æ˜å¼çš„åŒºåˆ«</h2><p><strong>1.ç›¸åŒç‚¹</strong></p><p>â€‹    éƒ½å¯ä»¥ç®¡ç†èµ„æº</p><p><strong>2.ä¸åŒç‚¹</strong></p><ul><li>å“åº”å¼ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼Œä½†æ˜¯èµ„æºè¢«é‡æ–°åˆ›å»ºååˆå¾—é‡æ–°æ‰§è¡Œç›¸å…³å‘½ä»¤;</li><li>å£°æ˜å¼ä¿®æ”¹éœ€è¦å…ˆä¿®æ”¹èµ„æºæ¸…å•ï¼Œåœ¨ä½¿ç”¨applyå‘½ä»¤æ›´æ–°åº”ç”¨é…ç½®;</li></ul><h2 id="è¿æ¥å®¹å™¨">è¿æ¥å®¹å™¨</h2><p><strong>1.è¿æ¥æŒ‡å®špodæ‰§è¡Œå‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it èµ„æºå <span class="built_in">command</span></span><br><span class="line">[root@master231:0 kubernetes]# kubectl <span class="built_in">exec</span> -it mysql80 -- mysql</span><br><span class="line">Â·Â·Â·</span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure><p><strong>2.è¿æ¥åŒä¸€ä¸ªPodçš„ä¸åŒå®¹å™¨æ‰§è¡Œå‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 pods]# kubectl <span class="built_in">exec</span> -it multiple-wordpress -c db -- <span class="built_in">ls</span> / -l</span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">1.kubectl <span class="built_in">exec</span>å’Œdocker <span class="built_in">exec</span>éƒ½æ˜¯åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤;</span><br><span class="line">2.å¦‚æœä¸€ä¸ªPodæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨-cè¿æ¥åˆ°æŒ‡å®šçš„å®¹å™¨æ‰§è¡Œç›¸åº”çš„å‘½ä»¤;</span><br><span class="line">3.å¦‚æœä¸€ä¸ªPodæœ‰å¤šä¸ªå®¹å™¨ï¼Œè‹¥ä¸ä½¿ç”¨-cè¿æ¥åˆ°æŒ‡å®šå®¹å™¨æ‰§è¡Œå‘½ä»¤ï¼Œåˆ™é»˜è®¤è¿æ¥åˆ°ç¬¬ä¸€ä¸ªå®¹å™¨;</span><br></pre></td></tr></table></figure><h2 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h2><h3 id="åŸºäºpodéƒ¨ç½²mysqlæ•°æ®åº“">åŸºäºpodéƒ¨ç½²mysqlæ•°æ®åº“</h3><p><strong>1.ç¼–å†™èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 pods]# <span class="built_in">cat</span> single-pods-mysql.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql80</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">spec:</span><br><span class="line">   <span class="comment"># æŒ‡å®šè°ƒåº¦åˆ°å“ªä¸ªèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å¿…é¡»åœ¨etcdæ•°æ®åº“ä¸­æœ‰è®°å½•</span></span><br><span class="line">  nodeName: worker233</span><br><span class="line">  containers:</span><br><span class="line">  - name: mysqld</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">      <span class="comment"># æŒ‡å®šå˜é‡çš„åç§°,å…è®¸å¯†ç ä¸ºç©º</span></span><br><span class="line">    - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">      <span class="comment"># æŒ‡å®šå˜é‡çš„å€¼</span></span><br><span class="line">      value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: wordpress</span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br></pre></td></tr></table></figure><p><strong>2.è¿è¡Œmsyqlå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:0 kubernetes]# kubectl apply -f single-pods-mysql.yaml </span><br><span class="line">pod/mysql80 created</span><br></pre></td></tr></table></figure><p><strong>3.æŸ¥çœ‹podä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:0 kubernetes]# kubectl get pod -o wide</span><br><span class="line">NAME      READY   STATUS             RESTARTS   AGE   IP            NODE     </span><br><span class="line">mysql80   0/1     ImagePullBackOff   0          83s   10.100.2.12   worker233</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºèŠ‚ç‚¹worker233   ip 10.100.2.12</span></span><br></pre></td></tr></table></figure><h3 id="åŸºäºä¸€ä¸ªpodéƒ¨ç½²wordpress">åŸºäºä¸€ä¸ªpodéƒ¨ç½²wordpress</h3><p><strong>1.ç¼–å†™èµ„æºæ¸…å•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# <span class="built_in">cat</span> wordpress.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-pod</span><br><span class="line">spec:</span><br><span class="line"> <span class="comment"># ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œåç§°ç©ºé—´</span></span><br><span class="line">  hostNetwork: <span class="literal">true</span></span><br><span class="line">  containers:</span><br><span class="line">  - name: db</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;yes&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: wp</span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">  - name: wp</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: WORDPRESS_DB_HOST</span><br><span class="line">      value: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_NAME</span><br><span class="line">      value: wp</span><br><span class="line">    - name: WORDPRESS_DB_USER</span><br><span class="line">      value: wp_usre</span><br><span class="line">    - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">`ä¿è¯å®¿ä¸»æœº80ç«¯å£ä¸è¢«å ç”¨`</span><br></pre></td></tr></table></figure><p><strong>2.æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºpod</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl apply -f wordpress.yaml </span><br></pre></td></tr></table></figure><p><strong>3.æŸ¥çœ‹podä¿¡æ¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master kubernetes]# kubectl get pod  -o wide</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   IP           NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx-565785f75c-tpjmj   1/1     Running   0          8h    10.2.2.2     node03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-pod                1/1     Running   0          8h    10.2.2.3     node03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">wordpress-pod            2/2     Running   0          26m   10.0.0.203   node03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">#podåˆ›å»ºèŠ‚ç‚¹ipä¸º10.0.0.203</span><br><span class="line">æµè§ˆå™¨è®¿é—®ï¼š100.0.203</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä»€ä¹ˆæ˜¯èµ„æºæ¸…å•ï¼Œåˆè¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿ</summary>
    
    
    
    
    <category term="k8s" scheme="https://lukme.top/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8sé›†ç¾¤éƒ¨ç½²</title>
    <link href="https://lukme.top/posts/a90d3645.html"/>
    <id>https://lukme.top/posts/a90d3645.html</id>
    <published>2024-12-02T13:35:13.000Z</published>
    <updated>2025-01-21T13:36:54.943Z</updated>
    
    <content type="html"><![CDATA[<h2 style="text-align:center">Kuberneteséƒ¨ç½²</h2><blockquote><p>è¯´æ˜ï¼š</p><p>â€‹k8sç³»åˆ—éƒ¨ç½²ä½¿ç”¨éƒ½æ˜¯åŸºäºUbuntuç³»ç»Ÿçš„ï¼Œå¦‚æœä½ ä¹Ÿæƒ³ä½¿ç”¨Ubuntuç³»ç»Ÿå’Œæˆ‘ä¿æŒä¸€è‡´ï¼Œè¯·å‚è€ƒ<a href="https://lukme.top/posts/91269589.html">ã€ŠUbuntuæœ€å°åŒ–å®‰è£…ã€‹</a></p></blockquote><p><strong>==è¿™é‡Œæ˜¯åŸºäºkubeadmæ¥éƒ¨ç½²k8==</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>é…ç½®</th></tr></thead><tbody><tr><td>master231</td><td>10.0.0.231</td><td>2c 4G 50G</td></tr><tr><td>worker232</td><td>10.0.0.232</td><td>2c 3G 50G</td></tr><tr><td>worker233</td><td>10.0.0.233</td><td>2c 3G 50G</td></tr></tbody></table><h2 id="éƒ¨ç½²K8Sé›†ç¾¤å‡†å¤‡">éƒ¨ç½²K8Sé›†ç¾¤å‡†å¤‡</h2><p><strong>1.å…³é—­swapåˆ†åŒº</strong></p><blockquote><p>Swapæ˜¯äº¤æ¢åˆ†åŒºï¼Œå¦‚æœæœºå™¨å†…å­˜ä¸å¤Ÿï¼Œä¼šä½¿ç”¨swapåˆ†åŒºï¼Œä½†æ˜¯swapåˆ†åŒºçš„æ€§èƒ½è¾ƒä½ï¼Œk8sè®¾è®¡çš„æ—¶å€™ä¸ºäº†èƒ½æå‡æ€§èƒ½ï¼Œé»˜è®¤æ˜¯ä¸å…è®¸ä½¿ç”¨äº¤æ¢åˆ†åŒºçš„ã€‚Kubeadmåˆå§‹åŒ–çš„æ—¶å€™ä¼šæ£€æµ‹swapæ˜¯å¦å…³é—­ï¼Œå¦‚æœæ²¡å…³é—­ï¼Œé‚£å°±åˆå§‹åŒ–å¤±è´¥ã€‚å¦‚æœä¸æƒ³è¦å…³é—­äº¤æ¢åˆ†åŒºï¼Œå®‰è£…k8sçš„æ—¶å€™å¯ä»¥æŒ‡å®šâ€“ignore-preflight-errors=Swapæ¥è§£å†³</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 ~]# swapoff -a &amp;&amp; sysctl -w vm.swappiness=0  <span class="comment"># ä¸´æ—¶å…³é—­</span></span><br><span class="line">[root@master231:1 ~]# sed -ri <span class="string">&#x27;/^[^#]*swap/s@^@#@&#x27;</span> /etc/fstab  <span class="comment"># åŸºäºé…ç½®æ–‡ä»¶å…³é—­</span></span><br></pre></td></tr></table></figure><p><strong>2.æŸ¥çœ‹swapåˆ†åŒºæ˜¯å¦å…³é—­</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 ~]# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       855Mi       1.4Gi       2.0Mi       1.5Gi       2.7Gi</span><br><span class="line">Swap:             0B          0B          0B</span><br><span class="line"><span class="comment">#swap éƒ½æ˜¯0B</span></span><br></pre></td></tr></table></figure><p><strong>3.ç¡®ä¿å„ä¸ªèŠ‚ç‚¹MACåœ°å€æˆ–product_uuidå”¯ä¸€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 ~]# ifconfig  eth0  | grep ether | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">00:0c:29:97:ce:c7</span><br><span class="line">[root@worker232:1 ~]# ifconfig  eth0  | grep ether | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">00:0c:29:31:90:93</span><br><span class="line">[root@worker233:0 ~]# ifconfig  eth0  | grep ether | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">00:0c:29:1a:94:53</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master231:1 ~]# <span class="built_in">cat</span> /sys/class/dmi/id/product_uuid </span><br><span class="line">64ea4d56-6c14-ca1e-54e6-489f5597cec7</span><br><span class="line">[root@worker232:1 ~]# <span class="built_in">cat</span> /sys/class/dmi/id/product_uuid </span><br><span class="line">a8bc4d56-161c-5efa-1edf-ce270e319093</span><br><span class="line">[root@worker233:0 ~]# <span class="built_in">cat</span> /sys/class/dmi/id/product_uuid </span><br><span class="line">21fe4d56-5f21-35aa-b83c-9f5b501a9453</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€èˆ¬æ¥è®²ï¼Œç¡¬ä»¶è®¾å¤‡ä¼šæ‹¥æœ‰å”¯ä¸€çš„åœ°å€ï¼Œä½†æ˜¯æœ‰äº›è™šæ‹Ÿæœºçš„åœ°å€å¯èƒ½ä¼šé‡å¤ã€‚Kubernetesä½¿ç”¨è¿™äº›å€¼æ¥å”¯ä¸€ç¡®å®šé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ã€‚ å¦‚æœè¿™äº›å€¼åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¸å”¯ä¸€ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰è£…å¤±è´¥ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>4 æ£€æŸ¥ç½‘ç»œèŠ‚ç‚¹æ˜¯å¦äº’é€š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 ~]# ping sina.com -c 10 </span><br></pre></td></tr></table></figure><p><strong>5 å…è®¸iptableæ£€æŸ¥æ¡¥æ¥æµé‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 ~]#  sysctl --system</span><br></pre></td></tr></table></figure><p><strong>6 æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨</strong></p><table><thead><tr><th>åè®®</th><th>æ–¹å‘</th><th>ç«¯å£èŒƒå›´</th><th>ç›®çš„</th><th>ä½¿ç”¨è€…</th></tr></thead><tbody><tr><td>TCP</td><td>å…¥ç«™</td><td>6443</td><td>Kubernetes API æœåŠ¡å™¨</td><td>æ‰€æœ‰</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>2379-2380</td><td>etcd æœåŠ¡å™¨å®¢æˆ·ç«¯ API</td><td>kube-apiserverã€etcd</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>10250</td><td>kubelet API</td><td>è‡ªèº«ã€æ§åˆ¶é¢</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>10259</td><td>kube-scheduler</td><td>è‡ªèº«</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>10257</td><td>kube-controller-manager</td><td>è‡ªèº«</td></tr></tbody></table><table><thead><tr><th>åè®®</th><th>æ–¹å‘</th><th>ç«¯å£èŒƒå›´</th><th>ç›®çš„</th><th>ä½¿ç”¨è€…</th></tr></thead><tbody><tr><td>TCP</td><td>å…¥ç«™</td><td>10250</td><td>kubelet API</td><td>è‡ªèº«ã€æ§åˆ¶é¢</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>10256</td><td>kube-proxy</td><td>è‡ªèº«ã€è´Ÿè½½å‡è¡¡å™¨</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>30000-32767</td><td>NodePort Servicesâ€ </td><td>æ‰€æœ‰</td></tr></tbody></table><p>å‚è€ƒé“¾æ¥: <a href="https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/">https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/</a></p><p>æ£€æŸ¥masterèŠ‚ç‚¹å’ŒworkerèŠ‚ç‚¹çš„å„ç»„ä»¶ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚</p><p><strong>æ‰€æœ‰èŠ‚ç‚¹ä¿®æ”¹cgroupçš„ç®¡ç†è¿›ç¨‹ä¸ºsystemd</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">åœ¨CentOSæ“ä½œç³»ç»Ÿä¸­ï¼Œå¦‚æœä¸ä¿®æ”¹cgroupçš„ç®¡ç†é©±åŠ¨ä¸ºsystemdï¼Œåˆ™é»˜è®¤å€¼ä¸ºcgroupfsï¼Œåœ¨åˆå§‹åŒ–masterèŠ‚ç‚¹æ—¶ä¼šå¤±è´¥</span><br><span class="line"></span><br><span class="line">ä¸‹é¢çš„æ¡ˆä¾‹æ˜¯CentOSæ“ä½œçš„å®ä¾‹ï¼ŒUbuntuå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚</span><br><span class="line">[root@master231 ~]# docker info  | grep cgroup</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line">[root@master231 ~]# </span><br><span class="line">[root@master231 ~]# <span class="built_in">cat</span> /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://tuv7rqqq.mirror.aliyuncs.com&quot;</span>,<span class="string">&quot;https://docker.mirrors.ustc.edu.cn/&quot;</span>,<span class="string">&quot;https://hub-mirror.c.163.com/&quot;</span>,<span class="string">&quot;https://reg-mirror.qiniu.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@master231 ~]# systemctl restart docker</span><br><span class="line">[root@master231 ~]# docker info | grep <span class="string">&quot;Cgroup Driver&quot;</span></span><br><span class="line"> Cgroup Driver: systemd</span><br><span class="line">[root@master231 ~]# </span><br></pre></td></tr></table></figure><p><strong>7.å®‰è£…dockerç¯å¢ƒ(æ‰€æœ‰èŠ‚ç‚¹)</strong></p><blockquote><p>ä¸€é”®å®‰è£…dockerè„šæœ¬ï¼Œè·å–è¯·å…³æ³¨å…¬ä¼—å·ã€ŠåŸæ¥å¼€æºã€‹ï¼Œç§ä¿¡å›å¤  docker-install</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨æ–¹æ³•ï¼š</span><br><span class="line">å®‰è£…æ‰§è¡Œï¼š./install-docker.sh i</span><br><span class="line">å¸è½½æ‰§è¡Œï¼š./install-docker.sh r</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Â 1.æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•ï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 2.å…è®¸APTä½¿ç”¨HTTPSï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 3.æ·»åŠ Dockerå®˜æ–¹GPGå¯†é’¥ï¼š</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 4.æ·»åŠ Dockerçš„ç¨³å®šç‰ˆæœ¬ä»“åº“ï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> add-apt-repositoryÂ <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 5.å†æ¬¡æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•ï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 5.å®‰è£…Docker CEï¼ˆç¤¾åŒºç‰ˆï¼‰ï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 6.éªŒè¯Dockeræ˜¯å¦å®‰è£…æˆåŠŸå¹¶è¿è¡Œï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 7.æˆ–è€…ä½¿ç”¨ç®€å•çš„å‘½ä»¤æ£€æŸ¥Dockerç‰ˆæœ¬ï¼š</span></span><br><span class="line">docker --version</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¸©é¦¨æç¤ºÂ  ä»¥ä¸Šæ­¥éª¤ä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Dockerã€‚å¦‚æœéœ€è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„Dockerï¼Œå¯ä»¥åˆ—å‡ºå¯ç”¨ç‰ˆæœ¬å¹¶é€‰æ‹©å®‰è£…ï¼š</span></span><br><span class="line">apt-cache madison docker-cesudo apt-get install docker-ce=&lt;VERSION_STRING&gt;</span><br><span class="line"><span class="comment">#æ›¿æ¢&lt;VERSION_STRING&gt;ä¸ºä½ éœ€è¦çš„ç‰ˆæœ¬å·ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 8.é…ç½®dockeré•œåƒåŠ é€Ÿ</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span><br><span class="line"><span class="string">    &quot;registry-mirrors&quot;: [</span></span><br><span class="line"><span class="string">    &quot;https://docker.1panel.live&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dockercf.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker-cf.registry.cyou&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.chenby.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.m.daocloud.io&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.m.daocloud.io&quot;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Â 9.é‡å¯docker</span></span><br><span class="line">[root@worker231 ~]# systemctl daemon-reload</span><br><span class="line">[root@worker231 ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹docker</span></span><br><span class="line">[root@master231:1 ~]# docker --version</span><br><span class="line">Docker version 20.10.24, build 297e128</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# docker info  | grep <span class="string">&quot;Cgroup Driver:&quot;</span></span><br><span class="line"> Cgroup Driver: systemd</span><br><span class="line"></span><br><span class="line">[root@worker232 ~]# docker info  | grep <span class="string">&quot;Cgroup Driver:&quot;</span></span><br><span class="line"> Cgroup Driver: systemd</span><br><span class="line"></span><br><span class="line">[root@worker233 ~]# docker info  | grep <span class="string">&quot;Cgroup Driver:&quot;</span></span><br><span class="line"> Cgroup Driver: systemd</span><br></pre></td></tr></table></figure><p><strong>8.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…kubeadmï¼Œkubeletï¼Œkubectl</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä½ éœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šå®‰è£…ä»¥ä¸‹çš„è½¯ä»¶åŒ…ï¼š</span><br><span class="line">kubeadmï¼š</span><br><span class="line">ç”¨æ¥åˆå§‹åŒ–K8Sé›†ç¾¤çš„å·¥å…·ã€‚</span><br><span class="line">kubeletï¼š</span><br><span class="line">åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨Podå’Œå®¹å™¨ç­‰ã€‚</span><br><span class="line">kubectlï¼š</span><br><span class="line">ç”¨æ¥ä¸K8Sé›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</span><br><span class="line"></span><br><span class="line">kubeadmä¸èƒ½å¸®ä½ å®‰è£…æˆ–è€…ç®¡ç†kubeletæˆ–kubectlï¼Œæ‰€ä»¥ä½ éœ€è¦ç¡®ä¿å®ƒä»¬ä¸é€šè¿‡kubeadmå®‰è£…çš„æ§åˆ¶å¹³é¢(master)çš„ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚ å¦‚æœä¸è¿™æ ·åšï¼Œåˆ™å­˜åœ¨å‘ç”Ÿç‰ˆæœ¬åå·®çš„é£é™©ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é¢„æ–™ä¹‹å¤–çš„é”™è¯¯å’Œé—®é¢˜ã€‚ </span><br><span class="line">ç„¶è€Œï¼Œæ§åˆ¶å¹³é¢ä¸kubeleté—´çš„ç›¸å·®ä¸€ä¸ªæ¬¡è¦ç‰ˆæœ¬ä¸ä¸€è‡´æ˜¯æ”¯æŒçš„ï¼Œä½†kubeletçš„ç‰ˆæœ¬ä¸å¯ä»¥è¶…è¿‡<span class="string">&quot;API SERVER&quot;</span>çš„ç‰ˆæœ¬ã€‚ ä¾‹å¦‚ï¼Œ1.7.0ç‰ˆæœ¬çš„kubeletå¯ä»¥å®Œå…¨å…¼å®¹1.8.0ç‰ˆæœ¬çš„<span class="string">&quot;API SERVER&quot;</span>ï¼Œåä¹‹åˆ™ä¸å¯ä»¥ã€‚</span><br></pre></td></tr></table></figure><p><strong>8.1 K8Sæ‰€æœ‰èŠ‚ç‚¹é…ç½®è½¯ä»¶æº</strong></p><pre><code>apt-get update &amp;&amp; apt-get install -y apt-transport-httpscurl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.listdeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial mainEOF[root@master231:1 ~]#  apt-get update</code></pre><p><strong>8.2 æŸ¥çœ‹ä¸€ä¸‹å½“å‰ç¯å¢ƒæ”¯æŒçš„k8sç‰ˆæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# apt-cache madison kubeadm</span><br><span class="line">   kubeadm |  1.28.2-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm |  1.28.1-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm |  1.28.0-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span><br><span class="line">   ...</span><br><span class="line">   kubeadm | 1.23.17-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm | 1.23.16-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm | 1.23.15-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm | 1.23.14-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span><br></pre></td></tr></table></figure><p><strong>8.3 å®‰è£… kubelet kubeadm kubectl</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install kubelet=1.23.17-00 kubeadm=1.23.17-00 kubectl=1.23.17-00</span><br></pre></td></tr></table></figure><p><strong>8.4æ£€æŸ¥å„ç»„ä»¶ç‰ˆæœ¬ æ˜¯å¦ç»Ÿä¸€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master232:1 ~]# kubeadm version</span><br><span class="line">kubeadm version: &amp;version.Info&#123;Major:<span class="string">&quot;1&quot;</span>, Minor:<span class="string">&quot;23&quot;</span>, GitVersion:<span class="string">&quot;v1.23.17&quot;</span>, GitCommit:<span class="string">&quot;953be8927218ec8067e1af2641e540238ffd7576&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>, BuildDate:<span class="string">&quot;2023-02-22T13:33:14Z&quot;</span>, GoVersion:<span class="string">&quot;go1.19.6&quot;</span>, Compiler:<span class="string">&quot;gc&quot;</span>, Platform:<span class="string">&quot;linux/amd64&quot;</span>&#125;</span><br><span class="line">[root@master231:1 ~]# </span><br><span class="line"></span><br><span class="line">[root@worker232:1 ~]# kubectl version</span><br><span class="line">Client Version: version.Info&#123;Major:<span class="string">&quot;1&quot;</span>, Minor:<span class="string">&quot;23&quot;</span>, GitVersion:<span class="string">&quot;v1.23.17&quot;</span>, GitCommit:<span class="string">&quot;953be8927218ec8067e1af2641e540238ffd7576&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>, BuildDate:<span class="string">&quot;2023-02-22T13:34:27Z&quot;</span>, GoVersion:<span class="string">&quot;go1.19.6&quot;</span>, Compiler:<span class="string">&quot;gc&quot;</span>, Platform:<span class="string">&quot;linux/amd64&quot;</span>&#125;</span><br><span class="line">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span><br><span class="line"></span><br><span class="line">[root@worker232:1 ~]# kubelet --version</span><br><span class="line">Kubernetes v1.23.17</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹éƒ½è¦æ£€æŸ¥ä¸‹ï¼Œé¿å…ä½ å®‰è£…çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼</span></span><br><span class="line">å‚è€ƒé“¾æ¥:</span><br><span class="line">https://kubernetes.io/zh/docs/tasks/tools/install-kubectl-linux/</span><br></pre></td></tr></table></figure><p><strong>9.æ£€æŸ¥æ—¶åŒº  ä¸€å®šè¦ä¸€è‡´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# <span class="built_in">date</span> -R</span><br><span class="line">Mon, 09 Sep 2024 14:58:34 +0800</span><br><span class="line">[root@master231 ~]# ll /etc/localtime </span><br><span class="line">lrwxrwxrwx 1 root root 33 Aug 30 15:27 /etc/localtime -&gt; /usr/share/zoneinfo/Asia/Shanghai</span><br><span class="line"></span><br><span class="line">[root@worker232 ~]# <span class="built_in">date</span> -R</span><br><span class="line">Mon, 09 Sep 2024 14:59:22 +0800</span><br><span class="line">[root@worker232 ~]# ll /etc/localtime </span><br><span class="line">lrwxrwxrwx 1 root root 33 Aug 30 15:27 /etc/localtime -&gt; /usr/share/zoneinfo/Asia/Shanghai</span><br><span class="line"></span><br><span class="line">[root@worker233 ~]# <span class="built_in">date</span> -R</span><br><span class="line">Mon, 09 Sep 2024 14:59:35 +0800</span><br><span class="line">[root@worker233 ~]# ll /etc/localtime </span><br><span class="line">lrwxrwxrwx 1 root root 33 Aug 30 15:27 /etc/localtime -&gt; /usr/share/zoneinfo/Asia/Shanghai</span><br></pre></td></tr></table></figure><p><strong>9.1ä¿®æ”¹æ—¶åŒº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# <span class="built_in">ln</span> -svf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime  </span><br><span class="line"></span><br><span class="line">[root@worker233 ~]# <span class="built_in">ln</span> -svf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span><br><span class="line"></span><br><span class="line">[root@worker232 ~]# <span class="built_in">ln</span> -svf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–K8Sçš„masterç»„ä»¶">åˆå§‹åŒ–K8Sçš„masterç»„ä»¶</h2><p><strong>1 ä½¿ç”¨kubeadmåˆå§‹åŒ–masterèŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# kubeadm init \</span><br><span class="line">--kubernetes-version=v1.23.17 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers  \</span><br><span class="line">--pod-network-cidr=10.100.0.0/16 \</span><br><span class="line">--service-cidr=10.200.0.0/16  \</span><br><span class="line">--service-dns-domain=k8s-service</span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤ºï¼š</span><br><span class="line">ç›¸å…³å‚æ•°è¯´æ˜åœ¨ä¸‹é¢</span><br><span class="line">...</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  </span><br><span class="line">Alternatively, <span class="keyword">if</span> you are the root user, you can run:</span><br><span class="line">  <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 10.0.0.231:6443 --token 8lutg1.3i6jcp7vgd7gpldl \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:e4a5061043bba6e271c502eb6e3fe80bb3555c8f00e42649e08f3939eacdb459 </span><br><span class="line">[root@master231 ~]# </span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä½ çš„tokenè·Ÿæˆ‘ä¸ä¸€è‡´ï¼Œè¯·ä¿å­˜å¥½tokenï¼Œé»˜è®¤ä¿ç•™24å°æ—¶ï¼Œå› æ­¤24å°æ—¶å†…ä½ çš„é›†ç¾¤å¿…é¡»å¯åŠ¨èµ·æ¥ï¼</p></blockquote><p><strong>masteråˆå§‹åŒ–ä¸æˆåŠŸè§£å†³é—®é¢˜çš„æ–¹æ³•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">å¯èƒ½å­˜åœ¨çš„åŸå› ï¼š</span><br><span class="line"> - ç”±äºæ²¡æœ‰ç¦ç”¨swapåˆ†åŒºå¯¼è‡´æ— æ³•å®Œæˆåˆå§‹åŒ–;</span><br><span class="line">   - æ¯ä¸ª2coreä»¥ä¸Šçš„CPUå¯¼è‡´æ— æ³•å®Œæˆåˆå§‹åŒ–;</span><br><span class="line">   - æ²¡æœ‰æ‰‹åŠ¨å¯¼å…¥é•œåƒ;</span><br><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line">  - 1.æ£€æŸ¥ä¸Šé¢çš„æ˜¯å¦æœ‰ä¸Šé¢çš„æƒ…å†µ</span><br><span class="line">   free -h </span><br><span class="line">   lscpu</span><br><span class="line">   </span><br><span class="line">  - 2.é‡ç½®å½“å‰èŠ‚ç‚¹ç¯å¢ƒ</span><br><span class="line">[root@master231 ~]# kubeadm reset -f</span><br><span class="line">  - 3.å†æ¬¡å°è¯•åˆå§‹åŒ–masterèŠ‚ç‚¹ </span><br></pre></td></tr></table></figure><p><strong>ç›¸å…³å‚æ•°è¯´æ˜:</strong>:dango:</p><pre><code>--kubernetes-version:æŒ‡å®šK8S masterç»„ä»¶çš„ç‰ˆæœ¬å·ã€‚--image-repository:æŒ‡å®šä¸‹è½½k8s masterç»„ä»¶çš„é•œåƒä»“åº“åœ°å€ã€‚--pod-network-cidr:æŒ‡å®šPodçš„ç½‘æ®µåœ°å€ã€‚--service-cidr:æŒ‡å®šSVCçš„ç½‘æ®µ--service-dns-domain:æŒ‡å®šserviceçš„åŸŸåã€‚è‹¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º&quot;cluster.local&quot;ã€‚</code></pre><p><strong>ä½¿ç”¨kubeadmåˆå§‹åŒ–é›†ç¾¤æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹çš„è¾“å‡ºä¿¡æ¯:</strong></p><pre><code>[init] ä½¿ç”¨åˆå§‹åŒ–çš„K8Sç‰ˆæœ¬ã€‚[preflight] ä¸»è¦æ˜¯åšå®‰è£…K8Sé›†ç¾¤çš„å‰ç½®å·¥ä½œï¼Œæ¯”å¦‚ä¸‹è½½é•œåƒï¼Œè¿™ä¸ªæ—¶é—´å–å†³äºä½ çš„ç½‘é€Ÿã€‚[certs] ç”Ÿæˆè¯ä¹¦æ–‡ä»¶ï¼Œé»˜è®¤å­˜å‚¨åœ¨&quot;/etc/kubernetes/pki&quot;ç›®å½•å“Ÿã€‚[kubeconfig]ç”ŸæˆK8Sé›†ç¾¤çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤å­˜å‚¨åœ¨&quot;/etc/kubernetes&quot;ç›®å½•å“Ÿã€‚[kubelet-start] å¯åŠ¨kubeletï¼Œç¯å¢ƒå˜é‡é»˜è®¤å†™å…¥:&quot;/var/lib/kubelet/kubeadm-flags.env&quot;é…ç½®æ–‡ä»¶é»˜è®¤å†™å…¥:&quot;/var/lib/kubelet/config.yaml&quot;[control-plane]ä½¿ç”¨é™æ€çš„ç›®å½•ï¼Œé»˜è®¤çš„èµ„æºæ¸…å•å­˜æ”¾åœ¨:&quot;/etc/kubernetes/manifests&quot;ã€‚æ­¤è¿‡ç¨‹ä¼šåˆ›å»ºé™æ€Podï¼ŒåŒ…æ‹¬&quot;kube-apiserver&quot;ï¼Œ&quot;kube-controller-manager&quot;å’Œ&quot;kube-scheduler&quot;[etcd] åˆ›å»ºetcdçš„é™æ€Podï¼Œé»˜è®¤çš„èµ„æºæ¸…å•å­˜æ”¾åœ¨:&quot;&quot;/etc/kubernetes/manifests&quot;[wait-control-plane] ç­‰å¾…kubeletä»èµ„æºæ¸…å•ç›®å½•&quot;/etc/kubernetes/manifests&quot;å¯åŠ¨é™æ€Podã€‚[apiclient]ç­‰å¾…æ‰€æœ‰çš„masterç»„ä»¶æ­£å¸¸è¿è¡Œã€‚[upload-config] åˆ›å»ºåä¸º&quot;kubeadm-config&quot;çš„ConfigMapåœ¨&quot;kube-system&quot;åç§°ç©ºé—´ä¸­ã€‚[kubelet] åˆ›å»ºåä¸º&quot;kubelet-config-1.22&quot;çš„ConfigMapåœ¨&quot;kube-system&quot;åç§°ç©ºé—´ä¸­ï¼Œå…¶ä¸­åŒ…å«é›†ç¾¤ä¸­kubeletçš„é…ç½®[upload-certs] è·³è¿‡æ­¤èŠ‚ç‚¹ï¼Œè¯¦æƒ…è¯·å‚è€ƒâ€--upload-certs&quot;[mark-control-plane]æ ‡è®°æ§åˆ¶é¢æ¿ï¼ŒåŒ…æ‹¬æ‰“æ ‡ç­¾å’Œæ±¡ç‚¹ï¼Œç›®çš„æ˜¯ä¸ºäº†æ ‡è®°masterèŠ‚ç‚¹ã€‚[bootstrap-token] åˆ›å»ºtokenå£ä»¤ï¼Œä¾‹å¦‚:&quot;kbkgsa.fc97518diw8bdqid&quot;ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™ä¸ªå£ä»¤å°†æ¥åœ¨åŠ å…¥é›†ç¾¤èŠ‚ç‚¹æ—¶å¾ˆæœ‰ç”¨ï¼Œè€Œä¸”å¯¹äºRBACæ§åˆ¶ä¹Ÿå¾ˆæœ‰ç”¨å¤„å“Ÿã€‚[kubelet-finalize] æ›´æ–°kubeletçš„è¯ä¹¦æ–‡ä»¶ä¿¡æ¯[addons] æ·»åŠ é™„åŠ ç»„ä»¶ï¼Œä¾‹å¦‚:&quot;CoreDNS&quot;å’Œ&quot;kube-proxyâ€</code></pre><p><strong>2 æ‹·è´æˆæƒæ–‡ä»¶ï¼Œç”¨äºç®¡ç†K8Sé›†ç¾¤  åˆå§‹åŒ–æ—¶å€™æœ‰è¿™äº›å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">[root@master231 ~]# <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">[root@master231 ~]# <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure><p><strong>3 æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 ~]# kubectl get cs</span><br><span class="line">Warning: v1 ComponentStatus is deprecated <span class="keyword">in</span> v1.19+</span><br><span class="line">NAME                 STATUS    MESSAGE                         ERROR</span><br><span class="line">controller-manager   Healthy   ok                              </span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">&quot;health&quot;</span>:<span class="string">&quot;true&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;&quot;</span>&#125;   </span><br><span class="line">scheduler            Healthy   ok                              </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master231 ~]# kubectl get nodes</span><br><span class="line">NAME        STATUS     ROLES                  AGE    VERSION</span><br><span class="line">master231   NotReady   control-plane,master   117s   v1.23.17</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²workerç»„ä»¶">éƒ¨ç½²workerç»„ä»¶</h2><p><strong>1.åœ¨workerèŠ‚ç‚¹æ‰§è¡ŒåŠ å…¥çš„å‘½ä»¤ ï¼ï¼ï¼ä½¿ç”¨è‡ªå·±åˆå§‹åŒ–è·å¾—çš„å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@worker232 ~]# kubeadm <span class="built_in">join</span> 10.0.0.231:6443 --token 8lutg1.3i6jcp7vgd7gpldl \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:e4a5061043bba6e271c502eb6e3fe80bb3555c8f00e42649e08f3939eacdb459 </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>2.masterèŠ‚ç‚¹æ£€æŸ¥é›†ç¾¤çš„workerèŠ‚ç‚¹åˆ—è¡¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# kubectl get nodes</span><br><span class="line">NAME        STATUS     ROLES                  AGE   VERSION</span><br><span class="line">master231   NotReady   control-plane,master   32m   v1.23.17</span><br><span class="line">worker232   NotReady   &lt;none&gt;                 36s   v1.23.17</span><br><span class="line">worker233   NotReady   &lt;none&gt;                 25s   v1.23.17</span><br></pre></td></tr></table></figure><blockquote><p>æ¸©é¦¨æç¤º:<br>æ­¤æ—¶K8Sç»„ä»¶å°±ç®—éƒ¨ç½²æˆåŠŸäº†ï¼Œä½†æ˜¯å°†æ¥å®¹å™¨çš„ç½‘ç»œä¾æ—§æ²¡æœ‰å‡†å¤‡å°±ç»ªï¼Œå› æ­¤å„èŠ‚ç‚¹å¤„äºâ€œNotReadyâ€çŠ¶æ€ã€‚</p></blockquote><h2 id="éƒ¨ç½²flannelçš„CNIæ’ä»¶">éƒ¨ç½²flannelçš„CNIæ’ä»¶</h2><p>ç¬¦åˆçš„CNIæ’ä»¶åˆ—è¡¨é€‰æ‹©:<br><a href="https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/addons/">https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/addons/</a></p><p>falnnelçš„ç½‘ç«™:<br><a href="https://github.com/flannel-io/flannel#deploying-flannel-manually">https://github.com/flannel-io/flannel#deploying-flannel-manually</a></p><p><strong>1.æ‰€æœ‰èŠ‚ç‚¹ä¸‹è½½Flannelç»„ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master231:1 ~]#  wget https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ²¡æœ‰é­”æ³•æ¯”è¾ƒæ…¢</span></span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹Podçš„ç½‘æ®µå³å¯ã€‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å°†10.244.0.0/16æ”¹ä¸º10.100.0.0/16  è¯¦æƒ…è§falnnelå®˜æ–¹</span></span><br><span class="line">...</span><br><span class="line">  net-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;10.100.0.0/16&quot;</span>,</span><br><span class="line">      <span class="string">&quot;EnableNFTables&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;Backend&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;vxlan&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>3.å®‰è£…Flannelç»„ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# kubectl apply -f kube-flannel.yml </span><br><span class="line">namespace/kube-flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.apps/kube-flannel-ds created</span><br></pre></td></tr></table></figure><p><strong>4.æ£€æŸ¥falnnelå„ç»„ä»¶æ˜¯å¦å®‰è£…æˆåŠŸ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# kubectl get pod -o wide -n kube-flannel</span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-flannel-ds-7mchd   1/1     Running   0          20s   10.0.0.232   worker232   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-ccwl7   1/1     Running   0          20s   10.0.0.231   master231   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-wzzq9   1/1     Running   0          20s   10.0.0.233   worker233   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">`åœ¨åˆå§‹åŒ–å®¹å™¨ï¼Œä¸å¯èƒ½é©¬ä¸Šå°±æ˜¯runningçŠ¶æ€ï¼Œç­‰å¾…ä¸€ä¼šæŸ¥çœ‹`</span><br></pre></td></tr></table></figure><p><strong>5.æµ‹è¯•å„èŠ‚ç‚¹ç»„ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# kubectl get nodes</span><br><span class="line">NAME        STATUS   ROLES                  AGE   VERSION</span><br><span class="line">master231   Ready    control-plane,master   58m   v1.23.17</span><br><span class="line">worker232   Ready    &lt;none&gt;                 26m   v1.23.17</span><br><span class="line">worker233   Ready    &lt;none&gt;                 25m   v1.23.17</span><br></pre></td></tr></table></figure><p><strong>6.æ£€æŸ¥flannel.1ç½‘å¡æ˜¯å¦å­˜åœ¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master231 ~]# ifconfig </span><br><span class="line">cni0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.100.0.1  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::7498:efff:fe86:d4bc  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 3a:28:99:ca:1f:85  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 2  bytes 164 (164.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">...</span><br><span class="line">flannel.1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.100.0.0  netmask 255.255.255.255  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::d88c:e5ff:fe0f:b4ba  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether da:8c:e5:0f:b4:ba  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 33 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master232 ~]# ifconfig </span><br><span class="line">cni0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.100.1.1  netmask 255.255.255.0  broadcast 10.100.1.255</span><br><span class="line">        inet6 fe80::3828:99ff:feca:1f85  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 3a:28:99:ca:1f:85  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 30  bytes 4343 (4.3 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">...</span><br><span class="line">flannel.1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.100.1.0  netmask 255.255.255.255  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::4846:2dff:fe52:2307  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 4a:46:2d:52:23:07  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master233 ~]# ifconfig </span><br><span class="line">cni0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.100.2.1  netmask 255.255.255.0  broadcast 10.100.2.255</span><br><span class="line">        inet6 fe80::3828:99ff:feca:1f85  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 3a:28:99:ca:1f:85  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 514  bytes 43908 (43.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 534  bytes 68678 (68.6 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">...</span><br><span class="line">flannel.1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">        inet 10.100.2.0  netmask 255.255.255.255  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::17:21ff:fe24:c641  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 02:17:21:24:c6:41  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 32 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><p><strong>7.fannelç½‘å¡cni0ç½‘å¡ç¼ºå¤±</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1é—®é¢˜æè¿°</span><br><span class="line">éƒ¨åˆ†èŠ‚ç‚¹ä¸å­˜åœ¨cni0ç½‘ç»œè®¾å¤‡ï¼Œä»…æœ‰flannel.1è®¾å¤‡ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»ºcni0ç½‘æ¡¥è®¾å¤‡ï¼Œä½†æ˜¯æ³¨æ„ç½‘æ®µè¦ä¸€è‡´ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ‰‹åŠ¨åˆ›å»ºcni0ç½‘å¡</span><br><span class="line">---&gt; å‡è®¾ master231çš„flannel.1æ˜¯10.100.0.0ç½‘æ®µã€‚</span><br><span class="line">ip <span class="built_in">link</span> add cni0 <span class="built_in">type</span> bridge</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev cni0 up</span><br><span class="line">ip addr add 10.100.0.1/24 dev cni0</span><br><span class="line"></span><br><span class="line">---&gt; å‡è®¾ worker232çš„flannel.1æ˜¯10.100.1.0ç½‘æ®µã€‚</span><br><span class="line">ip <span class="built_in">link</span> add cni0 <span class="built_in">type</span> bridge</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev cni0 up</span><br><span class="line">ip addr add 10.100.2.1/24 dev cni0</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯Podçš„CNIç½‘ç»œæ˜¯å¦æ­£å¸¸">éªŒè¯Podçš„CNIç½‘ç»œæ˜¯å¦æ­£å¸¸</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ç¼–å†™Podèµ„æºæ¸…å•</span></span><br><span class="line">[root@master231 ~]# <span class="built_in">cat</span> &gt; network-cni-test.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: xiuxian-v1</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  nodeName: worker232</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - image: registry.cn-hangzhou.aliyuncs.com/yinzhengjie-k8s/apps:v1 </span></span><br><span class="line"><span class="string">    name: xiuxian</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: xiuxian-v2</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  nodeName: worker233</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - image: registry.cn-hangzhou.aliyuncs.com/yinzhengjie-k8s/apps:v2</span></span><br><span class="line"><span class="string">    name: xiuxian</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.åˆ›å»ºPodèµ„æº</span></span><br><span class="line">[root@master231 ~]# kubectl apply -f network-cni-test.yaml</span><br><span class="line">pod/xiuxian-v1 created</span><br><span class="line">pod/xiuxian-v2 created</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æŸ¥çœ‹Podèµ„æºä½ åˆ—è¡¨</span></span><br><span class="line">[root@master231 ~]# kubectl get pods -o wide</span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">xiuxian-v1   1/1     Running   0          11s   10.100.1.2   worker232   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">xiuxian-v2   1/1     Running   0          11s   10.100.2.4   worker233   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">4.è®¿é—®worker232èŠ‚ç‚¹çš„æœåŠ¡</span><br><span class="line">[root@master231 ~]# curl 10.100.1.2 </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;yinzhengjie apps v1&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">       div img &#123;</span><br><span class="line">          width: 900px;</span><br><span class="line">          height: 600px;</span><br><span class="line">          margin: 0;</span><br><span class="line">       &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1 style=<span class="string">&quot;color: green&quot;</span>&gt;å‡¡äººä¿®ä»™ä¼  v1 &lt;/h1&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;img src=<span class="string">&quot;1.jpg&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line">[root@master231 ~]# </span><br><span class="line">[root@master231 ~]# curl  10.100.2.4</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;yinzhengjie apps v2&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">       div img &#123;</span><br><span class="line">          width: 900px;</span><br><span class="line">          height: 600px;</span><br><span class="line">          margin: 0;</span><br><span class="line">       &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1 style=<span class="string">&quot;color: red&quot;</span>&gt;å‡¡äººä¿®ä»™ä¼  v2 &lt;/h1&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;img src=<span class="string">&quot;2.jpg&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="kubectlè‡ªåŠ¨è¡¥å…¨">kubectlè‡ªåŠ¨è¡¥å…¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install bash-completion</span><br><span class="line">å¦‚æœæ‚¨çš„ç³»ç»Ÿä¸­æ²¡æœ‰å¯ç”¨ bash-completionï¼Œæ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹å‘½ä»¤æ¥å¯ç”¨å®ƒï¼š</span><br><span class="line">echo &quot;if [ -f /etc/bash_completion ]; then . /etc/bash_completion; fi&quot; &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">[root@master231 ~]# kubectl completion bash &gt; ~/.kube/completion.bash.inc</span><br><span class="line">[root@master231 ~]# echo source &#x27;$HOME/.kube/completion.bash.inc&#x27; &gt;&gt; ~/.bashrc </span><br><span class="line">[root@master231 ~]# source ~/.bashrc </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">åŸºäºkubeadméƒ¨ç½²k8sé›†ç¾¤</summary>
    
    
    
    
    <category term="k8s" scheme="https://lukme.top/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8sæ¦‚è¿°</title>
    <link href="https://lukme.top/posts/c470e553.html"/>
    <id>https://lukme.top/posts/c470e553.html</id>
    <published>2024-12-01T02:33:13.000Z</published>
    <updated>2025-01-21T13:36:54.938Z</updated>
    
    <content type="html"><![CDATA[<h2 style="text-align:center">Kubernetesä»‹ç»</h2><ul><li>Kuberneteså’Œdockerçš„ç®€å²ç²¾ç®€ç‰ˆ<ul><li>2013å¹´dockerå¼€æºï¼ŒITç•Œçš„ç¦éŸ³ï¼Œå¤‡å—å…³æ³¨</li><li>2014.06 Googleæœ‰15å¹´çš„å®¹å™¨ç¼–æ’Borg(åšæ ¼ï¼Œå•†ä¸šäº§å“)ä½¿ç”¨ç»éªŒï¼Œå¹¶å°†K8S(åŸºäºborgç³»ç»Ÿä½¿ç”¨goè¯­è¨€ç ”å‘)åº•å±‚åŸºäºdockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶å¼€æº</li><li>2014.12 docker incå…¬å¸æ¨å‡ºäº†K8Sç«å“ï¼Œdocker swarm</li><li>Google kubernets vs docker inc swarm ã€3å¹´å¯¹æŠ—èµ›ã€‘ 2017å¹´å¹´åº•ç»“æŸï¼Œk8så®Œèƒœã€‚ï¼ˆk8s 72% vs swarm %13ï¼‰<ul><li>2014 coreOS å…¬å¸æ¨å‡ºäº†rktå®¹å™¨ç®¡ç†å·¥å…·å¹¶ç«™é˜ŸK8S</li><li>2015 Googleå…¬å¸å°†K8Så¼€æºå¹¶è´¡çŒ®ç»™äº†CNCFç»„ç»‡ï¼Œæˆä¸ºè¯¥ç»„ç»‡çš„ç¬¬ä¸€ä¸ªæ¯•ä¸šé¡¹ç›®ã€‚</li><li>2015 docker incå…¬å¸æ¨å‡ºäº†OCIæè®®ï¼Œä¸»è¦é’ˆå¯¹å®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒè§„èŒƒï¼Œå¹¶å¼€æºäº†runcã€‚</li><li>2016 Googleæ¨å‡ºäº†CRIè§„èŒƒï¼Œç›®å‰å¸‚é¢ä¸Šæ²¡æœ‰ä»»ä½•äº§å“å¯ä»¥æ»¡è¶³ï¼Œäºæ˜¯å°±å¼€æºäº†docker-shimç»„ä»¶ï¼ˆä¼šè°ƒç”¨dockeræ¥å£å¹¶æ»¡è¶³criè§„èŒƒï¼‰æ”¯æŒCRIæ¥å£;</li><li>2016ï¼ŒRedHatå…¬å¸åŸºäºcri-oï¼ˆæ—¢ç¬¦åˆCRIä¹Ÿç¬¦åˆOCIè§„èŒƒï¼‰å¼€å‘æ¡†æ¶è®©rktå®¹å™¨ç®¡ç†å·¥å…·æ”¯æŒCRIæ¥å£;</li><li>2017ï¼Œdocker incå…¬å¸å°†containerdä»docker engineå‰¥ç¦»ï¼Œå¹¶å°†containerdå¼€æºç»™äº†CNCFç»„ç»‡ï¼Œ<ul><li>containerdåº•å±‚è°ƒç”¨runcï¼Œå› æ­¤è¯¥äº§å“æ˜¯æ”¯æŒOCIæè®®çš„;</li><li>containerdç»„ä»¶æœ¬èº«ä¸æ”¯æŒCRIï¼Œå› æ­¤ç¤¾åŒºå¤§ä½¬ä»¬ï¼ˆåŒ…å«å›½å†…å¤–ï¼‰é›†ä½“å¼€å‘cri-containerdç»„ä»¶ï¼Œæœ€ååˆå¹¶åˆ°containerdé¡¹ç›®</li></ul></li></ul></li><li>2018 å¹´å›½å†…å¼€å§‹æµç¨‹K8Sï¼Œå„å¤§äº‘å‚å•†å·²ç»å¼€å§‹å¤§è§„æ¨¡ä½¿ç”¨K8Sé›†ç¾¤ï¼Œ<ul><li>é˜¿é‡Œäº‘çš„ACKçš„SAASäº§å“</li><li>è…¾è®¯äº‘çš„TKEçš„SAASäº§å“</li><li>åä¸ºäº‘çš„CCEçš„SAASäº§å“</li><li>ucloudçš„UK8Sçš„SAASäº§å“</li><li>äºšé©¬é€Šçš„Amazon EKSçš„SAASäº§å“</li><li>äº¬ä¸œäº‘ï¼Œç™¾åº¦äº‘ç­‰</li></ul></li><li>2018å¹´ï¼ŒcoreOSå…¬å¸è¢«Redhatä»¥2.5äº¿ç¾å…ƒæ”¶è´­ã€‚</li><li>2018å¹´10æœˆ29æ—¥ï¼ŒIBMå®£å¸ƒä»¥340äº¿ç¾å…ƒçš„ä»·æ ¼æ”¶è´­Red Hatã€‚<ul><li>æ›¾ç»ä¸€åº¦ï¼ŒDockeræ–¹é¢çš„ç‚’ä½œéå¸¸çŒ›ã€‚</li><li>Dockerä»Greylock Partnersã€Insight Partnerså’Œçº¢æ‰èµ„æœ¬ç­‰å¤§ç‰ŒæŠ•èµ„è€…å¤„ç­¹èµ„è¶…è¿‡2.7äº¿ç¾å…ƒï¼Œ</li><li>2018å¹´ä¼°å€¼è¾¾åˆ°æœ€é«˜å³°ï¼š13.2äº¿ç¾å…ƒã€‚</li></ul></li><li>2019å¹´2ï¼ŒDockerä¸€åˆ†ä¸ºäºŒï¼Œå°†ä¼ä¸šä¸šåŠ¡å‡ºå”®ç»™äº†äº‘å’¨è¯¢å…¬å¸Mirantisï¼ˆå¯¹äºOpenStackä»£ç è´¡çŒ®é‡éå¸¸å¤§ï¼Œèƒ½æ’åˆ°å‰3ï¼‰ã€‚</li><li>2020å¹´ï¼ŒGoogleå®£å¸ƒK8Så°†åœ¨1.22+ç‰ˆæœ¬åå¼ƒç”¨dockerå®¹å™¨è¿è¡Œæ—¶ï¼Œå½“æ—¶å¹´åº•å‘å¸ƒçš„æœ€æ–°ç‰ˆæ˜¯1.20.X;</li><li>2020å¹´3æœˆ11æ—¥å…¬å¸ƒçš„ï¼Œå½“æ—¶Dockerå®£å¸ƒè¢«äº‘è®¡ç®—è½¯ä»¶å·¨å¤´å¾®è½¯ï¼ˆMicrosoftï¼‰ä»¥ 6.7äº¿ç¾å…ƒæ”¶è´­ã€‚</li><li>2021å¹´åº• K8S 1.23çš„RCç‰ˆæœ¬å‘å¸ƒ;</li><li>2022å¹´åˆï¼ŒK8S 1.24æ¨ªç©ºå‡ºä¸–ï¼Œç›´æ¥å°†docker-shimç»„ä»¶ç§»é™¤ï¼Œè€Œæ˜¯ä½¿ç”¨containerdä½œä¸ºå®¹å™¨è¿è¡Œæ—¶;</li><li>2023å¹´åˆï¼ŒK8S 1.27.Xå‘å¸ƒ;</li><li>2023å¹´3æœˆï¼ŒK8S 1.23.17 å‘å¸ƒäº†æœ€åä¸€ä¸ªæ”¯æŒdocker-shimçš„ç‰ˆæœ¬ã€‚<ul><li>dockerå’ŒMirantiså…¬å¸ä½œä¸ºåˆä½œä¼™ä¼´ï¼Œå°†ç»´æŠ¤è¯¥é¡¹ç›®ï¼Œè¿ç»´å°ä¼™ä¼´å¦‚æœéœ€è¦åœ¨K8S 1.24åŠä»¥åçš„ç‰ˆæœ¬ä½¿ç”¨dockerçš„è¯ï¼Œéœ€è¦å•ç‹¬cri-dockerç»„ä»¶ã€‚</li></ul></li><li>2024å¹´åˆï¼ŒK8S 1.30.xç‰ˆæœ¬å‘å¸ƒ</li></ul></li></ul><p>å®˜æ–¹æ–‡æ¡£:<br><a href="https://kubernetes.io/zh-cn/">https://kubernetes.io/zh-cn/</a></p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨K8S">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨K8S</h2><pre><code>- 1.å®ƒå°†ç»„æˆåº”ç”¨ç¨‹åºçš„å®¹å™¨ç»„åˆæˆé€»è¾‘å•å…ƒï¼Œä»¥ä¾¿äºç®¡ç†å’ŒæœåŠ¡å‘ç°ã€‚Kubernetes æºè‡ªGoogle 15 å¹´ç”Ÿäº§ç¯å¢ƒçš„è¿ç»´ç»éªŒï¼ŒåŒæ—¶å‡èšäº†ç¤¾åŒºçš„æœ€ä½³åˆ›æ„å’Œå®è·µã€‚- 2.Google æ¯å‘¨è¿è¡Œæ•°åäº¿ä¸ªå®¹å™¨ï¼ŒKubernetes åŸºäºä¸ä¹‹ç›¸åŒçš„åŸåˆ™æ¥è®¾è®¡ï¼Œèƒ½å¤Ÿåœ¨ä¸æ‰©å¼ è¿ç»´å›¢é˜Ÿçš„æƒ…å†µä¸‹è¿›è¡Œè§„æ¨¡æ‰©å±•ã€‚- 3.æ— è®ºæ˜¯æœ¬åœ°æµ‹è¯•ï¼Œè¿˜æ˜¯è·¨å›½å…¬å¸ï¼ŒKubernetes çš„çµæ´»æ€§éƒ½èƒ½è®©ä½ åœ¨åº”å¯¹å¤æ‚ç³»ç»Ÿæ—¶å¾—å¿ƒåº”æ‰‹ã€‚- 4.Kubernetesæ˜¯å¼€æºç³»ç»Ÿï¼Œå¯ä»¥è‡ªç”±åœ°éƒ¨ç½²åœ¨ä¼ä¸šå†…éƒ¨ï¼Œç§æœ‰äº‘ã€æ··åˆäº‘æˆ–å…¬æœ‰äº‘ï¼Œè®©æ‚¨è½»æ¾åœ°åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚</code></pre><h2 id="kubernetesç»„ä»¶">kubernetesç»„ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.master èŠ‚ç‚¹</span><br><span class="line">etcdï¼š              æ•´ä¸ªé›†ç¾¤çš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨K8Sè¯·æ±‚æ•°æ®æ‰€æœ‰çš„æ•°æ®ã€‚ä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€</span><br><span class="line">Controller managerï¼šè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰</span><br><span class="line">Schedulerï¼š         è´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Š;</span><br><span class="line">API Serverï¼š        æä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯å†…éƒ¨ç»„ä»¶éƒ½å¿…é¡»é€šè¿‡å®ƒæ¥è®¿é—®</span><br><span class="line">2.nodeèŠ‚ç‚¹</span><br><span class="line">kubeletï¼š           è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†;</span><br><span class="line">kube-proxyï¼š        è´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼›</span><br><span class="line">podï¼š               æ˜¯K8Sä¸­æœ€å°å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒï¼Œå¯åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨ç­‰èµ„æºã€‚</span><br><span class="line">Container Runtime   å®¹å™¨è¿è¡Œæ—¶ï¼Œè´Ÿè´£è¿è¡Œå®¹å™¨ï¼Œå¦‚Dockerã€containerdã€CRI-Oç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>1.Scheduler:</strong><br>kube-scheduleræ ¹æ®è°ƒåº¦ç®—æ³•ä¸ºæ–°åˆ›å»ºçš„Podé€‰æ‹©ä¸€ä¸ªNodeèŠ‚ç‚¹ï¼Œå¯ä»¥ä»»æ„éƒ¨ç½²ï¼Œå¯ä»¥éƒ¨ç½²åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚</p><p><strong>2.Controller Manager:</strong><br>Kube-controller-managerï¼Œå¤„ç†é›†ç¾¤ä¸­å¸¸è§„åå°ä»»åŠ¡ï¼Œä¸€ä¸ªèµ„æºå¯¹åº”ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè€ŒControllerManagerå°±æ˜¯è´Ÿè´£ç®¡ç†è¿™äº›æ§åˆ¶å™¨çš„ã€‚</p><p><strong>3.Cloud Controller Manager:</strong><br>ç”¨åœ¨äº‘å¹³å°ä¸Šçš„Kube-controller-managerç»„ä»¶ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ç‰©ç†æœºä¸Šéƒ¨ç½²çš„è¯ï¼Œå¯ä»¥ä¸ä½¿ç”¨è¯¥ç»„ä»¶ã€‚</p><p><strong>4.API Server:</strong><br>kube-apiserverï¼Œé›†ç¾¤çš„ç»Ÿä¸€å…¥å£ï¼Œå„ç»„ä»¶åè°ƒè€…ï¼Œä»¥RESTFUL APIæä¾›æ¥å£æœåŠ¡ï¼Œæ‰€æœ‰å¯¹è±¡èµ„æºçš„å¢åˆ æ”¹æŸ¥å’Œç›‘å¬æ“ä½œéƒ½äº¤ç»™APIServerå¤„ç†åå†æäº¤ç»™etcdå­˜å‚¨ã€‚</p><p><strong>5.Etcd:</strong><br>åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œç”¨äºä¿å­˜é›†ç¾¤çŠ¶æ€å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚Podï¼ŒServiceç­‰å¯¹è±¡ä¿¡æ¯ã€‚è¿™ä¸ªæ•°æ®åº“æ˜¯å¯ä»¥å•ç‹¬æ‹¿å‡ºæ¥éƒ¨ç½²ï¼Œåªéœ€è¦API serverå¯ä»¥è¿æ¥åˆ°è¯¥åˆ†å¸ƒå¼æ•°æ®åº“é›†ç¾¤å³å¯ã€‚</p><p><strong>6.kubelet:</strong><br>å¯ä»¥ç†è§£ä¸ºMasteråœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šçš„Agentï¼Œç®¡ç†æœ¬æœºè¿è¡Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚åˆ›å»ºå®¹å™¨ï¼ŒPodæŒ‚è½½æ•°æ®å·ï¼Œä¸‹è½½secretï¼Œè·å–å®¹å™¨çš„èŠ‚ç‚¹çŠ¶æ€ç­‰å·¥ä½œã€‚kubeletå°†æ¯ä¸€ä¸ªPodè½¬æ¢æˆä¸€ç»„å®¹å™¨ã€‚</p><p><strong>7.kube-proxy:</strong><br>åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šå®ç°Podç½‘ç»œä»£ç†ï¼Œç»´æŠ¤ç½‘ç»œè§„åˆ™å’Œå››å±‚è´Ÿè½½å‡è¡¡å·¥ä½œã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”¨äºè´Ÿè´£Podç½‘ç»œè·¯ç”±ï¼Œç”¨äºå¯¹å¤–æä¾›è®¿é—®çš„å®ç°ã€‚å¯ä»¥æ‰¾åˆ°ä½ å…³å¿ƒçš„é¡¹ç›®æ‰€åœ¨çš„podèŠ‚ç‚¹ã€‚</p><p><strong>8.POD:</strong><br>ç”¨æˆ·åˆ’åˆ†å®¹å™¨çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªPODå¯ä»¥å­˜åœ¨å¤šä¸ªå®¹å™¨ã€‚</p><p>docker/rocket(rktï¼Œå·²åœæ­¢æ”¯æŒ):<br>å®¹å™¨å¼•æ“ï¼Œç”¨äºè¿è¡Œå®¹å™¨ã€‚</p><p>å‚è€ƒé“¾æ¥:<br><a href="https://kubernetes.io/zh/docs/concepts/overview/components/">https://kubernetes.io/zh/docs/concepts/overview/components/</a></p><h2 id="kubernetesä¸‰ç§ç½‘ç»œ">kubernetesä¸‰ç§ç½‘ç»œ</h2><p>Kubernetesçš„ä¸‰ç§ç½‘æ®µè¯´æ˜</p><ul><li><p>K8Så„ç»„ä»¶é€šä¿¡çš„ç½‘ç»œ<br>ä½¿ç”¨æ—¶ç‰©ç†ç½‘å¡ï¼Œé»˜è®¤ç½‘æ®µ: 10.0.0.0/24ã€‚</p></li><li><p>è·¨èŠ‚ç‚¹å®¹å™¨å®ç°é€šä¿¡çš„ç½‘æ®µ:<br>ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ï¼Œå­¦ä¹ ç¯å¢ƒæ¨è: 10.100.0.0/16ã€‚</p><p>ä½†æ˜¯åœ¨è‡ªå®šä¹‰ç½‘æ®µæ—¶ï¼Œè¦è€ƒè™‘å°†æ¥èƒ½å¤Ÿåˆ†ç‰‡çš„IPåœ°å€æ•°é‡ï¼Œ&quot;10.100.0.0/16&quot;æœ€å¤šæœ‰65536ä¸ªIPåœ°å€ã€‚</p><p>å¦‚æœå°†æ¥å®¹å™¨è¿è¡Œçš„æ•°é‡è¶…è¿‡è¯¥è§„æ¨¡æ—¶ï¼Œåº”è¯¥è€ƒè™‘å°†ç½‘æ®µåœ°å€è°ƒå¤§ï¼Œæ¯”å¦‚&quot;10.0.0.0/8&quot;ã€‚</p></li><li><p>Serviceç½‘æ®µï¼š<br>ä¸ºå®¹å™¨æä¾›è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°åŠŸèƒ½ã€‚ä¹Ÿæ˜¯éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„ç½‘æ®µï¼Œæ¯”å¦‚&quot;10.200.0.0/16&quot;æœ€å¤šæœ‰65536ä¸ªIPåœ°å€ã€‚</p><p>åŒç†ï¼Œå¦‚æœè§„æ¨¡è¾ƒå¤§æ—¶ï¼Œåº”è¯¥è€ƒè™‘ç½‘æ®µåˆ†é…çš„é—®é¢˜ã€‚</p></li></ul><h2 id="kubernetesçš„éƒ¨ç½²æ–¹å¼">kubernetesçš„éƒ¨ç½²æ–¹å¼</h2><blockquote><p>1.kubeadméƒ¨ç½²      ç®€å•ï¼Œé€‚åˆæ–°æ‰‹</p><p>2.äºŒè¿›åˆ¶éƒ¨ç½²          ç¹çï¼Œä½†æ˜¯å¯ä»¥è‡ªå®šä¹‰é…ç½®ä¿¡æ¯</p><p>==è¿™é‡Œä½¿ç”¨kubeadméƒ¨ç½²==</p></blockquote><p><strong>äºŒè¿›åˆ¶éƒ¨ç½²å’Œkubeadméƒ¨ç½²çš„åŒºåˆ«ï¼Ÿ</strong></p><ul><li><p>K8Så¸¸è§çš„éƒ¨ç½²æ–¹å¼å¯¹æ¯”åŠCNCFé¡¹ç›®ï¼š</p><ul><li><p>å®˜æ–¹æä¾›</p><ul><li><p>äºŒè¿›åˆ¶éƒ¨ç½²K8Sé›†ç¾¤<br>æ‰‹åŠ¨éƒ¨ç½²K8Så„ä¸ªç»„ä»¶ï¼Œé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨è„šæœ¬åŠè¯ä¹¦ç”Ÿæˆï¼Œkubeconfigæ–‡ä»¶ã€‚<br>å¯¹æ–°æ‰‹ä¸å‹å¥½ï¼Œå°¤å…¶æ˜¯è¯ä¹¦ç®¡ç†ã€‚å¯¹K8Sç©ç†Ÿç»ƒçš„å°ä¼™ä¼´éœ€è¦2å°æ—¶èµ·æ­¥ã€‚</p></li><li><p>kubeadméƒ¨ç½²K8Sé›†ç¾¤<br>æ˜¯å®˜æ–¹æä¾›çš„ä¸€ç§å¿«é€Ÿéƒ¨ç½²K8Så„ç»„ä»¶çš„æ­å»ºï¼Œå¦‚æœé•œåƒå‡†å¤‡å°±ç»ªçš„æƒ…å†µä¸‹ï¼ŒåŸºäºå®¹å™¨çš„æ–¹å¼éƒ¨ç½²ï¼Œæ–°æ‰‹ä¼°è®¡å°±1-2åˆ†é’Ÿéƒ¨ç½²å®Œæˆã€‚</p><p>éœ€è¦æå‰å®‰è£…kubeletï¼Œdockeræˆ–è€…containerdï¼Œkubeadmç»„ä»¶ã€‚</p></li></ul></li><li><p>ç¬¬ä¸‰æ–¹æä¾›çš„éƒ¨ç½²æ–¹å¼ï¼š<br>å›½å†…å…¬å¸:<br>- é’äº‘ç§‘æŠ€ï¼š kubesphere<br>åº•å±‚åŸºäºkubeadmå¿«é€Ÿéƒ¨ç½²K8Sï¼Œæä¾›äº†ä¸°å¯Œçš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ã€‚<br>- kuboard<br>åº•å±‚åŸºäºkubeadmå¿«é€Ÿéƒ¨ç½²K8Sï¼Œæä¾›äº†ä¸°å¯Œçš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ã€‚<br>- kubeasz<br>åº•å±‚åŸºäºäºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²ï¼Œç»“åˆansibleçš„playbookå®ç°çš„å¿«é€Ÿéƒ¨ç½²ç®¡ç†K8Sé›†ç¾¤ã€‚</p><p>å›½å¤–çš„äº§å“:<br>- rancher:<br>å’Œå›½å†…çš„kubesphereå¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯K8Så‘è¡Œå•†ï¼Œæä¾›äº†ä¸°å¯Œçš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ã€‚<br>è¿˜åŸºäºK8Sç ”å‘å‡ºæ¥äº†K3Sï¼Œå·ç§°è½»é‡çº§çš„K8Sã€‚</p><p>äº‘å‚å•†ï¼š<br>- é˜¿é‡Œäº‘ï¼š ACK<br>- è…¾è®¯äº‘ï¼š TKE<br>- åä¸ºäº‘ï¼š CCE<br>- äº¬ä¸œäº‘ï¼š Kubernetes<br>- â€¦</p><p>å…¶ä»–éƒ¨ç½²æ–¹å¼:</p><ul><li>minikube:<br>é€‚åˆåœ¨windowséƒ¨ç½²K8Sï¼Œé€‚åˆå¼€å‘ç¯å¢ƒæ­å»ºçš„ä½¿ç”¨ã€‚ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚</li><li>kind:<br>å¯ä»¥éƒ¨ç½²å¤šå¥—K8Sç¯å¢ƒï¼Œè½»é‡çº§çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚ã€</li><li>yum:<br>ä¸æ¨èï¼Œç‰ˆæœ¬æ”¯æŒè¾ƒä½ï¼Œé»˜è®¤æ˜¯1.5.2ã€‚</li></ul></li></ul></li></ul><p>â€‹CNCFæŠ€æœ¯è“å›¾ï¼š<a href="https://landscape.cncf.io/">https://landscape.cncf.io/</a></p><p>:dango:<strong>K8Sçš„é›†ç¾¤é…ç½®ç¯å¢ƒå‡†å¤‡</strong></p><p>æ¨èé˜…è¯»:<br><a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p><ul><li>æœ¬æœºç¤ºä¾‹ç¯å¢ƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç¯å¢ƒå‡†å¤‡:</span><br><span class="line">ç¡¬ä»¶é…ç½®: 2core 4GB</span><br><span class="line">ç£ç›˜: 50GB+</span><br><span class="line">æ“ä½œç³»ç»Ÿ: Ubuntu 22.04.04 LTS</span><br><span class="line">IPå’Œä¸»æœºå:</span><br><span class="line">10.0.0.231 master231</span><br><span class="line">10.0.0.232 worker232</span><br><span class="line">10.0.0.233 worker233</span><br></pre></td></tr></table></figure><ul><li>Kubernetesçš„ç‰ˆæœ¬é€‰æ‹©</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€‰æ‹©çš„ç‰ˆæœ¬æ˜¯K8S 1.23.17ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬çš„ç¬¬ä¸€ä¸ªrcç‰ˆæœ¬æ˜¯2021å¹´åˆï¼Œæœ€åä¸€ä¸ªç‰ˆæœ¬æ˜¯23å¹´å¹´åˆç»“æŸ</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä»€ä¹ˆæ˜¯k8s</summary>
    
    
    
    
    <category term="k8s" scheme="https://lukme.top/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntuæœ€å°åŒ–å®‰è£…22.04</title>
    <link href="https://lukme.top/posts/91269589.html"/>
    <id>https://lukme.top/posts/91269589.html</id>
    <published>2024-11-28T12:33:13.000Z</published>
    <updated>2025-01-21T13:08:02.297Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœ€å°åŒ–å®‰è£…Ubuntu-Server-22-04">æœ€å°åŒ–å®‰è£…Ubuntu Server 22.04</h2><blockquote><p>å£°æ˜ï¼š</p><p>â€‹æœ¬ç¯‡å›¾ç‰‡å¼•ç”¨äº†csdnä½œè€…æ¨å°ç¾Šã€Šæœ€å°åŒ–å®‰è£…Ubuntu Server 22.04ï¼ˆå›¾æ–‡è¯¦è§£ç‰ˆæœ¬ï¼‰ã€‹ï¼Œè‡ªå·±åœ¨å…¶åŸºç¡€ä¸Šé¢å¤–å½’çº³äº†ä¸€äº›ç³»ç»Ÿä¼˜åŒ–å†…å®¹ï¼Œä»…ä¾›å­¦ä¹ ä½¿ç”¨ï¼Œå¦‚è‹¥ä¾µæƒè”ç³»åˆ é™¤</p></blockquote><h3 id="0-Ubuntu-Serverä¸‹è½½">0.Ubuntu Serverä¸‹è½½</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ubuntu.com/download/server</span><br></pre></td></tr></table></figure><h2 id="1ã€è‡ªå®šä¹‰å®‰è£…è™šæ‹Ÿæœº">1ã€è‡ªå®šä¹‰å®‰è£…è™šæ‹Ÿæœº</h2><p><img src="https://cos.lukme.top/Pic/Ubuntu-01.png" alt="centos ubuntulinux"></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-02.png" alt="02"></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-03.png" alt="03"></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-04.png" alt="04"></p><p><strong>è¿™é‡Œçš„cpuå†…å­˜ç­‰ç¡¬ä»¶è‡ªå®šä¹‰è®¾ç½®ï¼Œåšä¸»æ¯”è¾ƒå–œæ¬¢çš„é…ç½®æ˜¯ 2æ ¸2å†…æ ¸2Gå†…å­˜ï¼Œåé¢å…¶ä»–çš„æ²¡æœ‰æåŠçš„éƒ½é»˜è®¤é…ç½®</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-05.png" alt="05"></p><p><strong>è¿™é‡Œæœ€å¥½ä½¿ç”¨NATç½‘ç»œï¼Œæ–¹ä¾¿åé¢è¿œç¨‹è¿æ¥</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-06.png" alt="06"></p><p><strong>å®Œæˆé…ç½®åç‚¹å‡»ä¸‹é¢çš„CDï¼Œå¼€å§‹è®¾ç½®IOSè·¯å¾„</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-07.png" alt="07"></p><h5 id="å®Œæˆåç¡®è®¤ï¼Œå¼€æœº">å®Œæˆåç¡®è®¤ï¼Œå¼€æœº</h5><h2 id="2ã€Ubuntu-Serveræœ€å°åŒ–å®‰è£…">2ã€Ubuntu Serveræœ€å°åŒ–å®‰è£…</h2><p><img src="https://cos.lukme.top/Pic/Ubuntu-08.png" alt="08"></p><p><strong>é€‰æ‹©ç¬¬ä¸€ä¸ª</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-09.png" alt="09"></p><p><strong>è¿™é‡Œç”±äºæ²¡æœ‰ä¸­æ–‡ï¼Œåªèƒ½é€‰æ‹©è‹±æ–‡</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-10.png" alt="10"></p><p><strong>é€‰æ‹©ç¬¬äºŒä¸ªï¼Œä¸æ›´æ–°</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-11.png" alt="11"></p><p><strong>è¿™é‡Œç›´æ¥å›è½¦ï¼Œé»˜è®¤é…ç½®</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-12.png" alt="12"></p><p><strong>æŒ‰ä¸Šä¸‹é”®ï¼Œåˆ°æœ€å°åŒ–å®‰è£…é‚£ï¼ŒæŒ‰å›è½¦ï¼Œç­‰æœ€å°åŒ–å®‰è£…å‰é¢æ‹¬å·æœ‰ä¸€ä¸ªxæ—¶å€™ï¼Œï¼Œä¸‹é”®åˆ°Doneï¼Œå›è½¦</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-13.png" alt="13"></p><p><img src="C:/Users/Dell/Desktop/Luay_20241203_164511.png" alt="Luay_20241203_164511"></p><p><strong>è¿™é‡Œä¸Šä¸‹é”®ï¼Œé€‰æ‹©é™æ€ipï¼Œè®¾ç½®ens33å’Œens34ï¼Œipå’Œç½‘å…³æ ¹æ®ä½ çš„å®é™…ä¿®æ”¹</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-14.png" alt="14"></p><p><strong>Configure proxyé…ç½®é¡µé¢çš„Proxy addressæ— éœ€é…ç½®ï¼Œç›´æ¥å›è½¦</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-15.png" alt="15"></p><p><strong>è¿™é‡Œè®¾ç½®äº‘æºï¼Œè‡ªå·±è¾“å…¥ä»¥ä¸‹é˜¿é‡Œäº‘çš„æº</strong></p><p>é˜¿é‡Œäº‘æºåœ°å€ï¼š<code>https://mirrors.aliyun.com/ubuntu</code></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-16.png" alt="16"></p><p><strong>é€‰æ‹©å®‰è£…ç£ç›˜ï¼Œç›´æ¥å›è½¦é»˜è®¤è‡ªåŠ¨åˆ†é…ï¼Œéœ€è¦æ‰‹åŠ¨åˆ†åŒºçš„è¯é€‰æ‹© [custom storage layout]</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-17.png" alt="17"></p><p><strong>æ£€æŸ¥ç£ç›˜åˆ†åŒºæ˜¯å¦ç¬¦åˆä½ çš„è¦æ±‚ï¼Œå›è½¦ç»§ç»­</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-18.png" alt="18"></p><p><strong>å†æ¬¡ç¡®è®¤ Continue ç»§ç»­</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-19.png" alt="19"></p><p><strong>è®¾ç½®è®¡ç®—æœºåã€ç”¨æˆ·ååŠå¯†ç </strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-20.png" alt="20"></p><p><strong>æŒ‰ç©ºæ ¼é”®æˆ–è€…å›è½¦ é€‰æ‹©å®‰è£… OpenSSH Server æœåŠ¡</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-21.png" alt="21"></p><p><strong>é€‰æ‹©é¢„ç½®ç¯å¢ƒï¼ŒæŒ‰éœ€é€‰å–ï¼Œè‡ªç”±è€Œå®šï¼Œä¸éœ€è¦åˆ™ç›´æ¥é€‰æ‹©Doneå›è½¦ç»§ç»­</strong>,</p><p><img src="https://cos.lukme.top/Pic/Ubuntu-22.png" alt="22"></p><p><strong>å¼€å§‹å®‰è£…ï¼Œè¿™ä¸ªç¯èŠ‚æœ‰ç‚¹æ…¢ï¼Œéœ€è¦æœ‰ç‚¹è€å¿ƒ,ä¸‹é¢é‚£ä¸ªå°æ¨ªå†è½¬å°±è¯´æ˜åœ¨å®‰è£…ï¼Œåšä¸»ä¹Ÿå®‰è£…äº†åå‡ åˆ†é’Ÿ</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-23.png" alt="23"></p><p><strong>è¿™é‡Œå¯ä»¥å–æ¶ˆæ›´æ–°ï¼Œç›´æ¥é‡å¯ï¼Œæˆ‘ä»¬å¯ä»¥åç»­å†æ›´æ–°ï¼Œä¹Ÿå¯ä»¥ç­‰ä»–æ›´æ–°å®Œï¼Œåšä¸»å»ºè®®ç­‰ä»–æ›´è¡Œå®Œ</strong></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-24.png" alt="24"></p><p><strong>é‡å¯é‡å¯è¿‡ç¨‹ä¸­å¯èƒ½æœ‰çš„åœ°æ–¹ä¼šå¡ä¸€ä¸‹ï¼Œä½ æŒ‰ä¸€ä¸‹å›è½¦å°±å¥½</strong></p><h2 id="3ã€æœåŠ¡å™¨é…ç½®">3ã€æœåŠ¡å™¨é…ç½®</h2><h3 id="ï¼ˆ1ï¼‰è®¾ç½®rootå¯†ç ">ï¼ˆ1ï¼‰è®¾ç½®rootå¯†ç </h3><p>é‡å¯åï¼Œå¼€å¯rootç”¨æˆ·çš„è®¾ç½®ï¼Œè®¾ç½®rootç”¨æˆ·å¯†ç ï¼š<code>sudo passwd root</code></p><p>éœ€è¦å…ˆè¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼Œå†è¾“å…¥éœ€è¦è®¾ç½®çš„rootç”¨æˆ·å¯†ç </p><h3 id="ï¼ˆ2ï¼‰å®‰è£…éœ€è¦çš„å·¥å…·">ï¼ˆ2ï¼‰å®‰è£…éœ€è¦çš„å·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y vim zip net-tools iptables</span><br><span class="line"><span class="built_in">sudo</span> apt-get install inetutils-*ping*</span><br></pre></td></tr></table></figure><h3 id="ï¼ˆ3ï¼‰è®¾ç½®é™æ€ip">ï¼ˆ3ï¼‰è®¾ç½®é™æ€ip</h3><p>â‘ è·å–å½“å‰ip <code>ip addr</code></p><p>â‘¡ç¼–è¾‘ç½‘ç»œæ–‡ä»¶ï¼š<code>sudo vim /etc/netplan/00-installer-config.yaml</code></p><p><img src="https://cos.lukme.top/Pic/Ubuntu-25.png" alt="25"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># This is the network config written by &#x27;subiquity&#x27;</span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:</span><br><span class="line">      addresses:</span><br><span class="line">        - 192.168.10.133/24</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [114.114.114.114, 8.8.8.8]</span><br><span class="line">      routes:</span><br><span class="line">        - to: default</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line">  version: 21.2.3.4.5.6.7.8.9.10.11.12.</span><br></pre></td></tr></table></figure><p>â‘¢é…ç½®ç”Ÿæ•ˆï¼š <code>sudo netplan apply</code></p><p><strong>æ›´æ–°</strong></p><p>ç™»å½•åå¤åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get dist-upgrade</span><br></pre></td></tr></table></figure><h3 id="ï¼ˆ4ï¼‰rootè¿œç¨‹ç™»å½•">ï¼ˆ4ï¼‰rootè¿œç¨‹ç™»å½•</h3><blockquote><p>é»˜è®¤ä¸æ”¯æŒrootè¿œç¨‹ç™»å½•ï¼Œå¦‚æœä½ éœ€è¦å°±æ“ä½œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.ç¼–è¾‘sshé…ç½®æ–‡ä»¶</span><br><span class="line">root@luay:~# vim /etc/ssh/sshd_config</span><br><span class="line">Â·Â·Â·</span><br><span class="line">PermitRootLogin .*  ==ã€‹PermitRootLogin <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">2.é‡å¯æœåŠ¡</span><br><span class="line">root@luay:~# systemctl restart sshd</span><br></pre></td></tr></table></figure><h2 id="4ã€ä¼˜åŒ–">4ã€ä¼˜åŒ–</h2><h3 id="ä¿®æ”¹ç½‘å¡ä¸ºeth0">ä¿®æ”¹ç½‘å¡ä¸ºeth0</h3><blockquote><p>ä¿®æ”¹ä¸å¦çœ‹ä½ ï¼Œä¸å¼ºåˆ¶</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/default/grub</span><br><span class="line">æ‰¾åˆ°GRUB_CMDLINE_LINUX=<span class="string">&quot;&quot;</span></span><br><span class="line">æ”¹ä¸ºGRUB_CMDLINE_LINUX=<span class="string">&quot;net.ifnames=0 biosdevname=0&quot;</span></span><br><span class="line">ç„¶å<span class="built_in">sudo</span> grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"></span><br><span class="line">é‡å¯ç³»ç»Ÿ</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®æ–‡ä»¶é‡Œåå­—ä¿®æ”¹ä¸ºeth0ï¼Œeth1ï¼ˆå¦‚æœä½ æœ‰ç¬¬äºŒå—ç½‘å¡ï¼‰</span></span><br><span class="line">root@luay:~# vim /etc/netplan/00-installer-config.yaml </span><br><span class="line"><span class="comment"># This is the network config written by &#x27;subiquity&#x27;</span></span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:<span class="comment">#==&gt;eth0</span></span><br><span class="line">      addresses:</span><br><span class="line">      - 10.0.0.243/24</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses:</span><br><span class="line">        - 223.5.5.5</span><br><span class="line">        search:</span><br><span class="line">        - 114.114.114.114</span><br><span class="line">      routes:</span><br><span class="line">      - to: default</span><br><span class="line">        via: 10.0.0.254</span><br><span class="line">    ens34:<span class="comment">#==&gt;eth1</span></span><br><span class="line">      addresses:</span><br><span class="line">      - 172.16.1.243/24</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: []</span><br><span class="line">        search: []</span><br><span class="line">      routes:</span><br><span class="line">      - to: default</span><br><span class="line">        via: 10.0.0.254</span><br><span class="line">        </span><br><span class="line">å®Œæˆä¸Šè¿°é…ç½®åæ‰§è¡ŒæŒ‡ä»¤ <span class="built_in">sudo</span> netplan apply  é‡å¯ç½‘å¡</span><br></pre></td></tr></table></figure><h3 id="A-start-job-is-running-for-wait-for-network">A start job is running for wait for network</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@luay ~]# vim /etc/systemd/system/network-online.target.wants/systemd-networkd-wait-online.service </span><br><span class="line">Â·Â·Â·</span><br><span class="line">[Service]</span><br><span class="line"><span class="comment"># è®¾ç½®è¶…æ—¶2s</span></span><br><span class="line">TimeoutStartSec=2sec</span><br><span class="line"></span><br><span class="line">é‡å¯reboot</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤è‡ªåŠ¨è¡¥å…¨">å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…bash-completionåŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install bash-completion</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨bash-completion</span></span><br><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br></pre></td></tr></table></figure><h3 id="iptables">iptables</h3><p><strong>å¦‚æœéƒ¨ç½²dockeråº”ç”¨ï¼Œéœ€è¦ç”¨åˆ°iptablesï¼Œå¦åˆ™ä¼šç½‘ç»œæ§åˆ¶å™¨åˆå§‹åŒ–å¤±è´¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Ã— docker.service - linux Docke Engine</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: failed (Result: exit-code) since Thu 2025-01-16 03:21:02 UTC; 9s ago</span><br><span class="line">       Docs: https://docs.docker.com</span><br><span class="line">    Process: 2301 ExecStart=/usr/bin/dockerd (code=exited, status=1/FAILURE)</span><br><span class="line">   Main PID: 2301 (code=exited, status=1/FAILURE)</span><br><span class="line">        CPU: 149ms</span><br><span class="line"></span><br><span class="line">Jan 16 03:21:01 worker233 dockerd[2301]: time=<span class="string">&quot;2025-01-16T03:21:01.641966036Z&quot;</span> level=info msg=<span class="string">&quot;Loading containers: start.&quot;</span></span><br><span class="line">Jan 16 03:21:01 worker233 dockerd[2301]: time=<span class="string">&quot;2025-01-16T03:21:01.643510915Z&quot;</span> level=warning msg=<span class="string">&quot;failed to find iptables&quot;</span> error=<span class="string">&quot;exec: </span></span><br><span class="line"><span class="string">\&quot;iptables\&quot;: executable file not found in <span class="variable">$PATH</span>&quot;</span></span><br><span class="line">Jan 16 03:21:01 worker233 dockerd[2301]: time=<span class="string">&quot;2025-01-16T03:21:01.643999117Z&quot;</span> level=info msg=<span class="string">&quot;stopping event stream following graceful </span></span><br><span class="line"><span class="string">shutdown&quot;</span> error=<span class="string">&quot;context canceled&quot;</span> module=libcontainerd namespace=moby</span><br><span class="line">Jan 16 03:21:01 worker233 dockerd[2301]: time=<span class="string">&quot;2025-01-16T03:21:01.644115308Z&quot;</span> level=info msg=<span class="string">&quot;stopping healthcheck following graceful s</span></span><br><span class="line"><span class="string">hutdown&quot;</span> module=libcontainerd</span><br><span class="line">Jan 16 03:21:01 worker233 dockerd[2301]: time=<span class="string">&quot;2025-01-16T03:21:01.644136371Z&quot;</span> level=info msg=<span class="string">&quot;stopping event stream following graceful </span></span><br><span class="line"><span class="string">shutdown&quot;</span> error=<span class="string">&quot;context canceled&quot;</span> module=libcontainerd namespace=plugins.moby</span><br><span class="line">Jan 16 03:21:02 worker233 dockerd[2301]: time=<span class="string">&quot;2025-01-16T03:21:02.646850683Z&quot;</span> level=warning msg=<span class="string">&quot;grpc: addrConn.createTransport failed </span></span><br><span class="line"><span class="string">to connect to &#123;unix:///var/run/docker/containerd/containerd.sock  &lt;nil&gt; 0 &lt;nil&gt;&#125;. Err :connection error: desc = \&quot;transport: Error while</span></span><br><span class="line"><span class="string"> dialing dial unix:///var/run/docker/containerd/containerd.sock: timeout\&quot;. Reconnecting...&quot;</span> module=grpc</span><br><span class="line">Jan 16 03:21:02 worker233 dockerd[2301]: failed to start daemon: Error initializing network controller: error obtaining controller insta</span><br><span class="line">nce: failed to create NAT chain DOCKER: Iptables not found</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install iptables</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è™šæ‹Ÿæœºæœ€å°åŒ–å®‰è£…Ubuntuç³»ç»Ÿå­¦ä¹ ä½¿ç”¨å›¾æ–‡è¯¦è§£</summary>
    
    
    
    
    <category term="Ubuntu" scheme="https://lukme.top/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>11-Prometheusæ•°æ®è¿œç«¯å­˜å‚¨</title>
    <link href="https://lukme.top/posts/ee6702b0.html"/>
    <id>https://lukme.top/posts/ee6702b0.html</id>
    <published>2024-11-25T03:23:03.000Z</published>
    <updated>2024-12-05T04:38:23.646Z</updated>
    
    <content type="html"><![CDATA[<h2 id="VicoriaMetricsæ¦‚è¿°">VicoriaMetricsæ¦‚è¿°</h2><p>VictoriaMetricsæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç»æµé«˜æ•ˆä¸”å¯æ‰©å±•çš„ç›‘æ§è§£å†³æ–¹æ¡ˆå’Œæ—¶é—´åºåˆ—æ•°æ®åº“ã€‚</p><p>å®˜ç½‘åœ°å€:<br><a href="https://victoriametrics.com/">https://victoriametrics.com/</a></p><p>å®˜æ–¹æ–‡æ¡£:<br><a href="https://docs.victoriametrics.com/">https://docs.victoriametrics.com/</a></p><p>GitHubåœ°å€:<br><a href="https://github.com/VictoriaMetrics/VictoriaMetrics">https://github.com/VictoriaMetrics/VictoriaMetrics</a></p><p>éƒ¨ç½²æ–‡æ¡£:<br><a href="https://docs.victoriametrics.com/quick-start/">https://docs.victoriametrics.com/quick-start/</a></p><h2 id="éƒ¨ç½²victoriametrics">éƒ¨ç½²victoriametrics</h2><p><strong>1. ä¸‹è½½victoriametrics</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# wget https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.16/victoria-metrics-linux-amd64-v1.93.16.tar.gz</span><br></pre></td></tr></table></figure><p>**2. è§£å‹è½¯ä»¶åŒ… **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# tar xf victoria-metrics-linux-amd64-v1.93.16.tar.gz  -C /usr/local/bin/</span><br></pre></td></tr></table></figure><p><strong>3 ç¼–å†™å¯åŠ¨è„šæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# <span class="built_in">cat</span> &gt; /etc/systemd/system/victoria-metrics.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Linux VictoriaMetrics Server</span></span><br><span class="line"><span class="string">Documentation=https://docs.victoriametrics.com/</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStart=/usr/local/bin/victoria-metrics-prod  \</span></span><br><span class="line"><span class="string">   -httpListenAddr=0.0.0.0:8428 \</span></span><br><span class="line"><span class="string">   -storageDataPath=/data/victoria-metrics \</span></span><br><span class="line"><span class="string">   -retentionPeriod=3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">[root@elk02 ~]# systemctl daemon-reload</span><br><span class="line">[root@elk02 ~]# systemctl <span class="built_in">enable</span> --now victoria-metrics.service</span><br><span class="line">[root@elk02 ~]# systemctl status victoria-metrics</span><br></pre></td></tr></table></figure><p><strong>4 æ£€æŸ¥ç«¯å£æ˜¯å¦å­˜æ´»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# ss -ntl | grep 8428</span><br><span class="line">LISTEN 0      4096              0.0.0.0:8428       0.0.0.0:*        </span><br></pre></td></tr></table></figure><p><strong>5 æŸ¥çœ‹webUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.212:8428/</span><br><span class="line">`æ­¤æ—¶ç‚¹åˆ°WebUIæ—¶å€™æœç´¢`<span class="string">&#x27;node_cpu_seconds_total&#x27;</span>  æ˜¯æ²¡æœ‰ä»»ä½•æ•°æ®çš„</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128130653976.png" alt="image-20241128130653976"></p><h2 id="prometheusé…ç½®è¿œç«¯å­˜å‚¨">prometheusé…ç½®è¿œç«¯å­˜å‚¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># åœ¨é¡¶çº§å­—æ®µä¸­é…ç½®VictoriaMetricsåœ°å€</span></span><br><span class="line">remote_write:</span><br><span class="line">  - url: http://10.0.0.212:8428/api/v1/write</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å› ä¸ºä¹‹å‰é…ç½®çš„prometheusçš„å¯åŠ¨è„šæœ¬æŒ‡å®šäº†æ•°æ®å­˜å‚¨ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œä¸ºäº†é¿å…å†²çªï¼Œä¸ä½¿ç”¨systemdæ–¹å¼å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">1.åœæ­¢prometheus</span><br><span class="line">systemctl stop prometheus-server.service </span><br><span class="line"></span><br><span class="line">2.è¿›å…¥prometheuså®‰è£…ç›®å½•</span><br><span class="line">[root@elk02:2 ~]# <span class="built_in">cd</span> /softwares/prometheus-2.53.2.linux-amd64/</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨prometheusï¼ŒæŒ‡å®šä¿®æ”¹è¿‡çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœé…ç½®æ²¡æœ‰é”™è¯¯ï¼Œå°±ä¼šå»è¿æ¥http://10.0.0.212:8428ï¼‰</span><br><span class="line">./prometheus --config.file=<span class="string">&quot;prometheus.yml&quot;</span>  </span><br><span class="line"></span><br><span class="line">4.æŸ¥çœ‹WebUI</span><br><span class="line">http://10.0.0.212:8428/</span><br><span class="line">`æ­¤æ—¶ç‚¹åˆ°WebUIæ—¶å€™æœç´¢`<span class="string">&#x27;node_cpu_seconds_total&#x27;</span> å‘ç°æ•°æ®è¿‡æ¥äº†</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128133415223.png" alt="image-20241128133415223"></p><blockquote><p>æ¸©é¦¨æç¤ºï¼š</p><p>â€‹    å¦‚æœæ­¤æ—¶æ²¡æœ‰æ•°æ®æ¥å…¥ï¼Œå°±ä¸è¦è¿›è¡Œä¸‹é¢æ­¥éª¤äº†ï¼Œä¸ç„¶å°±ä¸€ç›´æ˜¯é”™çš„ï¼Œå‡ºæ•°æ®å°±è¡Œ</p></blockquote><p><strong>4.é…ç½®grafanaçš„æ•°æ®æºåŠURL</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€‰æ‹©æ•°æ®æºè¿˜æ˜¯prometheusï¼Œåå­—åŒºåˆ†ä¸‹ï¼Œåœ°å€æ›´æ¢ä¸‹å°±è¡Œäº†</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128134037207.png" alt="image-20241128134037207"></p><h2 id="éƒ¨ç½²å‚è€ƒè¿æ¥">éƒ¨ç½²å‚è€ƒè¿æ¥</h2><p>å•ç‚¹éƒ¨ç½²å‚è€ƒé“¾æ¥:<br><a href="https://docs.victoriametrics.com/quick-start/#starting-vm-single-from-a-binary">https://docs.victoriametrics.com/quick-start/#starting-vm-single-from-a-binary</a></p><p>é›†ç¾¤éƒ¨ç½²å‚è€ƒé“¾æ¥:<br><a href="https://docs.victoriametrics.com/quick-start/#starting-vm-cluster-from-binaries">https://docs.victoriametrics.com/quick-start/#starting-vm-cluster-from-binaries</a><br><a href="https://docs.victoriametrics.com/cluster-victoriametrics/#architecture-overview">https://docs.victoriametrics.com/cluster-victoriametrics/#architecture-overview</a></p><p>éƒ¨ç½²é›†ç¾¤æ—¶è½¯ä»¶åŒ…è¦ä¸‹è½½å¯¹åº”çš„é›†ç¾¤clusterç‰ˆæœ¬:<br>wget <a href="https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.16/victoria-metrics-linux-amd64-v1.93.16-cluster.tar.gz">https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.16/victoria-metrics-linux-amd64-v1.93.16-cluster.tar.gz</a></p><p>è½¯ä»¶åŒ…ä¼šæä¾›3ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºå¯¹åº”äº†é›†ç¾¤çš„3ä¸ªç»„ä»¶<br>vmstorage:<br>å­˜å‚¨åŸå§‹æ•°æ®ï¼Œå¹¶è¿”å›ç»™å®šæ ‡ç­¾è¿‡æ»¤å™¨åœ¨ç»™å®šæ—¶é—´èŒƒå›´å†…çš„æŸ¥è¯¢æ•°æ®<br>vminsert:<br>æ¥å—æ‘„å…¥çš„æ•°æ®ï¼Œå¹¶æ ¹æ®å¯¹åº¦é‡åç§°åŠå…¶æ‰€æœ‰æ ‡ç­¾çš„ä¸€è‡´æ•£åˆ—åœ¨vmstorageèŠ‚ç‚¹ä¹‹é—´ä¼ æ’­<br>vmselect:<br>é€šè¿‡ä»æ‰€æœ‰é…ç½®çš„vmstorageèŠ‚ç‚¹è·å–æ‰€éœ€æ•°æ®æ¥æ‰§è¡Œä¼ å…¥æŸ¥è¯¢</p><p><strong>é›†ç¾¤éƒ¨ç½²VictoriaMetricsæ¶æ„</strong></p><p><img src="https://cos.lukme.top/Pic/VictoriaMetrics-cluster.png" alt="VictoriaMetricsé›†ç¾¤æ¶æ„å›¾è§£"></p>]]></content>
    
    
    <summary type="html">äº†è§£ä½¿ç”¨ VicoriaMetrics</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>10-Prometheusçš„è”é‚¦æ¨¡å¼</title>
    <link href="https://lukme.top/posts/d10c7e6f.html"/>
    <id>https://lukme.top/posts/d10c7e6f.html</id>
    <published>2024-11-24T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.740Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è”é‚¦æ¨¡å¼é…ç½®">è”é‚¦æ¨¡å¼é…ç½®</h2><p><strong>1.prometheusè”é‚¦æ¨¡å¼æ¶æ„æ¦‚è¿°</strong><br>é»˜è®¤æƒ…å†µä¸‹ï¼Œprometheusé‡‡é›†çš„æ•°æ®ä¼šå­˜å‚¨åˆ°æœ¬åœ°ï¼Œè¿™æ„å‘³è€…prometheusåœ¨è¿™ç§å·¥ä½œæ¨¡å¼ä¸‹ï¼Œå¯èƒ½ä¼šå­˜åœ¨å•æœºå­˜å‚¨çš„ç“¶é¢ˆã€‚ä¸ºäº†è§£å†³prometheuså¯¹äºæ•°æ®çš„é‡‡é›†å‹åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è”é‚¦æ¨¡å¼æ¥éƒ¨ç½²prometheusã€‚</p><blockquote><p>è¿™é‡Œ 91,92,93 èŠ‚ç‚¹åˆ†åˆ«å¯¹åº”æœ¬ç¯‡çš„ 211,212,213 èŠ‚ç‚¹</p></blockquote><p><img src="https://cos.lukme.top/Pic/prometheus-federate.jpg" alt="è”é‚¦æ¨¡å¼Prometheus server"></p><p><strong>2.éƒ¨ç½²Prometheusçš„é›†ç¾¤ç¯å¢ƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">1. 212,213èŠ‚ç‚¹éƒ¨ç½²Prometheus</span><br><span class="line">  ç•¥ï¼Œæ­¥éª¤è§01-Prometheusä»‹ç»åŠéƒ¨ç½²</span><br><span class="line"></span><br><span class="line">`212èŠ‚ç‚¹`</span><br><span class="line">2. 212èŠ‚ç‚¹é…ç½®Prometheus</span><br><span class="line">[root@elk02:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">  - job_name: <span class="string">&#x27;file-sd-discovery-212&#x27;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files:</span><br><span class="line">        - /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml</span><br><span class="line"></span><br><span class="line">3. ç¼–å†™Prometheusçš„åŸºäºæ–‡ä»¶æœåŠ¡çš„å‘ç°</span><br><span class="line">[root@elk02:0 ~]# <span class="built_in">cat</span> &gt; /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">- targets:</span></span><br><span class="line"><span class="string">  - 10.0.0.211:9100</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    &quot;tag&quot;: &quot;elk01&quot;</span></span><br><span class="line"><span class="string">    &quot;apps&quot;: &quot;yaml&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">4. æ£€æŸ¥Prometheusè¯­æ³•</span><br><span class="line">[root@elk02:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">5.Prometheusçƒ­åŠ è½½</span><br><span class="line">[root@elk02:0 ~]# curl -X POST http://10.0.0.212:9090/-/reload</span><br><span class="line"></span><br><span class="line">6.è®¿é—®Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.212:9090/targets?search=</span><br><span class="line"></span><br><span class="line">`213èŠ‚ç‚¹`</span><br><span class="line">1. 213 èŠ‚ç‚¹é…ç½®Prometheus</span><br><span class="line">[root@elk03:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">  - job_name: <span class="string">&#x27;file-sd-discovery-212&#x27;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files:</span><br><span class="line">        - /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml</span><br><span class="line"></span><br><span class="line">2.ç¼–å†™Prometheusçš„åŸºäºæ–‡ä»¶æœåŠ¡çš„å‘ç°</span><br><span class="line">[root@elk03:0 ~]# <span class="built_in">cat</span> &gt; /softwares/prometheus-2.53.2.linux-amd64/file-sd.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">- targets:</span></span><br><span class="line"><span class="string">  - 10.0.0.212:9100</span></span><br><span class="line"><span class="string">  - 10.0.0.213:9100</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    &quot;tag&quot;: &quot;elk02/03&quot;</span></span><br><span class="line"><span class="string">    &quot;apps&quot;: &quot;yaml&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">3. æ£€æŸ¥Prometheusè¯­æ³•</span><br><span class="line">[root@elk03:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">4.Prometheusçƒ­åŠ è½½</span><br><span class="line">[root@elk03:0 ~]# curl -X POST http://10.0.0.213:9090/-/reload</span><br><span class="line"></span><br><span class="line">5.è®¿é—®Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.213:9090/targets?search=</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹211èŠ‚ç‚¹é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk01:0 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">  - job_name: <span class="string">&quot;prometheus-federate-212&quot;</span></span><br><span class="line">    metrics_path: <span class="string">&quot;/federate&quot;</span></span><br><span class="line">    honor_labels: <span class="literal">true</span></span><br><span class="line">    params:</span><br><span class="line">       <span class="string">&quot;match[]&quot;</span>:</span><br><span class="line">       - <span class="string">&#x27;&#123;job=&quot;promethues&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;job:.*&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;node.*&quot;&#125;&#x27;</span></span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.212:9090&quot;</span></span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;prometheus-federate-213&quot;</span></span><br><span class="line">    metrics_path: <span class="string">&quot;/federate&quot;</span></span><br><span class="line">    honor_labels: <span class="literal">true</span></span><br><span class="line">    params:</span><br><span class="line">       <span class="string">&quot;match[]&quot;</span>:</span><br><span class="line">       - <span class="string">&#x27;&#123;job=&quot;promethues&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;job:.*&quot;&#125;&#x27;</span></span><br><span class="line">       - <span class="string">&#x27;&#123;__name__=~&quot;node.*&quot;&#125;&#x27;</span></span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.213:9090&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.æ£€æŸ¥Prometheusè¯­æ³•</span><br><span class="line">3.Prometheusçƒ­åŠ è½½</span><br></pre></td></tr></table></figure><p><strong>4.éªŒè¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">213ä¸Šå¯æŸ¥è¯¢çš„è¯­æ³•ï¼ˆå¯è‡ªè¡Œè®¿é—®212æˆ–è€…213çš„Prometheusçš„WebUIç•Œé¢æ‰¾åˆ°promQLè¯­æ³•æŸ¥è¯¢æ”¾åœ¨211èŠ‚ç‚¹ä¸ŠéªŒè¯ï¼‰</span><br><span class="line">node_cpu_seconds_total&#123;apps=<span class="string">&quot;yaml&quot;</span>, cpu=<span class="string">&quot;0&quot;</span>, job=<span class="string">&quot;file-sd-discovery-213&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">åœ¨211ä¸ŠæŸ¥è¯¢æ˜¯å¦æœ‰ç»“æœ</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241128112719771.png" alt="image-20241128112719771"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Prometheusè”é‚¦æ¨¡å¼ç¼“è§£æ•°æ®é‡‡é›†å‹åŠ›</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>09-Prometheusçš„æœåŠ¡å‘ç°</title>
    <link href="https://lukme.top/posts/86e5bc5f.html"/>
    <id>https://lukme.top/posts/86e5bc5f.html</id>
    <published>2024-11-23T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.739Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœåŠ¡å‘ç°çš„å¸¸è§ç±»åˆ«è¯´æ˜">æœåŠ¡å‘ç°çš„å¸¸è§ç±»åˆ«è¯´æ˜</h2><pre><code>- é™æ€é…ç½®ï¼š static_configsæ¯æ¬¡ä¿®æ”¹é…ç½®åï¼Œéƒ½éœ€è¦é‡æ–°åŠ è½½é…ç½®æˆ–è€…é‡å¯æœåŠ¡ã€‚- åŠ¨æ€é…ç½®æ¯æ¬¡ä¿®æ”¹åï¼Œæ— éœ€é‡æ–°åŠ è½½é…ç½®æˆ–è€…é‡å¯æœåŠ¡ã€‚å¸¸è§çš„åŠ¨æ€é…ç½®:&lt;file_sd_config&gt;åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#file_sd_config&lt;consul_sd_config&gt;åŸºäºconsulçš„æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#consul_sd_config&lt;kubernetes_sd_config&gt;åŸºäºK8Så®ç°çš„æœåŠ¡å‘ç°https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#kubernetes_sd_config&lt;dns_sd_config&gt;:åŸºäºDNSå®ç°æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#dns_sd_config&lt;docker_sd_config&gt;ï¼šåŸºäºdocker engineçš„æœåŠ¡å‘ç°https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#docker_sd_config&lt;http_sd_config&gt;ï¼šåŸºäºhttpçš„æœåŠ¡å‘ç°ã€‚https://prometheus.io/docs/prometheus/2.53/configuration/configuration/#http_sd_config</code></pre><h2 id="åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°">åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°</h2><p><strong>1.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">...</span><br><span class="line">  - job_name: <span class="string">&quot;linux-file-sd-config&quot;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">     - files:</span><br><span class="line">        -  /softwares/prometheus-2.53.2.linux-amd64/test.yaml</span><br><span class="line">        -  /softwares/prometheus-2.53.2.linux-amd64/test.json</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶è®¿é—®Prometheusçš„webuiï¼Œå‘ç°æ²¡æœ‰æ˜¾ç¤ºæ–°çš„æœåŠ¡</span><br><span class="line">http://10.0.0.211:9090/targets</span><br></pre></td></tr></table></figure><p><strong>2.ç¼–è¾‘æœåŠ¡å‘ç°æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">`yamlæ ¼å¼ï¼š`</span><br><span class="line">[root@elk01:5 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/test.yaml</span><br><span class="line">- targets:</span><br><span class="line">    - 10.0.0.213:9100</span><br><span class="line">    - 10.0.0.211:9100</span><br><span class="line">    - 10.0.0.212:3000</span><br><span class="line">    </span><br><span class="line">`jsonæ ¼å¼`</span><br><span class="line">[root@elk01:5 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/test.json</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;targets&quot;</span>: [ <span class="string">&quot;10.0.0.211:9100&quot;</span>,<span class="string">&quot;10.0.0.212:9100&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>3.æµ‹è¯•éªŒè¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶ä¿å­˜åç›´æ¥è®¿é—®webUIï¼Œå³å¯å‘ç°å°±å¯ä»¥æ˜¾ç¤ºäº†ï¼Œä¸éœ€è¦çƒ­åŠ è½½Prometheus</span><br><span class="line">http://10.0.0.211:9090/targets</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127135024922.png" alt="image-20241127135024922"></p><h2 id="åŸºäºæ–‡ä»¶å‘ç°å’ŒåŸºäºconsulå¯¹æ¯”">åŸºäºæ–‡ä»¶å‘ç°å’ŒåŸºäºconsulå¯¹æ¯”</h2><p>åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°æ˜¯åœ¨Prometheusæœ¬åœ°åŸºäºæŸä¸ªæ–‡ä»¶è¯»å–è¦ç›‘æ§çš„èŠ‚ç‚¹;</p><p>åŸºäºconsulæœåŠ¡å‘ç°æ˜¯éœ€è¦å•ç‹¬éƒ¨ç½²ä¸€å¥—consulé›†ç¾¤ï¼ŒPrometheus-serverå»å¯¹åº”çš„consulé›†ç¾¤è·å–éœ€è¦ç›‘æ§çš„èŠ‚ç‚¹ã€‚</p><h2 id="éƒ¨ç½²åŸºäºconsoleçš„æœåŠ¡å‘ç°">éƒ¨ç½²åŸºäºconsoleçš„æœåŠ¡å‘ç°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1 ä¸‹è½½consul</span><br><span class="line">wget https://releases.hashicorp.com/consul/1.19.2/consul_1.19.2_linux_amd64.zip</span><br><span class="line"></span><br><span class="line">2 è§£å‹consul</span><br><span class="line">unzip consul_1.19.2_linux_amd64.zip -d /usr/local/bin/</span><br><span class="line"></span><br><span class="line">3 è¿è¡Œconsul é›†ç¾¤</span><br><span class="line">æœåŠ¡ç«¯211:</span><br><span class="line">consul agent -server -bootstrap -<span class="built_in">bind</span>=10.0.0.211 -data-dir=/data/consul -client=10.0.0.211 -ui</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯212:</span><br><span class="line">consul agent  -<span class="built_in">bind</span>=10.0.0.212 -data-dir=/data/consul -client=10.0.0.212 -ui -retry-join=10.0.0.211</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯213:</span><br><span class="line">consul agent -server -<span class="built_in">bind</span>=10.0.0.213 -data-dir=/data/consul -client=10.0.0.213 -ui -retry-join=10.0.0.211</span><br><span class="line"></span><br><span class="line">4 æŸ¥çœ‹å„èŠ‚ç‚¹çš„ç›‘å¬ç«¯å£</span><br><span class="line">ss -ntl | grep 8500</span><br><span class="line"></span><br><span class="line">5 è®¿é—®consoleæœåŠ¡çš„WebUI</span><br><span class="line">http://10.0.0.213:8500/ui/dc1/nodes</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127144212517.png" alt="image-20241127144212517"></p><h2 id="åŸºäºconsulçš„æœåŠ¡å‘ç°åº”ç”¨">åŸºäºconsulçš„æœåŠ¡å‘ç°åº”ç”¨</h2><p><strong>1 ä¿®æ”¹prometheusçš„é…ç½®æ–‡ä»¶å¹¶é‡æ–°åŠ è½½é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">  ...</span><br><span class="line">  - job_name: <span class="string">&quot;Linux-consul-seriver-discovery&quot;</span></span><br><span class="line">    <span class="comment"># é…ç½®åŸºäºconsulçš„æœåŠ¡å‘ç°</span></span><br><span class="line">    consul_sd_configs:</span><br><span class="line">        <span class="comment"># æŒ‡å®šconsulçš„æœåŠ¡å™¨åœ°å€ï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤å€¼ä¸º&quot;localhost:8500&quot;.</span></span><br><span class="line">      - server: 10.0.0.213:8500</span><br><span class="line">      - server: 10.0.0.212:8500</span><br><span class="line">      - server: 10.0.0.211:8500</span><br><span class="line">    relabel_configs:</span><br><span class="line">        <span class="comment"># åŒ¹é…consulçš„æºæ ‡ç­¾å­—æ®µï¼Œè¡¨ç¤ºæœåŠ¡åç§°</span></span><br><span class="line">      - source_labels: [__meta_consul_service]</span><br><span class="line">        <span class="comment"># æŒ‡å®šæºæ ‡ç­¾çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè‹¥ä¸å®šä¹‰ï¼Œé»˜è®¤å€¼ä¸º&quot;(.*)&quot;</span></span><br><span class="line">        regex: consul</span><br><span class="line">        <span class="comment"># æ‰§è¡ŒåŠ¨ä½œä¸ºåˆ é™¤ï¼Œé»˜è®¤å€¼ä¸º&quot;replace&quot;,æœ‰æ•ˆå€¼æœ‰å¤šç§</span></span><br><span class="line">        <span class="comment">#   https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_action</span></span><br><span class="line">        action: drop</span><br><span class="line">        </span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br></pre></td></tr></table></figure><p><strong>2.è¢«ç›‘æ§èŠ‚ç‚¹æ³¨å†Œåˆ°consoleé›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk211&quot;,&quot;name&quot;:&quot;elk01&quot;,&quot;address&quot;:&quot;10.0.0.211&quot;,&quot;port&quot;:9100,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.211:9100&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line">[root@elk02 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk212&quot;,&quot;name&quot;:&quot;elk212&quot;,&quot;address&quot;:&quot;10.0.0.212&quot;,&quot;port&quot;:9100,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.212:9100&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line">[root@elk03 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk213&quot;,&quot;name&quot;:&quot;elk213&quot;,&quot;address&quot;:&quot;10.0.0.213&quot;,&quot;port&quot;:9100,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.213:9100&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`è¯¦è§£`</span><br><span class="line"><span class="string">&quot;id&quot;</span>:<span class="string">&quot;elk211&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;elk01&quot;</span>,<span class="string">&quot;address&quot;</span>:<span class="string">&quot;10.0.0.211&quot;</span>,<span class="string">&quot;port&quot;</span>:9100 ç›‘æ§211èŠ‚ç‚¹ï¼Œåœ°å€å’Œç«¯å£</span><br><span class="line">checks<span class="string">&quot;: [&#123;&quot;</span>http<span class="string">&quot;:&quot;</span>http://10.0.0.211:9100<span class="string">&quot;,&quot;</span>interval<span class="string">&quot;:&quot;</span>5m<span class="string">&quot;&#125;]&#125;&#x27;  æ£€æŸ¥èŠ‚ç‚¹ï¼Œå’Œé—´éš”æ—¶é—´</span></span><br><span class="line"><span class="string">http://10.0.0.213:8500/v1/agent/service/register                æ³¨å†Œåˆ°consoleé›†ç¾¤ï¼ˆå†™211,212,213éƒ½å¯ä»¥ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p><strong>3.æ£€æŸ¥consulçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.212:8500/ui/dc1/services</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127153448968.png" alt="image-20241127153448968"></p><p><strong>4 æ£€æŸ¥Prometheusçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.211:9090/targets?search=</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127153520806.png" alt="image-20241127153520806"></p><p><strong>5.æ³¨é”€èŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT http://10.0.0.213:8500/v1/agent/service/deregister/elk213</span><br><span class="line"></span><br><span class="line">elk213  `è¿™é‡Œå†™çš„æ˜¯<span class="built_in">id</span>ï¼Œè€Œä¸æ˜¯name`</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨POSTMANç›´æ¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼Œéœ€è¦ä½¿ç”¨PUTæ–¹æ³•ã€‚<br>PUT <a href="http://10.0.0.213:8500/v1/agent/service/deregister/elk213">http://10.0.0.213:8500/v1/agent/service/deregister/elk213</a></p><h2 id="Prometheusç›‘æ§consoleé›†ç¾¤">Prometheusç›‘æ§consoleé›†ç¾¤</h2><p>Prometheusç›‘æ§consulé›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½consul exporter</span><br><span class="line">[root@elk02:5 ~]# wget https://github.com/prometheus/consul_exporter/releases/download/v0.12.1/consul_exporter-0.12.1.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹è½¯ä»¶åŒ… </span><br><span class="line">[root@elk02:5 ~]# tar xf consul_exporter-0.12.1.linux-amd64.tar.gz  -C /usr/local/bin/ consul_exporter-0.12.1.linux-amd64/consul_exporter --strip-components=1</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨console exporter </span><br><span class="line">[root@elk02:5 ~]# consul_exporter --consul.server=<span class="string">&quot;http://10.0.0.213:8500&quot;</span> --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> --web.listen-address=:9107 </span><br><span class="line"></span><br><span class="line">4.è®¿é—®consul exporterçš„WebUI</span><br><span class="line">http://10.0.0.212:9107/metrics</span><br><span class="line"></span><br><span class="line">5.å‘consulæ³¨å†Œ(æˆ–è€…ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶ï¼Œé™æ€å‘ç°éœ€è¦çƒ­åŠ è½½Prometheus)</span><br><span class="line">[root@elk02:5 ~]# curl -X PUT -d <span class="string">&#x27;&#123;&quot;id&quot;:&quot;elk212-consul&quot;,&quot;name&quot;:&quot;consul-cluster&quot;,&quot;address&quot;:&quot;10.0.0.212&quot;,&quot;port&quot;:9107,&quot;tags&quot;:[&quot;node-exporter&quot;],&quot;checks&quot;: [&#123;&quot;http&quot;:&quot;http://10.0.0.212:9107&quot;,&quot;interval&quot;:&quot;5m&quot;&#125;]&#125;&#x27;</span> http://10.0.0.213:8500/v1/agent/service/register</span><br><span class="line"></span><br><span class="line">6.è®¿é—®consulçš„WebUI</span><br><span class="line">http://10.0.0.212:8500/ui/dc1/services/consul-cluster/instances</span><br><span class="line"></span><br><span class="line">7.è®¿é—®prometheusçš„WebUI</span><br><span class="line">http://10.0.0.211:9090/targets</span><br><span class="line"></span><br><span class="line">8.grafanaå¯¼å…¥æ¨¡æ¿ID </span><br><span class="line">12049</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Prometheusçš„æœåŠ¡å‘ç°ï¼Œè®©ä½ ä¸å†éœ€è¦çƒ­åŠ è½½æˆ–è€…é‡å¯Prometheus</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>08-éƒ¨ç½²pushgetwayå’Œaltermanager</title>
    <link href="https://lukme.top/posts/2cdee406.html"/>
    <id>https://lukme.top/posts/2cdee406.html</id>
    <published>2024-11-22T03:23:03.000Z</published>
    <updated>2024-12-05T04:36:34.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨ç½²pushgatway">éƒ¨ç½²pushgatway</h2><p>Prometheusè‡ªå®šä¹‰ç›‘æ§ç»„ä»¶pushgateway<br>1.ä¸‹è½½pushgateway</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]# wget https://github.com/prometheus/pushgateway/releases/download/v1.9.0/pushgateway-1.9.0.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>2.è§£å‹è½¯ä»¶åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]# tar xf pushgateway-1.9.0.linux-amd64.tar.gz -C /softwares/</span><br></pre></td></tr></table></figure><p>3.è¿è¡Œpushgatewayç»„ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]# <span class="built_in">cd</span> /softwares/pushgateway-1.9.0.linux-amd64/</span><br><span class="line">[root@elk02:0 ~]# ./pushgateway --web.listen-address=:9091 --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> </span><br></pre></td></tr></table></figure><p>4.è®¿é—®pushgetwayç»„ä»¶çš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.212:9091</span><br></pre></td></tr></table></figure><p>5.æ¨é€æµ‹è¯•æ•°æ®åˆ°pushgatewayç»„ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk211 ~]# <span class="built_in">echo</span> <span class="string">&quot;student_online 75&quot;</span> | curl --data-binary @-  http://10.0.0.212:9091/metrics/job/student/instance/10.0.0.211</span><br></pre></td></tr></table></figure><p>6.å†æ¬¡è®¿é—®pushgetwayç»„ä»¶çš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.92:9091/#</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241124112052347.png" alt="image-20241124112052347"></p><p>7.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">...</span><br><span class="line">    - job_name: <span class="string">&quot;pushgateway&quot;</span></span><br><span class="line">      <span class="comment"># ç”¨äºè§£å†³æ ‡ç­¾çš„å†²çªé—®é¢˜ï¼Œæœ‰æ•ˆå€¼ä¸º: trueå’Œfalseï¼Œé»˜è®¤å€¼ä¸ºfalse</span></span><br><span class="line">      <span class="comment"># å½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†ä¿ç•™æŠ“å–çš„æ ‡ç­¾ä»¥å¿½ç•¥æœåŠ¡å™¨è‡ªèº«çš„æ ‡ç­¾ã€‚è¯´ç™½äº†ä¼šè¦†ç›–åŸæœ‰æ ‡ç­¾ã€‚</span></span><br><span class="line">      <span class="comment"># å½“è®¾ç½®ä¸ºfalseæ—¶ï¼Œåˆ™ä¸ä¼šè¦†ç›–åŸæœ‰æ ‡ç­¾ï¼Œè€Œæ˜¯åœ¨æ ‡ç‚¹å‰åŠ äº†ä¸€ä¸ª&quot;exported_&quot;å‰ç¼€ã€‚</span></span><br><span class="line">      honor_labels: <span class="literal">true</span></span><br><span class="line">      static_configs:</span><br><span class="line">        - targets: </span><br><span class="line">          - <span class="string">&quot;10.0.0.212:9091&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">http://10.0.0.211:9090/targets?search=</span><br></pre></td></tr></table></figure><h2 id="Alertmanagerç¯å¢ƒéƒ¨ç½²">Alertmanagerç¯å¢ƒéƒ¨ç½²</h2><p><strong>1.altermanageræ¦‚è¿°</strong><br>ç”¨äºprometheus serverçš„å‘Šè­¦åŠŸèƒ½çš„ç»„ä»¶ï¼Œç›®å‰æ”¯æŒå¤šç§å‘Šè­¦åª’ä»‹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºé‚®ä»¶å‘Šè­¦ï¼Œé’‰é’‰å‘Šè­¦ï¼Œä¼ä¸šå¾®ä¿¡å‘Šè­¦ç­‰ã€‚</p><p><strong>2.éƒ¨ç½²alermanagerç»„ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½è½¯ä»¶åŒ…</span><br><span class="line">[root@elk02:1 ~]# wget https://github.com/prometheus/alertmanager/releases/download/v0.27.0/alertmanager-0.27.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2. è§£å‹è½¯ä»¶åŒ…</span><br><span class="line">[root@elk02:1 ~]# tar xf alertmanager-0.27.0.linux-amd64.tar.gz  -C /softwares/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.ä¿®æ”¹alermanagerçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:1 ~]# vim /softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml </span><br><span class="line">global:</span><br><span class="line">  resolve_timeout: 5m</span><br><span class="line">  smtp_from: <span class="string">&#x27;1968554226@qq.com&#x27;</span></span><br><span class="line">  smtp_smarthost: <span class="string">&#x27;smtp.qq.com:465&#x27;</span></span><br><span class="line">  smtp_auth_username: <span class="string">&#x27;1968554226@qq.com&#x27;</span></span><br><span class="line">  smtp_auth_password: <span class="string">&#x27;xwghtaasufprewcb&#x27;</span></span><br><span class="line">  smtp_require_tls: <span class="literal">false</span></span><br><span class="line">  smtp_hello: <span class="string">&#x27;qq.com&#x27;</span></span><br><span class="line">route:</span><br><span class="line">  group_by: [<span class="string">&#x27;alertname&#x27;</span>]</span><br><span class="line">  group_wait: 5s</span><br><span class="line">  group_interval: 5s</span><br><span class="line">  repeat_interval: 30s</span><br><span class="line">  receiver: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">receivers:</span><br><span class="line">- name: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  email_configs:</span><br><span class="line">  - to: <span class="string">&#x27;3078155561@qq.com&#x27;</span></span><br><span class="line">    send_resolved: <span class="literal">true</span></span><br><span class="line">inhibit_rules:</span><br><span class="line">  - source_match:</span><br><span class="line">      severity: <span class="string">&#x27;critical&#x27;</span></span><br><span class="line">    target_match:</span><br><span class="line">      severity: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    equal: [<span class="string">&#x27;alertname&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;instance&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨alermanager</span><br><span class="line">[root@elk02:1 ~]# <span class="built_in">cd</span> /softwares/alertmanager-0.27.0.linux-amd64/</span><br><span class="line">[root@elk02:1 alertmanager-0.27.0.linux-amd64]# ./alertmanager </span><br><span class="line"></span><br><span class="line">5.è®¿é—®webui</span><br><span class="line">http://10.0.0.212:9093/#/status</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># Alertmanager configuration</span></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets:</span><br><span class="line">          - 10.0.0.212:9093</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load rules once and periodically evaluate them according to the global &#x27;evaluation_interval&#x27;.</span></span><br><span class="line">rule_files:</span><br><span class="line">  - <span class="string">&quot;/softwares/prometheus-2.53.2.linux-amd64/status-rules.yaml&quot;</span></span><br></pre></td></tr></table></figure><p><strong>4.ä¿®æ”¹å‘Šè­¦è§„åˆ™</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /softwares/prometheus-2.53.2.linux-amd64/status-rules.yaml &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">groups:</span></span><br><span class="line"><span class="string">- name: service_status</span></span><br><span class="line"><span class="string">  rules:</span></span><br><span class="line"><span class="string">  - alert: 10.0.0.213:9100èŠ‚ç‚¹æŒ‚æ‰å•¦</span></span><br><span class="line"><span class="string">    expr: up&#123;instance=&quot;10.0.0.213:9100&quot;&#125; == 0</span></span><br><span class="line"><span class="string">    for: 15s</span></span><br><span class="line"><span class="string">    labels:</span></span><br><span class="line"><span class="string">      service: node_exporter</span></span><br><span class="line"><span class="string">      porter: 9100</span></span><br><span class="line"><span class="string">    annotations:</span></span><br><span class="line"><span class="string">      summary: &quot;&#123;&#123; $labels.instance &#125;&#125; å·²åœæ­¢è¿è¡Œè¶…è¿‡ 15sï¼&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p><strong>5.é‡æ–°åŠ è½½Prometheusé…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127094655913.png" alt="image-20241127094655913"></p><p>6.éªŒè¯å‘Šè­¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœæ­¢elk3çš„node_exporteræœåŠ¡</span><br><span class="line">[root@elk03:0 ~]# systemctl stop node-exporter.service </span><br><span class="line"></span><br><span class="line">é—®é¢˜æœªä¿®å¤æ²¡é—´éš”30så‘ä¸€æ¬¡é‚®ä»¶ï¼ˆè‡ªå·±å¯è®¾ç½®ï¼‰</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127095054688.png" alt="image-20241127095054688"></p><p>å‘Šè­¦é‚®ä»¶</p><p><img src="https://cos.lukme.top/Pic/image-20241127095509855.png" alt="image-20241127095509855"></p><h2 id="ä¿®æ”¹å‘Šè­¦æ¨¡æ¿">ä¿®æ”¹å‘Šè­¦æ¨¡æ¿</h2><p><strong>1. å‘Šè­¦æ¨¡æ¿ä»‹ç»</strong><br>é»˜è®¤çš„å‘Šè­¦ä¿¡æ¯ç•Œé¢æœ‰äº›ç®€å•ï¼Œå¯ä»¥å€ŸåŠ©å‘Šè­¦çš„æ¨¡æ¿ä¿¡æ¯ï¼Œå¯¹å‘Šè­¦ä¿¡æ¯è¿›è¡Œä¸°å¯Œï¼Œéœ€è¦å€ŸåŠ©äºAlertmanagerçš„æ¨¡æ¿åŠŸèƒ½æ¥å®ç°ã€‚</p><p>å‘Šè­¦æ¨¡æ¿çš„ä½¿ç”¨æµç¨‹å¦‚ä¸‹:<br>- åˆ†æå…³é”®ä¿¡æ¯<br>- å®šåˆ¶æ¨¡æ¿å†…å®¹<br>- AlertmanageråŠ è½½æ¨¡æ¿æ–‡ä»¶<br>- å‘Šè­¦ä¿¡æ¯ä½¿ç”¨æ¨¡æ¿å†…å®¹å±æ€§</p><p>æ¨¡æ¿æ–‡ä»¶ä½¿ç”¨æ ‡å‡†Goæ¨¡æ¿è¯­æ³•ï¼Œå¹¶æš´éœ²ä¸€äº›åŒ…å«æ—¶é—´æ ‡ç­¾å’Œå€¼çš„å˜é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ ‡ç­¾å¼•ç”¨: &#123;&#123; <span class="variable">$label</span>.&lt;label_name&gt; &#125;&#125;</span><br><span class="line">æŒ‡æ ‡æ ·æœ¬å€¼å¼•ç”¨: &#123;&#123; <span class="variable">$value</span> &#125;&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ˜¾å¼æ•ˆæœï¼Œéœ€è¦äº†è§£ä¸€äº›htmlç›¸å…³æŠ€æœ¯ï¼Œå‚è€ƒé“¾æ¥:<br><a href="https://www.w3school.com.cn/html/index.asp">https://www.w3school.com.cn/html/index.asp</a></p><p><strong>2.è‡ªå®šä¹‰æ¨¡æ¿</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ç›®å½•</span><br><span class="line">[root@elk02:0 ~]# <span class="built_in">mkdir</span> /softwares/alertmanager-0.27.0.linux-amd64/tmpl</span><br><span class="line">[root@elk02:0 tmpl]# <span class="built_in">cat</span> email.tmpl</span><br><span class="line">&#123;&#123; define <span class="string">&quot;alert.html&quot;</span> &#125;&#125;</span><br><span class="line">&lt;h1 style=<span class="string">&#x27;color: red;&#x27;</span>&gt;æœåŠ¡å¼‚å¸¸å‘Šè­¦&lt;/h1&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="built_in">tr</span>&gt;</span><br><span class="line">                &lt;th&gt;æŠ¥è­¦é¡¹&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;å®ä¾‹&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;æŠ¥è­¦é˜€å€¼&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;å¼€å§‹æ—¶é—´&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &#123;&#123; range <span class="variable">$i</span>, <span class="variable">$alert</span> := .Alerts &#125;&#125;</span><br><span class="line">                &lt;<span class="built_in">tr</span>&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; index <span class="variable">$alert</span>.Labels <span class="string">&quot;alertname&quot;</span> &#125;&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; index <span class="variable">$alert</span>.Labels <span class="string">&quot;instance&quot;</span> &#125;&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; index <span class="variable">$alert</span>.Annotations <span class="string">&quot;value&quot;</span> &#125;&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&#123;&#123; <span class="variable">$alert</span>.StartsAt &#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">        &#123;&#123; end &#125;&#125;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&#123;&#123; end &#125;&#125;</span><br></pre></td></tr></table></figure><p><strong>3.alertmanagerå¼•ç”¨è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 temp]# vim /softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml </span><br><span class="line"><span class="comment">#åŠ è½½æ¨¡æ¿</span></span><br><span class="line">templates:</span><br><span class="line">  - <span class="string">&#x27;./tmpl/*.tmpl&#x27;</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">receivers:</span><br><span class="line">- name: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  email_configs:</span><br><span class="line">  - to: <span class="string">&#x27;3078155561@qq.com&#x27;</span></span><br><span class="line">    send_resolved: <span class="literal">true</span></span><br><span class="line">    <span class="comment"># æ·»åŠ æ­¤è¡Œï¼Œå®šåˆ¶é‚®ä»¶çš„æ ‡é¢˜ï¼Œå¯¹äº&quot;&#123;&#123;&#125;&#125;&quot;å±æ€§ç”¨äºåŠ è½½å…¶ä»–ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨å•å¼•å·æ‹¬ä½ã€‚</span></span><br><span class="line">    headers: &#123; Subject: <span class="string">&quot;[WARN] æŠ¥è­¦é‚®ä»¶&quot;</span> &#125;</span><br><span class="line">    <span class="comment"># æ·»åŠ æ­¤è¡Œï¼Œè°ƒç”¨æ¨¡æ¿æ˜¾å¼é‚®ä»¶æ­£æ–‡ï¼Œå¯¹äº&quot;&#123;&#125;&quot;ä¸éœ€è¦ä½¿ç”¨å•å¼•å·ï¼Œå¦åˆ™æœåŠ¡å¯åŠ¨ä¸æˆåŠŸã€‚</span></span><br><span class="line">    html: <span class="string">&#x27;&#123;&#123; template &quot;alert.html&quot; . &#125;&#125;&#x27;</span></span><br><span class="line">      <span class="comment">#alter.htmlæ˜¯æ¨¡æ¿é‡Œå®šä¹‰çš„çš„defineï¼Œ.ä»£è¡¨çš„æ˜¯åŠ è½½</span></span><br></pre></td></tr></table></figure><p><strong>4.altermanagerè¯­æ³•æ£€æŸ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 alertmanager-0.27.0.linux-amd64]# <span class="built_in">pwd</span></span><br><span class="line">/softwares/alertmanager-0.27.0.linux-amd64</span><br><span class="line">[root@elk02:0 alertmanager-0.27.0.linux-amd64]# ./amtool check-config ./alertmanager.yml </span><br><span class="line">Checking <span class="string">&#x27;./alertmanager.yml&#x27;</span>  SUCCESS</span><br><span class="line">Found:</span><br><span class="line"> - global config</span><br><span class="line"> - route</span><br><span class="line"> - 1 inhibit rules</span><br><span class="line"> - 1 receivers</span><br><span class="line"> - 1 templates</span><br><span class="line">  SUCCESS</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">#altermanagerè‡ªå¸¦çš„è¯­æ³•æ£€æŸ¥</span></span><br></pre></td></tr></table></figure><p><strong>5.é‡æ–°å¯åŠ¨altermanager</strong></p><p>ä¸Šé¢æˆ‘ä»¬å®šåˆ¶é‚®ä»¶å†…å®¹ä¸­åŒ…å«é˜ˆå€¼çš„éƒ¨åˆ†ï¼Œè€Œæˆ‘ä»¬åœ¨è§„åˆ™ä¸­å¹¶æ²¡æœ‰æŒ‡å®šï¼Œæ‰€ä»¥prometheuséœ€è¦ä¿®æ”¹ä»¥ä¸‹è§„åˆ™æ–‡ä»¶ã€‚</p><p><strong>6.ä¿®æ”¹è§„åˆ™æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/status-rules.yaml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    annotations:</span><br><span class="line">      summary: <span class="string">&quot;&#123;&#123; .instance &#125;&#125; å·²åœæ­¢è¿è¡Œè¶…è¿‡ 15sï¼&quot;</span></span><br><span class="line">      value: <span class="string">&quot;&#123;&#123; <span class="variable">$value</span> &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>7.æ£€æŸ¥Prometheusé…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br><span class="line">[root@elk01:0 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br></pre></td></tr></table></figure><p><strong>è®¿é—®prometheusçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.91:9090/rules</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241127104621570.png" alt="image-20241127104621570"></p><p><strong>8.éªŒè¯æµ‹è¯•</strong></p><p>åœæ‰exporteræœåŠ¡</p><p><img src="https://cos.lukme.top/Pic/image-20241127110010277.png" alt="image-20241127110010277"></p><p>ä¾æ®æ¨¡æ¿å¯ä»¥å°†å‘Šè­¦å’Œæ¢å¤æ¨¡æ¿åˆ†å¼€ï¼Œä½¿ç”¨ä¸åŒæ¨¡æ¿é€šçŸ¥</p><p>æ¨èé˜…è¯»:<br><a href="https://prometheus.io/docs/alerting/latest/configuration/">https://prometheus.io/docs/alerting/latest/configuration/</a></p>]]></content>
    
    
    <summary type="html">éƒ¨ç½²ç›‘æ§ç»„å»ºpushgetwayå’Œå‘Šè­¦ç»„ä»¶altermanager</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>07-ç›‘æ§nginxå’Œtomcat</title>
    <link href="https://lukme.top/posts/750619ba.html"/>
    <id>https://lukme.top/posts/750619ba.html</id>
    <published>2024-11-21T03:23:03.000Z</published>
    <updated>2024-12-05T04:40:27.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Prometheusç›‘æ§nginx">Prometheusç›‘æ§nginx</h2><h3 id="1-ç¼–è¯‘å®‰è£…nginx">1 ç¼–è¯‘å®‰è£…nginx</h3><p>1.1 å®‰è£…ç¼–è¯‘å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CentOSï¼š</span><br><span class="line">yum -y install git wget gcc make zlib-devel gcc-c++ libtool openssl openssl-devel</span><br><span class="line"></span><br><span class="line">Ubuntuï¼š</span><br><span class="line">[root@elk93 ~]# apt -y install git wget gcc make zlib1g-dev build-essential libtool openssl libssl-dev</span><br></pre></td></tr></table></figure><p>1.2 å…‹éš†nginx-module-vtsæ¨¡å—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/vozlt/nginx-module-vts.git</span><br><span class="line"></span><br><span class="line">å¦‚æœä¸Šè¿°è¿æ¥ä¸å¥½ç”¨ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢ä»£ç :</span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/jasonyin2020/nginx-module-vts.git</span><br></pre></td></tr></table></figure><p>1.3 ä¸‹è½½nginxè½¯ä»¶åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 ~]# wget https://nginx.org/download/nginx-1.26.2.tar.gz</span><br></pre></td></tr></table></figure><p>1.4 è§£å‹nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 ~]# tar xf nginx-1.26.2.tar.gz </span><br><span class="line"></span><br><span class="line">[root@elk93 ~]# ll nginx-1.26.2</span><br><span class="line">total 860</span><br><span class="line">drwxr-xr-x  8  502 staff   4096 Aug 13 00:39 ./</span><br><span class="line">drwx------ 10 root root    4096 Sep  5 14:35 ../</span><br><span class="line">drwxr-xr-x  6  502 staff   4096 Sep  5 14:35 auto/</span><br><span class="line">-rw-r--r--  1  502 staff 327851 Aug 13 00:39 CHANGES</span><br><span class="line">-rw-r--r--  1  502 staff 501527 Aug 13 00:39 CHANGES.ru</span><br><span class="line">drwxr-xr-x  2  502 staff   4096 Sep  5 14:35 conf/</span><br><span class="line">-rwxr-xr-x  1  502 staff   2611 Aug 12 22:28 configure*</span><br><span class="line">drwxr-xr-x  4  502 staff   4096 Sep  5 14:35 contrib/</span><br><span class="line">drwxr-xr-x  2  502 staff   4096 Sep  5 14:35 html/</span><br><span class="line">-rw-r--r--  1  502 staff   1397 Aug 12 22:28 LICENSE</span><br><span class="line">drwxr-xr-x  2  502 staff   4096 Sep  5 14:35 man/</span><br><span class="line">-rw-r--r--  1  502 staff     49 Aug 12 22:28 README</span><br><span class="line">drwxr-xr-x  9  502 staff   4096 Aug 13 00:39 src/</span><br></pre></td></tr></table></figure><p>1.5 é…ç½®nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Centosï¼š</span><br><span class="line"><span class="built_in">cd</span> nginx-1.22.1</span><br><span class="line">./configure --prefix=/softwares/nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--without-http_gzip_module \</span><br><span class="line">--with-pcre \</span><br><span class="line">--with-file-aio \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-stream_ssl_module \</span><br><span class="line">--with-stream_realip_module \</span><br><span class="line">--add-module=/root/nginx-module-vts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ubuntu:</span><br><span class="line">[root@elk93 ~]# <span class="built_in">cd</span> nginx-1.26.2/</span><br><span class="line">[root@elk93 nginx-1.26.2]# </span><br><span class="line">[root@elk93 nginx-1.26.2]# ./configure --prefix=/softwares/nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --without-http_rewrite_module --with-http_stub_status_module --without-http_gzip_module  --with-file-aio --with-stream --with-stream_ssl_module --with-stream_realip_module --add-module=/root/nginx-module-vts</span><br></pre></td></tr></table></figure><p>1.6 ç¼–è¯‘å¹¶å®‰è£…nginx</p><pre><code>[root@elk93 nginx-1.26.2]# make -j 2 &amp;&amp; make install</code></pre><p>1.7 ä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 nginx-1.26.2]# vim /softwares/nginx/conf/nginx.conf</span><br><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">    vhost_traffic_status_zone;</span><br><span class="line">    upstream linux-promethues &#123;</span><br><span class="line">       server 10.0.0.31:9090;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    server &#123;</span><br><span class="line">        ...</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            <span class="comment"># index  index.html index.htm;</span></span><br><span class="line">            proxy_pass http://linux-promethues;</span><br><span class="line">        &#125;</span><br><span class="line">    location /status &#123;</span><br><span class="line">        vhost_traffic_status_display;</span><br><span class="line">        vhost_traffic_status_display_format html;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.8 æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 nginx-1.26.2]# /softwares/nginx/sbin/nginx -t</span><br><span class="line">nginx: the configuration file /softwares/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /softwares/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure><p>1.9 å¯åŠ¨nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 nginx-1.26.2]# /softwares/nginx/sbin/nginx</span><br></pre></td></tr></table></figure><p>1.10 è®¿é—®nginxçš„çŠ¶æ€é¡µé¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.93/status/format/prometheus</span><br></pre></td></tr></table></figure><h3 id="2-å®‰è£…nginx-vtx-exporter">2 å®‰è£…nginx-vtx-exporter</h3><p>2.1 ä¸‹è½½nginx-vtx-exporter</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CentOSï¼š</span><br><span class="line">wget https://github.com/hnlq715/nginx-vts-exporter/releases/download/v0.10.3/nginx-vts-exporter-0.10.3.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">ä¸å»ºè®®ä¸‹è½½æ›´é«˜ç‰ˆæœ¬ï¼Œå› ä¸ºå…¶ä¼šæå‡å¯¹GLICçš„ç‰ˆæœ¬è¦æ±‚ï¼Œå¯ä»¥é€šè¿‡<span class="string">&quot; strings /lib64/libc.so.6 | grep GLIBC_ &quot;</span>æŸ¥çœ‹é»˜è®¤æ˜¯2.17ç‰ˆæœ¬ï¼Œè‹¥ä½¿ç”¨è¾ƒé«˜ç‰ˆæœ¬åˆ™éœ€è¦2.32+</span><br><span class="line"></span><br><span class="line">Ubuntu:</span><br><span class="line">wget https://github.com/sysulq/nginx-vts-exporter/releases/download/v0.10.8/nginx-vtx-exporter_0.10.8_linux_amd64.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2.2 è§£å‹è½¯ä»¶åŒ…åˆ°pathè·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk92 ~]# tar xf nginx-vtx-exporter_0.10.8_linux_amd64.tar.gz -C /usr/local/bin/ nginx-vtx-exporter</span><br></pre></td></tr></table></figure><p>2.3 è¿è¡Œnginx-vtx-exporter</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk92 ~]# nginx-vtx-exporter -nginx.scrape_uri=http://10.0.0.93/status/format/json</span><br></pre></td></tr></table></figure><p>2.4 è®¿é—®æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.92:9913/metrics</span><br><span class="line">http://10.0.0.93/status/format/prometheus</span><br></pre></td></tr></table></figure><h3 id="3-é…ç½®prometheusé‡‡é›†nginxæ•°æ®">3 é…ç½®prometheusé‡‡é›†nginxæ•°æ®</h3><p>3.1 ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">scrape_configs:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;nginx-exporter&quot;</span></span><br><span class="line">    metrics_path: <span class="string">&quot;/status/format/prometheus&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.93:80&quot;</span></span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;nginx-vts-exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - <span class="string">&quot;10.0.0.92:9913&quot;</span></span><br><span class="line">          ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½         ï¼ˆå‰é¢æ–‡ç« éƒ½æœ‰æœªèµ˜è¿°ï¼‰</span></span><br></pre></td></tr></table></figure><p>3.2 æŸ¥çœ‹Prometheusçš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.91:9090/targets?</span><br></pre></td></tr></table></figure><p>3.3 å¯¼å…¥grafanaæ¨¡æ¿</p><pre><code>2949</code></pre><h2 id="prometheusç›‘æ§tomcat">prometheusç›‘æ§tomcat</h2><p>éƒ¨ç½²tomcat-exporter<br>1 åŸºäºDockerfileæ„å»ºtomcat-exporter<br>å‚è€ƒé“¾æ¥ï¼š<br>[root@elk93 ~]# git clone <a href="https://gitee.com/jasonyin2020/tomcat-exporter.git">https://gitee.com/jasonyin2020/tomcat-exporter.git</a></p><p>2 ç¼–è¯‘tomcat exporteré•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 ~]# <span class="built_in">cd</span> tomcat-exporter/</span><br><span class="line">[root@elk93 tomcat-exporter]# ll</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x  5 root root 4096 Sep  5 15:02 ./</span><br><span class="line">drwx------ 11 root root 4096 Sep  5 15:02 ../</span><br><span class="line">-rw-r--r--  1 root root   96 Sep  5 15:02 build.sh</span><br><span class="line">-rw-r--r--  1 root root  503 Sep  5 15:02 Dockerfile</span><br><span class="line">drwxr-xr-x  8 root root 4096 Sep  5 15:02 .git/</span><br><span class="line">drwxr-xr-x  2 root root 4096 Sep  5 15:02 libs/</span><br><span class="line">-rw-r--r--  1 root root 3407 Sep  5 15:02 metrics.war</span><br><span class="line">drwxr-xr-x  2 root root 4096 Sep  5 15:02 myapp/</span><br><span class="line">-rw-r--r--  1 root root  191 Sep  5 15:02 README.md</span><br><span class="line">-rw-r--r--  1 root root 7604 Sep  5 15:02 server.xml</span><br><span class="line">[root@elk93 tomcat-exporter]# </span><br><span class="line">[root@elk93 tomcat-exporter]# bash build.sh </span><br></pre></td></tr></table></figure><p>3.è¿è¡Œtomcat exporteré•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk93 tomcat-exporter]# docker run -p 28080:8080 -d --name tomcat-server registry.cn-hangzhou.aliyuncs.com/yinzhengjie-k8s/tomcat9-app:v1</span><br><span class="line">81926f3514f0531a462d289a022b6dbb12c4d68f2023e9c947ad9d8766d0fb90</span><br></pre></td></tr></table></figure><p>4.è®¿é—®tomcatåº”ç”¨</p><pre><code>http://10.0.0.93:28080/metrics/http://10.0.0.93:28080/myapp/</code></pre><p>5 é…ç½®prometheusç›‘æ§tomcatåº”ç”¨</p><p>5.1 ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elk91 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">...</span><br><span class="line">scrape_configs:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  - job_name: <span class="string">&quot;tomcat-exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: </span><br><span class="line">        - <span class="string">&quot;10.0.0.93:28080&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line"><span class="comment">#Prometheusçƒ­åŠ è½½</span></span><br></pre></td></tr></table></figure><p>5.2 æŸ¥çœ‹Prometheusçš„WebUI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.91:9090/targets</span><br></pre></td></tr></table></figure><p>5.3 å¯¼å…¥grafanaæ¨¡æ¿</p><pre><code>ç”±äºå®˜æ–¹çš„æ”¯æŒå¹¶ä¸å‹å¥½ï¼Œå¯ä»¥åœ¨GitHubè‡ªè¡Œæœç´¢ç›¸åº”çš„tomcatç›‘æ§æ¨¡æ¿ã€‚ å‚è€ƒé“¾æ¥:https://github.com/nlighten/tomcat_exporter/blob/master/dashboard/example.json</code></pre>]]></content>
    
    
    <summary type="html">å¸¦ä½ äº†è§£ä½¿ç”¨Prometheusç›‘æ§ELKé›†ç¾¤</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>06-ç›‘æ§dockerå®¹å™¨åŠæ•°æ®åº“</title>
    <link href="https://lukme.top/posts/668ffa27.html"/>
    <id>https://lukme.top/posts/668ffa27.html</id>
    <published>2024-11-20T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.736Z</updated>
    
    <content type="html"><![CDATA[<h1>ç›‘æ§docker</h1><p><strong>ç¯å¢ƒå‡†å¤‡</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>elk01</td><td>10.0.0.211</td><td>PrometheusæœåŠ¡ç«¯</td></tr><tr><td>elk02</td><td>10.0.0.212</td><td>ä½œä¸ºdockerçš„è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…dockerï¼Œcadvisor</td></tr><tr><td>elk03</td><td>10.0.0.213</td><td>ä½œä¸ºdockerçš„è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…dockerï¼Œcadvisor</td></tr></tbody></table><p>Prometheusç›‘æ§dockerå®¹å™¨ç¯å¢ƒ<br>1.cadVisor<br>cadVisoræ˜¯Googleå…¬å¸å¼€æºçš„ä¸€æ¬¾å®¹å™¨ç›‘æ§å·¥å…·ï¼Œæ”¯æŒdockerï¼Œpodmanå®¹å™¨ç®¡ç†å·¥å…·çš„ç›‘æ§ã€‚</p><p>GitHubåœ°å€:<br><a href="https://github.com/google/cadvisor">https://github.com/google/cadvisor</a></p><p><strong>ä¸¤å°éœ€è¦æœºå™¨èƒ½å¤Ÿç¿»å¢™ï¼Œå› ä¸ºæ‹‰å–çš„æ˜¯è°·æ­Œå®¹å™¨é•œåƒä»“åº“</strong></p><p><strong>æˆ‘æœ‰cadvisoré•œåƒï¼Œæ‰€æœ‰ç›´æ¥å¯¼å…¥å°±è¡Œäº†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@elk02:~# docker load  &lt; cadvisor-amd64-0.49.1.tar.gz </span><br><span class="line">root@elk03:~# docker load  &lt; cadvisor-amd64-0.49.1.tar.gz </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">åç»­è€ƒè™‘æä¾›cadvisoré•œåƒ</span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">  -v /:/rootfs:ro \</span><br><span class="line">  -v /var/run:/var/run:ro \</span><br><span class="line">  -v /sys:/sys:ro \</span><br><span class="line">  -v /var/lib/docker/:/var/lib/docker:ro \</span><br><span class="line">  -v /dev/disk/:/dev/disk:ro \</span><br><span class="line">  -p 18080:8080 \</span><br><span class="line">  -d  \</span><br><span class="line">  --name=cadvisor \</span><br><span class="line">  --privileged \</span><br><span class="line">  --device=/dev/kmsg \</span><br><span class="line">  gcr.io/cadvisor/cadvisor-amd64:v0.49.1</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">å¯ä»¥å°ä½¿ç”¨dockerhubé‡Œçš„cadvisorï¼Œé•œåƒæ¢ä¸ºgoogle/cadvisor:latest  </span><br></pre></td></tr></table></figure><p><strong>è®¿é—®æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:1 ~]# curl -s 10.0.0.213:18080/metrics | <span class="built_in">head</span> -3</span><br><span class="line"><span class="comment"># HELP cadvisor_version_info A metric with a constant &#x27;1&#x27; value labeled by kernel version, OS version, docker version, cadvisor version &amp; cadvisor revision.</span></span><br><span class="line"><span class="comment"># TYPE cadvisor_version_info gauge</span></span><br><span class="line">cadvisor_version_info&#123;cadvisorRevision=<span class="string">&quot;6f3f25ba&quot;</span>,cadvisorVersion=<span class="string">&quot;v0.49.1&quot;</span>,dockerVersion=<span class="string">&quot;&quot;</span>,kernelVersion=<span class="string">&quot;5.15.0-124-generic&quot;</span>,osVersion=<span class="string">&quot;Alpine Linux v3.18&quot;</span>&#125; 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ–è€…æµè§ˆå™¨è®¿é—®</span><br><span class="line">http://10.0.0.212:18080/containers/</span><br></pre></td></tr></table></figure><p><strong>prometheuså®šä¹‰è¦ç›‘æ§çš„dockerä¸»æœº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;docker&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.212:18080</span><br><span class="line">        - 10.0.0.213:18080</span><br><span class="line">        </span><br><span class="line">2.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">3.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span><br><span class="line">[root@elk02 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">4.grafanaå¯¼å…¥å¯¹åº”çš„æ¨¡æ¿Id</span><br><span class="line">315</span><br><span class="line">10619</span><br></pre></td></tr></table></figure><h1>ç›‘æ§æ•°æ®åº“</h1><h2 id="ç›‘æ§MySQL">ç›‘æ§MySQL</h2><p><strong>mysqlæœ¬èº«å¹¶ä¸æ”¯æŒmetricsæ¥å£ï¼Œå› æ­¤éœ€è¦ç‹¬ç«‹éƒ¨ç½²mysql-exporteræ¥æä¾›metricsæ¥å£ã€‚</strong></p><p><strong>è¿™é‡Œä½¿ç”¨dockeréƒ¨ç½²MySQLï¼Œä½¿ç”¨Prometheusç›‘æ§MySQL(ä¸å†èµ˜è¿°dockerå®‰è£…éƒ¨ç½²äº†)</strong></p><p>GitHubåœ°å€:</p><p><a href="https://github.com/prometheus/mysqld_exporter/releases/download/v0.16.0/mysqld_exporter-0.16.0.linux-amd64.tar.gz">https://github.com/prometheus/mysqld_exporter/releases/download/v0.16.0/mysqld_exporter-0.16.0.linux-amd64.tar.gz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½mysql_exporter</span><br><span class="line">[root@elk02:1 ~]# wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.16.0/mysqld_exporter-0.16.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.æ‹‰å–é•œåƒ</span><br><span class="line">[root@elk02:1 ~]# docker pull mysql:8.3.0-oracle</span><br><span class="line"></span><br><span class="line">3.éƒ¨ç½²MySQLæ•°æ®åº“ </span><br><span class="line">[root@elk02:1 ~]# docker run --name mysql-server -t \</span><br><span class="line">             -e MYSQL_DATABASE=<span class="string">&quot;linux&quot;</span> \</span><br><span class="line">             -e MYSQL_USER=<span class="string">&quot;luay&quot;</span> \</span><br><span class="line">             -e MYSQL_PASSWORD=<span class="string">&quot;123&quot;</span> \</span><br><span class="line">             -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="string">&quot;yes&quot;</span> \</span><br><span class="line">             --restart unless-stopped \</span><br><span class="line"> --network host \</span><br><span class="line">             -d mysql:8.3.0-oracle \</span><br><span class="line">             --character-set-server=utf8mb4 --collation-server=utf8mb4_bin \</span><br><span class="line">             --default-authentication-plugin=mysql_native_password</span><br><span class="line"></span><br><span class="line">4.æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</span><br><span class="line">[root@elk02:1 ~]# docker ps -l</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS      </span><br><span class="line">a069ae1367ff   mysql:8.3.0-oracle   <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   5 seconds ago   Up 4 seconds</span><br><span class="line"></span><br><span class="line">[root@elk02:1 ~]# netstat -lntup|grep 3306</span><br><span class="line">tcp6       0      0 :::3306      :::*      LISTEN      38663/mysqld       </span><br><span class="line">tcp6       0      0 :::33060     :::*      LISTEN      38663/mysqld </span><br><span class="line"></span><br><span class="line">5.è§£å‹è½¯ä»¶åŒ…(åé¢æ­¥éª¤æ„æ€æ˜¯å°†mysqld_exporterç›´æ¥è§£å‹åˆ°/usr/local/bin/ä¸‹ï¼Œè·³è¿‡ä¸€å±‚ç›®å½•)</span><br><span class="line">tar xf mysqld_exporter-0.15.1.linux-amd64.tar.gz -C /usr/local/bin/ mysqld_exporter-0.15.1.linux-amd64/mysqld_exporter  --strip-components=1</span><br><span class="line"></span><br><span class="line">6.åˆ›å»ºMySQLçš„é…ç½®ï¼ŒæŒ‡å®šé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">[root@elk02:1 ~]#  <span class="built_in">cat</span> &gt; /root/.my.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">user=luay</span></span><br><span class="line"><span class="string">password=123</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">7.è¿è¡Œmysqld-exporter</span><br><span class="line">[root@elk02:1 ~]# mysqld_exporter --mysqld.address=<span class="string">&quot;10.0.0.212:3306&quot;</span> --web.listen-address=:9104 --config.my-cnf=<span class="string">&quot;/root/.my.cnf&quot;</span></span><br><span class="line"></span><br><span class="line">8.è®¿é—®mysqld-exporterçš„webui</span><br><span class="line">http://10.0.0.212:9104/metrics</span><br><span class="line"></span><br><span class="line">9.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;mysql&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.212:9104</span><br><span class="line">        </span><br><span class="line">10.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">11.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span><br><span class="line">[root@elk02 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">12.æ£€æŸ¥Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.211:9090/targets</span><br><span class="line"></span><br><span class="line">13.grafanaå¯¼å…¥å¯¹åº”çš„æ¨¡æ¿ID</span><br><span class="line">17320</span><br><span class="line">18949</span><br><span class="line">14057</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§redis">ç›‘æ§redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1.æ‹‰å–é•œåƒ</span><br><span class="line">[root@elk02:1 ~]# docker pull redis:7.2.5</span><br><span class="line"></span><br><span class="line">2.ä¸‹è½½redis_exporter</span><br><span class="line">[root@elk02:1 ~]# wget https://github.com/oliver006/redis_exporter/releases/download/v1.62.0/redis_exporter-v1.62.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨redis</span><br><span class="line">[root@elk02:1 ~]# docker run -d --name redis-sever --network host redis:7.2.5 </span><br><span class="line"></span><br><span class="line">[root@elk02:1 ~]# netstat -lntup|grep 6379</span><br><span class="line">tcp     0   0 0.0.0.0:6379     0.0.0.0:*   LISTEN      39212/redis-server</span><br><span class="line">tcp6    0   0 :::6379          :::*        LISTEN      39212/redis-server</span><br><span class="line"></span><br><span class="line">4.è§£å‹è½¯ä»¶åŒ… </span><br><span class="line">[root@elk02:1 ~]# tar xf redis_exporter-v1.62.0.linux-amd64.tar.gz -C /usr/local/bin/ redis_exporter-v1.62.0.linux-amd64/redis_exporter --strip-components=1</span><br><span class="line"></span><br><span class="line">5.å¯åŠ¨redis-exporter</span><br><span class="line">[root@elk92 ~]# redis_exporter -redis.addr redis://10.0.0.212:6379 -web.telemetry-path /metrics -web.listen-address :9121</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹redis_exporterå¸®åŠ©</span></span><br><span class="line">[root@elk02:1 ~]# redis_exporter -h</span><br><span class="line"></span><br><span class="line">5.æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.212:9121/metrics</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123135827708.png" alt="image-20241123135827708"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.è¿›å…¥redisæ•°æ®åº“</span><br><span class="line">[root@elk02:2 ~]# docker <span class="built_in">exec</span> -it redis-sever redis-cli --raw -n 1</span><br><span class="line">127.0.0.1:6379[1]&gt; </span><br><span class="line"></span><br><span class="line">2.å†™å…¥æ•°æ®</span><br><span class="line">127.0.0.1:6379[1]&gt; <span class="built_in">set</span> name zhangsan </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; get name</span><br><span class="line">zhangsan</span><br><span class="line">127.0.0.1:6379[1]&gt; <span class="built_in">set</span> age 18</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; get age</span><br><span class="line">18</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">name</span><br><span class="line">age</span><br><span class="line">127.0.0.1:6379[1]&gt; </span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123140117078.png" alt="image-20241123140117078"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk02:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;redis&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.212:9121</span><br><span class="line">        </span><br><span class="line">10.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line">11.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span><br><span class="line">[root@elk02 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line">12.æ£€æŸ¥Prometheusçš„WebUI</span><br><span class="line">http://10.0.0.211:9021/targets</span><br><span class="line"></span><br><span class="line">13.grafanaå¯¼å…¥å¯¹åº”çš„æ¨¡æ¿ID</span><br><span class="line">763</span><br><span class="line">14091</span><br><span class="line">14615</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Prometheusç›‘æ§dockerå®¹å™¨åŠdockerèµ·çš„æ•°æ®åº“</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>05-ç›‘æ§CPU</title>
    <link href="https://lukme.top/posts/2471ba3e.html"/>
    <id>https://lukme.top/posts/2471ba3e.html</id>
    <published>2024-11-19T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.736Z</updated>
    
    <content type="html"><![CDATA[<p><strong>ç›‘æ§CPUçš„ä½¿ç”¨æƒ…å†µæ¡ˆä¾‹</strong><br>1 ç»Ÿè®¡å„ä¸ªèŠ‚ç‚¹CPUçš„ä½¿ç”¨ç‡<br>1.1 æˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°CPUç›¸å…³çš„KEY</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total</span><br></pre></td></tr></table></figure><p>1.2 è¿‡æ»¤å‡ºCPUçš„ç©ºé—²æ—¶é—´({mode=â€˜idleâ€™})å’Œå…¨éƒ¨CPUçš„æ—¶é—´(â€˜{}â€™)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;<span class="attribute">mode</span>=<span class="string">&#x27;idle&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤CPUçš„ç©ºé—²æ—¶é—´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;&#125;</span><br><span class="line">æ­¤å¤„çš„<span class="string">&#x27;&#123;&#125;&#x27;</span>å¯ä»¥ä¸å†™ï¼Œå› ä¸ºé‡Œé¢æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä»£è¡¨è·å–CPUçš„æ‰€æœ‰çŠ¶æ€æ—¶é—´ã€‚</span><br></pre></td></tr></table></figure><p>1.3 ç»Ÿè®¡1åˆ†é’Ÿå†…CPUçš„å¢é‡æ—¶é—´</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">increase</span><span class="params">(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[<span class="number">1</span>m])</span></span></span><br></pre></td></tr></table></figure><p>ç»Ÿè®¡1åˆ†é’Ÿå†…CPUç©ºé—²çŠ¶æ€çš„å¢é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">increase(node_cpu_seconds_total[1m])</span><br></pre></td></tr></table></figure><p>ç»Ÿè®¡1åˆ†é’Ÿå†…CPUæ‰€æœ‰çŠ¶æ€çš„å¢é‡ã€‚</p><p>1.4 å°†ç»“æœè¿›è¡ŒåŠ å’Œç»Ÿè®¡</p><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">sum</span><span class="params">(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[<span class="number">1</span>m])</span></span>)</span><br></pre></td></tr></table></figure><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total[1m]))</span><br></pre></td></tr></table></figure><p>1.5 æŒ‰ç…§ä¸åŒèŠ‚ç‚¹è¿›è¡Œåˆ†ç»„</p><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ï¼Œå¹¶æŒ‰ç…§æœºå™¨å®ä¾‹è¿›è¡Œåˆ†ç»„ã€‚</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>&#123;mode=&#x27;idle&#x27;&#125;[<span class="number">1</span>m])) by (<span class="name">instance</span>)</span><br></pre></td></tr></table></figure><p>å°†1åˆ†é’Ÿå†…æ‰€æœ‰CPUç©ºé—²æ—¶é—´çš„å¢é‡è¿›è¡ŒåŠ å’Œè®¡ç®—ï¼Œå¹¶æŒ‰ç…§æœºå™¨å®ä¾‹è¿›è¡Œåˆ†ç»„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total[1m])) by (instance)</span><br></pre></td></tr></table></figure><p>1.6 è®¡ç®—1åˆ†é’Ÿå†…CPUç©ºé—²æ—¶é—´çš„ç™¾åˆ†æ¯”</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>&#123;mode=&#x27;idle&#x27;&#125;[<span class="number">1</span>m])) by (<span class="name">instance</span>) / sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>[<span class="number">1</span>m])) by (<span class="name">instance</span>)</span><br></pre></td></tr></table></figure><p>1.7 ç»Ÿè®¡1å°æ—¶å†…CPUçš„ä½¿ç”¨ç‡ï¼Œè®¡ç®—å…¬å¼: (1 - CPUç©ºé—²æ—¶é—´çš„ç™¾åˆ†æ¯”) * 100%ã€‚</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span> - sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>&#123;mode=&#x27;idle&#x27;&#125;[<span class="number">1</span>h])) by (<span class="name">instance</span>) / sum(<span class="name">increase</span>(<span class="name">node_cpu_seconds_total</span>[<span class="number">1</span>h])) by (<span class="name">instance</span>)) * <span class="number">100</span></span><br></pre></td></tr></table></figure><p>1.8 ç»Ÿè®¡1åˆ†é’Ÿå†…CPUçš„ä½¿ç”¨ç‡ï¼Œè®¡ç®—å…¬å¼: (1 - CPUç©ºé—²æ—¶é—´çš„ç™¾åˆ†æ¯”) * 100%ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1 - <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total[1m])) by (instance)) * 100</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123101647287.png" alt="image-20241123101647287"></p><p>2 è®¡ç®—CPUç”¨æˆ·æ€çš„1åˆ†é’Ÿå†…ç™¾åˆ†æ¯”</p><pre><code>sum(increase(node_cpu_seconds_total&#123;mode='user'&#125;[1m])) by (instance) / sum(increase(node_cpu_seconds_total[1m])) by (instance) * 100</code></pre><p>3 è®¡ç®—CPUå†…æ ¸æ€çš„1åˆ†é’Ÿå†…ç™¾åˆ†æ¯”</p><pre><code>(sum(increase(node_cpu_seconds_total&#123;mode='system'&#125;[1m])) by (instance) / sum(increase(node_cpu_seconds_total[1m])) by (instance)) * 100</code></pre><p>4 è®¡ç®—CPU IOç­‰å¾…æ—¶é—´çš„1åˆ†é’Ÿå†…ç™¾åˆ†æ¯”</p><pre><code>(sum(increase(node_cpu_seconds_total&#123;mode='iowait'&#125;[1m])) by (instance) / sum(increase(node_cpu_seconds_total[1m])) by (instance)) * 100</code></pre><p><strong>ä»¥æ­¤æ·»åŠ ä»¥ä¸Š2,3,4è¯­æ³•æ•ˆæœå¦‚ä¸‹</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123101831485.png" alt="image-20241123101831485"></p><p><strong>ä¿å­˜dashboard</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123102158402.png" alt="image-20241123102158402"></p><p><strong>å¦‚ä½•å®ç°ç±»ä¼¼è¿™æ ·é€‰æ‹©æ•ˆæœï¼Ÿ</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123102014754.png" alt="image-20241123102014754"></p><h2 id="grafanaçš„å˜é‡å®šä¹‰">grafanaçš„å˜é‡å®šä¹‰</h2><p><img src="https://cos.lukme.top/Pic/image-20241123102621980.png" alt="image-20241123102621980"></p><p><img src="https://cos.lukme.top/Pic/image-20241123103440922.png" alt="image-20241123103440922"></p><p><strong>åº”ç”¨ä¿å­˜åå†æ¬¡æŸ¥çœ‹è¿™ä¸ªdashboard</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123103551574.png" alt="image-20241123103551574"></p><p>==ä¸è¿‡æ­¤æ—¶æˆ‘ä»¬ç‚¹å‡»æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰å†™çš„promQLæ˜¯ç›´æ¥å†™æ­»çš„æ²¡æœ‰ä½¿ç”¨å˜é‡==</p><p><strong>æ›¿æ¢å¦‚ä¸‹å˜é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;iowait&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance)) * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(1 - <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance)) * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;system&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance)) * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;user&#x27;</span>,instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$myhost</span>&quot;</span>&#125;[1m])) by (instance) * 100</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241123104039207.png" alt="image-20241123104039207"></p><p><strong>å†æ¬¡å›åˆ°dashboardéªŒè¯ç‚¹å‡»æ˜¯å¦æœ‰å˜åŒ–ï¼ˆåªéªŒè¯äº†ä¸€ä¸ªï¼‰</strong></p><p>==å¾ˆæ˜æ˜¾å˜åŒ–äº†==</p><p><img src="D:/PixPin/History/recording.gif" alt="recording"></p><h2 id="è‡ªå®šä¹‰å˜é‡ç±»å‹">è‡ªå®šä¹‰å˜é‡ç±»å‹</h2><p><img src="https://cos.lukme.top/Pic/image-20241123105342511.png" alt="image-20241123105342511"></p><h2 id="dashboardå¤‡ä»½">dashboardå¤‡ä»½</h2><p><strong>ç‚¹å‡»åˆ°æ¨¡æ¿çš„è®¾ç½®ï¼Œé€‰æ‹©json model</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123111303063.png" alt="image-20241123111303063"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Prometheusç›‘æ§CPUå¹¶å‡ºå›¾å±•ç¤º</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>04-ç›‘æ§ELKç³»åˆ—</title>
    <link href="https://lukme.top/posts/750619ba.html"/>
    <id>https://lukme.top/posts/750619ba.html</id>
    <published>2024-11-18T03:23:03.000Z</published>
    <updated>2024-12-05T04:38:04.407Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›‘æ§zookeeperé›†ç¾¤">ç›‘æ§zookeeperé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ä¿®æ”¹zookeeperé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03:2 ~]# vim /app/zookeeper/conf/zoo.cfg </span><br><span class="line">Â·Â·Â·</span><br><span class="line">metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span><br><span class="line">metricsProvider.httpHost=0.0.0.0</span><br><span class="line">metricsProvider.httpPort=7000</span><br><span class="line">metricsProvider.exportJvmInfo=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg root@10.0.0.212:/app/zookeeper/conf/</span><br><span class="line">[root@elk01 ~]# scp /app/zookeeper/conf/zoo.cfg root@10.0.0.213:/app/zookeeper/conf/</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.é‡å¯zookeeperé›†ç¾¤</span></span><br><span class="line">[root@elk01 ~]# zkServer.sh restart</span><br><span class="line">[root@elk02 ~]# zkServer.sh restart</span><br><span class="line">[root@elk03 ~]# zkServer.sh restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æµ‹è¯•è®¿é—®zookeeperçš„ç›‘å¬ç«¯å£æ˜¯å¦æ­£å¸¸</span></span><br><span class="line">[root@elk03 ~]# curl -s 10.0.0.211:7000/metrics | <span class="built_in">head</span> -3</span><br><span class="line"><span class="comment"># HELP approximate_data_size approximate_data_size</span></span><br><span class="line"><span class="comment"># TYPE approximate_data_size gauge</span></span><br><span class="line">approximate_data_size 15794.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.Prometheusé…ç½®zookeeper </span></span><br><span class="line">[root@elk03:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">   - job_name: <span class="string">&quot;zookeeper&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.211:7000</span><br><span class="line">        - 10.0.0.212:7000</span><br><span class="line">        - 10.0.0.213:7000</span><br><span class="line">        </span><br><span class="line"><span class="comment">#6.æ£€æŸ¥Prometheusè¯­æ³•æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#7.é‡æ–°å‘èµ·è¯·æ±‚ï¼ˆçƒ­åŠ è½½Prometheusï¼‰</span></span><br><span class="line">[root@elk211 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#8. æµè§ˆå™¨åˆ·æ–°è®¿é—®,åœ¨targeté‡Œå³å¯çœ‹åˆ°è¢«ç›‘æ§ç«¯</span></span><br><span class="line">10.0.0.211:9090/targets</span><br><span class="line"></span><br><span class="line"><span class="comment">#grafanaå¯¼å…¥æ¨¡æ¿ID</span></span><br><span class="line">10465</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§kafkaé›†ç¾¤">ç›‘æ§kafkaé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®˜æ–¹  https://prometheus.io/docs/instrumenting/exporters/  æœç´¢kafka exporter</span></span><br><span class="line"></span><br><span class="line">1.ä¸‹è½½kafka exporter </span><br><span class="line">wget https://github.com/danielqsj/kafka_exporter/releases/download/v1.8.0/kafka_exporter-1.8.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹kafka exporterè½¯ä»¶åŒ… å¹¶åšè½¯è¿æ¥</span><br><span class="line">[root@elk01:3 ~]# tar xf kafka_exporter-1.8.0.linux-amd64.tar.gz -C /app/</span><br><span class="line">[root@elk01:3 ~]# <span class="built_in">ln</span> -s  /app/kafka_exporter-1.8.0.linux-amd64/ /app/kafka-exporter</span><br><span class="line"></span><br><span class="line">3.è¿è¡Œkafka exporterç¨‹åºæš´éœ²kafkaé›†ç¾¤çš„æŒ‡æ ‡æä¾›httpæ¥å£ï¼Œä»¥ä¾›Prometheusè¯†åˆ«</span><br><span class="line">[root@elk01:3 ~]# /app/kafka-exporter/kafka_exporter \</span><br><span class="line">--web.listen-address=<span class="string">&quot;:9308&quot;</span> --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> \</span><br><span class="line">--kafka.server=elk211:9092 --kafka.server=elk212:9092  \</span><br><span class="line">--kafka.server=elk213:9092 --kafka.version=<span class="string">&quot;3.8.0&quot;</span></span><br><span class="line"></span><br><span class="line">4.è®¿é—®kafka exporteræµ‹è¯•</span><br><span class="line">http://10.0.0.213:9308/metrics</span><br><span class="line"></span><br><span class="line">5.Prometheusé…ç½®ç›‘æ§kafka</span><br><span class="line">[root@elk03:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    - job_name: <span class="string">&quot;kafka&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.213:9308 </span><br><span class="line">        </span><br><span class="line">6.æ£€æµ‹Prometheusè¯­æ³•</span><br><span class="line">7.çƒ­åŠ è½½Prometheus</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§elasticsearché›†ç¾¤">ç›‘æ§elasticsearché›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½elasticsearch exporter </span><br><span class="line">[root@elk01:3 ~]# wget https://github.com/prometheus-community/elasticsearch_exporter/releases/download/v1.7.0/elasticsearch_exporter-1.7.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.è§£å‹è½¯ä»¶åŒ…</span><br><span class="line">[root@elk01:3 ~]# tar xf elasticsearch_exporter-1.7.0.linux-amd64.tar.gz -C /app</span><br><span class="line"></span><br><span class="line">3.è¿è¡Œelasticsearch exporteræš´éœ²ESé›†ç¾¤çš„ç›‘æ§æŒ‡æ ‡ä¸ºhttpæ¥å£ï¼Œä¾›ç»™PrometheusæŠ“å–æ•°æ®</span><br><span class="line">[root@elk01:3 ~]# /app/elasticsearch_exporter-1.7.0.linux-amd64/elasticsearch_exporter \</span><br><span class="line">--web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> \</span><br><span class="line">--web.listen-address=:9114 \</span><br><span class="line">--es.all \</span><br><span class="line">--es.uri=<span class="string">&quot;http://elastic:123456@10.0.0.211:9200&quot;</span></span><br><span class="line"></span><br><span class="line">4.è®¿é—®elasticsearch exporterçš„WebUI</span><br><span class="line">http://10.0.0.212:9114/metrics</span><br><span class="line"></span><br><span class="line">5.Prometheusé…ç½®ç›‘æ§kafka</span><br><span class="line">[root@elk03:2 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Â·Â·Â·</span><br><span class="line">    - job_name: <span class="string">&quot;es&quot;</span></span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 10.0.0.213:9114</span><br><span class="line">        </span><br><span class="line">6.æ£€æµ‹Prometheusè¯­æ³•</span><br><span class="line">7.çƒ­åŠ è½½Prometheus</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¸¦ä½ äº†è§£ä½¿ç”¨Prometheusç›‘æ§ELKé›†ç¾¤</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>03-grafanaå‡ºå›¾</title>
    <link href="https://lukme.top/posts/c9c8c45c.html"/>
    <id>https://lukme.top/posts/c9c8c45c.html</id>
    <published>2024-11-17T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.733Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…éƒ¨ç½²grafana">å®‰è£…éƒ¨ç½²grafana</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç½‘å€ï¼š https://grafana.com/grafana/download/9.5.21?pg=get&amp;plcmt=selfmanaged-box1-cta1</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.å®‰è£…è½¯ä»¶åŒ…ï¼ˆé€‰æ‹©9ç‰ˆæœ¬çš„æœ€æ–°ç‰ˆï¼‰</span></span><br><span class="line">[root@elk01:0 ~]# yum install -y https://dl.grafana.com/enterprise/release/grafana-enterprise-9.5.21-1.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.é…ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">[root@elk01:0 ~]# systemctl <span class="built_in">enable</span> --now grafana-server </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.è®¿é—®grafanaçš„WebUI</span></span><br><span class="line">http://10.0.0.211:3000/login</span><br><span class="line"></span><br><span class="line">é¦–æ¬¡ç™»å½•ç”¨æˆ·åå’Œå¯†ç å‡ä¸ºadminï¼Œç™»å½•ç‚¹å‡»åé¢ç›´æ¥ç‚¹å‡»skipè·³è¿‡ä¿®æ”¹å¯†ç </span><br></pre></td></tr></table></figure><h2 id="é…ç½®Prometheusæ•°æ®æº">é…ç½®Prometheusæ•°æ®æº</h2><p><img src="https://cos.lukme.top/Pic/image-20241122135329713.png" alt="image-20241122135329713"></p><p><img src="https://cos.lukme.top/Pic/image-20241122135413189.png" alt="image-20241122135413189"></p><p><img src="https://cos.lukme.top/Pic/image-20241122135559291.png" alt="image-20241122135559291"></p><p><strong>ä¸‹æ‹‰æ‰¾åˆ°ä¿å­˜saveå³å¯</strong></p><h2 id="å¯¼å…¥æ¨¡æ¿">å¯¼å…¥æ¨¡æ¿</h2><p><a href="https://grafana.com/grafana/dashboards/?search=node">å®˜æ–¹dashboardï¼Œç‚¹å‡»ç›´è¾¾ï¼Œæœç´¢nodeæŸ¥çœ‹æ¨¡æ¿</a></p><p>æ‰¾åˆ°åˆé€‚æ¨¡æ¿çŸ¥é“æ¨¡æ¿idå¯¼å…¥grafana</p><p><img src="https://cos.lukme.top/Pic/image-20241122135814095.png" alt="image-20241122135814095"></p><p><img src="https://cos.lukme.top/Pic/image-20241122141944442.png" alt="image-20241122141944442"></p><blockquote><p>è¿˜æœ‰ä¸ªæ¨¡æ¿8919ä»…ä¾›å‚è€ƒ</p></blockquote><p><strong>CPUå‹æµ‹åæ•°æ®æ˜æ˜¾äº†</strong><img src="https://cos.lukme.top/Pic/image-20241122142250940.png" alt="image-20241122142250940"></p><h2 id="åˆ›å»ºè‡ªå·±çš„æ¨¡æ¿">åˆ›å»ºè‡ªå·±çš„æ¨¡æ¿</h2><p><img src="https://cos.lukme.top/Pic/image-20241123094852067.png" alt="image-20241123094852067"></p><p><strong>Add  visualization</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241123095639123.png" alt="image-20241123095639123"></p><p><strong>==åˆ›å»ºdashboardä»¥åŠå‡ºå›¾è§05-ç›‘æ§CPUä½¿ç”¨æƒ…å†µ==</strong></p><h2 id="grafanaä¿®æ”¹æ¨¡æ¿">grafanaä¿®æ”¹æ¨¡æ¿</h2><p><strong>ä»¥æ™®ç½—ç±³æ¨¡æ¿11277ä¸ºä¾‹</strong></p><p><strong>å¯¼å…¥æ¨¡æ¿</strong></p><p><img src="https://cos.lukme.top/Pic/QQ_1726060882752.png" alt="QQ_1726060882752"></p><p><img src="https://cos.lukme.top/Pic/image-20240911212345131.png" alt="image-20240911212345131"></p><p><img src="https://cos.lukme.top/Pic/image-20240911212434248.png" alt="image-20240911212434248"></p><h2 id="ä¿®æ”¹æ¨¡æ¿">ä¿®æ”¹æ¨¡æ¿</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å»æ™®ç½—ç±³é‡Œå‘ç°æ–°ç°ç‰ˆprometheusçš„projectæ”¹ä¸ºäº†jobï¼Œæ‰€æœ‰ä¸‹ä¸€æ­¥ä¿®æ”¹å˜é‡</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/recording.gif" alt="recording"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°†projectæ”¹ä¸ºjobï¼Œå¹¶ä¸”åˆ æ‰ä¸æ”¯æŒçš„project</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Prometheusæ¥å…¥grafanaå‡ºå›¾å±•ç¤º</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>02-prometheuså¸¸ç”¨å‡½æ•°ä»‹ç»</title>
    <link href="https://lukme.top/posts/7c8bc612.html"/>
    <id>https://lukme.top/posts/7c8bc612.html</id>
    <published>2024-11-16T03:23:03.000Z</published>
    <updated>2024-12-05T04:17:45.731Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Prometheuså¸¸ç”¨çš„å‡½æ•°</strong></p><h2 id="increase">increase</h2><p>increaseå‡½æ•°:<br>ç”¨æ¥é’ˆå¯¹counteræ•°æ®ç±»å‹ï¼Œæˆªå–å…¶ä¸­ä¸€æ®µæ—¶é—´æ€»çš„å¢é‡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ€»æ—¶é—´å¢é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;10.0.0.211:9100&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[1m])</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122125610115.png" alt="image-20241122125610115"></p><blockquote><p>ä¸€åˆ†é’Ÿå†…ç©ºé—²59sï¼ŒCPUå¤ªé—²äº†ï¼Œå‹æµ‹ä¸€æ³¢</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.å®‰è£…å‹åŠ›æµ‹è¯•å·¥å…·</span></span><br><span class="line">[root@elk02 ~]# yum install -y stress</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.å‹åŠ›æµ‹è¯•CPU</span></span><br><span class="line">[root@elk03:1 ~]# stress --cpu 8 --io 4 --vm 2 --vm-bytes 128M --<span class="built_in">timeout</span> 10m</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122130528444.png" alt="image-20241122130528444"></p><h2 id="sum">sum</h2><p>sumå‡½æ•°:<br>åŠ å’Œçš„ä½œç”¨ã€‚ ï¼ˆå°†ä¸‹æ–¹å›¾1æ‰€æœ‰ç»“æœç´¯åŠ ï¼Œä¸åˆ†ç»„ï¼‰</p><p>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ€»æ—¶é—´å¢é‡ï¼Œå¹¶å°†è¿”å›ç»“æœç´¯åŠ ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>,cpu=<span class="string">&#x27;0&#x27;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122131145124.png" alt="image-20241122131145124"></p><p><img src="https://cos.lukme.top/Pic/image-20241122131116002.png" alt="image-20241122131116002"></p><h2 id="by">by</h2><p>byå‡½æ•°:<br>å°†æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç±»ä¼¼äºMySQLçš„&quot;GROUP BY&quot;ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹CPUç©ºé—²çŠ¶æ€ï¼Œå¹¶å°†ç»“æœè¿›è¡Œç´¯åŠ ï¼ŒåŸºäºinstanceè¿›è¡Œåˆ†ç»„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>,cpu=<span class="string">&#x27;0&#x27;</span>&#125;[1m])) by (instance)</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122131653295.png" alt="image-20241122131653295"></p><h2 id="rate">rate</h2><p>rateå‡½æ•°:<br>å®ƒçš„åŠŸèƒ½æ˜¯æŒ‰ç…§è®¾ç½®çš„æ—¶é—´æ®µï¼Œå–counteråœ¨è¿™ä¸ªæ—¶é—´æ®µä¸­å¹³å‡æ¯ç§’çš„å¢é‡ã€‚<br>ä¸¾ä¸ªä¾‹å­:</p><p>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.212:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ¯ç§’çš„å¢é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(node_cpu_seconds_total&#123;instance=<span class="string">&quot;10.0.0.212:9100&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>,cpu=<span class="string">&#x27;0&#x27;</span>&#125;[1m])</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122132326591.png" alt="image-20241122132326591"></p><p>increaseå’Œrateå¦‚ä½•é€‰æ‹©:<br>(1)å¯¹äºé‡‡é›†æ•°æ®é¢‘ç‡è¾ƒä½çš„åœºæ™¯å»ºè®®ä½¿ç”¨increaseå‡½æ•°ï¼Œå› ä¸ºä½¿ç”¨rateå‡½æ•°å¯èƒ½ä¼šå‡ºç°æ–­ç‚¹,æ¯”å¦‚é’ˆå¯¹ç¡¬ç›˜å®¹é‡ç›‘æ§ã€‚<br>(2)å¯¹äºé‡‡é›†æ•°æ®é¢‘ç‡è¾ƒé«˜çš„åœºæ™¯å»ºè®®ä½¿ç”¨rateå‡½æ•°ï¼Œæ¯”å¦‚é’ˆå¯¹CPUï¼Œå†…å­˜ï¼Œç½‘ç»œæµé‡ç­‰éƒ½æ˜¯å¯ä»¥åŸºäºrateå‡½æ•°æ¥é‡‡é›†ç­‰ã€‚</p><h2 id="topk">topk</h2><p>topkå‡½æ•°:<br>å–å‰å‡ ä½çš„æœ€é«˜å€¼ï¼Œå®é™…ä½¿ç”¨çš„æ—¶å€™ä¸€èˆ¬ä¼šç”¨è¯¥å‡½æ•°è¿›è¡Œç¬æ—¶æŠ¥è­¦ï¼Œè€Œä¸æ˜¯ä¸ºäº†è§‚å¯Ÿæ›²çº¿å›¾ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:<br>ç»Ÿè®¡1åˆ†é’Ÿå†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹CPUï¼Œæ‰€æœ‰çŠ¶æ€ä½¿ç”¨çš„æ¯ç§’çš„å¢é‡ï¼ŒåªæŸ¥çœ‹å‰3ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topk(3,rate(node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122132911868.png" alt="image-20241122132911868"></p><p><img src="https://cos.lukme.top/Pic/image-20241122133011958.png" alt="image-20241122133011958"></p><h2 id="count">count</h2><p>countå‡½æ•°:<br>æŠŠæ•°å€¼ç¬¦åˆæ¡ä»¶çš„ï¼Œè¾“å‡ºæ•°ç›®è¿›è¡Œç´¯åŠ åŠ å’Œã€‚<br>æ¯”å¦‚è¯´ä¼ä¸šä¸­æœ‰100å°æœåŠ¡å™¨ï¼Œå¦‚æœåªæœ‰10å°æœåŠ¡å™¨CPUä½¿ç”¨ç‡é«˜äº80%æ—¶å€™æ˜¯ä¸éœ€è¦æŠ¥è­¦çš„ï¼Œä½†æ˜¯æ•°é‡è¶…è¿‡70å°æ—¶å°±éœ€è¦æŠ¥è­¦äº†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:<br>count(tcp_wait_conn &gt; 500):<br>å‡è®¾tcp_wait_connæ˜¯å’±ä»¬è‡ªå®šä¹‰çš„KEYã€‚<br>è‹¥TCPç­‰å¾…æ•°é‡å¤§äº500çš„æœºå™¨æ•°é‡å°±åˆ¤æ–­æ¡ä»¶ä¸ºçœŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¹ç»Ÿè®¡çš„ç»“æœè¿›è¡Œè®¡æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line">count(rate(node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122133509836.png" alt="image-20241122133509836"></p><p>7 å…¶ä»–å‡½æ•°</p><p>æ¨èé˜…è¯»:<br><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/">https://prometheus.io/docs/prometheus/latest/querying/functions/</a></p>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡ä»‹ç»äº†Prometheusçš„å¸¸ç”¨å‡½æ•°</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>01-prometheusä»‹ç»åŠéƒ¨ç½²</title>
    <link href="https://lukme.top/posts/d9386973.html"/>
    <id>https://lukme.top/posts/d9386973.html</id>
    <published>2024-11-15T03:23:03.000Z</published>
    <updated>2024-12-05T03:37:04.631Z</updated>
    
    <content type="html"><![CDATA[<h2 id="prometheusä»‹ç»">prometheusä»‹ç»</h2><p>1.ä»€ä¹ˆæ˜¯Prometheus<br>Prometheusæ˜¯ä¸€æ¬¾ç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥ç›‘æ§ä¼ ç»Ÿä¸šåŠ¡ï¼ˆtomcatï¼Œnginxï¼Œmysqlï¼Œredisï¼Œelasticsearchï¼‰ï¼Œè¿˜èƒ½å¤Ÿç›‘æ§äº‘åŸç”Ÿä¸šåŠ¡ï¼Œæ¯”å¦‚dockerï¼Œk8sç›‘æ§ã€‚</p><p><strong>å®˜æ–¹é“¾æ¥:</strong><br><a href="https://prometheus.io/docs/introduction/overview/#architecture">https://prometheus.io/docs/introduction/overview/#architecture</a></p><p>æ¨èé˜…è¯»:</p><pre><code>äº‘åŸç”ŸCNCFå®˜ç½‘:    https://landscape.cncf.io/Prometheusçš„GitHubåœ°å€:    https://github.com/prometheus/prometheusPrometheusçš„å®˜ç½‘åœ°å€:    https://prometheus.io/</code></pre><p><img src="https://cos.lukme.top/Pic/image-20241121163541907.png" alt="image-20241121163541907"></p><table><thead><tr><th>ä¸»æœºå</th><th>WanIP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>elk01</td><td>10.0.0.211</td><td>PrometheusæœåŠ¡ç«¯ï¼Œå®‰è£…Prometheusã€node exporeter</td></tr><tr><td>elk02</td><td>10.0.0.212</td><td>è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…node exporeter</td></tr><tr><td>elk03</td><td>10.0.0.213</td><td>è¢«ç›‘æ§ç«¯ï¼Œå®‰è£…node exporeter</td></tr></tbody></table><blockquote><p>æˆ‘çš„ç¯å¢ƒä½¿ç”¨çš„æ˜¯ä¹‹å‰éƒ¨ç½²elkçš„ç¯å¢ƒï¼Œä¸»æœºåæ‰€ä»¥éƒ½æ˜¯elkï¼Œâ€”æ— å…³ç´§è¦</p></blockquote><h2 id="äºŒè¿›åˆ¶éƒ¨ç½²prometheus">äºŒè¿›åˆ¶éƒ¨ç½²prometheus</h2><p><strong>æœ¬ç¯‡ä½¿ç”¨çš„æ˜¯ä¸€é”®å®‰è£…æ–¹å¼è„šæœ¬éƒ¨ç½²ï¼Œå®‰è£…ç›®å½•éƒ½åœ¨/softwareç›®å½•ä¸‹</strong>k8sé˜¶æ®µå¯ä»¥ä½¿ç”¨äº‘åŸç”Ÿæ–¹å¼éƒ¨ç½²</p><p>**1.ä¸‹è½½Prometheus server **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# wget https://github.com/prometheus/prometheus/releases/download/v2.53.3/prometheus-2.53.3.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>**2.è§£å‹è½¯ä»¶åŒ… **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# tar xf prometheus-2.53.2.linux-amd64.tar.gz -C /app/</span><br><span class="line">[root@elk01 ~]# <span class="built_in">ln</span> -s /app/prometheus-2.53.2.linux-amd64/ /app/prometheus</span><br></pre></td></tr></table></figure><p>**3.å¯åŠ¨Prometheus server **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]# <span class="built_in">cd</span> /app/prometheus/ &amp;&amp; ./prometheus </span><br></pre></td></tr></table></figure><p><strong>4.è®¿é—®Prometheusçš„WebUI</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.211:9090</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨å®‰è£…è„šæœ¬ä¸€é”®å®‰è£…prometheus,è½¯ä»¶åŒ…æ”¾åœ¨åŒçº§ç›®å½•çš„downloadé‡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 auto_install_prometheus-server]# <span class="built_in">cat</span> install-prometheus-server.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># auther: lugaojie</span></span><br><span class="line"><span class="comment"># blog: www.lukme.top</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VERSION=2.53.2</span><br><span class="line">ARCH=amd64</span><br><span class="line">SOFTWARE=prometheus-<span class="variable">$&#123;VERSION&#125;</span>.linux-<span class="variable">$&#123;ARCH&#125;</span>.tar.gz</span><br><span class="line">URL=https://github.com/prometheus/prometheus/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line">DOWNLOAD=./download          <span class="comment">#æŒ‡å®šè½¯ä»¶ä¸‹è½½ç›®å½•</span></span><br><span class="line">INSTALLDIR=/softwares</span><br><span class="line">BASEDIR=<span class="variable">$&#123;INSTALLDIR&#125;</span>/prometheus-<span class="variable">$&#123;VERSION&#125;</span>.linux-amd64</span><br><span class="line">DATADIR=/data/prometheus</span><br><span class="line">LOGDIR=/var/log/prometheus</span><br><span class="line">HOSTIP=0.0.0.0</span><br><span class="line">PORT=9090</span><br><span class="line">HOSTNAME=`hostname`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">prepare</span></span>() &#123;</span><br><span class="line"><span class="comment"># åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œ-dæŒ‡å®šç›®å½•ï¼Œ-oå¯ä»¥æŒ‡å®šå±ä¸»ï¼Œ-gæŒ‡å®šæ•°ç»„</span></span><br><span class="line">[ -d <span class="variable">$INSTALLDIR</span> ] || install -d  <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line">[ -d <span class="variable">$DOWNLOAD</span> ] || install -d <span class="variable">$&#123;DOWNLOAD&#125;</span></span><br><span class="line">[ -d <span class="variable">$DATADIR</span> ] || install -d <span class="variable">$&#123;DATADIR&#125;</span></span><br><span class="line">[ -d <span class="variable">$LOGDIR</span> ] || install -d <span class="variable">$&#123;LOGDIR&#125;</span></span><br><span class="line"></span><br><span class="line">. /etc/os-release</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ID</span>&quot;</span> == <span class="string">&quot;centos&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"> <span class="comment"># åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å®‰è£…wget</span></span><br><span class="line"> [ -f /usr/bin/wget ] || yum -y install wget</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¸‹è½½</span></span><br><span class="line">[ -s <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> ] || wget <span class="variable">$URL</span> -O <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">deploy</span></span>() &#123;</span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¯å¢ƒ</span></span><br><span class="line">prepare</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹æ–‡ä»¶è½¯ä»¶åŒ…</span></span><br><span class="line">tar xf <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> -C <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯åŠ¨è„šæœ¬</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/prometheus-server.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description== Linux  Prometheus Server</span></span><br><span class="line"><span class="string">Documentation=https://prometheus.io/docs/introduction/overview/</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">ExecStart=/bin/bash -c &quot;$&#123;BASEDIR&#125;/prometheus \</span></span><br><span class="line"><span class="string">  --config.file=$&#123;BASEDIR&#125;/prometheus.yml \</span></span><br><span class="line"><span class="string">      --web.enable-lifecycle \</span></span><br><span class="line"><span class="string">      --storage.tsdb.path=$&#123;DATADIR&#125; \</span></span><br><span class="line"><span class="string">      --storage.tsdb.retention.time=60d  \</span></span><br><span class="line"><span class="string">      --web.listen-address=$&#123;HOSTIP&#125;:$&#123;PORT&#125;  \</span></span><br><span class="line"><span class="string">      --web.max-connections=65535  \</span></span><br><span class="line"><span class="string">      --storage.tsdb.retention.size=512MB \</span></span><br><span class="line"><span class="string">      --query.timeout=10s \</span></span><br><span class="line"><span class="string">      --query.max-concurrency=20 \</span></span><br><span class="line"><span class="string">      --log.level=info \</span></span><br><span class="line"><span class="string">      --log.format=json \</span></span><br><span class="line"><span class="string">      --web.read-timeout=5m &amp;&gt;&gt; $&#123;LOGDIR&#125;/prometheus-server.log&quot;</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -HUP \$MAINPID</span></span><br><span class="line"><span class="string">LimitNOFILE=65535</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  --web.enable-lifecycle                      æŒ‡å®šwebUIçš„çƒ­åŠ è½½åŠŸèƒ½</span></span><br><span class="line"><span class="comment">#  --storage.tsdb.path=$&#123;DATADIR&#125;     æŒ‡å®šå­˜å‚¨è·¯å¾„</span></span><br><span class="line"><span class="comment">#  --storage.tsdb.retention.time=60d  æŒ‡å®šä¿ç•™æ•°æ®æ—¶é—´ï¼Œé»˜è®¤15d</span></span><br><span class="line"><span class="comment">#  --web.max-connections=65535        æŒ‡å®šæœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="comment">#  --storage.tsdb.retention.size=512MBæŒ‡å®šå­˜å‚¨å—å¤§å°ï¼Œ512Mæ»šåŠ¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">#  --log.level=info                                  æŒ‡å®šæ—¥å¿—çº§åˆ«</span></span><br><span class="line"><span class="comment">#  --log.format=json                              æŒ‡å®šæ—¥å¿—æ ¼å¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æœåŠ¡è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now prometheus-server</span><br><span class="line">systemctl status prometheus-server</span><br><span class="line"><span class="built_in">sleep</span> 0.3</span><br><span class="line">ss -ntl | grep <span class="variable">$&#123;PORT&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">delete</span></span>()&#123;</span><br><span class="line">systemctl <span class="built_in">disable</span> --now prometheus-server.service</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/systemd/system/node-exporter.service <span class="variable">$BASEDIR</span> <span class="variable">$DATADIR</span> <span class="variable">$LOGDIR</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span> </span><br><span class="line"> deploy|i)</span><br><span class="line">   deploy</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;HOSTNAME&#125;</span> çš„prometheus-server å·²ç»éƒ¨ç½²æˆåŠŸ![successfully]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> delete|r)</span><br><span class="line">   delete</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;HOSTNAME&#125;</span> çš„prometheus-server å·²ç»å¸è½½æˆåŠŸ,æœŸå¾…ä¸‹æ¬¡ä½¿ç”¨~&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> *)</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> deploy[i]|delete[r]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main <span class="variable">$1</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="éƒ¨ç½²node-exporter">éƒ¨ç½²node exporter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">éƒ¨ç½²è¿‡ç¨‹åŒä¸Šï¼Œå®˜ç½‘æ‰¾åˆ°ä¸‹è½½</span><br><span class="line"></span><br><span class="line">1.#ä¸‹è½½node exporter</span><br><span class="line">[root@elk01 ~]# wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">2.#è§£å‹è‡³æŒ‡å®šç›®å½•</span><br><span class="line">[root@elk01 ~]# tar xf node_exporter-1.8.2.linux-amd64.tar.gz -C /app</span><br><span class="line">[root@elk01 ~]# <span class="built_in">ln</span> -s /app/node_exporter-1.8.2.linux-amd64 /app/node_exporter</span><br><span class="line"></span><br><span class="line">4.#å¯åŠ¨node_exporter</span><br><span class="line">[root@elk01 ~]# <span class="built_in">cd</span>  /app/node_exporter &amp;&amp; ./node_exporter </span><br><span class="line"></span><br><span class="line">5.#å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹åŒæ ·å®‰è£… node exporter</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµè§ˆå™¨è®¿é—®ï¼ˆè¿™å°±æ˜¯æš´éœ²å‡ºæ¥çš„æ¥å£ï¼‰</span></span><br><span class="line">http://10.0.0.211:9100/metrics</span><br><span class="line">http://10.0.0.212:9100/metrics</span><br><span class="line">http://10.0.0.213:9100/metrics</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€é”®å®‰è£…exporter,è½¯ä»¶åŒ…æ”¾åœ¨åŒçº§ç›®å½•çš„downloadç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# <span class="built_in">cat</span> auto-install-node-exporter/install-node-exporter.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># auther: lugaojie</span></span><br><span class="line"><span class="comment"># blog: https://www.lukme.top</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VERSION=1.8.2</span><br><span class="line">SOFTWARE=node_exporter-<span class="variable">$&#123;VERSION&#125;</span>.linux-amd64.tar.gz</span><br><span class="line">URL=https://github.com/prometheus/node_exporter/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line">DOWNLOAD=./download</span><br><span class="line">INSTALLDIR=/softwares</span><br><span class="line">BASEDIR=<span class="variable">$&#123;INSTALLDIR&#125;</span>/node_exporter-<span class="variable">$&#123;VERSION&#125;</span>.linux-amd64</span><br><span class="line">HOST=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">PORT=9100</span><br><span class="line">hostname=`hostname`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">prepare</span></span>() &#123;</span><br><span class="line"><span class="comment"># åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">[ -d <span class="variable">$INSTALLDIR</span> ] || <span class="built_in">mkdir</span> -pv <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line">[ -d <span class="variable">$DOWNLOAD</span> ] || <span class="built_in">mkdir</span> -pv <span class="variable">$&#123;DOWNLOAD&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ID</span>&quot;</span> == <span class="string">&quot;centos&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="comment"># åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å®‰è£…curl</span></span><br><span class="line">  [ -f /usr/bin/wget ] || yum -y install wget</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¸‹è½½</span></span><br><span class="line">[ -s <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> ] || wget <span class="variable">$URL</span> -O <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install</span></span>() &#123;</span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¯å¢ƒ</span></span><br><span class="line">prepare</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹æ–‡ä»¶è½¯ä»¶åŒ…</span></span><br><span class="line">tar xf <span class="variable">$&#123;DOWNLOAD&#125;</span>/<span class="variable">$&#123;SOFTWARE&#125;</span> -C <span class="variable">$&#123;INSTALLDIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯åŠ¨è„šæœ¬</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/node-exporter.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description= Linux Node Exporter</span></span><br><span class="line"><span class="string">Documentation=https://prometheus.io/docs/introduction/overview/</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStart=$&#123;BASEDIR&#125;/node_exporter --web.telemetry-path=&quot;/metrics&quot; \</span></span><br><span class="line"><span class="string">--web.listen-address=$&#123;HOST&#125;:$&#123;PORT&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å°†æœåŠ¡è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">  systemctl daemon-reload</span><br><span class="line">  systemctl <span class="built_in">enable</span> --now node-exporter.service</span><br><span class="line">  systemctl status node-exporter.service</span><br><span class="line">  ss -ntl | grep 9100</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">remove</span></span>()&#123;</span><br><span class="line">systemctl <span class="built_in">disable</span> --now node-exporter.service</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/systemd/system/node-exporter.service <span class="variable">$BASEDIR</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span> </span><br><span class="line"> install|i)</span><br><span class="line">   install</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;hostname&#125;</span> çš„node-exporter å·²ç»éƒ¨ç½²æˆåŠŸ![successfully]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> remove|r)</span><br><span class="line">   remove</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;hostname&#125;</span> çš„node-exporter å·²ç»å¸è½½æˆåŠŸ,æœŸå¾…ä¸‹æ¬¡ä½¿ç”¨~&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"> *)</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> install[i]|remove[r]&quot;</span></span><br><span class="line">   ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main <span class="variable">$1</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="ä¿®æ”¹Prometheusæ–‡ä»¶">ä¿®æ”¹Prometheusæ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01:0 ~]# vim /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line"><span class="comment">#ä¸ºäº†æµ‹è¯•ï¼Œæ‹‰å–é—´éš”æ—¶é—´å¯ä»¥è®¾ç½®ä¸º3s</span></span><br><span class="line">scrape_interval: 3s</span><br><span class="line">Â·Â·Â·æœ«å°¾åŠ ä¸Š</span><br><span class="line">    <span class="comment">#jobåéšä¾¿ï¼Œå‘Šè¯‰Prometheuså»å“ªæ‹‰å–æ•°æ®     </span></span><br><span class="line">  - job_name: <span class="string">&quot;elk&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.211:9100&quot;</span>,<span class="string">&quot;10.0.0.212:9100&quot;</span>,<span class="string">&quot;10.0.0.213:9100&quot;</span>]</span><br><span class="line">      </span><br><span class="line"><span class="comment">#2.ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼ˆPrometheusè‡ªå¸¦çš„ï¼‰</span></span><br><span class="line">[root@elk01:0 ~]# /softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml </span><br><span class="line">Checking /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml</span><br><span class="line"> SUCCESS: /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml is valid prometheus config file syntax</span><br><span class="line"> </span><br><span class="line">`å¯ä»¥è®¾ç½®åˆ«åé’ˆå¯¹æ£€æŸ¥é…ç½®æ–‡ä»¶å‘½ä»¤å¤ªé•¿`</span><br><span class="line">[root@elk01:~]# vim /etc/profile</span><br><span class="line"><span class="built_in">alias</span> check=<span class="string">&#x27;/softwares/prometheus-2.53.2.linux-amd64/promtool check config /softwares/prometheus-2.53.2.linux-amd64/prometheus.yml&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@elk01:0 ~]# <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.é‡æ–°åŠ è½½é…ç½®ï¼ˆçƒ­åŠ è½½ï¼‰</span></span><br><span class="line">[root@elk211 ~]# curl -X POST http://10.0.0.211:9090/-/reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. æµè§ˆå™¨åˆ·æ–°è®¿é—®,åœ¨targeté‡Œå³å¯çœ‹åˆ°è¢«ç›‘æ§ç«¯</span></span><br><span class="line">10.0.0.211:9090/targets</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241122111710195.png" alt="image-20241122111710195"></p><p><strong>å…³äºmetrics</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241122113152787.png" alt="image-20241122113152787"></p><p><strong>è¿‡æ»¤æ•°æ®</strong></p><p><img src="https://cos.lukme.top/Pic/image-20241122114130917.png" alt="image-20241122114130917"></p><h2 id="Prometheus-metrics-ç±»å‹">Prometheus metrics ç±»å‹</h2><ul><li>prometheus metrics type<br>prometheusç›‘æ§ä¸­é‡‡é›†è¿‡æ¥çš„æ•°æ®ç»Ÿä¸€ç§°ä¸ºMetricsæ•°æ®ï¼Œå…¶å¹¶ä¸æ˜¯ä»£è¡¨å…·ä½“çš„æ•°æ®æ ¼å¼ï¼Œè€Œæ˜¯ä¸€ç§ç»Ÿè®¡åº¦é‡è®¡ç®—å•ä½ã€‚</li></ul><p>å½“æˆ‘ä»¬éœ€è¦ä¸ºæŸä¸ªç³»ç»Ÿæˆ–è€…æŸä¸ªæœåŠ¡åšç›‘æ§æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°metricsã€‚</p><p>prometheusæ”¯æŒçš„metricsåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹:<br>guage:<br>æœ€ç®€å•çš„åº¦é‡æŒ‡æ ‡ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„è¿”å›å€¼ï¼Œæˆ–è€…å«ç¬æ—¶çŠ¶æ€ã€‚<br>æ¯”å¦‚è¯´ç»Ÿè®¡ç¡¬ç›˜ï¼Œå†…å­˜ç­‰ä½¿ç”¨æƒ…å†µã€‚<br>couter:<br>å°±æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä»æ•°æ®é‡0å¼€å§‹ç´¯ç§¯è®¡ç®—ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œåªèƒ½æ˜¯æ°¸è¿œçš„å¢é•¿ï¼Œä¸ä¼šé™ä½(æœ‰ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ç²‰ä¸é‡)ã€‚<br>æ¯”å¦‚ç»Ÿè®¡1å°æ—¶ï¼Œ1å¤©ï¼Œ1å‘¨ï¼Œ1ä¸€ä¸ªæœˆçš„ç”¨æˆ·è®¿é—®é‡ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç´¯åŠ çš„æ“ä½œã€‚<br>histograms:<br>æ˜¯ç»Ÿè®¡æ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼Œæ¯”å¦‚æœ€å°å€¼ï¼Œæœ€å¤§å€¼ï¼Œä¸­é—´å€¼ï¼Œä¸­ä½æ•°ç­‰ï¼Œä»£è¡¨çš„æ˜¯ä¸€ç§è¿‘ä¼¼ç™¾åˆ†æ¯”ä¼°ç®—æ•°å€¼ã€‚<br>é€šè¿‡histogramså¯ä»¥åˆ†åˆ«ç»Ÿè®¡å¤„åœ¨ä¸€ä¸ªæ—¶é—´æ®µ(1s,2s,5s,10s)å†…nginxè®¿é—®ç”¨æˆ·çš„å“åº”æ—¶é—´ã€‚<br>summary:<br>summaryæ˜¯histogramsçš„æ‰©å±•ç±»å‹ï¼Œä¸»è¦å¼¥è¡¥histogramsä¸è¶³ã€‚</p><h2 id="Prometheusçš„PromQLè¯­æ³•">Prometheusçš„PromQLè¯­æ³•</h2><p>1 æŸ¥çœ‹æŸä¸ªç‰¹å®šçš„key<br>node_cpu_seconds_total</p><p>2.æŸ¥çœ‹æŸä¸ªèŠ‚ç‚¹çš„æŒ‡æ ‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;instance=<span class="string">&quot;10.0.0.211:9100&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>3 æŸ¥çœ‹æŸä¸ªèŠ‚ç‚¹çš„æŸåˆ»CPUçš„æŸç§çŠ¶æ€</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode=&quot;idle&quot;,cpu=&quot;1&quot;&#125;</code></pre><p>4 æŸ¥è¯¢æœ€è¿‘10så†…æŸä¸ªèŠ‚ç‚¹CPUçš„æŸç§çŠ¶æ€æ—¶é—´</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode=&quot;idle&quot;,cpu=&quot;1&quot;&#125;[10s]</code></pre><p>5 ç»Ÿè®¡10så†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œéç©ºé—²çŠ¶æ€ä½¿ç”¨çš„æ€»æ—¶é—´</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode!=&quot;idle&quot;,cpu=&quot;1&quot;&#125;[10s]</code></pre><p>6 ç»Ÿè®¡10så†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œmodeåç§°ä»¥å­—æ¯&quot;i&quot;å¼€å¤´çš„æ‰€æœ‰CPUæ ¸å¿ƒã€‚</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode=~&quot;i.*&quot;,cpu=&quot;0&quot;&#125;[10s]</code></pre><p>7 ç»Ÿè®¡10så†…ï¼Œä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å™¨æŸ¥çœ‹&quot;10.0.0.211:9100&quot;èŠ‚ç‚¹çš„ç¬¬0é¢—CPUï¼Œmodeåç§°ä¸æ˜¯ä»¥å­—æ¯&quot;i&quot;å¼€å¤´çš„æ‰€æœ‰CPUæ ¸å¿ƒã€‚</p><pre><code>node_cpu_seconds_total&#123;instance=&quot;10.0.0.211:9100&quot;,mode!~&quot;i.*&quot;,cpu=&quot;0&quot;&#125;[10s]</code></pre>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡ä»‹ç»äº†Prometheusçš„éƒ¨ç½²åŠPrometheusçš„metricsç±»å‹å’ŒPromQLè¯­æ³•</summary>
    
    
    
    <category term="ç›‘æ§" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Prometheus" scheme="https://lukme.top/categories/%E7%9B%91%E6%8E%A7/Prometheus/"/>
    
    
    <category term="Prometheus" scheme="https://lukme.top/tags/Prometheus/"/>
    
  </entry>
  
  <entry>
    <title>14.åŸºäºkafkaçš„æ—¥å¿—æ”¶é›†</title>
    <link href="https://lukme.top/posts/b922fe1d.html"/>
    <id>https://lukme.top/posts/b922fe1d.html</id>
    <published>2024-10-30T02:46:01.000Z</published>
    <updated>2024-10-30T04:02:48.777Z</updated>
    
    <content type="html"><![CDATA[<h2 id="filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤">filebeatå†™å…¥æ•°æ®åˆ°kafkaé›†ç¾¤</h2><p><strong>1. åˆ›å»ºtopic</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-topics.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic linux-study.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@elk01:5 ~]# kafka-topics.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --describe</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030003043850.png" alt="image-20241030003043850"></p><p><strong>2. filebeatå†™å…¥æ•°æ®åˆ°kafka</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/filebeat/20-filebeat-to-kafka.yaml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">  - <span class="built_in">type</span>: filestream</span><br><span class="line">    paths:</span><br><span class="line">      - /opt/access.log*</span><br><span class="line">  </span><br><span class="line">output.kafka:</span><br><span class="line">  <span class="comment"># æŒ‡å®škafkaé›†ç¾¤åœ°å€</span></span><br><span class="line">  hosts: [<span class="string">&quot;10.0.0.211:9092&quot;</span>, <span class="string">&quot;10.0.0.212:9092&quot;</span>, <span class="string">&quot;10.0.0.213:9092&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># æŒ‡å®šå†™å…¥çš„topicåœ°å€</span></span><br><span class="line">  topic: <span class="string">&#x27;linux-study&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01:0 ~]# filebeat -e -c /etc/filebeat/20-filebeat-to-kafka.yaml</span><br></pre></td></tr></table></figure><p><strong>3. kafkaèŠ‚ç‚¹æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]#  kafka-console-consumer.sh --bootstrap-server 10.0.0.212:9092 --topic linux-study --from-beginning --group filebeat01</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030004427518.png" alt="image-20241030004427518"></p><h2 id="logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®">logstashä»kafkaé›†ç¾¤è¯»å–æ•°æ®</h2><p>**1.ç¼–å†™logstashå®ä¾‹ **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment"># elasticsearch&#123;</span></span><br><span class="line"> <span class="comment">#    hosts =&gt; [&quot;10.0.0.91:9200&quot;,&quot;10.0.0.92:9200&quot;,&quot;10.0.0.93:9200&quot;]</span></span><br><span class="line"> <span class="comment">#    index =&gt; &quot;oldboyedu-kafka-elk-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line"> <span class="comment">#    user =&gt; &quot;elastic&quot;</span></span><br><span class="line"> <span class="comment">#    password =&gt; &quot;123456&quot;</span></span><br><span class="line"> <span class="comment">#  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. å¯åŠ¨logstashå®ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# logstash -rf /etc/logstash/conf.d/17-kafka-to-logstash.conf </span><br><span class="line"></span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T17:05:27.448Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;&#123;\&quot;@timestamp\&quot;:\&quot;2024-10-29T16:39:24.279Z\&quot;,\&quot;@metadata\&quot;:&#123;\&quot;beat\&quot;:\&quot;filebeat\&quot;,\&quot;type\&quot;:\&quot;_doc\&quot;,\&quot;version\&quot;:\&quot;7.17.23\&quot;&#125;,\&quot;log\&quot;:&#123;\&quot;offset\&quot;:20478,\&quot;file\&quot;:&#123;\&quot;path\&quot;:\&quot;/opt/access.log\&quot;&#125;&#125;,\&quot;message\&quot;:\&quot;109.110.162.51 - - [04/Oct/2024:10:00:41 +0800] \\\&quot;GET / HTTP/1.1\\\&quot; 304 0 \\\&quot;-\\\&quot; \\\&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1 Edg/129.0.0.0\\\&quot;\&quot;,\&quot;input\&quot;:&#123;\&quot;type\&quot;:\&quot;filestream\&quot;&#125;,\&quot;ecs\&quot;:&#123;\&quot;version\&quot;:\&quot;1.12.0\&quot;&#125;,\&quot;host\&quot;:&#123;\&quot;name\&quot;:\&quot;elk01\&quot;&#125;,\&quot;agent\&quot;:&#123;\&quot;id\&quot;:\&quot;0f020f85-7619-4e85-83ae-346d91b5ca57\&quot;,\&quot;name\&quot;:\&quot;elk01\&quot;,\&quot;type\&quot;:\&quot;filebeat\&quot;,\&quot;version\&quot;:\&quot;7.17.23\&quot;,\&quot;hostname\&quot;:\&quot;elk01\&quot;,\&quot;ephemeral_id\&quot;:\&quot;ed96638d-32ee-4ee0-afbb-504643c3d52a\&quot;&#125;&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030010834508.png" alt="image-20241030010834508"></p><p><strong>3. ä¼˜åŒ–logstash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹messageå­—æ®µè¿›è¡Œjsonæ ¼å¼åŒ–</span></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;message&quot;</span></span><br><span class="line">    <span class="comment">#ç§»é™¤ä¸éœ€è¦çš„å­—æ®µï¼Œä¸ç„¶åƒä¸‹é¢ä¸€æ ·å‡ºç°å¾ˆå¤šæ²¡æœ‰ä»·å€¼çš„å­—æ®µ</span></span><br><span class="line">   <span class="comment"># remove_field =&gt; [ &quot;input&quot;,&quot;host&quot;,&quot;agent&quot;,&quot;@version&quot;,&quot;log&quot;, &quot;ecs&quot; ]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºç»“æœå±•ç¤º</span></span><br><span class="line"></span><br><span class="line">         <span class="string">&quot;agent&quot;</span> =&gt; &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span>,</span><br><span class="line">             <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;7.17.23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ephemeral_id&quot;</span> =&gt; <span class="string">&quot;9a1e6795-8fe4-476b-ba6b-9d91b41f282c&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;id&quot;</span> =&gt; <span class="string">&quot;1b86f9d4-c41a-4c30-8b3c-c921ed07d026&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">         <span class="string">&quot;input&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filestream&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T16:40:45.156Z,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;elk01&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="string">&quot;ecs&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;1.12.0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="string">&quot;log&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;offset&quot;</span> =&gt; 27088,</span><br><span class="line">          <span class="string">&quot;file&quot;</span> =&gt; &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;/opt/access.log&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#ç§»é™¤å­—æ®µåå±•ç¤º</span></span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2024-10-29T16:40:45.156Z,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;150.109.253.34 - - [04/Oct/2024:10:01:27 +0800] \&quot;GET /app HTTP/1.1\&quot; 404 197 \&quot;-\&quot; \&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36 Edg/129.0.0.0\&quot;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>4. æ­£å¸¸æ“ä½œä¼˜åŒ–,å¹¶è¾“å‡ºåˆ°esé›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:0 ~]# <span class="built_in">cat</span> /etc/logstash/conf.d/17-kafka-to-logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    <span class="comment"># æŒ‡å®škafkaé›†ç¾¤çš„åœ°å€</span></span><br><span class="line">    bootstrap_servers =&gt; <span class="string">&quot;10.0.0.211:9092,10.0.0.212:9092,10.0.0.213:9092&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®štopicåˆ—è¡¨</span></span><br><span class="line">    topics =&gt; [<span class="string">&quot;linux-study&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„  (æ¯æ¬¡å¯åŠ¨logstashï¼Œéƒ½éœ€è¦æ¢ä¸ªç»„ï¼Œå› ä¸ºåŒä¸€ä¸ªç»„çš„é‡‡é›†äº†ä¸ä¼šå†æ¬¡é‡‡é›†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ª)</span></span><br><span class="line">    group_id =&gt; [<span class="string">&quot;filebeat01&quot;</span>]</span><br><span class="line">    <span class="comment"># æŒ‡å®šä»offsetå¼€å§‹è¯»å–æ•°æ®çš„ä½ç½®ï¼Œearliestè¡¨ç¤ºæœ€æ—©çš„æ•°æ®å¼€å§‹è¯»ï¼Œlatestè¡¨ç¤ºä»æœ€æ–°çš„ä½ç½®è¯»å–ã€‚</span></span><br><span class="line">    auto_offset_reset =&gt; <span class="string">&quot;earliest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹messageå­—æ®µè¿›è¡Œjsonæ ¼å¼åŒ–</span></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;message&quot;</span></span><br><span class="line">    <span class="comment">#ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">    remove_field =&gt; [ <span class="string">&quot;input&quot;</span>,<span class="string">&quot;host&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;@version&quot;</span>,<span class="string">&quot;log&quot;</span>, <span class="string">&quot;ecs&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># åŸºäºæ­£åˆ™åŒ¹é…ä»»æ„æ–‡æœ¬ï¼Œgrokå†…ç½®äº†120ç§åŒ¹é…æ¨¡å¼</span></span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;HTTPD_COMBINEDLOG&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  useragent &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;agent&quot;</span></span><br><span class="line">    target =&gt; <span class="string">&quot;agent-kind&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  geoip &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">&quot;clientip&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">date</span> &#123;</span><br><span class="line">    match =&gt; [ <span class="string">&quot;timestamp&quot;</span>, <span class="string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  elasticsearch&#123;</span><br><span class="line">     hosts =&gt; [<span class="string">&quot;10.0.0.211:9200&quot;</span>,<span class="string">&quot;10.0.0.212:9200&quot;</span>,<span class="string">&quot;10.0.0.213:9200&quot;</span>]</span><br><span class="line">     index =&gt; <span class="string">&quot;kafka-elk-%&#123;+yyyy.MM.dd&#125;&quot;</span></span><br><span class="line">     user =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">     password =&gt; <span class="string">&quot;123456&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cos.lukme.top/Pic/image-20241030013045764.png" alt="image-20241030013045764"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†åŸºäºELFKæ¶æ„+kafkaæ”¶é›†æ—¥å¿—å¤„ç†</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>13.ä½¿ç”¨supervisorç®¡ç†æœåŠ¡</title>
    <link href="https://lukme.top/posts/1267bcfa.html"/>
    <id>https://lukme.top/posts/1267bcfa.html</id>
    <published>2024-10-30T02:45:01.000Z</published>
    <updated>2024-10-30T04:02:43.037Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨supervisorç®¡ç†æœåŠ¡">ä½¿ç”¨supervisorç®¡ç†æœåŠ¡</h2><p><strong>1. ä¸‹è½½supervisor</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]#  apt -y install supervisor</span><br></pre></td></tr></table></figure><p><strong>2. å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk02:0 ~]#  systemctl start supervisor</span><br><span class="line">[root@elk02:0 ~]#  systemctl <span class="built_in">enable</span> supervisor</span><br></pre></td></tr></table></figure><p><strong>3.ä¿®æ”¹supervisoré…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# vim /etc/supervisor/supervisord.conf</span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># ä»¥åéœ€è¦é…ç½®çš„æœåŠ¡åªéœ€è¦æ”¾åœ¨/etc/supervisor/ä¸‹ï¼Œä»¥.iniç»“å°¾çš„éƒ½å¯è¢«supervisorç®¡ç†</span></span><br><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/*.ini</span><br></pre></td></tr></table></figure><p><strong>4.ç¼–è¾‘inié…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# <span class="built_in">cat</span> /etc/supervisor/zk.ini </span><br><span class="line">[program:zookeeper]</span><br><span class="line"><span class="built_in">command</span>=/app/zookeeper/bin/zkServer.sh start-foreground</span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stderr_logfile=/var/log/zookeeper.err.log</span><br><span class="line">stdout_logfile=/var/log/zookeeper.out.log</span><br><span class="line">user=root</span><br><span class="line">priority=1</span><br><span class="line">environment=JAVA_HOME=<span class="string">&quot;/usr/share/elasticsearch/jdk/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ä¿®æ”¹zookeeperçš„å®‰è£…è·¯å¾„ï¼Œä»¥åŠjavahomeè·¯å¾„   ï¼ˆä½¿ç”¨  echo $JAVA_HOME æŸ¥çœ‹javaç¯å¢ƒ ï¼‰</span></span><br><span class="line">[root@elk01:2 ~]# <span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br><span class="line">/usr/share/elasticsearch/jdk</span><br></pre></td></tr></table></figure><p><strong>5. æ›´æ–°supervisoré…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:2 ~]# supervisorctl update</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šæ¯æ¬¡è·Ÿæ–°æœåŠ¡é…ç½®éƒ½éœ€è¦update</span><br></pre></td></tr></table></figure><p><strong>6.supervisorç®¡ç†å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl start zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl stop zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æˆ–è€…åœæ­¢æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">[root@elk01:2 ~]# supervisorctl start/stop all</span><br><span class="line"></span><br><span class="line">å‹æƒ…æç¤ºï¼š</span><br><span class="line">  å¦‚æœä½ çš„zookeeperæ˜¯ä½¿ç”¨zkServer.sh start å¯åŠ¨çš„ï¼Œè¦å…ˆä½¿ç”¨zkServer.sh stopå…³é—­æœåŠ¡ï¼Œä¸èƒ½ä½¿ç”¨zkServerå¯åŠ¨æœåŠ¡ï¼Œä½¿ç”¨supervisorå»å…³é—­æœåŠ¡</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†ä½¿ç”¨supervisorç»Ÿä¸€ç®¡ç†zookeeperå’Œkafkaï¼Œç›¸æ¯”systemdç®¡ç†æ›´åŠ æ–¹ä¾¿</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>12.kafkaçš„è„šæœ¬ç®¡ç†åŠæ•°æ®å»¶è¿Ÿã€ä¸¢å¤±åˆ†æ</title>
    <link href="https://lukme.top/posts/70dc5443.html"/>
    <id>https://lukme.top/posts/70dc5443.html</id>
    <published>2024-10-30T02:44:01.000Z</published>
    <updated>2024-10-30T04:02:38.055Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kafkaçš„è„šæœ¬ç®¡ç†">kafkaçš„è„šæœ¬ç®¡ç†</h2><h3 id="topicç®¡ç†">topicç®¡ç†</h3><p><strong>1.æŸ¥çœ‹topicåˆ—è¡¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --list </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>**2.åˆ›å»ºtopic **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic luay.</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Šï¼š</span></span><br><span class="line">--topic  luay           <span class="comment">#æŒ‡å®štopicä¸ºluay</span></span><br><span class="line">--partitions 3          <span class="comment">#åˆ›å»º3ä¸ªåˆ†åŒº</span></span><br><span class="line">--replication-factor 2  <span class="comment">#åˆ›å»º2ä¸ªå‰¯æœ¬</span></span><br><span class="line">--create                <span class="comment">#åŠ¨ä½œ--åˆ›å»º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶å®ƒé€‰é¡¹</span></span><br><span class="line">--delete                <span class="comment">#åˆ é™¤</span></span><br><span class="line">--alter                 <span class="comment">#ä¿®æ”¹</span></span><br><span class="line">--describe              <span class="comment">#è¾“å‡ºè¯¦ç»†ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029180717295.png" alt="image-20241029180717295"></p><p><strong>3.ä¿®æ”¹åˆ†åŒºæ•°é‡ã€åªèƒ½ç”±å°å˜å¤§ï¼Œä¸èƒ½ç”±å¤§å˜å°ã€‘</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --partitions 5 --alter</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029180957289.png" alt="image-20241029180957289"></p><p><strong>4.æŸ¥çœ‹æŒ‡å®štopicçš„è¯¦ç»†ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --describe</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029181157071.png" alt="image-20241029181157071"></p><p><strong>5.åˆ é™¤topic</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:1 ~]# kafka-topics.sh kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic luay --delete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#kafkaæ•°æ®ç›®å½•é‡Œtopicä¼šè¢«æ ‡è®°-deleteï¼Œç­‰å¾…ä¸€ä¼šä¾¿ä¼šè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">[root@elk01:1 ~]# ll /app/data/kafka/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 29 18:15 luay-1.2baa4b610f314befbfbed58aaad84052-delete/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 29 18:15 luay-2.0f44f4821a1849ccb7e0e37e1fe65ff4-delete/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="producerç®¡ç†">producerç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt;999999</span><br><span class="line">[2024-10-29 20:49:30,357] WARN [Producer clientId=console-producer] Error <span class="keyword">while</span> fetching metadata with correlation <span class="built_in">id</span> 7 : &#123;<span class="built_in">test</span>=LEADER_NOT_AVAILABLE&#125; (org.apache.kafka.clients.NetworkClient)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é¦–æ¬¡å†™å…¥æ—¶ï¼Œè‹¥topicä¸å­˜åœ¨ï¼Œåˆ™kafkaé›†ç¾¤é»˜è®¤ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line">[root@elk02:1 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --list</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="kafkaçš„consumerç®¡ç†">kafkaçš„consumerç®¡ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt;12112112</span><br><span class="line">&gt;666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯---æ¥æ”¶ç°åœ¨å¼€å§‹çš„æ¶ˆæ¯</span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span></span><br><span class="line">666666</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯---ä»å¤´æ¥æ”¶æ¶ˆæ¯    --from-beginning </span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic <span class="built_in">test</span> --from-beginning </span><br><span class="line">999999</span><br><span class="line">12112112</span><br><span class="line">666666</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…ç»„ç†å¿µ">æ¶ˆè´¹è€…ç»„ç†å¿µ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- kafkaçš„æ¶ˆè´¹è€…ç»„æ¦‚å¿µ</span><br><span class="line">1.kafkaçš„offsetå­˜å‚¨ä½ç½®</span><br><span class="line">kafkaæ—©æœŸç‰ˆæœ¬ 0.9-ç‰ˆæœ¬ï¼Œoffsetè®°å½•å­˜å‚¨åœ¨zookeeperé›†ç¾¤ã€‚</span><br><span class="line">ä»kafka 0.10+ç‰ˆæœ¬ï¼Œé»˜è®¤çš„offsetå­˜å‚¨åœ¨kafkaé›†ç¾¤ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<span class="string">&quot;__consumer_offsets&quot;</span>å†…ç½®çš„topicã€‚(å½“æ¶ˆè´¹è€…å‡ºç°å®•æœºï¼Œå½“å‰å½“å‰ç»„é‡Œçš„å…¶å®ƒæ¶ˆè´¹è€…ä¼šä»_consumer_offsetsè®°å½•çš„åç§»é‡é‡Œï¼Œæ‰¾åˆ°å·²ç»å–åˆ°å“ªé‡Œçš„æ•°æ®ï¼Œä»æ­¤ç‚¹ç»§ç»­å¾€åå–æ•°æ®ï¼Œè€Œä¸æ˜¯ä»æ–°å–æ‰€æœ‰æ•°æ®ï¼Œé¿å…æ•°æ®é‡å¤é‡‡é›†)</span><br><span class="line"></span><br><span class="line">2.ç›¸å…³æœ¯è¯­</span><br><span class="line">consumer groupï¼š    æ¶ˆè´¹è€…ç»„ï¼Œä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½éš¶å±äºä¸€ä¸ªæ¶ˆè´¹è€…ç»„ã€‚</span><br><span class="line"></span><br><span class="line">1.è€Œ<span class="string">&quot;__consumer_offsets&quot;</span>å†…ç½®çš„topicè®°å½•çš„åç§»é‡å¹¶ä¸å±äºæŸä¸ªæ¶ˆè´¹è€…ï¼Œè€Œæ˜¯åŸºäºæ¶ˆè´¹è€…è¿›è¡Œè®°å½•çš„ã€‚</span><br><span class="line">2.å½“æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘é‡å¹³è¡¡(Rebalance);</span><br><span class="line">  1.æ¯”å¦‚æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…ï¼ˆC1/C2ï¼‰æ–°å¢æˆ–è€…ä¸‹çº¿ï¼Œæ‰€è°“çš„é‡å¹³è¡¡æŒ‡çš„æ˜¯è¯¥æ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…é‡æ–°åˆ†é…åˆ†åŒºï¼ˆ0åˆ†åŒº,1åˆ†åŒº,2åˆ†åŒºè¿‡ç¨‹ã€‚</span><br><span class="line">  2.è¯¥æ¶ˆè´¹è€…ç»„è‹¥æ–°å¢äº†æ¶ˆè´¹è€…ï¼Œä¹Ÿä¼šè§¦å‘é‡å¹³è¡¡;</span><br><span class="line">  3.å½“æ¶ˆè´¹è€…ç»„çš„æ•°é‡å¤šä½™partitionæ•°é‡æ—¶ï¼Œåˆ™ä¼šå¯¼è‡´è¯¥æ¶ˆè´¹è€…ç»„æœ‰ç©ºé—²çš„æ¶ˆè´¹è€…;ï¼ˆå‡è®¾5ä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯åªæœ‰3ä¸ªåˆ†åŒº)</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/consumer_group.png" alt="consumer_group"></p><h2 id="kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ">kafkaæ¶ˆè´¹è€…ç»„æ•°æ®å»¶è¿Ÿåˆ†æ</h2><p>ç”±å›¾è§£ï¼Œkafkaçš„æ¶ˆè´¹è€…æ˜¯logstashï¼Œæ€ä¹ˆä¼šå‡ºç°æ•°æ®å»¶è¿Ÿå‘¢ï¼Ÿ</p><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/ElasticStack_MQ.png" alt="ElasticStack_MQ"></p><blockquote><p>å½“ç”Ÿäº§è€…è¿‡å¤šï¼Œlogstashå¿™ä¸è¿‡æ¥æ—¶å€™æ”¶é›†ï¼Œå°±ä¼šå‡ºç°æ•°æ®å»¶è¿Ÿå¯èƒ½</p></blockquote><p>ç†è®ºå­˜åœ¨ï¼Œåˆ†æå®è·µ</p><p><strong>1. æŸ¥çœ‹ç°æœ‰çš„æ¶ˆè´¹è€…ç»„åˆ—è¡¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --list</span><br><span class="line">console-consumer-10558</span><br><span class="line">console-consumer-73547</span><br><span class="line">console-consumer-4558</span><br></pre></td></tr></table></figure><p><strong>2.åˆ›å»ºtopicæŒ‡å®šåˆ†åŒºå’Œå‰¯æœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk03:0 ~]# kafka-topics.sh --bootstrap-server 10.0.0.211:9092 --topic new --partitions 3 --replication-factor 2 --create</span><br><span class="line">Created topic new.</span><br></pre></td></tr></table></figure><p><strong>3.å¯åŠ¨ç”Ÿäº§è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999</span><br></pre></td></tr></table></figure><p><strong>4.å¯åŠ¨æ¶ˆè´¹è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. å¯åŠ¨ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ŒæŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">[root@elk01:4 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic new --from-beginning --group dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹æ¶ˆè´¹è€…åˆ—è¡¨</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --list</span><br><span class="line">dev</span><br><span class="line">console-consumer-10558</span><br><span class="line">console-consumer-73547</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹æŒ‡å®šæ¶ˆè´¹è€…çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --group dev --describe</span><br><span class="line">GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG</span><br><span class="line">dev             new             0          0               0               0  </span><br><span class="line">dev             new             1          0               0               0  </span><br><span class="line">dev             new             2          1               0               0  </span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029224849054.png" alt="image-20241029224849054"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.ç”Ÿäº§è€…ç»§ç»­å†™å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999999</span><br><span class="line">&gt;aaaaaaaa</span><br><span class="line">&gt;vbbbbbb</span><br><span class="line">&gt;ccccc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å¯åŠ¨æ–°çš„æ¶ˆè´¹è€…</span></span><br><span class="line">[root@elk02:1 ~]# kafka-console-consumer.sh --bootstrap-server 10.0.0.211:9092 --topic new --from-beginning --group dev</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶æ²¡æœ‰æ–°çš„æ•°æ®ï¼Œå› ä¸ºè¢«åŒä¸€ä¸ªç»„ï¼ˆdevï¼‰çš„ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…å·²ç»é‡‡é›†è¿‡äº†</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. å†™å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;999999999</span><br><span class="line">&gt;aaaaaaaa</span><br><span class="line">&gt;vbbbbbb</span><br><span class="line">&gt;ccccc</span><br><span class="line">&gt;9999999999</span><br><span class="line">&gt;69696969696</span><br></pre></td></tr></table></figure><p><strong>åœæ­¢æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œåªå†™å…¥æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01:5 ~]# kafka-console-producer.sh --bootstrap-server 10.0.0.211:9092 --topic new</span><br><span class="line">&gt;h</span><br><span class="line">&gt;h</span><br><span class="line">&gt;asasasasasasas</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹è¯¦ç»†æ•°æ®</span></span><br><span class="line">[root@elk03:0 ~]# kafka-consumer-groups.sh --bootstrap-server  10.0.0.211:9092 --group dev --describe</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20241029230457830.png" alt="image-20241029230457830"></p><h2 id="kafkaæ•°æ®ä¸¢å¤±åˆ†æ">kafkaæ•°æ®ä¸¢å¤±åˆ†æ</h2><blockquote><p>è§å›¾è§£</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kafkaçš„ISRåˆ—è¡¨å¯¼è‡´æ•°æ®ä¸¢å¤±çš„åŸå› ï¼š</span><br><span class="line">ISR:</span><br><span class="line">å’Œleaderå‰¯æœ¬åŒæ­¥çš„æ‰€æœ‰å‰¯æœ¬é›†åˆã€‚</span><br><span class="line">OSR:</span><br><span class="line">å’Œleaderå‰¯æœ¬ä¸åŒæ­¥æ‰€æœ‰å‰¯æœ¬é›†åˆã€‚</span><br><span class="line">AR:</span><br><span class="line">æ‰€æœ‰å‰¯æœ¬ï¼ŒæŒ‡çš„æ˜¯leader  + followerï¼Œå³AR = ISR + OSR </span><br><span class="line">LEO:</span><br><span class="line">è‹±æ–‡å…¨ç§°ä¸º: LOG-END-OFFSETï¼Œè¡¨ç¤ºæ¯ä¸ªpartitionæœ€åä¸€ä¸ªOffsetã€‚</span><br><span class="line">HW:</span><br><span class="line">è¡¨ç¤ºåœ¨ISRåˆ—è¡¨ä¸­æ‰€æœ‰LEOä¸­æœ€å°çš„LEOã€‚</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/kafka-ISR.png" alt="kafka-ISR"></p>]]></content>
    
    
    <summary type="html">æœ¬ç« ä»‹ç»äº†Kafkaçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¦‚ä½•å‘èµ·æ•°æ®å’Œæ”¶é›†æ•°æ®ï¼Œå¹¶ä¸”åˆ†ææ•°æ®å»¶è¿Ÿ</summary>
    
    
    
    <category term="ELKæ—¥å¿—æ”¶é›†" scheme="https://lukme.top/categories/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="ELK" scheme="https://lukme.top/tags/ELK/"/>
    
  </entry>
  
</feed>
